/*! head.load - v1.0.3 */
!function(e,t){"use strict";function r(){}function n(e,t){if(e){"object"==typeof e&&(e=[].slice.call(e));for(var r=0,n=e.length;r<n;r++)t.call(e,e[r],r)}}function i(e,r){var n=Object.prototype.toString.call(r).slice(8,-1);return r!==t&&null!==r&&n===e}function o(e){return i("Function",e)}function a(e){return i("Array",e)}function s(e){var t=e.split("/"),r=t[t.length-1],n=r.indexOf("?");return-1!==n?r.substring(0,n):r}function l(e){(e=e||r)._done||(e(),e._done=1)}function c(e){var t,r,n={};if("object"==typeof e)for(t in e)!e[t]||(n={name:t,url:e[t]});else n={name:s(e),url:e};return(r=S[n.name])&&r.url===n.url?r:(S[n.name]=n,n)}function d(e){for(var t in e=e||S)if(e.hasOwnProperty(t)&&e[t].state!==R)return!1;return!0}function u(e){e.state===t&&(e.state=T,e.onpreload=[],p({url:e.url,type:"cache"},(function(){!function(e){e.state=E,n(e.onpreload,(function(e){e.call()}))}(e)})))}function f(e,t){t=t||r,e.state!==R?e.state!==A?e.state!==T?(e.state=A,p(e,(function(){e.state=R,t(),n(k[e.name],(function(e){l(e)})),_&&d()&&n(k.ALL,(function(e){l(e)}))}))):e.onpreload.push((function(){f(e,t)})):C.ready(e.name,t):t()}function p(t,n){function i(t){t=t||e.event,a.onload=a.onreadystatechange=a.onerror=null,n()}function o(r){("load"===(r=r||e.event).type||/loaded|complete/.test(a.readyState)&&(!y.documentMode||y.documentMode<9))&&(e.clearTimeout(t.errorTimeout),e.clearTimeout(t.cssTimeout),a.onload=a.onreadystatechange=a.onerror=null,n())}var a,s;n=n||r,"css"===function(e){var t=(e=e||"").split("?")[0].split(".");return t[t.length-1].toLowerCase()}(t.url)?((a=y.createElement("link")).type="text/"+(t.type||"css"),a.rel="stylesheet",a.href=t.url,t.cssRetries=0,t.cssTimeout=e.setTimeout((function r(){if(t.state!==R&&t.cssRetries<=20){for(var n=0,i=y.styleSheets.length;n<i;n++)if(y.styleSheets[n].href===a.href)return void o({type:"load"});t.cssRetries++,t.cssTimeout=e.setTimeout(r,250)}}),500)):((a=y.createElement("script")).type="text/"+(t.type||"javascript"),a.src=t.url),a.onload=a.onreadystatechange=o,a.onerror=i,a.async=!1,a.defer=!1,t.errorTimeout=e.setTimeout((function(){i({type:"timeout"})}),7e3),(s=y.head||y.getElementsByTagName("head")[0]).insertBefore(a,s.lastChild)}function g(){if(!y.body)return e.clearTimeout(C.readyTimeout),void(C.readyTimeout=e.setTimeout(g,50));_||(_=!0,function(){for(var e,t=y.getElementsByTagName("script"),r=0,n=t.length;r<n;r++)if(e=t[r].getAttribute("data-headjs-load"))return void C.load(e)}(),n(v,(function(e){l(e)})))}function m(){y.addEventListener?(y.removeEventListener("DOMContentLoaded",m,!1),g()):"complete"===y.readyState&&(y.detachEvent("onreadystatechange",m),g())}var _,h,y=e.document,v=[],k={},S={},b="async"in y.createElement("script")||"MozAppearance"in y.documentElement.style||e.opera,w=e.head_conf&&e.head_conf.head||"head",C=e[w]=e[w]||function(){C.ready.apply(null,arguments)},T=1,E=2,A=3,R=4;if("complete"===y.readyState)g();else if(y.addEventListener)y.addEventListener("DOMContentLoaded",m,!1),e.addEventListener("load",g,!1);else{y.attachEvent("onreadystatechange",m),e.attachEvent("onload",g),h=!1;try{h=!e.frameElement&&y.documentElement}catch(e){}h&&h.doScroll&&function t(){if(!_){try{h.doScroll("left")}catch(r){return e.clearTimeout(C.readyTimeout),void(C.readyTimeout=e.setTimeout(t,50))}g()}}()}C.load=C.js=b?function(){var e=arguments,t=e[e.length-1],r={};return o(t)||(t=null),a(e[0])?(e[0].push(t),C.load.apply(null,e[0]),C):(n(e,(function(e){e!==t&&(e=c(e),r[e.name]=e)})),n(e,(function(e){e!==t&&f(e=c(e),(function(){d(r)&&l(t)}))})),C)}:function(){var e=arguments,t=e[e.length-1],r=[].slice.call(e,1),i=r[0];return o(t)||(t=null),a(e[0])?(e[0].push(t),C.load.apply(null,e[0]),C):(i?(n(r,(function(e){o(e)||!e||u(c(e))})),f(c(e[0]),o(i)?i:function(){C.load.apply(null,r)})):f(c(e[0])),C)},C.test=function(e,t,n,i){var o="object"==typeof e?e:{test:e,success:!!t&&(a(t)?t:[t]),failure:!!n&&(a(n)?n:[n]),callback:i||r},s=!!o.test;return s&&o.success?(o.success.push(o.callback),C.load.apply(null,o.success)):s||!o.failure?i():(o.failure.push(o.callback),C.load.apply(null,o.failure)),C},C.ready=function(e,t){var r,i,s;return e===y?(_?l(t):v.push(t),C):(o(e)&&(t=e,e="ALL"),a(e)?(r={},n(e,(function(e){r[e]=S[e],C.ready(e,(function(){d(r)&&l(t)}))})),C):"string"==typeof e&&o(t)?(i=S[e])&&i.state===R||"ALL"===e&&d()&&_?(l(t),C):((s=k[e])?s.push(t):s=k[e]=[t],C):C)},C.ready(y,(function(){d()&&n(k.ALL,(function(e){l(e)})),C.feature&&C.feature("domloaded",!0)}))}(window),function(e){
/**
 * This script gives you the zone info key representing your device's time zone setting.
 *
 * @name jsTimezoneDetect
 * @version 1.0.6
 * @author Jon Nylander
 * @license MIT License - https://bitbucket.org/pellepim/jstimezonedetect/src/default/LICENCE.txt
 *
 * For usage and examples, visit:
 * http://pellepim.bitbucket.org/jstz/
 *
 * Copyright (c) Jon Nylander
 */
var t=function(){"use strict";var e={DAY:864e5,HOUR:36e5,MINUTE:6e4,SECOND:1e3,BASELINE_YEAR:2014,MAX_SCORE:864e6,AMBIGUITIES:{"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":["Asia/Amman","Asia/Jerusalem","Europe/Helsinki","Asia/Damascus","Africa/Cairo","Asia/Gaza","Europe/Minsk"],"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk","Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]}},r=function(e){var t=-e.getTimezoneOffset();return null!==t?t:0},n=function(e){for(var t=new Date(e,0,1,0,0,1,0).getTime(),r=new Date(e,12,31,23,59,59).getTime(),n=t,o=new Date(n).getTimezoneOffset(),a=null,s=null;n<r-864e5;){var l=new Date(n),c=l.getTimezoneOffset();c!==o&&(c<o&&(a=l),c>o&&(s=l),o=c),n+=864e5}return!(!a||!s)&&{s:i(a).getTime(),e:i(s).getTime()}},i=function t(r,n,i){void 0===n&&(n=e.DAY,i=e.HOUR);for(var o=new Date(r.getTime()-n).getTime(),a=r.getTime()+n,s=new Date(o).getTimezoneOffset(),l=o,c=null;l<a-i;){var d=new Date(l);if(d.getTimezoneOffset()!==s){c=d;break}l+=i}return n===e.DAY?t(c,e.HOUR,e.MINUTE):n===e.HOUR?t(c,e.MINUTE,e.SECOND):c},o=function(r){var i=function(){for(var e=[],r=0;r<t.olson.dst_rules.years.length;r++){var i=n(t.olson.dst_rules.years[r]);e.push(i)}return e}();return function(e){for(var t=0;t<e.length;t++)if(!1!==e[t])return!0;return!1}(i)?function(r,n){for(var i=function(t){for(var i=0,o=0;o<r.length;o++)if(t.rules[o]&&r[o]){if(!(r[o].s>=t.rules[o].s&&r[o].e<=t.rules[o].e)){i="N/A";break}if(i=0,i+=Math.abs(r[o].s-t.rules[o].s),(i+=Math.abs(t.rules[o].e-r[o].e))>e.MAX_SCORE){i="N/A";break}}return function(e,t,r,n){if("N/A"!==r)return r;if("Asia/Beirut"===t){if("Africa/Cairo"===n.name&&13983768e5===e[6].s&&14116788e5===e[6].e)return 0;if("Asia/Jerusalem"===n.name&&13959648e5===e[6].s&&14118588e5===e[6].e)return 0}else if("America/Santiago"===t){if("America/Asuncion"===n.name&&14124816e5===e[6].s&&1397358e6===e[6].e)return 0;if("America/Campo_Grande"===n.name&&14136912e5===e[6].s&&13925196e5===e[6].e)return 0}else if("America/Montevideo"===t){if("America/Sao_Paulo"===n.name&&14136876e5===e[6].s&&1392516e6===e[6].e)return 0}else if("Pacific/Auckland"===t&&"Pacific/Fiji"===n.name&&14142456e5===e[6].s&&13961016e5===e[6].e)return 0;return r}(r,n,i,t)},o={},a=t.olson.dst_rules.zones,s=a.length,l=e.AMBIGUITIES[n],c=0;c<s;c++){var d=a[c],u=i(a[c]);"N/A"!==u&&(o[d.name]=u)}for(var f in o)if(o.hasOwnProperty(f))for(var p=0;p<l.length;p++)if(l[p]===f)return f;return n}(i,r):r};return{determine:function(){var n,i,a,s=function(){var e,t;if("undefined"!=typeof Intl&&void 0!==Intl.DateTimeFormat&&void 0!==(e=Intl.DateTimeFormat())&&void 0!==e.resolvedOptions)return(t=e.resolvedOptions().timeZone)&&(t.indexOf("/")>-1||"UTC"===t)?t:void 0}();return s||(s=t.olson.timezones[(n=r(new Date(e.BASELINE_YEAR,0,2)),i=r(new Date(e.BASELINE_YEAR,5,2)),a=n-i,a<0?n+",1":a>0?i+",1,s":n+",0")],void 0!==e.AMBIGUITIES[s]&&(s=o(s))),{name:function(){return s}}}}}();t.olson=t.olson||{},t.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},t.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572e5,s:12090744e5},{e:1250802e6,s:1240524e6},{e:12858804e5,s:12840696e5},!1,!1,!1,{e:14116788e5,s:1406844e6}]},{name:"Africa/Casablanca",rules:[{e:12202236e5,s:12122784e5},{e:12508092e5,s:12438144e5},{e:1281222e6,s:12727584e5},{e:13120668e5,s:13017888e5},{e:13489704e5,s:1345428e6},{e:13828392e5,s:13761e8},{e:14142888e5,s:14069448e5}]},{name:"America/Asuncion",rules:[{e:12050316e5,s:12243888e5},{e:12364812e5,s:12558384e5},{e:12709548e5,s:12860784e5},{e:13024044e5,s:1317528e6},{e:1333854e6,s:13495824e5},{e:1364094e6,s:1381032e6},{e:13955436e5,s:14124816e5}]},{name:"America/Campo_Grande",rules:[{e:12032172e5,s:12243888e5},{e:12346668e5,s:12558384e5},{e:12667212e5,s:1287288e6},{e:12981708e5,s:13187376e5},{e:13302252e5,s:1350792e6},{e:136107e7,s:13822416e5},{e:13925196e5,s:14136912e5}]},{name:"America/Goose_Bay",rules:[{e:122559486e4,s:120503526e4},{e:125704446e4,s:123648486e4},{e:128909886e4,s:126853926e4},{e:13205556e5,s:129998886e4},{e:13520052e5,s:13314456e5},{e:13834548e5,s:13628952e5},{e:14149044e5,s:13943448e5}]},{name:"America/Havana",rules:[{e:12249972e5,s:12056436e5},{e:12564468e5,s:12364884e5},{e:12885012e5,s:12685428e5},{e:13211604e5,s:13005972e5},{e:13520052e5,s:13332564e5},{e:13834548e5,s:13628916e5},{e:14149044e5,s:13943412e5}]},{name:"America/Mazatlan",rules:[{e:1225008e6,s:12074724e5},{e:12564576e5,s:1238922e6},{e:1288512e6,s:12703716e5},{e:13199616e5,s:13018212e5},{e:13514112e5,s:13332708e5},{e:13828608e5,s:13653252e5},{e:14143104e5,s:13967748e5}]},{name:"America/Mexico_City",rules:[{e:12250044e5,s:12074688e5},{e:1256454e6,s:12389184e5},{e:12885084e5,s:1270368e6},{e:1319958e6,s:13018176e5},{e:13514076e5,s:13332672e5},{e:13828572e5,s:13653216e5},{e:14143068e5,s:13967712e5}]},{name:"America/Miquelon",rules:[{e:12255984e5,s:12050388e5},{e:1257048e6,s:12364884e5},{e:12891024e5,s:12685428e5},{e:1320552e6,s:12999924e5},{e:13520016e5,s:1331442e6},{e:13834512e5,s:13628916e5},{e:14149008e5,s:13943412e5}]},{name:"America/Santa_Isabel",rules:[{e:12250116e5,s:1207476e6},{e:12564612e5,s:12389256e5},{e:12885156e5,s:12703752e5},{e:13199652e5,s:13018248e5},{e:13514148e5,s:13332744e5},{e:13828644e5,s:13653288e5},{e:1414314e6,s:13967784e5}]},{name:"America/Santiago",rules:[{e:1206846e6,s:1223784e6},{e:1237086e6,s:12552336e5},{e:127035e7,s:12866832e5},{e:13048236e5,s:13138992e5},{e:13356684e5,s:13465584e5},{e:1367118e6,s:13786128e5},{e:13985676e5,s:14100624e5}]},{name:"America/Sao_Paulo",rules:[{e:12032136e5,s:12243852e5},{e:12346632e5,s:12558348e5},{e:12667176e5,s:12872844e5},{e:12981672e5,s:1318734e6},{e:13302216e5,s:13507884e5},{e:13610664e5,s:1382238e6},{e:1392516e6,s:14136876e5}]},{name:"Asia/Amman",rules:[{e:1225404e6,s:12066552e5},{e:12568536e5,s:12381048e5},{e:12883032e5,s:12695544e5},{e:13197528e5,s:13016088e5},!1,!1,{e:14147064e5,s:13959576e5}]},{name:"Asia/Damascus",rules:[{e:12254868e5,s:120726e7},{e:125685e7,s:12381048e5},{e:12882996e5,s:12701592e5},{e:13197492e5,s:13016088e5},{e:13511988e5,s:13330584e5},{e:13826484e5,s:1364508e6},{e:14147028e5,s:13959576e5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572e5,s:12066552e5},{e:12520152e5,s:12381048e5},{e:1281474e6,s:126964086e4},{e:1312146e6,s:130160886e4},{e:13481784e5,s:13330584e5},{e:13802292e5,s:1364508e6},{e:1414098e6,s:13959576e5}]},{name:"Asia/Irkutsk",rules:[{e:12249576e5,s:12068136e5},{e:12564072e5,s:12382632e5},{e:12884616e5,s:12697128e5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612e5,s:12066624e5},{e:1254006e6,s:1238112e6},{e:1284246e6,s:12695616e5},{e:131751e7,s:1301616e6},{e:13483548e5,s:13330656e5},{e:13828284e5,s:13645152e5},{e:1414278e6,s:13959648e5}]},{name:"Asia/Kamchatka",rules:[{e:12249432e5,s:12067992e5},{e:12563928e5,s:12382488e5},{e:12884508e5,s:12696984e5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612e5,s:12068172e5},{e:12564108e5,s:12382668e5},{e:12884652e5,s:12697164e5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648e5,s:12068208e5},{e:12564144e5,s:12382704e5},{e:12884688e5,s:126972e7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504e5,s:12068064e5},{e:12564e8,s:1238256e6},{e:12884544e5,s:12697056e5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954e6,s:120681e7},{e:12564036e5,s:12382596e5},{e:1288458e6,s:12697092e5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684e5,s:12068244e5},{e:1256418e6,s:1238274e6},{e:12884724e5,s:12697236e5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972e6,s:1206828e6},{e:12564216e5,s:12382776e5},{e:1288476e6,s:12697272e5},{e:13199256e5,s:13011768e5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076e5,s:12231342e5},{e:12388572e5,s:12545838e5},{e:12703068e5,s:12860334e5},{e:13017564e5,s:1317483e6},{e:1333206e6,s:13495374e5},{e:13652604e5,s:1380987e6},{e:139671e7,s:14124366e5}]},{name:"Australia/Perth",rules:[{e:12068136e5,s:12249576e5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]},{name:"Europe/Minsk",rules:[{e:12249792e5,s:12068352e5},{e:12564288e5,s:12382848e5},{e:12884832e5,s:12697344e5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756e5,s:12068316e5},{e:12564252e5,s:12382812e5},{e:12884796e5,s:12697308e5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528e5,s:13168728e5},{e:13332024e5,s:13489272e5},{e:13652568e5,s:13803768e5},{e:13967064e5,s:14118264e5}]},{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984e5,s:12878424e5},{e:13271544e5,s:1319292e6},{e:1358604e6,s:13507416e5},{e:139005e7,s:1382796e6},{e:14215032e5,s:14148504e5}]},{name:"Europe/London",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]}]},"undefined"!=typeof module&&void 0!==module.exports?module.exports=t:"undefined"!=typeof define&&null!==define&&null!=define.amd?define([],(function(){return t})):window.jstz=t}();var load_time=window.performance.now();function BrowserDetection(e,t,r,n){"use strict";var i=this,o=[{string:"ua",subString:"Edge",identity:"Edge"},{string:"ua",subString:"Edg",identity:"ChromiumEdge"},{string:"ua",subString:"Samsung",identity:"SamsungBrowser"},{string:"ua",subString:"Chrome",identity:"Chrome"},{string:"ua",subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:"ua",subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:"vendor",subString:"iCab",identity:"iCab"},{string:"vendor",subString:"KDE",identity:"Konqueror"},{string:"ua",subString:"Firefox",identity:"Firefox"},{string:"vendor",subString:"Camino",identity:"Camino"},{string:"ua",subString:"Netscape",identity:"Netscape"},{string:"ua",subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:"ua",subString:"Trident",identity:"Explorer",versionSearch:"rv"},{string:"ua",subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:"ua",subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],a=e||navigator.userAgent,s=t||navigator.vendor,l=r||navigator.platform,c=n||navigator.appVersion,d={};function u(e,t){return d.hasOwnProperty(e)||(d[e]=!!t()),d[e]}this.getString=function(e){switch(e){case"ua":return a;case"vendor":return s;case"platform":return l;default:return e}},this.searchString=function(e){var t,r,n;for(t=0;t<e.length;t++)if(r=this.getString(e[t].string),n=e[t].prop,this.versionSearchString=e[t].versionSearch||e[t].identity,r){if(-1!==r.indexOf(e[t].subString))return e[t].identity}else if(n)return e[t].identity},this.searchVersion=function(e){var t=e.indexOf(this.versionSearchString);if(-1!==t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},this.searchOSVersion=function(){var e,t="Intel Mac OS X ",r=a.indexOf(t);return-1===r&&(t="iPhone OS ",r=a.indexOf(t)),-1===r?[99999,0,0]:(e=a.substring(r+t.length,r+t.length+11).replace(/_/g,".").split("."),[parseInt(e[0],10)||99999,parseInt(e[1],10)||0,parseInt(e[2],10)||0])},this.browser=this.searchString(o)||"An unknown browser",this.version=this.searchVersion(a)||this.searchVersion(c)||"an unknown version",this.OS=this.searchString([{string:"platform",subString:"Win",identity:"Windows"},{string:"ua",subString:"iPhone",identity:"iOS"},{string:"ua",subString:"iPad",identity:"iOS"},{string:"ua",subString:"iPod",identity:"iOS"},{string:"ua",subString:"Android",identity:"Android"},{string:"platform",subString:"Mac",identity:"Mac"},{string:"platform",subString:"Linux",identity:"Linux"}])||"an unknown OS";try{this.OSVersion=this.searchOSVersion()}catch(e){this.OSVersion=[99999,0,0]}this.isIE=function(){return"Explorer"===this.browser},this.isIE10=function(){return this.isIE()&&10===this.version},this.isIE11=function(){return this.isIE()&&11===this.version},this.isChrome=function(){return"Chrome"===this.browser||this.isSamsungBrowser()||this.isChromiumEdge()},this.isAndroid=function(){return"Android"===this.OS},this.isAndroidChrome=function(){return this.isChrome()&&(this.isAndroid()||this.supportsTouchEvents())},this.isSamsungBrowser=function(){return"SamsungBrowser"===this.browser},this.isEdge=function(){return"Edge"===this.browser},this.isChromiumEdge=function(){return"ChromiumEdge"===this.browser},this.isFirefox=function(){return"Firefox"===this.browser},this.isSafari=function(){return"Safari"===this.browser},this.isMobileSafari=function(){return this.isSafari()&&this.isMobile()},this.isMac=function(){return"Mac"===this.OS},this.isIOS=function(){return"iOS"===this.OS},this.isWindows=function(){return"Windows"===this.OS},this.getVersion=function(){return this.version},this.isMobile=function(){return this.supportsTouchEvents()||this.isAndroid()||this.isIOS()},this.isDesktop=function(){return!this.isMobile()},this.supportsTouchEvents=function(){return void 0!==document.ontouchstart},this.getPlatform=function(){return navigator.platform},this.isMobileSafariOnIPhone=function(){return this.isMobileSafari()&&"iPhone"===this.getPlatform()},this.supportsPassiveEventListeners=function(){if(void 0!==i.passive_option_supported)return i.passive_option_supported;i.passive_option_supported=!1;try{var e=Object.defineProperty({},"passive",{get:function(){i.passive_option_supported=!0}});window.addEventListener("fake",null,e)}catch(e){}return i.passive_option_supported},i.supportsComplexCSSClipPath=function(){return u("complex_css_clip_path",(function(){var e=document.createElement("div");return e.style.clipPath='path("M 0 0 Z")',"path("===e.style.clipPath.substr(0,5)}))},i.supportsResizeObserver=function(){return u("resize_observer",(function(){return!!window.ResizeObserver}))},i.supportsFontAPI=function(){return u("font_api",(function(){return document.fonts&&window.FontFace}))},i.supportsImageDecoder=function(){return u("image_decoder",(function(){return window.ImageDecoder&&window.fetch&&window.Promise&&window.ReadableStream&&window.ReadableStream.prototype.tee}))}}!function(){var e,t=function(){},r=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],n=r.length,i=window.console=window.console||{};for(window.native_console={};n--;)e=r[n],window.native_console[e]=i[e],i[e]||(i[e]=t)}();var BrowserDetect=new BrowserDetection,diff_match_patch=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;diff_match_patch.Diff=function(e,t){this[0]=e,this[1]=t},diff_match_patch.Diff.prototype.length=2,diff_match_patch.Diff.prototype.toString=function(){return this[0]+","+this[1]},diff_match_patch.prototype.diff_main=function(e,t,r,n){void 0===n&&(n=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var i=n;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[new diff_match_patch.Diff(DIFF_EQUAL,e)]:[];void 0===r&&(r=!0);var o=r,a=this.diff_commonPrefix(e,t),s=e.substring(0,a);e=e.substring(a),t=t.substring(a),a=this.diff_commonSuffix(e,t);var l=e.substring(e.length-a);e=e.substring(0,e.length-a),t=t.substring(0,t.length-a);var c=this.diff_compute_(e,t,o,i);return s&&c.unshift(new diff_match_patch.Diff(DIFF_EQUAL,s)),l&&c.push(new diff_match_patch.Diff(DIFF_EQUAL,l)),this.diff_cleanupMerge(c),c},diff_match_patch.prototype.diff_compute_=function(e,t,r,n){var i;if(!e)return[new diff_match_patch.Diff(DIFF_INSERT,t)];if(!t)return[new diff_match_patch.Diff(DIFF_DELETE,e)];var o=e.length>t.length?e:t,a=e.length>t.length?t:e,s=o.indexOf(a);if(-1!=s)return i=[new diff_match_patch.Diff(DIFF_INSERT,o.substring(0,s)),new diff_match_patch.Diff(DIFF_EQUAL,a),new diff_match_patch.Diff(DIFF_INSERT,o.substring(s+a.length))],e.length>t.length&&(i[0][0]=i[2][0]=DIFF_DELETE),i;if(1==a.length)return[new diff_match_patch.Diff(DIFF_DELETE,e),new diff_match_patch.Diff(DIFF_INSERT,t)];var l=this.diff_halfMatch_(e,t);if(l){var c=l[0],d=l[1],u=l[2],f=l[3],p=l[4],g=this.diff_main(c,u,r,n),m=this.diff_main(d,f,r,n);return g.concat([new diff_match_patch.Diff(DIFF_EQUAL,p)],m)}return r&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,n):this.diff_bisect_(e,t,n)},diff_match_patch.prototype.diff_lineMode_=function(e,t,r){var n=this.diff_linesToChars_(e,t);e=n.chars1,t=n.chars2;var i=n.lineArray,o=this.diff_main(e,t,!1,r);this.diff_charsToLines_(o,i),this.diff_cleanupSemantic(o),o.push(new diff_match_patch.Diff(DIFF_EQUAL,""));for(var a=0,s=0,l=0,c="",d="";a<o.length;){switch(o[a][0]){case DIFF_INSERT:l++,d+=o[a][1];break;case DIFF_DELETE:s++,c+=o[a][1];break;case DIFF_EQUAL:if(s>=1&&l>=1){o.splice(a-s-l,s+l),a=a-s-l;for(var u=this.diff_main(c,d,!1,r),f=u.length-1;f>=0;f--)o.splice(a,0,u[f]);a+=u.length}l=0,s=0,c="",d=""}a++}return o.pop(),o},diff_match_patch.prototype.diff_bisect_=function(e,t,r){for(var n=e.length,i=t.length,o=Math.ceil((n+i)/2),a=o,s=2*o,l=new Array(s),c=new Array(s),d=0;d<s;d++)l[d]=-1,c[d]=-1;l[a+1]=0,c[a+1]=0;for(var u=n-i,f=u%2!=0,p=0,g=0,m=0,_=0,h=0;h<o&&!((new Date).getTime()>r);h++){for(var y=-h+p;y<=h-g;y+=2){for(var v=a+y,k=(T=y==-h||y!=h&&l[v-1]<l[v+1]?l[v+1]:l[v-1]+1)-y;T<n&&k<i&&e.charAt(T)==t.charAt(k);)T++,k++;if(l[v]=T,T>n)g+=2;else if(k>i)p+=2;else if(f){if((w=a+u-y)>=0&&w<s&&-1!=c[w])if(T>=(b=n-c[w]))return this.diff_bisectSplit_(e,t,T,k,r)}}for(var S=-h+m;S<=h-_;S+=2){for(var b,w=a+S,C=(b=S==-h||S!=h&&c[w-1]<c[w+1]?c[w+1]:c[w-1]+1)-S;b<n&&C<i&&e.charAt(n-b-1)==t.charAt(i-C-1);)b++,C++;if(c[w]=b,b>n)_+=2;else if(C>i)m+=2;else if(!f){if((v=a+u-S)>=0&&v<s&&-1!=l[v]){var T;k=a+(T=l[v])-v;if(T>=(b=n-b))return this.diff_bisectSplit_(e,t,T,k,r)}}}}return[new diff_match_patch.Diff(DIFF_DELETE,e),new diff_match_patch.Diff(DIFF_INSERT,t)]},diff_match_patch.prototype.diff_bisectSplit_=function(e,t,r,n,i){var o=e.substring(0,r),a=t.substring(0,n),s=e.substring(r),l=t.substring(n),c=this.diff_main(o,a,!1,i),d=this.diff_main(s,l,!1,i);return c.concat(d)},diff_match_patch.prototype.diff_linesToChars_=function(e,t){var r=[],n={};function i(e){for(var t="",i=0,a=-1,s=r.length;a<e.length-1;){-1==(a=e.indexOf("\n",i))&&(a=e.length-1);var l=e.substring(i,a+1);(n.hasOwnProperty?n.hasOwnProperty(l):void 0!==n[l])?t+=String.fromCharCode(n[l]):(s==o&&(l=e.substring(i),a=e.length),t+=String.fromCharCode(s),n[l]=s,r[s++]=l),i=a+1}return t}r[0]="";var o=4e4,a=i(e);return o=65535,{chars1:a,chars2:i(t),lineArray:r}},diff_match_patch.prototype.diff_charsToLines_=function(e,t){for(var r=0;r<e.length;r++){for(var n=e[r][1],i=[],o=0;o<n.length;o++)i[o]=t[n.charCodeAt(o)];e[r][1]=i.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var r=0,n=Math.min(e.length,t.length),i=n,o=0;r<i;)e.substring(o,i)==t.substring(o,i)?o=r=i:n=i,i=Math.floor((n-r)/2+r);return i},diff_match_patch.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var r=0,n=Math.min(e.length,t.length),i=n,o=0;r<i;)e.substring(e.length-i,e.length-o)==t.substring(t.length-i,t.length-o)?o=r=i:n=i,i=Math.floor((n-r)/2+r);return i},diff_match_patch.prototype.diff_commonOverlap_=function(e,t){var r=e.length,n=t.length;if(0==r||0==n)return 0;r>n?e=e.substring(r-n):r<n&&(t=t.substring(0,r));var i=Math.min(r,n);if(e==t)return i;for(var o=0,a=1;;){var s=e.substring(i-a),l=t.indexOf(s);if(-1==l)return o;a+=l,0!=l&&e.substring(i-a)!=t.substring(0,a)||(o=a,a++)}},diff_match_patch.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var r=e.length>t.length?e:t,n=e.length>t.length?t:e;if(r.length<4||2*n.length<r.length)return null;var i=this;function o(e,t,r){for(var n,o,a,s,l=e.substring(r,r+Math.floor(e.length/4)),c=-1,d="";-1!=(c=t.indexOf(l,c+1));){var u=i.diff_commonPrefix(e.substring(r),t.substring(c)),f=i.diff_commonSuffix(e.substring(0,r),t.substring(0,c));d.length<f+u&&(d=t.substring(c-f,c)+t.substring(c,c+u),n=e.substring(0,r-f),o=e.substring(r+u),a=t.substring(0,c-f),s=t.substring(c+u))}return 2*d.length>=e.length?[n,o,a,s,d]:null}var a,s,l,c,d,u=o(r,n,Math.ceil(r.length/4)),f=o(r,n,Math.ceil(r.length/2));return u||f?(a=f?u&&u[4].length>f[4].length?u:f:u,e.length>t.length?(s=a[0],l=a[1],c=a[2],d=a[3]):(c=a[0],d=a[1],s=a[2],l=a[3]),[s,l,c,d,a[4]]):null},diff_match_patch.prototype.diff_cleanupSemantic=function(e){for(var t=!1,r=[],n=0,i=null,o=0,a=0,s=0,l=0,c=0;o<e.length;)e[o][0]==DIFF_EQUAL?(r[n++]=o,a=l,s=c,l=0,c=0,i=e[o][1]):(e[o][0]==DIFF_INSERT?l+=e[o][1].length:c+=e[o][1].length,i&&i.length<=Math.max(a,s)&&i.length<=Math.max(l,c)&&(e.splice(r[n-1],0,new diff_match_patch.Diff(DIFF_DELETE,i)),e[r[n-1]+1][0]=DIFF_INSERT,n--,o=--n>0?r[n-1]:-1,a=0,s=0,l=0,c=0,i=null,t=!0)),o++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),o=1;o<e.length;){if(e[o-1][0]==DIFF_DELETE&&e[o][0]==DIFF_INSERT){var d=e[o-1][1],u=e[o][1],f=this.diff_commonOverlap_(d,u),p=this.diff_commonOverlap_(u,d);f>=p?(f>=d.length/2||f>=u.length/2)&&(e.splice(o,0,new diff_match_patch.Diff(DIFF_EQUAL,u.substring(0,f))),e[o-1][1]=d.substring(0,d.length-f),e[o+1][1]=u.substring(f),o++):(p>=d.length/2||p>=u.length/2)&&(e.splice(o,0,new diff_match_patch.Diff(DIFF_EQUAL,d.substring(0,p))),e[o-1][0]=DIFF_INSERT,e[o-1][1]=u.substring(0,u.length-p),e[o+1][0]=DIFF_DELETE,e[o+1][1]=d.substring(p),o++),o++}o++}},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var r=e.charAt(e.length-1),n=t.charAt(0),i=r.match(diff_match_patch.nonAlphaNumericRegex_),o=n.match(diff_match_patch.nonAlphaNumericRegex_),a=i&&r.match(diff_match_patch.whitespaceRegex_),s=o&&n.match(diff_match_patch.whitespaceRegex_),l=a&&r.match(diff_match_patch.linebreakRegex_),c=s&&n.match(diff_match_patch.linebreakRegex_),d=l&&e.match(diff_match_patch.blanklineEndRegex_),u=c&&t.match(diff_match_patch.blanklineStartRegex_);return d||u?5:l||c?4:i&&!a&&s?3:a||s?2:i||o?1:0}for(var r=1;r<e.length-1;){if(e[r-1][0]==DIFF_EQUAL&&e[r+1][0]==DIFF_EQUAL){var n=e[r-1][1],i=e[r][1],o=e[r+1][1],a=this.diff_commonSuffix(n,i);if(a){var s=i.substring(i.length-a);n=n.substring(0,n.length-a),i=s+i.substring(0,i.length-a),o=s+o}for(var l=n,c=i,d=o,u=t(n,i)+t(i,o);i.charAt(0)===o.charAt(0);){n+=i.charAt(0),i=i.substring(1)+o.charAt(0),o=o.substring(1);var f=t(n,i)+t(i,o);f>=u&&(u=f,l=n,c=i,d=o)}e[r-1][1]!=l&&(l?e[r-1][1]=l:(e.splice(r-1,1),r--),e[r][1]=c,d?e[r+1][1]=d:(e.splice(r+1,1),r--))}r++}},diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,diff_match_patch.whitespaceRegex_=/\s/,diff_match_patch.linebreakRegex_=/[\r\n]/,diff_match_patch.blanklineEndRegex_=/\n\r?\n$/,diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/,diff_match_patch.prototype.diff_cleanupMerge=function(e){e.push(new diff_match_patch.Diff(DIFF_EQUAL,""));for(var t,r=0,n=0,i=0,o="",a="";r<e.length;)switch(e[r][0]){case DIFF_INSERT:i++,a+=e[r][1],r++;break;case DIFF_DELETE:n++,o+=e[r][1],r++;break;case DIFF_EQUAL:n+i>1?(0!==n&&0!==i&&(0!==(t=this.diff_commonPrefix(a,o))&&(r-n-i>0&&e[r-n-i-1][0]==DIFF_EQUAL?e[r-n-i-1][1]+=a.substring(0,t):(e.splice(0,0,new diff_match_patch.Diff(DIFF_EQUAL,a.substring(0,t))),r++),a=a.substring(t),o=o.substring(t)),0!==(t=this.diff_commonSuffix(a,o))&&(e[r][1]=a.substring(a.length-t)+e[r][1],a=a.substring(0,a.length-t),o=o.substring(0,o.length-t))),r-=n+i,e.splice(r,n+i),o.length&&(e.splice(r,0,new diff_match_patch.Diff(DIFF_DELETE,o)),r++),a.length&&(e.splice(r,0,new diff_match_patch.Diff(DIFF_INSERT,a)),r++),r++):0!==r&&e[r-1][0]==DIFF_EQUAL?(e[r-1][1]+=e[r][1],e.splice(r,1)):r++,i=0,n=0,o="",a=""}""===e[e.length-1][1]&&e.pop();var s=!1;for(r=1;r<e.length-1;)e[r-1][0]==DIFF_EQUAL&&e[r+1][0]==DIFF_EQUAL&&(e[r][1].substring(e[r][1].length-e[r-1][1].length)==e[r-1][1]?(e[r][1]=e[r-1][1]+e[r][1].substring(0,e[r][1].length-e[r-1][1].length),e[r+1][1]=e[r-1][1]+e[r+1][1],e.splice(r-1,1),s=!0):e[r][1].substring(0,e[r+1][1].length)==e[r+1][1]&&(e[r-1][1]+=e[r+1][1],e[r][1]=e[r][1].substring(e[r+1][1].length)+e[r+1][1],e.splice(r+1,1),s=!0)),r++;s&&this.diff_cleanupMerge(e)},this.diff_match_patch=diff_match_patch,this.DIFF_DELETE=DIFF_DELETE,this.DIFF_INSERT=DIFF_INSERT,this.DIFF_EQUAL=DIFF_EQUAL;"use strict";function SoftAssertException(e){this.message=e}function AssertUnimplementedException(e){this.message=e}function reportAssert(e,t){var r=printStackTrace();window.reportClientEvent&&reportClientEvent(e,{stacktrace:r,message:t||"no message given"})}function soft_assert(e,t){if(!e)throw"string"!=typeof t&&(t=JSON.stringify(t)),reportAssert("tc-soft-assert",t),new SoftAssertException(t)}SoftAssertException.prototype.toString=function(){return"SoftAssertException: "+this.message},AssertUnimplementedException.prototype.toString=function(){return"AssertUnimplementedException: "+this.message};var assert_msg_count={};function assert_unimplemented(e,t){window.DEBUG&&(e||("string"!=typeof t&&(t=JSON.stringify(t)),assert_msg_count.hasOwnProperty(t)?assert_msg_count[t]+=1:(assert_msg_count[t]=1,new Logger("assert",{level:"info"}).error({event:"unimplemented",message:t}))))}function Logger(e,t){var r=t.level||"debug",n=this;function i(r,n){var i,o=r;i=function(r){var n,i,o,a=new Date,s=printStackTrace()[5],l={};if(a.setUTCHours((24+a.getUTCHours()-a.getTimezoneOffset()/60)%24),n=a.toISOString().substr(11,12)+" | "+Util.fit_string_in_fixed_len_field(e,12,"..")+" | ",s&&(i=s.indexOf("@"),s=s.slice(0,i),n+=Util.fit_string_in_fixed_len_field(s,22,"")+" | "),t.header&&(l=t.header()),"object"==typeof r)for(o in r)r.hasOwnProperty(o)&&(l[o]=r[o]);else l.detail=r;return n+=JSON.stringify(l,(function(e,t){return Util.is_string(t)?Util.string_shorten(t,4096,"..."):t})),Util.string_shorten(n,8192,"...")}(n),window.console[r]||(o="log"),"debug"===o&&"Explorer"===browser.name&&browser.version<=10&&(o="log");try{window.console[o](i)}catch(e){window.console.log(i)}}function o(e,t){try{i(e,t)}catch(e){try{window.console.log(e)}catch(e){}}}switch(n.debug=n.info=n.warn=function(e){},r){case"debug":DEBUG&&(n.debug=function(e){o("debug",e)});case"info":n.info=function(e){o("info",e)};case"warn":n.warn=function(e){o("warn",e)}}n.error=function(e){o("error",e)}}var Util={};function __randstr(e,t){var r,n,i,o=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],a=window.crypto||window.msCrypto,s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-";for(n="",t&&(r=new window.Uint8Array(e),a.getRandomValues(r)),i=0;i<e;i+=1)n+=t?s[r[i]%s.length]:o[Math.floor(Math.random()*o.length)];return n}function __startswith(e,t){return e.substring(0,t.length)===t}function __endswith(e,t){return e.substring(e.length-t.length)===t}function __object_assign(e,t){var r;if("function"==typeof Object.assign)return Object.assign(e,t);for(var n in r=Object(e),t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r}function assert(e,t){if(!e&&("string"!=typeof t&&(t=JSON.stringify(t)),window.reportAssert&&reportAssert("tc-assert",t),DEBUG))throw new Error(t)}function printStackTrace(e){var t;if(e)t=e.stack.split("\n");else try{throw new Error}catch(e){t=e.stack.split("\n")}return BrowserDetect.isIE()||BrowserDetect.isChrome()?t.slice(1).map((function(e){return e.replace(/^\s*at\s+(.+)\s+\((.+)\)$/gm,"$1@$2").replace(/^\s*at\s+(.*)$/gm,"{anonymous}@$1")})):t}function ParsedURL(e){var t,r,n,i=this;i.protocol="",i.hostname="",i.port="",i.pathname="",i.search="",i.hash="",i.email=!1,i.applink=!1,i.host=function(){return i.hostname?i.hostname+(i.port?":"+i.port:""):""},i.origin=function(){var e=i.host();return e?i.email?"":i.protocol+"//"+e:i.applink?i.protocol:""},i.defrag=function(){var e=i.origin();return(i.email||i.applink)&&""===e&&(e=i.protocol+"/"),e+i.pathname+i.search},i.href=function(){return i.defrag()+i.hash},i.hasHash=function(){return i.hash||"#"===i.defrag().slice(-1)},i.getParam=function(e){return Util.getParamFromSearch(i.search,e)},e&&(BrowserDetect.isIE()&&(__startswith(e,"/")?e=window.location.origin+e:(__startswith(e,"0/")||__startswith(e,"1/"))&&(e="https://"+e)),(t=document.createElement("a")).href=e,i.protocol=t.protocol,i.applink=!("ws:"===i.protocol||"wss:"===i.protocol||"http:"===i.protocol||"https:"===i.protocol),t.port&&("80"!==t.port||"http:"!==i.protocol&&"ws:"!==i.protocol)&&("443"!==t.port||"https:"!==i.protocol&&"wss:"!==i.protocol)?i.port=t.port:i.port="","0.0.0.0"===t.hostname||"0.0.0.1"===t.hostname||__startswith(e,"0/")||__startswith(e,"1/")?(r=__startswith(e,"0/")||__startswith(e,"1/")?0:i.protocol.length+1,-1===(n=e.indexOf("?"))&&(n=e.indexOf("#")),-1===n&&(n=e.length),i.email=!0,i.hostname="",i.pathname=e.slice(r,n)):(i.email=!1,i.hostname=t.hostname,i.pathname=t.pathname),i.applink||""!==i.pathname&&0===i.pathname.indexOf("/")||(i.pathname="/"+i.pathname),i.search=t.search,i.search||-1===(r=e.indexOf("?"))||(-1===(n=e.indexOf("#"))&&(n=e.length),r<n&&(i.search="?")),i.hash=t.hash,!i.hash&&__endswith(t.href,"#")&&(i.hash="#"))}function allowNavigateToURL(e){var t,r;if(__startswith(e=e.toLowerCase().trim(),"/"))return!0;if(__startswith(e,"data:")||__startswith(e,"blob:")||__startswith(e,"javascript:"))return!1;if(__startswith(e,"http:")||__startswith(e,"https:"))return!0;if(safeview.pairing_dict&&safeview.pairing_dict.client_caps&&(t=safeview.pairing_dict.client_caps.applicationLinks))for(r=0;r<t.length;r+=1)if(-1!==t[r].indexOf(":")&&__startswith(e,t[r]))return!0;return!1}function suppressReferrerIfRequired(e,t){var r,n;if(e===window){if(TPROXY_ENABLED)r="strict-origin-when-cross-origin";else{if(__startswith(t,window.location.origin))return;r="no-referrer"}(n=document.createElement("meta")).setAttribute("name","referrer"),n.setAttribute("content",r),document.head.appendChild(n)}}function BrowserPrefs(e){const t=["light","dark","no-preference"];function r(t){e.surrogate_channel.send("color-scheme",t)}function n(e){const t=window.matchMedia("(prefers-color-scheme: "+e+")");function n(t){t.matches&&r(e)}n(t),void 0!==t.addEventListener?EventListener.addListener(t,"change",n):void 0!==t.addListener&&t.addListener(n)}function i(){window.matchMedia?function(){let e;for(e=0;e<t.length;++e)n(t[e])}():r("no-preference")}e.callback.register("surrogate-channel-connected",(function(e){e&&i()}))}function ClientEventReporterCore(e){this.make_event_dict=function(e,t){var r={ctime:(new Date).toUTCString(),build_id:window.BUILD_ID,tc_api:window.TC_API_VERSION,event:e,user_agent:window.navigator.userAgent,url:Util.getRawPageUrl()};return Util.simpleExtend(r,t),r},this.send_events=function(t,r,n){t.url=Util.getRawPageUrl(),t.host=window.HOST,Util.xhrRequest(e.url_builder.buildProtocolUrl("/safeview-client-logger/clientevent"),t,r,n)}}function ClientEventReporter(e){var t,r,n=new Logger("event-reporter",{level:"info"}),i=[],o=this,a=!1,s={},l=0;function c(){window.clearTimeout(l),l=window.setTimeout(o.flush,5e3)}o.flush=function(){if(i.length){var e={items:[]};for(t=0,r=i.length;t<r;t+=1)e.items.push(i[t]);e.items.length,o.core.send_events(e,(function(){i.length,i.length=0,c()}),(function(e,t,r){e.response,e.status,c()}))}else c()},o.save_ping_stats=function(e){var t=e.ping;["ping","url","user_agent","build_id"].forEach((function(t){delete e[t]})),e.tlast=t.last,e.tmin=t.min,e.tavg=t.avg,e.tstdev=t.stdev,e.tmax=t.max,e.count=t.count,e.mode=t.mode,o.ping_stats=e},o.save_to_local_stats=function(e){o.local_stats.length>=50?n.info("clientevent ClientEventReporter local_stats is full, discarding new event"):o.local_stats.push(e)},o.enqueue=function(e){100!==i.length?i.push(e):n.info("clientevent ClientEventReporter queue is full, discarding new event")},o.shouldReport=function(e){return!s[e]&&(s[e]=!0,!0)},o.report=function(e,t){switch(e){case"warn":n.warn(t);break;case"error":n.error(t);break;case"debug":break;default:n.info(t)}},o.reportSkipped=function(e){},o.flushPingStats=function(){var t,r,n,i={items:[]};o.ping_stats&&(t=e.url_builder.buildProtocolUrl("/safeview-client-logger/clientevent"),i.items.push(o.ping_stats),i.url=Util.getRawPageUrl(),i.host=window.HOST,i.build_id=BUILD_ID,i.tc_api=TC_API_VERSION,r=JSON.stringify(i),Util.areAuthTokensInUse()||!navigator.sendBeacon?((n=new Util.xmlHttpRequest).open("POST",t,!1),n.withCredentials=!0,n.setRequestHeader("Content-Type","text/plain"),n.send(r)):navigator.sendBeacon(t,r))},o.unpair=function(){var t=e.url_builder.buildProtocolUrl("/r/unpair"),r={build_id:BUILD_ID,tc_api:TC_API_VERSION,url:location.href,host:window.HOST,transparent_mode:TPROXY_ENABLED,mpa_id:e.pairing_dict.mpa_id,tab_id:e.pairing_dict.tab_id,safe_rid:e.pairing_dict.safe_rid};navigator.sendBeacon&&(e.pairing_dict.cid&&(t+="?cid="+e.pairing_dict.cid,e.pairing_dict.cluster_id&&(t+="&cl="+e.pairing_dict.cluster_id)),navigator.sendBeacon(t,JSON.stringify(r)))},o.notify_cross_site_nav=function(){a=!0},e.callback&&e.callback.register("safeview-exit",(function(){tabstore_is_reliable(a)||o.unpair(),o.flush(),o.flushPingStats()})),window.setTimeout(o.flush,5e3),o.local_stats=[],o.core=new ClientEventReporterCore(e)}function reportClientEventWork(e,t,r,n){var i,o=e+": "+JSON.stringify(t);n||safeview.event_reporter.shouldReport(e)?(r?safeview.event_reporter.report(t.tclevel,o):"tc-local-stats"!==t.tclevel&&"tc-ping-stats"!==t.tclevel&&safeview.event_reporter.report("debug",o),i=safeview.event_reporter.core.make_event_dict(e,t),safeview.pairing_dict&&(i.sid=safeview.pairing_dict.safe_rid,i.srouter_id=safeview.pairing_dict.cid,i.cluster_id=safeview.pairing_dict.cluster_id,i.tab=safeview.pairing_dict.tab_id,i.xff=safeview.pairing_dict.xff),"tc-local-stats"===t.tclevel?safeview.event_reporter.save_to_local_stats(i):"tc-ping-stats"===t.tclevel?safeview.event_reporter.save_ping_stats(i):safeview.event_reporter.enqueue(i)):safeview.event_reporter.reportSkipped(o)}function reportClientEvent(e,t,r,n){try{reportClientEventWork(e,t,r,n)}catch(r){console.log("reportClientEvent threw exception: "+r.toString()+". Original log message: "+e+": "+JSON.stringify(t))}}function reportWarnClientEvent(e,t,r,n){!1!==r&&(r=!0),!0!==n&&(n=!1),void 0===t&&(t={}),t.tclevel="tc-warn",reportClientEvent(e,t,r,n)}function reportErrorClientEvent(e,t,r,n){!1!==r&&(r=!0),!0!==n&&(n=!1),void 0===t&&(t={}),t.tclevel="tc-error",reportClientEvent(e,t,r,n)}function CloudDebug(e){var t=this;function r(r,n){!0===r?(e.feedback_bar.disableMenuOption("debug-record-option"),e.snackbar.setCloudDebugSnackbarState(t.RECORDING_STATES.RECORDING)):(!0===n&&e.ui_frame.call("showModal","CloudDebugRecordError"),e.snackbar.setCloudDebugSnackbarState(t.RECORDING_STATES.STOPPED),e.feedback_bar.enableMenuOption("debug-record-option"))}t.RECORDING_STATES={STOPPED:1,PENDING:2,RECORDING:3,STOPPING:4},t.startRecord=function(t){e.surrogate_channel.send("cloud-debug",!0,t),e.ui_frame.call("showModal","CloudDebugRecordMessage")},t.cancelRecord=function(){e.snackbar.setCloudDebugSnackbarState(t.RECORDING_STATES.STOPPED)},t.stopRecord=function(){e.surrogate_channel.send("cloud-debug",!1),e.snackbar.setCloudDebugSnackbarState(t.RECORDING_STATES.STOPPING)},t.showRecordOptionsModal=function(){e.ui_frame.call("showModal","CloudDebugRecordOptions"),e.snackbar.setCloudDebugSnackbarState(t.RECORDING_STATES.PENDING)},e.callback.registerOnFirst("dom-loaded",(function(){e.interp.registerOpcodeHandler("cloud-debug-state",r),e.surrogate_channel.send("cloud-debug-check")}))}"function"!=typeof Number.isFinite&&(Number.isFinite=function(e){return"number"==typeof e&&isFinite(e)}),Function.prototype.curry=function(){var e=this,t=Array.prototype.slice.call(arguments);return function(){return e.apply(this,t.concat(Array.prototype.slice.call(arguments)))}},Util.addTrackingLabel=function(e){var t=new ParsedURL(e);return assert(-1===t.search.indexOf("xid=")),t.search+=(t.search?"&":"?")+"xid="+__randstr(16),t.href()},Util.origin_of=function(e){return new ParsedURL(e).origin()},Util.parseSpecialUrlParts=function(e,t){var r,n,i,o,a,s=new ParsedURL(e),l=!1,c="",d="readonly",u="readonly/",f="mpa/",p="_sv_p_id";return __startswith(e,u)?(l=!0,s=new ParsedURL(e=e.substring(u.length))):__startswith(e,f)?((r=(e=e.substring(f.length)).indexOf("/"))>0&&(c=e.substring(0,r),e=e.substring(r+1)),s=new ParsedURL(e)):s.hostname===d?(l=!0,s=new ParsedURL(s.protocol+"/"+s.pathname+s.search+s.hash)):"mpa"===s.hostname&&((r=s.pathname.indexOf("/",1))>0&&(c=s.pathname.substring(1,r),s.pathname=s.pathname.substring(r)),s=new ParsedURL(s.protocol+"/"+s.pathname+s.search+s.hash)),t&&__startswith(s.search,"?__SV_SURROGATE_NODE=")&&2===(i=(n=s.search.substring(1).split("&"))[0].split("=")).length&&(o=i[1],s.search=n.length>=2?"?"+n.slice(1).join("&"):""),(a=s.getParam(p))&&(s.search=Util.removeParamFromSearch(s.search,p,a)||""),{mpa_id:c,ro:l,url:s.href(),pair_node:o}},Util.parseConfig=function(){var e,t,r=document.getElementsByTagName("safeview-info")[0],n=r.getAttribute("session-info"),i=Util.b64Decode(n),o=JSON.parse(i);for(e in o.hasOwnProperty("DEBUG")||(window.DEBUG=!1),o)if(o.hasOwnProperty(e)){if(t=o[e],("TC_API_VERSION"===e||"TC_BUNDLED"===e)&&window.hasOwnProperty(e))continue;window[e]=t}window.hasOwnProperty("TC_API_VERSION")||(window.TC_API_VERSION="0"),window.hasOwnProperty("TC_BUNDLED")||(window.TC_BUNDLED=!0),window.hasOwnProperty("BUILD_ID")||(window.BUILD_ID=r.getAttribute("build")),o.hasOwnProperty("INSPECT_DOMAIN")||(window.INSPECT_DOMAIN=window.CLUSTER_DOMAIN)},Util.parseURL=function(e){var t=document.createElement("a");return t.href=e,t},Util.windowOpen=function(e,t,r){return e&&!allowNavigateToURL(e)?null:void 0!==e?void 0!==t?void 0!==r?window.open(e,t,r):window.open(e,t):window.open(e):window.open()},Util.locationSetHref=function(e,t){allowNavigateToURL(t)&&(suppressReferrerIfRequired(e,t),e.location.href=t)},Util.locationReplace=function(e,t){return allowNavigateToURL(t)?(suppressReferrerIfRequired(e,t),e.location.replace(t)):null},Util.locationAssign=function(e,t){return allowNavigateToURL(t)?(suppressReferrerIfRequired(e,t),e.location.assign(t)):null},Util.locationSet=function(e,t){allowNavigateToURL(t)&&(suppressReferrerIfRequired(e,t),e.location=t)},Util.hashCode=function(e){var t,r=0;if(!e||0===e.length)return r;for(t=0;t<e.length;t+=1)r=(r<<5)-r+e.charCodeAt(t),r&=r;return r},Util.isIpAddress=function(e){return 0===e.search(/^(\d{1,3}\.){3}\d{1,3}$/)},Util.getScrollbarThickness=function(){function e(e,t){var r,n,i=document.createElement("div"),o=document.createElement("div");return i.style.visibility="hidden",i.style[e]="100px",document.body.appendChild(i),r=i[t],i.style.overflow="scroll",o.style[e]="100%",i.appendChild(o),n=o[t],i.parentNode.removeChild(i),r-n}return Util.cached_thickness||(Util.cached_thickness=[e("width","offsetWidth"),e("height","offsetHeight")]),Util.cached_thickness},Util.getDeviceScaleFactor=function(){var e=window.devicePixelRatio||1;return e-Math.floor(e)<.1?e:Math.ceil(e)},Util.getScreenOrientationType=function(){if(void 0===window.orientation)return"portrait";switch(window.orientation){case 0:case 180:return"portrait";case 90:case-90:return"landscape";default:return assert(0),"portrait"}},Util.getScreenOrientationAngle=function(){return"number"==typeof window.orientation?window.orientation:0},Util.getInnerWidth=function(){return window.innerWidth},Util.getInnerHeight=function(){return window.innerHeight},Util.getPortraitScreenSize=function(){var e=window.screen.width,t=window.screen.height;return(BrowserDetect.isIE()||BrowserDetect.isEdge())&&(window.innerWidth&&window.innerWidth>e&&(e=window.innerWidth),window.innerHeight&&window.innerHeight>t&&(t=window.innerHeight)),"portrait"===Util.getScreenOrientationType()||BrowserDetect.isMobileSafari()&&e<t?{width:e,height:t}:{width:t,height:e}},Util.getVisualViewport=function(){return window.visualViewport},Util.usesOverlayScrollbars=function(){var e=Util.getScrollbarThickness();return 0===e[0]&&0===e[1]},Util.getDeviceMetrics=function(){return{screen_size:Util.getPortraitScreenSize(),screen_orientation_type:Util.getScreenOrientationType(),screen_orientation_angle:Util.getScreenOrientationAngle(),device_scale_factor:window.debug_dsf||Util.getDeviceScaleFactor(),scrollbar_thickness:Util.getScrollbarThickness(),uses_overlay_scrollbars:Util.usesOverlayScrollbars(),enable_touch_events:void 0!==document.ontouchstart,max_touch_points:void 0!==navigator.maxTouchPoints?navigator.maxTouchPoints:2,mobile:BrowserDetect.isMobile()}},Util.getDoctypeDecl=function(e){var t,r=e.document.doctype;return r?(t="<!DOCTYPE "+r.name,r.publicId?(t+=' PUBLIC "'+r.publicId+'"',r.systemId&&(t+=' "'+r.systemId+'"')):r.systemId&&(t+=' SYSTEM "'+r.systemId+'"'),t+=">"):t="",t},Util.persistentPolicy=function(){var e;try{e=window.history.state||{}}catch(t){e={}}return"object"!=typeof e.persistent_policy&&(e.persistent_policy={}),e.persistent_policy||{}},Util.setUrlHint=function(e,t){safeview.qs_hint={key:e,value:t}},Util.getUrlHint=function(e){if(window.TPROXY_ENABLED)return e&&e.hint_key&&e.hint?{key:e.hint_key,value:e.hint}:safeview?safeview.qs_hint:void 0},Util.mpa_id_from_url=function(e){var t=e.split("/",5);return 5!==t.length||"mpa"!==t[3]?"":t[4]},Util.removePrefix=function(e){var t,r=["readonly/","mpa/"];for(t=0;t<r.length;t+=1)0===e.indexOf(r[t])&&(e=e.slice(r[t].length),"mpa/"===r[t]&&e.indexOf("/")>0&&(e=e.slice(e.indexOf("/")+1)));return e},Util.getRawPageUrl=function(e){var t,r;return e=e||location.href,window.TPROXY_ENABLED?e:(assert(2===(t=new RegExp(".+?://.+?/(.+)").exec(e)).length),r=t[1],new RegExp("(ftp|https?|ext)://","i").test(r)||(r="http://"+r),r)},Util.isAboutBlankUrl=function(){var e=Util.getRawPageUrl();return!!__startswith(e,"http://__about_~_blank__")||__endswith(new ParsedURL(e).pathname,"/__about_~_blank__")},Util.isMPAPortalUrl=function(){return __endswith(Util.getRawPageUrl(),"https://portal/")},Util.getPageUrl=function(){var e=Util.removePrefix(Util.getRawPageUrl());return Util.isAboutBlankUrl()&&(e="about:blank"),e},Util.getLanguage=function(){return navigator.userAgent.indexOf("MSIE 10.0")>=0?window.navigator.browserLanguage:window.navigator.language},Util.getLanguages=function(){return window.navigator.languages?window.navigator.languages.join():""},Util.b64_chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Util.b64Decode=function(e,t){var r,n,i,o,a,s,l="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)r=Util.b64_chars.indexOf(e.charAt(c++))<<2|(o=Util.b64_chars.indexOf(e.charAt(c++)))>>4,n=(15&o)<<4|(a=Util.b64_chars.indexOf(e.charAt(c++)))>>2,i=(3&a)<<6|(s=Util.b64_chars.indexOf(e.charAt(c++))),l+=String.fromCharCode(r),64!==a&&(l+=String.fromCharCode(n)),64!==s&&(l+=String.fromCharCode(i));return t||(l=Util.utf8Decode(l)),l},Util.utf8Decode=function(e){for(var t,r,n,i="",o=0;o<e.length;)(t=e.charCodeAt(o))<128?(i+=String.fromCharCode(t),o++):t>191&&t<224?(r=e.charCodeAt(o+1),i+=String.fromCharCode((31&t)<<6|63&r),o+=2):(r=e.charCodeAt(o+1),n=e.charCodeAt(o+2),i+=String.fromCharCode((15&t)<<12|(63&r)<<6|63&n),o+=3);return i},Util.getFramingStatus=function(){if(window.top===window)return 0;try{if(window.parent.location.host===window.location.host)return 2}catch(e){}return 1},Util.getParamFromSearch=function(e,t,r){var n,i,o=e.substring(1).split("&");for(n=0;n<o.length;n+=1)if(o[n].split("=")[0]===t)return i=o[n].slice(o[n].indexOf("=")+1),r||(i=decodeURIComponent(i)),i;return null},Util.getParam=function(e,t){return Util.getParamFromSearch(window.location.search,e,t)},Util.appendParam=function(e,t){var r=document.location.search;return r+=(r?"&":"?")+e+"="+t,document.location.protocol+"//"+document.location.hostname+document.location.pathname+r+document.location.hash},Util.removeParamFromSearch=function(e,t,r){var n,i,o="";if(-1!==(i=(n=e.substring(1).split("&")).indexOf(t+"="+r)))return n.splice(i,1),n.length&&(o="?"+n.join("&")),o},Util.removeParam=function(e,t){var r,n=Util.removeParamFromSearch(document.location.search,e,t);if(void 0!==n){r=document.location.protocol+"//"+document.location.hostname+document.location.pathname+n+document.location.hash;try{window.history.state&&window.history.state.url&&(window.history.state.url=r),window.history.replaceState(window.history.state,"",r)}catch(e){}}},Util.is_in_iframe=function(){try{return window.self!==window.top}catch(e){return!0}},Util.isFrameBuster=function(){var e=window.FRAMEBUST;return e&&e.enabled&&window.top!==window.self&&0===window.innerWidth&&0===window.innerHeight&&-1!==e.domains.indexOf(window.location.hostname)},Util.simpleExtend=function(e,t){var r;for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},Util.xmlHttpRequest=function(){this.timeout=0,this.withCredentials=!1,this.responseType="",this._headers={},this._abort=!1,this._request=null,this._request_id=null,this.onreadystatechange=this.onabort=this.ontimeout=this.onload=this.onerror=function(){},this.response=null,this.status=null,this.responseText="",this.readyState=0},Util.xmlHttpRequest.prototype.open=function(e,t,r){Util.areAuthTokensInUse()&&t.startsWith("https://")?(this._request=[e,t],this.readyState=1):(this._request=new XMLHttpRequest,void 0===r&&(r=!0),this._request.open(e,t,r))},Util.xmlHttpRequest.prototype.setRequestHeader=function(e,t){this._headers[e]=t},Util.xmlHttpRequest.prototype.getAllResponseHeaders=function(){return this._request instanceof XMLHttpRequest?this._request.getAllResponseHeaders():{}},Util.xmlHttpRequest.prototype.send=function(e){var t,r,n=this;if(this._request instanceof XMLHttpRequest){for(r in 0!==this.timeout&&(this._request.timeout=this.timeout),this._request.withCredentials=this.withCredentials,this._request.responseType=this.responseType,this._headers)this._headers.hasOwnProperty(r)&&this._request.setRequestHeader(r,this._headers[r]);t=function(){n.readyState=n._request.readyState,n.status=n._request.status,n.response=n._request.response,""!==n.responseType&&"text"!==n.responseType||(n.responseText=n._request.responseText)},this._request.onload=function(e){t(),n.onload(e)},this._request.onabort=function(e){t(),n.onabort(e)},this._request.onerror=function(e){t(),n.onerror(e)},this._request.ontimeout=function(e){t(),n.ontimeout(e)},this._request.onreadystatechange=function(e){t(),n.onreadystatechange(e)},this._request.send(e)}else this._request_id=Math.random(),this.readyState=2,safeview.cof.call(["xhrRequest",this._request[1],e,this.timeout,this._request[0],this.responseType,this._headers,this._request_id],(function(e){n.readyState=4,null===e?n._abort?n.onabort(n):n.onerror(n):408===e.status?n.ontimeout(n):(n.status=e.status,n.response=e.response,"text"===n.responseType&&(n.responseText=n.response),n.onload(n)),n.onreadystatechange(n)}))},Util.xmlHttpRequest.prototype.abort=function(){this._request instanceof XMLHttpRequest?this._request.abort():(this._abort=!0,safeview.cof.call(["xhrRequestAbort",this._request_id]))},Util.xhrRequest=function(e,t,r,n,i){var o=new Util.xmlHttpRequest;o.open("POST",e),o.timeout=i||safeview.perf.xhr_timeout_ms,o.withCredentials=!0,r&&(o.onload=function(t){200===o.status?r(JSON.parse(o.response)):n&&n(o,t,e)}),n&&(o.onerror=function(t){n(o,t,e)},o.ontimeout=function(t){n(o,t,e)}),o.send(JSON.stringify(t))},Util.setAuthTokensInUse=function(){Util.__auth_tokens=!0},Util.areAuthTokensInUse=function(){return!!Util.__auth_tokens},Util.isMseSupported=function(){return!BrowserDetect.isMobileSafariOnIPhone()&&(window.MediaSource=window.MediaSource||window.WebKitMediaSource,!!window.MediaSource)},Util.getUnsupportedMediaFormats=function(){var e,t,r=[{mime_types:["video/mp2t"],codecs:["avc1.64001F","mp4a.66","mp4a.40.2","mp3"]}],n=document.createElement("video"),i=null;function o(e,t,r){var n,i,o,a;for(n=0;n<t.length;n++)for(i=0;i<t[n].mime_types.length;i++){if(a=[],e(t[n].mime_types[i])){for(o=0;o<t[n].codecs.length;o++)e(t[n].mime_types[i]+';codecs="'+t[n].codecs[o]+'"')||a.push(t[n].codecs[o]);if(0===o)continue}else a=t[n].codecs;a.length===t[n].codecs.length?r.push(t[n].mime_types[i]):a.length&&r.push(t[n].mime_types[i]+';codecs="'+a.join(",")+'"')}}if(n.canPlayType&&o((function(e){return n.canPlayType(e)}),[{mime_types:["audio/wav","audio/x-wav"],codecs:["1"]},{mime_types:["audio/webm"],codecs:["opus","vorbis"]},{mime_types:["video/webm"],codecs:["opus","vorbis","vp8","vp9","av01.0.08M.08"]},{mime_types:["audio/ogg"],codecs:["flac","opus","vorbis"]},{mime_types:["video/ogg","application/ogg"],codecs:["vp8","flac","opus","vorbis","theora"]},{mime_types:["audio/flac","audio/mp3","audio/x-mp3","audio/aac"],codecs:[]},{mime_types:["audio/mp4"],codecs:["flac","mp3","opus","mp4a.66","mp4a.40.2","mp4a.40.42"]},{mime_types:["audio/mpeg"],codecs:["mp3"]},{mime_types:["video/mp4"],codecs:["vp09.00.10.08","avc1.64001F","av01.0.08M.08","flac","mp3","opus","mp4a.66","mp4a.40.2","mp4a.40.42","hev1.1.0.L90.B0","hev1.2.0.L90.B0","hev1.3.0.L90.B0","hev1.4.0.L90.B0","hev1.5.0.L90.B0","hev1.6.0.L90.B0","hev1.7.0.L90.B0","hev1.8.0.L90.B0","hev1.9.0.L90.B0","hev1.10.0.L90.B0","hev1.11.0.L90.B0"]},{mime_types:["audio/x-m4a"],codecs:["mp4a.66","mp4a.40.2","mp4a.40.42"]},{mime_types:["video/x-m4v","video/3gpp"],codecs:["avc1.64001F","mp4a.66","mp4a.40.2","mp4a.40.42"]},{mime_types:["application/x-mpegurl","application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl"],codecs:["avc1.64001F","mp3","mp4a.40.2"]}],i=[]),void 0!==window.MediaSource)null===i&&(i=[]),o((function(e){return MediaSource.isTypeSupported(e)}),r,i);else if(null!==i)for(e=0;e<r.length;++e)for(t=0;t<r[e].mime_types.length;t++)i.push(r[e].mime_types[t]);return window.SourceBuffer&&window.SourceBuffer.prototype.changeType||i.push("mse_change_type"),i},Util.clientHintsSupported=function(){return void 0!==window.navigator&&void 0!==window.navigator.userAgentData},Util.getClientHints=function(e){if(Util.clientHintsSupported()){const t=["architecture","bitness","brands","formFactors","fullVersionList","mobile","model","platform","platformVersion","uaFullVersion","wow64"];navigator.userAgentData.getHighEntropyValues(t).then(e).catch((function(){e(null)}))}else e(null)},Util.isPermittedURL=function(e){return __startswith(e,"https:")||__startswith(e,"data:")},Util.COFPath=function(){var e="/safeview-template/cof_frame.html?a="+TC_API_VERSION;return!1!==window.TC_BUNDLED&&(e+="&v="+BUILD_ID),e};var ONE_LEVEL_TLDS=["com","org","int","net","edu","gov","mil"];function argumentsToArray(e){return Array.prototype.slice.call(e).slice(0)}function Countdown(e,t,r,n){var i=null,o=null,a=this;function s(){t(safeview.localization.get("ID_TC_RECONNECT_ERROR")),setTimeout((function(){a.restart()}),2e3)}function l(){var e=o/1e3;assert(e>=0),t(safeview.localization.get("ID_TC_RELOADING",e))}function c(){i&&(clearInterval(i),i=null)}function d(){var e;assert(o>=1e3),o-=1e3,l(),0===o&&(c(),e=safeview.url_builder.buildServiceURL("/safeview-director/traffic_cop"),safeview.serverCall({url:e}).done((function(t){JSON.stringify(t),reportClientEvent("tc-service-check-done",{action:t,request_url:e}),"go"===t?r():s()})).fail((function(t,r){reportClientEvent("tc-service-check-failed",{textStatus:r,request_url:e}),s()})))}this.restart=function(){c(),o=e,l(),i=setInterval(d,1e3)},this.stop=c}Util.input_text_types={text:1,password:1,search:1,email:1,url:1,tel:1,number:1},Util.input_text_types_strict=["text","email","password","search","tel","url"],Util.date_time_input_types={date:"yyyy-MM-dd",time:"hh:mm",month:"yyyy-MM",week:"yyyy-Www","datetime-local":"yyyy-MM-ddThh:mm"},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.indexOf(e)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return this.substring(this.length-e.length)===e}),"function"!=typeof Math.sign&&(Math.sign=function(e){return 0===e?0:e<0?-1:1}),"number"!=typeof Number.MAX_SAFE_INTEGER&&(Number.MAX_SAFE_INTEGER=Math.pow(2,53)-1,Number.MIN_SAFE_INTEGER=-Number.MAX_SAFE_INTEGER),Util.show_message_bar=function(e){var t,r,n=document.getElementById("__safly_message_bar");safeview.pairing_dict&&safeview.pairing_dict.client_caps&&safeview.pairing_dict.client_caps.enable_reconnect_banner&&(n||((n=document.createElement("div")).id="__safly_message_bar",n.style.cursor="pointer",n.style.display="none",n.style.position="fixed",n.style.top=0,n.style.left="27%",n.style.right="27%",n.style.margin="auto",n.style.padding="3px",n.style.width="35%",n.style.background="#fc0",n.style.textAlign="center",n.style.font="12px arial, sans-serif",n.style.opacity="0.9",n.style.zIndex="100000000000",n.style.borderBottomLeftRadius="5px",n.style.borderBottomRightRadius="5px",n.style.verticalAlign="middle",(t=document.body)||((r=document.getElementsByTagName("html")[0])||(r=document.createElement("html"),document.appendChild(r)),t=document.createElement("body"),r.appendChild(t),assert(document.body)),t.appendChild(n)),n.innerText=e,n.style.display="block")},Util.hide_message_bar=function(){var e=document.getElementById("__safly_message_bar");e&&(e.style.display="none")},Util.conf_default=function(e,t,r,n,i,o,a,s){var l,c;l=function(t){return{arr:1,array:1}.hasOwnProperty(o)&&void 0!==t?e[n][t]:e[n]},c=function(t,r){!{boolean:1,bool:1}.hasOwnProperty(o)?!{integer:1,int:1}.hasOwnProperty(o)?"func"===o&&(t||(t=function(){})):t=parseInt(t,10):t=!(!t||{0:1,no:1,false:1}.hasOwnProperty(t)),void 0!==r?e[n][r]=t:e[n]=t},t[n+"_description"]=s,void 0===t["get_"+n]&&(t["get_"+n]=l),void 0===t["set_"+n]&&(t["set_"+n]=function(t,r){if({RO:1,ro:1}.hasOwnProperty(i))throw new Error(n+" is read-only");if({WO:1,wo:1}.hasOwnProperty(i)&&void 0!==e[n])throw new Error(n+" can only be set once");c(t,r)}),void 0!==r[n]?a=r[n]:!{arr:1,array:1}.hasOwnProperty(o)||a instanceof Array||(a=[]),c(a)},Util.conf_defaults=function(e,t,r,n){var i;for(i=0;i<n.length;i+=1)Util.conf_default(e,t,r,n[i][0],n[i][1],n[i][2],n[i][3],n[i][4])},Util.objectPrototypeToString=Object.prototype.toString,Util.is_string=function(e){return"[object String]"===Util.objectPrototypeToString.call(e)},Util.is_valid_number=function(e){return Number.isFinite?Number.isFinite(e):isFinite(e)},Util.string_rpad=function(e,t){var r,n;for(r=Math.max(t-e.length,0),n=0;n<r;n+=1)e+=" ";return e},Util.string_shorten=function(e,t,r){return(r=r||"").length>t&&(r=r.substring(0,t)),e.length<=t?e:e.substring(0,t-r.length)+r},Util.fit_string_in_fixed_len_field=function(e,t,r){return Util.string_rpad(Util.string_shorten(e,t,r),t)},Util.getPosition=function(e){var t=0,r=0;if(e.offsetParent)do{t+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent}while(e);return{x:t,y:r}},Util.getTopWindowMousePosition=function(e){for(var t,r={x:e.clientX,y:e.clientY},n=e.target;n=(n=(n=n.ownerDocument).defaultView||n.parentWindow).frameElement;)t=n.getBoundingClientRect(),r.x+=t.left,r.y+=t.top;return r},Util.getTopWindowPosition=function(e){for(var t,r={x:0,y:0};e;)t=e.getBoundingClientRect(),r.x+=t.left,r.y+=t.top,e=(e=(e=e.ownerDocument).defaultView||e.parentWindow).frameElement;return r.x+=document.body.scrollLeft+document.documentElement.scrollLeft,r.y+=document.body.scrollTop+document.documentElement.scrollTop,r},Util.getEventPosition=function(e,t,r){var n,i,o,a;return(n=e||window.event).pageX||n.pageY?(i=n.pageX,o=n.pageY):(n.clientX||n.clientY)&&(i=n.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o=n.clientY+document.body.scrollTop+document.documentElement.scrollTop),void 0===r&&(r=1),{x:(i-(a=Util.getPosition(t)).x)/r,y:(o-a.y)/r}},Util.getScreenWidth=function(){return document.documentElement.clientWidth},Util.getScreenHeight=function(){return document.documentElement.clientHeight},Util.htmlMsg=function(e){return"<!DOCTYPE html><html><body>"+e+"</body></html>"},Util.isSameDomain=function(e,t){var r=Util.parseURL(e).hostname,n=Util.parseURL(t).hostname,i=r.split("."),o=n.split(".");return JSON.stringify(i.slice(-2))===JSON.stringify(o.slice(-2))&&(i.slice(-2)[0].length>3||i.length<3||o.length<3||ONE_LEVEL_TLDS.indexOf(i.slice(-1)[0])>=0||i.slice(-3)[0]===o.slice(-3)[0])},Util.makeSet=function(e){var t,r={};for(t=0;t<e.length;t+=1)r[e[t]]=1;return r},Util.buildQueryStr=function(e){var t,r="";if(e)for(t in e)e.hasOwnProperty(t)&&(r+="&"+t+"="+e[t]);return r};var PREFIX="sv_tab_id:";function Poller(e){var t=this,r=null;if(!e.cond_func)throw new Error("Must specify condition function");if(!e.max_nr_polls)throw new Error("Must specify max number of polls");if(!e.poll_interval_ms)throw new Error("Must specify poll interval");function n(t){void 0===t&&(t=0),t+=1,e.cond_func()?e.success_cb():t>e.max_nr_polls?e.timeout_cb&&e.timeout_cb():r=setTimeout((function(){r=null,n(t)}),e.poll_interval_ms)}t.stop=function(){r&&(clearTimeout(r),r=null)},t.start=function(){t.stop(),n()}}function calculateMovement(e,t){var r;return void 0!==e.movementX?{x:e.movementX,y:e.movementY}:(r=safeview[t]?{x:e.screenX-safeview[t].screenX,y:e.screenY-safeview[t].screenY}:{x:0,y:0},safeview[t]={screenX:e.screenX,screenY:e.screenY},r)}function EventListenerModule(){var e=new Logger("event-listener",{level:"info"}),t=this,r=0;function n(e,t,r,n,i){var o;"function"==typeof e.removeEventListener?(o=BrowserDetect.supportsPassiveEventListeners()?{capture:!!n,passive:!!i}:!!n,e.removeEventListener(t,r,o)):"function"==typeof e.detachEvent?e.detachEvent("on"+t,r):assert(!1,"Cannot remove listener.")}function i(e,t,r,n){function i(e){return e?e.toString():null}try{var o={stacktrace:printStackTrace(e),callback:t,"type-of-arguments":i(r),"value-of-arguments":n.join(", "),exception:i(e)};DEBUG&&safeview.ui_frame.call("showModal","Crash"),reportErrorClientEvent("tc-uncaught-exception",o)}catch(t){try{reportErrorClientEvent("double-fault",{"first-exception":i(e),"second-exception":i(t)})}catch(r){window.triple_fault={"first-exception":i(e),"second-exception":i(t),"third-exception":i(r)}}}}t.addListener=function(e,t,o,a,s){var l,c;void 0===e.sv_evt_reg_map&&(e.sv_evt_reg_map={}),void 0===o.sv_evt_reg_id&&(o.sv_evt_reg_id=r,r+=1),l=t+"-"+o.sv_evt_reg_id.toString(),e.sv_evt_reg_map[l]&&n(e,t,c=e.sv_evt_reg_map[l],a,s),c=function(e){var t,r,n,o=e.toString(),a=[],s=[];function l(e){-1===s.indexOf(e)&&s.push(e)}return function(){try{e.apply(this,arguments)}catch(e){if(!safeview.resync_in_progress){for(o=(o=o.substr("function ".length)).substr(0,o.indexOf("{")),t=Array.prototype.slice.call(arguments),r=t[0];r;)Object.getOwnPropertyNames(r).forEach(l),r=Object.getPrototypeOf(r);for(n=0;n<s.length;n++){r=s[n];try{a.push(r+":"+t[0][r])}catch(e){a.push(r+": "+(e.message||"<inaccessible>"))}}i(e,o,t,a)}}}}(o),e.sv_evt_reg_map[l]=c,function(e,t,r,n,i){var o;"function"==typeof e.addEventListener?(o=BrowserDetect.supportsPassiveEventListeners()?{capture:!!n,passive:!!i}:!!n,e.addEventListener(t,r,o)):"function"==typeof e.attachEvent?e.attachEvent("on"+t,r):assert(!1,"Cannot add listener.")}(e,t,c,a,s)},t.removeListener=function(t,r,i,o,a){var s,l;void 0!==t.sv_evt_reg_map&&void 0!==i.sv_evt_reg_id?(s=r+"-"+i.sv_evt_reg_id.toString(),(l=t.sv_evt_reg_map[s])?(n(t,r,l,o,a),delete t.sv_evt_reg_map[s]):e.error("Callback not found in removeListener")):e.error("Registration id not found in removeListener")},t.setListenersEnabled=function(e,r,n,i){var o=e?t.addListener:t.removeListener;assert(r),assert(i),n.forEach((function(e){o(r,e,i)}))}}Util.getOrSetTabID=function(){var e;return assert(window.localStorage),assert("string"==typeof window.name),__startswith(window.name,PREFIX)?window.name.substr(PREFIX.length):(e=__randstr(16),window.name=PREFIX+e,window.history.replaceState&&window.history.replaceState(window.history.state,document.title,window.location.href),e)},Util.safeCreateWebSocket=function(e,t){var r=null;e=Util.addTrackingLabel(e);try{window.WebSocket?r=new window.WebSocket(e):window.MozWebSocket&&(r=new window.MozWebSocket(e))}catch(r){if(t)throw r;reportClientEvent("tc-websocket-create-failed",{request_url:e})}return r},Util.wsCloseDiags=function(e){return{wasClean:e.wasClean,code:e.code,reason:e.reason}},Util.get_node_tag=function(e){soft_assert(e);var t=e.localName||e.nodeName;return t=t?t.toLowerCase():t},Util.getDoctypeDecl=function(e){var t,r=e.document.doctype;return r?(t="<!DOCTYPE "+r.name,r.publicId?(t+=' PUBLIC "'+r.publicId+'"',r.systemId&&(t+=' "'+r.systemId+'"')):r.systemId&&(t+=' SYSTEM "'+r.systemId+'"'),t+=">"):t="",t},Util.is_element_input_text=function(e){var t=Util.get_node_tag(e);return"textarea"===t||"input"===t&&Util.input_text_types.hasOwnProperty(e.type)},Util.is_frame_node_name=function(e){return"iframe"===e||"frame"===e},Util.is_frame_node=function(e){return Util.is_frame_node_name(e.localName)},Util.is_frame_owner=function(e){return Util.is_frame_node(e)||e.__sv_frame_owner},Util.is_autofill_target=function(e){return"input"===Util.get_node_tag(e)&&Util.is_element_input_text(e)},Util.handle_autofill_event=function(e,t){return Util.is_autofill_target(e)&&("keypress"===t.type||"keydown"===t.type||"keyup"===t.type)&&!("keyCode"in t||"metaKey"in t||"shiftKey"in t||"ctrlKey"in t||"altKey"in t)&&(t.keyCode=0,t.charCode=0,t.key="",t.code="",t.shiftKey=!1,t.ctrlKey=!1,t.metaKey=!1),t},Util.can_element_use_lecho=function(e){var t;return!("input"!==Util.get_node_tag(e)||!e.ownerDocument)&&("number"!==e.__sv_original_input_type&&(!(e.ownerDocument.defaultView||e.ownerDocument.parentWindow).__sv_surrogate_is_readonly&&((t=e.getAttribute("type"))||(t="text"),t=t.toLowerCase(),Util.input_text_types_strict.indexOf(t)>-1)))},Util.is_content_editable=function(e){var t=Util.get_node_tag(e);return(!e.ownerDocument||!(e.ownerDocument.defaultView||e.ownerDocument.parentWindow).__sv_surrogate_is_readonly)&&("textarea"===t||e.isContentEditable||3===e.nodeType&&e.parentNode&&e.parentNode.isContentEditable)},Util.is_node_likely_anchor_tag=function(e){return!!e.getAttribute&&!!e.getAttribute("href")},Util.is_elem_editable=function(e){var t=Util.get_node_tag(e);return(e.isContentEditable||e.ownerDocument&&"on"===e.ownerDocument.designMode)&&"textarea"!==t&&"input"!==t},Util.findPredicateOnBranch=function(e,t){for(var r=e;r;){if(t(r))return r;r=r.parentNode}return null},Util.now=function(){return window.performance?Number(window.performance.now()).toFixed():Date.now()},Util.rewriteRawHref=function(e){return window.TPROXY_ENABLED?e:(safeview.pairing_dict.mpa_id&&!e.startsWith("mpa/")&&(e="mpa/"+(safeview.pairing_dict.mpa_id||"1")+"/"+e),"/"+e)},Util.getCookie=function(e){var t={};if(e)return document.cookie.split(";").forEach((function(e){e=e.trim().split("="),t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])})),t[e]},Util.setCookie=function(e,t,r,n,i,o,a){var s=[encodeURIComponent(e)+"="+encodeURIComponent(t)];return!!e&&(r&&s.push("expires="+r.toUTCString()),n&&s.push("path="+n),i&&s.push("domain="+i),o&&s.push("secure"),a&&!safeview.xbrowser.isBrokenSameSite()&&s.push("samesite="+a),document.cookie=s.join("; "),!0)},Util.forEachItem=function(e,t){var r;for(r in assert("object"==typeof e),assert("function"==typeof t),e)if(e.hasOwnProperty(r)&&t(r,e[r]))return},Util.isDictEmpty=function(e){var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},Util.dictValues=function(e){var t=[];return Object.values?Object.values(e):(Util.forEachItem(e,(function(e,r){t.push(r)})),t)},Util.copyDict=function(e,t){var r=t||{};return Util.forEachItem(e,(function(e,t){r[e]=t})),r},Util.getImageFromU8Array=function(e,t){var r=new window.Blob([e],{type:"image/*"}),n=new Image;function i(e){assert(n.src),window.URL.revokeObjectURL(n.src),n.onload=n.onerror=null,t(n,e)}assert(t),n.onload=i.curry(!0),n.onerror=i.curry(!1),n.src=window.URL.createObjectURL(r)},Util.getImageFromURL=function(e,t){var r=new Image;function n(e){assert(r.src),r.onload=r.onerror=null,t(r,e)}assert(t),r.onload=n.curry(!0),r.onerror=n.curry(!1),Util.requiresCofRequest(e)?safeview.xbrowser.createBlobSrc(e).catch((function(){return e})).then((function(e){r.src=e})):r.src=e},Util.Uint8ArrayToBase64=function(e){var t,r=[];for(t=0;t<e.length;t+=4096)r.push(String.fromCharCode.apply(null,e.subarray(t,t+4096)));return window.btoa(r.join(""))},Util.elementIntersectsViewport=function(e){var t=e.getBoundingClientRect(),r=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth;return!(t.left>=n||t.right<=0||t.top>=r||t.bottom<=0)},Util.elementIsInsideViewport=function(e){var t,r=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth;return!e.getBoundingClientRect||(t=e.getBoundingClientRect()).top>=0&&t.left>=0&&t.bottom<=r&&t.right<=n},Util.isIframeReady=function(e,t){var r=e.contentWindow;return r&&r.document&&"complete"===r.document.readyState&&(!t||r.document.documentElement&&r.document.documentElement.getAttribute("tc-nonce")===t)},Util.IsEventTargetForeign=function(e,t){return assert(e),(!t||"resize"!==t.type&&"copy"!==t.type&&"focus"!==t.type)&&!getUidByNode(e)},Util.calculateMouseMovement=function(e){return calculateMovement(e,"last_mouse_pos")},Util.calculateDragMovement=function(e){return calculateMovement(e,"last_drag_pos")},Util.makePasteDataList=function(e,t,r){var n,i,o,a,s,l,c,d=[],u=[],f=0,p=0,g=!1,m=function(){safeview.allow_backend_dragdrop&&u.length&&(d.push(u),d.push("file_obj_list"))};if(e.clipboardData&&e.clipboardData.getData)for(n=e.clipboardData,o=0;o<n.types.length;o+=1)if("text/plain"===(i=n.types[o])||"text/html"===i||"text/rtf"===i&&!safeview.pairing_dict.mpa_id)d.push(n.getData(i)),d.push(i);else if("Files"===i)for(a=0;a<n.files.length;++a)0===(l=n.files.item(a)).type.indexOf("image")?(f+=1,g=!0,(c=new FileReader).onload=function(){var e=c.result;e&&(d.push(e),d.push(l.type)),++p===f&&(m(),r(d))},c.onerror=function(e){++p===f&&(m(),r(d)),reportWarnClientEvent("tc-image-paste-error",{name:e.name||"none",mime:e.type||"none"})}.curry(l),c.readAsDataURL(l)):u.push(l);else reportWarnClientEvent("tc-paste-error",{reason:"Unsupported type",type:i});else t.clipboardData&&t.clipboardData.getData&&(s=t.clipboardData.getData("Text"))&&(d.push(s),d.push("text/plain"));g||(m(),r(d))},Util.filterPasteDataList=function(e){var t,r=[];for(t=0;t<e.length;t+=2){if("text/plain"===e[t+1]){r[0]=e[t],r[1]=e[t+1];break}"text/html"===e[t+1]&&(r[0]=e[t],r[1]=e[t+1])}for(;e.length>0;)e.pop();2===r.length&&(e.push(r[0]),e.push(r[1]))},Util.copyToClipboardInEventHandler=function(e,t,r){BrowserDetect.isEdge()?e.clipboardData.setData("text",t):e.clipboardData?(e.clipboardData.setData("text/plain",t),r&&e.clipboardData.setData("text/html",r)):window.clipboardData.setData("text",t),e.preventDefault()},Util.MouseAndKeyboardModifiers=Object.freeze({kNone:0,kLeftButtonDown:1,kRightButtonDown:2,kMiddleButtonDown:4,kBackButtonDown:8,kForwardButtonDown:16,kShiftKey:32,kCtrlKey:64,kAltKey:128,kMetaKey:256,kScrollbarScrolled:512,kSetForeground:1024,kWheelDefaultPrevented:2048}),Util.getButtonModifiers=function(e,t){if(void 0!==e.buttons)return e.buttons;switch(e.which){case 0:return Util.MouseAndKeyboardModifiers.kNone;case 1:return Util.MouseAndKeyboardModifiers.kLeftButtonDown;case 2:return Util.MouseAndKeyboardModifiers.kMiddleButtonDown;case 3:return Util.MouseAndKeyboardModifiers.kRightButtonDown;default:return t.error({event:"tc-unknown-button",which:e.which}),0}},Util.getMouseAndKeyboardModifiers=function(e,t){var r=Util.getButtonModifiers(e,t);return assert(void 0!==e.shiftKey),assert(void 0!==e.ctrlKey),assert(void 0!==e.altKey),assert(void 0!==e.metaKey),e.shiftKey&&(r|=Util.MouseAndKeyboardModifiers.kShiftKey),e.ctrlKey&&(r|=Util.MouseAndKeyboardModifiers.kCtrlKey),e.altKey&&(r|=Util.MouseAndKeyboardModifiers.kAltKey),e.metaKey&&(r|=Util.MouseAndKeyboardModifiers.kMetaKey),e.__sv_scrollbar_scrolled&&(r|=Util.MouseAndKeyboardModifiers.kScrollbarScrolled),e.__sv_set_foreground&&(r|=Util.MouseAndKeyboardModifiers.kSetForeground),e.__sv_wheel_default_prevented&&(r|=Util.MouseAndKeyboardModifiers.kWheelDefaultPrevented),r},Util.getRelativeMouseCoords=function(e,t){var r;return(r=(e=3===e.nodeType?e.parentNode:e).getBoundingClientRect()).left>0&&r.top>0&&r.right<window.innerWidth&&r.bottom<window.innerHeight&&(!t.buttons||!e||"canvas"!==e.nodeName.toLowerCase()||"mousemove"!==t.type&&"pointermove"!==t.type)&&"drag"!==t.type&&"dragstart"!==t.type&&"dragend"!==t.type&&"dragover"!==t.type&&"dragenter"!==t.type&&"dragleave"!==t.type&&"drop"!==t.type?{x:t.clientX-r.left,y:t.clientY-r.top,relative_to_target:!0}:{x:t.clientX,y:t.clientY,relative_to_target:!1}},Util.gen_dragdrop_file_list=function(e){var t,r,n,i=[];function o(e){return{name:e.name,type:e.type}}if(e.items&&e.items.length>0)for(t=0;t<e.items.length;t++)"file"===(n=e.items[t]).kind&&(r=n.getAsFile(),i.push(r?o(r):{type:n.type}));else{for(t=0;t<e.files.length;t++)i.push(o(e.files[t]));0===i.length&&(e.types.contains&&e.types.contains("Files")||(e.types.indexOf&&e.types.indexOf("Files"))>=0)&&(i=[{type:"text/plain"}])}return i},Util.debug_print_selection=function(e,t){var r,n,i,o;function a(e){return 1===e.nodeType?"node_type:element_node, node_name:"+e.nodeName+", text_content:"+e.textContent:3===e.nodeType?"node_type:text_node, node_value:"+e.nodeValue:"Unexpected node type in selection, node_type:"+e.nodeType}if(!e.anchorNode||!e.focusNode)return e.anchorNode,void e.focusNode;if("anchorNode={"+a(e.anchorNode)+"}, focusNode={"+a(e.focusNode)+"}, anchorOffset="+e.anchorOffset+", focusOffset="+e.focusOffset+", isCollapsed="+e.isCollapsed+", rangeCount="+e.rangeCount,"startContainer={"+a((r=e.getRangeAt(0)).startContainer)+"}, endContainer={"+a(r.endContainer)+"}, startOffset="+r.startOffset+", endOffset="+r.endOffset,1===(i=e.focusNode).nodeType)for(i.nodeName,n=0;n<i.childNodes.length;n+=1)1===(o=i.childNodes[n]).nodeType?(o.nodeType,o.nodeName,o.textContent):3===o.nodeType&&(o.nodeType,o.nodeValue)},Util.ensureElementPresent=function(e){var t,r=document[e];r||((t=document.getElementsByTagName("html")[0])||(t=document.createElement("html"),document.appendChild(t)),r=document.createElement(e),t.appendChild(r),assert(document[e]))},Util.splunkify=function(e){var t=JSON.stringify(e);return t?t.replace(/\"/g,"'"):t},Util.buildLoginForm=function(e,t){var r,n,i;function o(e,t){var n=document.createElement("input");n.type="hidden",n.name=e,n.value=t,r.appendChild(n)}for((r=document.createElement("form")).action=e.login_url,o("url",t),i=["through","entry_mode","redirect_list","prepend","doc_headers","xheaders","inspect_host","mpa_id","flow_id"],n=0;n<i.length;n++)e[i[n]]&&o(i[n],e[i[n]]);return r},Util.submitLoginForm=function(e,t){t&&(e.target=t),e.method="POST",document.body.appendChild(e),e.submit()},Util.b64Encode=function(e,t){var r,n,i,o,a,s,l,c="",d=0;for(t||(e=Util.utf8Encode(e));d<e.length;)o=(r=e.charCodeAt(d++))>>2,a=(3&r)<<4|(n=e.charCodeAt(d++))>>4,s=(15&n)<<2|(i=e.charCodeAt(d++))>>6,l=63&i,isNaN(n)?s=l=64:isNaN(i)&&(l=64),c=c+Util.b64_chars.charAt(o)+Util.b64_chars.charAt(a)+Util.b64_chars.charAt(s)+Util.b64_chars.charAt(l);return c},Util.utf8Encode=function(e){var t,r,n="";for(e=e.replace(/\r\n/g,"\n"),t=0;t<e.length;t++)(r=e.charCodeAt(t))<128?n+=String.fromCharCode(r):r>127&&r<2048?(n+=String.fromCharCode(r>>6|192),n+=String.fromCharCode(63&r|128)):(n+=String.fromCharCode(r>>12|224),n+=String.fromCharCode(r>>6&63|128),n+=String.fromCharCode(63&r|128));return n},Util.utf8ByteDecode=function(e){var t,r;if(window.TextDecoder)return new TextDecoder("utf-8").decode(e);for(t="",r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return decodeURIComponent(window.escape(t))},Util.is_korean_char=function(e){var t=e.charCodeAt(0);return t>=44032&&t<=55203||t>=4352&&t<=4607||t>=12592&&t<=12687||t>=43360&&t<=43391||t>=55216&&t<=55295},Util.isTabVisible=function(){return"hidden"!==document.visibilityState},Util.showEmbeddedError=function(e,t,r,n){document.getElementsByTagName("sv_error_page").length||(document.body.innerHTML=n.get("error-template")),document.getElementById("error-title").textContent=e,document.getElementById("error-description").textContent=t,document.getElementById("spinner").style.display="none"},Util.showError=function(e,t,r,n){reportWarnClientEvent("tc-main-show-error-page",{title:e,body:t,extra:r}),safeview&&safeview.event_reporter&&safeview.event_reporter.flush(),Util.showEmbeddedError(e,t,r,n)},Util.getDocIdIfSafedocs=function(){return window.location.href.indexOf("/doc/docview/viewer")>-1||window.location.href.indexOf("/cloudview/viewer")>-1||window.location.href.indexOf("viewer.documentisolation:8081")>-1?window.location.href.substring(window.location.href.lastIndexOf("/")+1):null},Util.getQueryValue=function(e,t){var r,n;if(BrowserDetect.isIE()||!window.URLSearchParams){for("?"===e.charAt(0)&&(e=e.substring(1)),r=decodeURIComponent(e).split("&"),n=0;n<r.length;n+=1){if(r[n]===t)return"";if(r[n].startsWith(t+"="))return r[n].substring(t.length+1)}return null}return(r=new window.URLSearchParams(e)).get(t)},Util.addQueryValue=function(e,t,r){var n,i,o,a;if(BrowserDetect.isIE()||!window.URLSearchParams){for(n=e.substring(1).split("&"),o=encodeURIComponent(t)+"="+encodeURIComponent(r),a=0;a<n.length;a+=1)if(""===(i=decodeURIComponent(n[a])))n.splice(a,1);else{if(i===t){n[a]=o;break}if(i.startsWith(t+"=")){n[a]=o;break}}return a>=n.length&&(n[n.length]=o),"?"+n.join("&")}return(n=new window.URLSearchParams(e)).set(t,r),"?"+n.toString()},Util.addQueryValueToLocation=function(e,t,r){var n=e.href,i=e.search,o=e.hash;return!o&&n.endsWith("#")&&(o="#"),o&&(n=n.slice(0,-o.length)),!i&&n.endsWith("?")&&(i="?"),i&&(n=n.slice(0,-i.length)),n+(i=Util.addQueryValue(i,t,r))+o},Util.restoreLocationHint=function(){var e,t=Util.getUrlHint(Util.persistentPolicy());t&&(e=Util.addQueryValueToLocation(window.location,t.key,t.value),window.history.replaceState(window.history.state||{},document.title,e))},Util.xframe_reload=function(e){var t;BrowserDetect.isIE()&&Util.is_in_iframe()?(t=window.location.href,window.location.hash&&(t=Util.appendParam("sv_reload",1)),Util.locationSetHref(window,t)):(Util.restoreLocationHint(),window.location.reload(e))},Util.getIframeHelperURL=function(e,t,r,n){var i=Util.getUrlHint(Util.persistentPolicy()),o=window.location.protocol+"//"+window.location.host+"/safeview-redirect/tc_frame.html?dt="+encodeURIComponent(Util.b64Encode(e))+"&n="+t+"&a="+window.TC_API_VERSION;return o+="&fid="+r,n&&(o+="&turl="+encodeURIComponent(Util.b64Encode(new ParsedURL(n).defrag()))),i&&(o+="&"+i.key+"="+i.value),o},Util.formDecode=function(e){return decodeURIComponent(e.replace(/\+/g," "))},Util.startsWithAnyOf=function(e,t){var r;for(r=0;r<t.length;r+=1)if(__startswith(e,t[r]))return!0;return!1},Util.getBrowserScrollOffset=function(e,t){var r,n,i=Util.getVisualViewport();return e!==window?(assert(void 0!==e.scrollLeft),{x:e.scrollLeft,y:e.scrollTop}):i?(assert(void 0!==i.pageLeft&&void 0!==i.pageTop),{x:i.pageLeft-i.offsetLeft,y:i.pageTop-i.offsetTop}):BrowserDetect.isMobileSafari()?(r=e.scrollX,n=e.scrollY,{x:(r+=t.x)||0,y:(n+=t.y)||0}):(void 0!==e.pageYOffset?(r=e.pageXOffset,n=e.pageYOffset):(r=e.scrollLeft||e.scrollX,n=e.scrollTop||e.scrollY),{x:r||0,y:n||0})},Util.is_element_date_time_input=function(e){return"input"===Util.get_node_tag(e)&&!!Util.date_time_input_types[e.getAttribute("type")]},Util.is_supported_element_date_time_input=function(e){return Util.is_element_date_time_input(e)&&!!Util.date_time_input_types[e.type]},Util.is_unsupported_element_date_time_input=function(e){return Util.is_element_date_time_input(e)&&"text"===e.type},Util.is_element_color_input=function(e){return"input"===Util.get_node_tag(e)&&"color"===e.getAttribute("type")},Util.is_supported_element_color_input=function(e){return Util.is_element_color_input(e)&&"color"===e.type},Util.is_unsupported_element_color_input=function(e){return Util.is_element_color_input(e)&&"text"===e.type},Util.is_element_range_input=function(e){return"input"===Util.get_node_tag(e)&&"range"===e.getAttribute("type")},Util.is_element_visible=function(e){var t=getComputedStyle(e);return(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&"hidden"!==t.visibility&&"none"!==t.display&&"0"!==t.opacity},Util.get_corresponding_chrome_keycode=function(e,t){if("keypress"!==e.type&&BrowserDetect.isFirefox())switch(t){case 59:return 186;case 61:return 187;case 173:return 189}return t},Util.isPdfViewerDisabled=function(){return!1===navigator.pdfViewerEnabled||navigator.plugins&&0===navigator.plugins.length},Util.array_buffer_to_base64=function(e){return null===e?null:Util.Uint8ArrayToBase64(new Uint8Array(e))},Util.base64_to_uint8_array=function(e){var t,r=window.atob(e),n=new Uint8Array(r.length);for(t=0;t<r.length;++t)n[t]=r.charCodeAt(t);return n},Util.base64_to_array_buffer=function(e){return Util.base64_to_uint8_array(e).buffer},Util.join_array_buffers=function(e){var t,r,n=0,i=0;for(r=0;r<e.length;++r)n+=e[r].byteLength;for(t=new Uint8Array(n),r=0;r<e.length;++r)t.set(new Uint8Array(e[r]),i),i+=e[r].byteLength;return t.buffer},Util.isDataOrCtrlMessage=function(e){return e===MSG_KIND_DATA||e===MSG_KIND_CONTROL},Util.replaceAll=function(e,t,r){return e.replace(new RegExp(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),r)},Util.safeFocus=function(e){BrowserDetect.isIE()?(void 0===document.body.__sv_original_pos_style&&(document.body.__sv_original_pos_style=document.body.style.position),document.body.style.position="fixed",e.focus(),setTimeout((function(){void 0!==document.body.__sv_original_pos_style&&(document.body.style.position=document.body.__sv_original_pos_style,delete document.body.__sv_original_pos_style)}),0)):e.focus({preventScroll:!0})},Util.getShadowDomAwareSelection=function(e){for(var t,r,n=e.getSelection();n.anchorNode&&n.anchorNode===n.focusNode&&n.anchorOffset===n.focusOffset&&(n.anchorNode.nodeType===Node.ELEMENT_NODE||n.anchorNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE);){if((t=n.anchorOffset<n.anchorNode.childNodes.length?n.anchorNode.childNodes[n.anchorOffset]:n.anchorNode).nodeType===Node.ELEMENT_NODE)r=t.shadowRoot;else{if(t.nodeType!==Node.DOCUMENT_FRAGMENT_NODE)break;r=t}if(!(r&&r.getSelection&&r.getSelection().anchorNode))break;n=r.getSelection()}return n},Util.getSelectedOptionUids=function(e){var t,r,n=[];for(r=0,t=0;t<e.options.length;t++)e.options[t].selected&&(n[r++]=getUidByNode(e.options[t]));return n},Util.BiMap=function(){var e=this,t={},r={};e.erase=function(e,n){t.hasOwnProperty(e)&&r.hasOwnProperty(n)&&t[e]===n&&r[n]===e&&(delete t[e],delete r[n])},e.set=function(e,n){assert("number"==typeof e||"string"==typeof e),assert("number"==typeof n||"string"==typeof n),t.hasOwnProperty(e)&&t[e]!==n&&delete r[t[e]],r.hasOwnProperty(n)&&r[n]!==e&&delete t[r[n]],t[e]=n,r[n]=e},e.getValByKey=function(e){return t[e]},e.getKeyByVal=function(e){return r[e]},e.viewFromLeft=function(){return __object_assign({},t)},e.viewFromRight=function(){return __object_assign({},r)}},Util.requiresCofRequest=function(e){return!!Util.areAuthTokensInUse()&&(!!e.startsWith("https://")&&(-1===e.indexOf("&k=")||-1===e.indexOf("?k=")||(-1===e.indexOf("&b=")||-1===e.indexOf("?b="))))},Util.same_origin=function(e,t){return Util.origin_of(e)===Util.origin_of(t)};var EventListener=new EventListenerModule;function ExitHandler(e){var t=!1;this.openingLocalApp=function(){t=!0},this.isLocalAppOpening=function(){return t},EventListener.addListener(window,"beforeunload",(function r(){t?setTimeout((function(){t=!1}),100):(e.callback.fire("safeview-exit"),EventListener.removeListener(window,"beforeunload",r,!1))}),!1)}function Selection(e){function t(t,r,n,i,o,a,s){var l,c=getWindowByFid(t),d=c.document,u=c.getSelection();if(!e.ui_frame.active()){if(local_echo_enabled&&local_echo_config.extended&&e.lecho_regulator_ext.defer_range_sel_if_needed(t,r,n,i,o,a))return!0;if(!e.local_input.defer_range_sel_if_needed(t,r,n,i,o,a,s)&&!e.local_events.defer_range_sel_when_mouse_down(t,r,n,i,o,a,s))try{s&&d.activeElement!==s&&(d.activeElement&&d.activeElement.blur(),Util.safeFocus(s)),u.removeAllRanges(),(l=d.createRange()).setStart(n,i),l.setEnd(o,a),u.addRange(l),e.clipboard.set_last_selection_fid(t)}catch(e){reportWarnClientEvent("tc-sel-range-error",{error:e.toString()})}}}this.getSelection=function(t){var r,n=Util.is_element_input_text(t)?function(e){var t={start:e.selectionStart,end:e.selectionEnd};return{mode:"input",collapsed:t.start===t.end,uid:getUidByNode(e),selection:t}}(t):function(t){var r,n,i,o,a,s,l;if((r=getWindowByFid(getFidByNode(t)))||(r=t.ownerDocument.defaultView),!(n=Util.getShadowDomAwareSelection(r)).rangeCount)return{mode:"clear",collapsed:!0,uid_start:0,uid_end:0,selection_start:0,selection_end:0};i=n.getRangeAt(0);try{o=getUidByNode(i.startContainer),a=getUidByNode(i.endContainer),s=i.startOffset,l=i.endOffset}catch(e){o=getUidByNode(n.anchorNode),a=getUidByNode(n.focusNode),s=n.anchorOffset,l=n.focusOffset}return o&&a||(e.local_input.is_node_attached(i.endContainer),3===i.endContainer.nodeType?i.endContainer.data:i.endContainer.nodeName,3===i.startContainer.nodeType?i.startContainer.data:i.startContainer.nodeName),{mode:"range",collapsed:n.isCollapsed,start_container:o,end_container:a,start_offset:s,end_offset:l}}(t),i=getWindowByFid(getFidByNode(t));return(r=t&&t.getRootNode?t.getRootNode().activeElement:i&&i.document.activeElement)&&(n.active_element=getUidByNode(r)),JSON.stringify(n),n},this.set_range_selection=t,e.interp.registerOpcodeHandler(e.interp.OPCODES.SET_SELECTIONS,(function(r,n){var i,o,a,s=JSON.parse(n),l=null,c=getWindowByFid(r);if(s.mode&&c)if("clearselection"===s.mode)!function(e){var t=getWindowByFid(e).getSelection();if(!t.isCollapsed)try{t.removeAllRanges()}catch(e){throw reportErrorClientEvent("tc-sel-clear-selection-fail",{error:e.toString()}),e}}(r);else if("input"===s.mode){if(!(a=getNodeByUid(r,s.uid)))return void reportErrorClientEvent("tc-sel-input-selection-fail",{detail:"Cannot set input selection: node",uid:s.uid});if(e.local_input.in_ime_mode(a))return;!function(t,r,n,i){var o;if(soft_assert(r,"null element passed to setInputSelection"),t.document.activeElement!==r&&Util.safeFocus(r),o="textarea"===Util.get_node_tag(r)&&local_echo_enabled&&local_echo_config.extended,r.selectionStart!==n||r.selectionEnd!==i||i!==n||o){if(local_echo_enabled&&Util.can_element_use_lecho(r))e.lecho_regulator.set_remote_caret(getFidByNode(r),getUidByNode(r),n,i);else if(o)e.lecho_regulator_ext.set_remote_caret(getFidByNode(r),getUidByNode(r),n,i);else try{r.selectionStart=n,r.selectionEnd=i}catch(e){}r.selectionStart,r.selectionEnd}}(c,a,s.selection.start,s.selection.end)}else if("range"===s.mode){if(s.active_element&&(l=getNodeByUid(r,s.active_element)),i=getNodeByUid(r,s.start_container),o=getNodeByUid(r,s.end_container),soft_assert(i,"selection data.start_container unknown"),soft_assert(o,"selection data.end_container unknown"),i.textContent&&o.textContent&&(s.start_offset>i.textContent.length||s.end_offset>o.textContent.length))return i.textContent.length,void o.textContent.length;t(r,s.mode,i,s.start_offset,o,s.end_offset,l)}}))}var browser={name:BrowserDetect.browser,version:BrowserDetect.version,os:BrowserDetect.OS},uidToNode={},fidToWindow={},fidToIframeNode={},fidToSvgRootUids={},frameNodeUidToFid={},fidToFrameNodeUid={};function setFidToIframe(e,t){fidToIframeNode[t]=e}function removeFidToIframe(e){delete fidToIframeNode[e]}function getIframeByFid(e){return fidToIframeNode[e]}function setFrameFidForNode(e,t,r){var n=getNodeKey(e,t);frameNodeUidToFid[n]=r,fidToFrameNodeUid[r]=n}var main_frame_fid=null;function setFidToWindow(e,t){assert(e),fidToWindow[t]=e,e.__sv_fid=t}function __init_id_state(e){main_frame_fid=e,uidToNode={},fidToWindow={},fidToIframeNode={},fidToSvgRootUids={},setFidToWindow(mf.window,e),setFidToIframe(mf.window,e)}function isTopFrameFid(e){return e===main_frame_fid}function getTopFrameFid(){return main_frame_fid}function getNodeKey(e,t){return e+"_"+t}function splitNodeKey(e){var t=e.split("_");return{fid:Number(t[0]),uid:Number(t[1])}}function setNodeIds(e,t,r){assert(e);var n=uidToNode[r];n||(n=uidToNode[r]={}),n[t]=e,e.__sv_uid=t,e.__sv_fid=r}function __re_init_id_state(){uidToNode={},fidToWindow={},fidToIframeNode={},fidToSvgRootUids={},setFidToWindow(mf.window,main_frame_fid),setFidToIframe(mf.window,main_frame_fid),setNodeIds(document,document.__sv_uid,document.__sv_fid)}function setNodeInMap(e,t,r,n){e[r]=t,t.__sv_uid=r,t.__sv_fid=n}function getNodeMapForFrame(e){return uidToNode[e]}function setNodeMapForFrame(e,t){uidToNode[e]=t}function getUidByNode(e){return assert(e),e.__sv_uid}function getNodeByUid(e,t){var r=uidToNode[e];if(r)return r[t]}function getNodeByUidOnly(e){var t,r;for(t in uidToNode)if(uidToNode.hasOwnProperty(t)&&(r=uidToNode[t])&&r.hasOwnProperty(e))return r[e]}function removeUidNodeEntry(e,t){var r=uidToNode[e];r&&delete r[t]}function removeUidNodeEntriesForFid(e){delete uidToNode[e]}function getFidByNode(e){var t=e.__sv_fid;return safeview.frameset_wrapper&&(t=safeview.frameset_wrapper.get_original_fid(t)),t}function getWindowByFid(e){if(fidToWindow.hasOwnProperty(e))return fidToWindow[e]}function removeFidWindowEntry(e){delete fidToWindow[e]}function getFrameFidByNode(e){var t=getFidByNode(e);return frameNodeUidToFid[t+"_"+getUidByNode(e)]||null}function getNodeByFrameFid(e){return fidToFrameNodeUid[e]?splitNodeKey(fidToFrameNodeUid[e]):null}function addSvgRootUidForFid(e,t,r){var n=fidToSvgRootUids[e];n||(fidToSvgRootUids[e]={},n=fidToSvgRootUids[e]),n[t]=r}function getSvgRootUidForFid(e,t){var r=fidToSvgRootUids[e];if(r)return r[t]}function removeSvgRootUidsForFid(e){delete fidToSvgRootUids[e]}function CallbackSupport(){var e=this,t=new Logger("callback",{level:"info"}),r={},n={},i=0,o={};function a(t,r,i){var o=n[t];assert(o),o.is_one_shot&&(o.timer_id&&(clearTimeout(o.timer_id),o.timer_id=null),e.deregister(o.id)),o.call_count+=1;try{o.callbacks[r].apply(this,i)}catch(e){throw reportErrorClientEvent("tc-cb-generated-exception",{cb_id:t,cb_event:o.event_name,cb_info:o,cb_ex:e}),e}}function s(e,t,o,s){var l={};return assert("string"==typeof e),assert("object"==typeof s),l.id=i+1,l.callbacks=s,l.event_name=e,l.is_one_shot=t,l.call_count=0,t&&o&&(assert(l.callbacks.on_timeout),l.timer_id=setTimeout((function(){a(l.id,"on_timeout",[])}),o)),assert(l.callbacks.on_success),i+=1,r[e]||(r[e]={}),assert(!r[e].hasOwnProperty(l.id)),r[e][l.id]=!0,n[l.id]=l,l.id,l.id}e.register=function(e,t){return s(e,!1,0,{on_success:t})},e.registerOneShot=function(e,t,r){return s(e,!0,t,r)},e.registerOnFirst=function(e,t){var r=s(e,!0,0,{on_success:t});return o.hasOwnProperty(e)&&o[e]>0?(a(r,"on_success"),null):r},e.deregister=function(e){var t=n[e];return!!t&&(t.event_name,assert(r.hasOwnProperty(t.event_name)),delete r[t.event_name][t.id],delete n[e],!0)},e.fire=function(e){var t,n=r[e]||{};for(t in assert("string"==typeof e),n)n.hasOwnProperty(t)&&a(t,"on_success",argumentsToArray(arguments).slice(1));o.hasOwnProperty(e)?o[e]++:o[e]=1},e.dumpStats=function(){var e,r;if(DEBUG)for(e in n)n.hasOwnProperty(e)&&(r=n[e],t.info("Callback: id="+e+" event="+r.event_name+" one_shot="+r.is_one_shot+" call_count="+r.call_count))}}function WheelCtrl(e){var t=this,r={};e.callback.register("frame-node-removed",(function(e){var t;for(t in r)r.hasOwnProperty(t)&&t.startsWith(e+"_")&&delete r[t]})),t.should_prevent_default=function(e){var t=getFidByNode(e),n=getUidByNode(e);return!(!t||!n)&&"SURR"===r[getNodeKey(t,n)]},t.on_elem_wheel_ctrl_msg=function(e,t,n){var i;(Object.keys(r).length||"TC"!==n)&&(i=getNodeKey(e,t),"SURR"===n?r[i]=n:"TC"===n&&delete r[i])},t.on_remove_node=function(e,t){var n;n=getNodeKey(e,t),delete r[n]}}function KeyCtrl(e){var t=this,r=new KeyMap,n=!1,i={},o={};function a(e,t,r,n,i,o){return[e,t,r,n,i,o].join("-")}e.callback.register("frame-node-removed",(function(e){var t;for(t in o)o.hasOwnProperty(t)&&t.startsWith(e+"_")&&delete o[t]})),t.set_prevent_local_all_keys=function(e){n=e},t.get_prevent_local_all_keys=function(){return n},t.set_wait_for_key_ctrl=function(e){var t,r,n;for(i={},t=0;t<e.length;t++)n=a((r=e[t]).type||"keypress",r.keycode,!!r.ctrl,!!r.shift,!!r.alt,!!r.meta),i[n]=!0},t.should_prevent_default=function(e,t,s,l,c,d,u,f){var p,g;return!(!e||!t)&&(!(!n||"keydown"===s&&r.SCROLLING_KEYS_ON_KEYPRESS.hasOwnProperty(l))||!!function(e,t,n,i,o){return t&&80===e||t&&187===e||o&&187===e||t&&189===e||o&&189===e||r.SCROLLING_KEYS_WITH_KEY_CTRL.hasOwnProperty(e)||r.FUNCTION_KEYS_WITH_KEY_CTRL.hasOwnProperty(e)}(l,c,0,0,f)&&(p=getNodeKey(e,t),g=a(s,l,c,d,u,f),o[p]&&o[p].hasOwnProperty(g)?o[p][g]:i.hasOwnProperty(g)))},t.on_elem_key_ctrl_msg=function(e,t,r,n,i,s,l,c,d){var u=getNodeKey(e,t),f=a(r,n,i,s,l,c);o[u]||(o[u]={}),o[u][f]=d},t.on_remove_node=function(e,t){delete o[getNodeKey(e,t)]}}function ShortcutKeyHandler(e,t){var r;function n(e){var t=0;return e.shiftKey&&(t+=1),e.ctrlKey&&(t+=2),e.altKey&&(t+=4),e.metaKey&&(t+=8),t}r="Mac"===browser.os||"iPhone/iPod"===browser.os?{65:{8:"selectAll"},66:{8:"bold"},67:{8:"copy"},70:{8:"inPageSearch"},71:{8:"inPageSearchNext",9:"inPageSearchPrev"},73:{8:"italic"},80:{8:"print"},85:{8:"underline"},86:{8:"paste"},88:{8:"cut"},90:{8:"undo",9:"redo"}}:{45:{1:"paste",2:"copy"},65:{2:"selectAll"},66:{2:"bold"},67:{2:"copy"},70:{2:"inPageSearch"},71:{2:"inPageSearchNext",3:"inPageSearchPrev"},73:{2:"italic"},80:{2:"print"},85:{2:"underline"},86:{2:"paste",3:"specialPaste"},88:{2:"cut"},89:{2:"redo"},90:{2:"undo"}},this.get_operation=function(e){var t;return"keydown"!==e.type?null:(t=r[e.keyCode])?t[n(e)]:null},this.tryProcess=function(e){var i,o=e.keyCode,a=e.target,s=e.type,l=n(e),c=!1;if("keydown"!==s&&"keypress"!==s)return!1;if("keypress"===e.type&&(e.altKey||e.metaKey||e.ctrlKey))return!0;if("Firefox"===browser.name&&browser.version<=24&&"keypress"===e.type&&!e.charCode)return!0;if(!r.hasOwnProperty(o))return!1;if(!(i=r[o][l]))return!1;switch(i){case"selectAll":case"bold":case"italic":case"underline":case"redo":case"undo":t&&(c=t(a,e,i))}return c}}function KeyMap(){var e=this,t={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",46:"Delete"},r={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Down:"ArrowDown",Right:"ArrowRight",Del:"Delete"};e.SPECIAL_KEYS={8:1,9:1,13:1,27:1,33:1,34:1,35:1,36:1,37:1,38:1,39:1,40:1,46:1},e.SCROLLING_KEYS={32:1,33:1,34:1,35:1,36:1,37:1,38:1,39:1,40:1},e.SCROLLING_KEYS_ON_KEYDOWN={33:1,34:1,35:1,36:1,37:1,38:1,39:1,40:1},e.SCROLLING_KEYS_ON_KEYPRESS={32:1},e.SCROLLING_KEYS_WITH_KEY_CTRL={32:1},e.FUNCTION_KEYS_WITH_KEY_CTRL={116:1},e.LECHO_SPECIAL_KEYS={8:1,35:1,36:1,37:1,39:1,46:1},e.getKeyCode=function(e){var n;return n=e.key||t[e.keyCode]||"","Unidentified"===(n=r[n]||n)&&(n=t[e.keyCode]||""),n},e.getCode=function(t){return BrowserDetect.isIE()?e.getKeyCode(t):t.code}}function PointerEventQueue(e,t){var r,n=[],i=this,o=!1,a=-1;function s(){clearTimeout(r),r=setTimeout((function(){i.flush()}),30)}i.flush=function(){n.length&&e.local_events.send_mouse_and_pointer_event(["multiple-mouse",t,{flg:BrowserDetect.isIE(),cnt:a,evts:n}]),clearTimeout(r),e.local_events.pointer_queue_flushed()},i.push_mouse_event=function(e,r,o,l){var c;return a+1>=n.length?(i.flush(),!1):(c=n[a+1],getFidByNode(e)!==t||r.substr(-3)!==c[1].substr(-3)||getUidByNode(e)!==c[0]||c[11]!==(o?getUidByNode(o):null)?(i.flush(),!1):(a+=1,c.push({m_btn:l}),s(),!0))},i.push_pointer_event=function(e,r,a,l,c,d,u,f,p,g,m,_,h,y,v,k,S,b,w,C,T,E,A,R,x,D,I,O){return getFidByNode(e)!==t?(i.flush(),!1):("pointerover"===r&&(o=!0),n.push([getUidByNode(e),r,y.x,y.y,y.relative_to_target,u,d,f,w,m,_,v?getUidByNode(v):null,h,a,l,c,p,g,k,S,b,C,T,E,A,R,x,D,I,O]),s(),!0)},i.flush_if_necessary=function(e){return!(!o||"pointerout"!==e)&&(i.flush(),!0)}}function LocalEvents(e){var t,r,n,i,o=this,a=new Logger("local-events",{level:"info"}),s=new KeyMap,l=new ShortcutKeyHandler(e,(function(t,r,n){var i,o=getFidByNode(r.target),a=getUidByNode(r.target),l=!1;switch(n){case"bold":case"italic":case"underline":case"selectAll":case"undo":case"redo":i=["kbd",o,a,r.type,r.keyCode,r.charCode,s.getKeyCode(r),s.getCode(r),r.shiftKey,r.ctrlKey,r.altKey,r.metaKey,0,!1],e.surrogate_channel.send.apply(e.surrogate_channel,i),l=!0}return l&&r.preventDefault(),l})),c=null,d=[0,0],u=null,f=[0,0],p={x:0,y:0},g=null,m={last_mouse_time:0,last_key_time:0},_=!1,h=null,y=!1,v=0,k=null,S=!1,b=!1,w=!1,C=!1,T={in_progress:!1,pending_end_msg:!1},E={};function A(t,r){var n,i;if(local_echo_enabled&&local_echo_config.extended&&(n=getFidByNode(t),void 0!==(i=getUidByNode(t))))switch(r.type){case"compositionstart":T.in_progress||(T.pending_end_msg||e.surrogate_channel.send("ime_state",n,i,!0),T.in_progress=!0,T.pending_end_msg=!1,T.fid=n,T.uid=i);break;case"compositionupdate":break;case"compositionend":T.in_progress&&(T.in_progress=!1,T.pending_end_msg=!0);break;case"keyup":!T.in_progress&&T.pending_end_msg&&(e.surrogate_channel.send("ime_state",T.fid,T.uid,!1),T.pending_end_msg=!1);break;default:assert(0)}}function R(t,r){A(t,r),e.local_input.handle_local_input_events(t,r)}function x(t,r){if(local_echo_enabled&&t.__keypress_just_happened)return Util.can_element_use_lecho(t)?e.lecho_regulator.update_local_value(getFidByNode(t),getUidByNode(t),t.value,v):e.lecho_regulator_ext.update_local_value(t,"input_evt"),void delete t.__keypress_just_happened;Util.is_element_date_time_input(t)||Util.is_element_color_input(t)?(Util.is_supported_element_date_time_input(t)||Util.is_supported_element_color_input(t))&&e.surrogate_channel.send("input",getFidByNode(t),getUidByNode(t),t.value):Util.is_element_range_input(t)?e.surrogate_channel.send("input",getFidByNode(t),getUidByNode(t),t.value):"select"!==Util.get_node_tag(t)?(e.local_input.handle_local_input_events(t,r),e.http_alert.update()):t.multiple?e.surrogate_channel.send("input",getFidByNode(t),getUidByNode(t),Util.getSelectedOptionUids(t)):e.surrogate_channel.send("input",getFidByNode(t),getUidByNode(t),t.value)}function D(t,r){local_echo_enabled&&t.__keypress_just_happened||e.local_input.handle_local_input_events(t,r)}function I(t,r){local_echo_enabled&&t.__keypress_just_happened||e.local_input.handle_local_input_events(t,r)}function O(t,r){var n,i,o,a,s,l=!1;if(!e.copy_paste_ctrl.enforce_on_user_action(t,r)){if(a=e.copy_paste_ctrl.has_paste_restriction(),i=getFidByNode(t),o=getUidByNode(t),n=getWindowByFid(i),r=r||n.event,k&&(clearTimeout(k),k=null),local_echo_enabled&&Util.can_element_use_lecho(t)&&Util.is_element_visible(t)&&e.lecho_regulator.lecho_enabled(i,o))return e.local_input.handle_local_input_events(t,r),S=!1,void(b=!1);b&&e.surrogate_channel.send("pre-paste"),s=function(t,r,n){var s;for(a&&Util.filterPasteDataList(n),s=0;s<n.length;s+=2)"file_obj_list"===n[s+1]&&(e.upload.setupDroppedUpload(n[s]),n[s]="placeholder");e.surrogate_channel.send("paste",i,o,n,t,r),l=!0}.curry(S,b),Util.makePasteDataList(r,n,s),S=!1,b=!1,l||!BrowserDetect.isIE()||a?r.preventDefault():e.local_input.handle_local_input_events(t,r)}}function U(e,t){return!(!s.SCROLLING_KEYS.hasOwnProperty(t)||!function(e){return!!("body"===Util.get_node_tag(e)||"html"===Util.get_node_tag(e)||e.scrollTo||e.scrollBy||e.scrollByLines||e.scrollByPages)}(e)||Util.is_element_input_text(e)||Util.is_elem_editable(e))}function M(t,r){r=Util.handle_autofill_event(t,r);var n,i,a,c,d,u,f=Util.get_node_tag(t),p=r.keyCode,g=r.ctrlKey,_=r.shiftKey,h=r.metaKey,y=r.altKey,C=!1,T=0,E=!1,R=l.get_operation(r);if(e.detached)e.prevent_reattach||(e.detached=!1,Util.xframe_reload());else if(m.last_key_time=Date.now(),w=!1,"keydown"===r.type&&(e.clipboard.piggyback(r),e.callback.fire("interaction",r)),"keyup"===r.type&&A(t,r),e.callback.fire("key-event",t,r),!e.print_handler.handlePrintKeyEventIfNeeded(r,R)){if(Util.getDocIdIfSafedocs()&&"inPageSearch"===R&&r.preventDefault(),local_echo_enabled&&"keyup"===r.type&&delete r.target.__keypress_just_happened,"keydown"===r.type&&e.context_menu.dismiss_if_necessary(r),"select"===f){if(!local_echo_enabled)return;if("keydown"!==r.type||9!==p)return}if(!o.local_text_input_in_date_time_field(t,f)&&!Util.is_unsupported_element_color_input(t)&&(p=Util.get_corresponding_chrome_keycode(r,p),a="keypress"===r.type&&0===p&&32===r.charCode?32:p,"keypress"===r.type&&r.altKey&&(BrowserDetect.isIE()||RegExp("^.$","u").test(r.key))&&(g=!1,h=!1,y=!1,C=!0),d=e.key_ctrl.should_prevent_default(getFidByNode(t),getUidByNode(t),r.type,a,g,_,y,h),u=U(t,a)&&("keydown"===r.type||"keypress"===r.type)&&d,(C||!l.tryProcess(r))&&!(BrowserDetect.isFirefox()&&BrowserDetect.version<=65&&"keypress"===r.type&&p>=112&&p<=123))){if(BrowserDetect.isFirefox()&&BrowserDetect.version>=37&&"checkbox"===r.target.type&&32===a&&(r.target.__sv_ignore_click_event=!0),local_echo_enabled){if(n=getFidByNode(t),i=getUidByNode(t),Util.can_element_use_lecho(t)){if(e.lecho_regulator.is_input_locked())return void r.preventDefault();("keypress"===r.type||"keydown"===r.type&&8===r.keyCode||"keydown"===r.type&&46===r.keyCode)&&e.lecho_regulator.lecho_enabled(n,i)&&(T=v+=1)}"keydown"!==r.type||13!==r.keyCode&&9!==r.keyCode||e.lecho_regulator.send_precheck(n,13===r.keyCode?"enter":"tab")}if("specialPaste"===l.get_operation(r)&&(S=!0),"paste"!==l.get_operation(r)&&"specialPaste"!==l.get_operation(r)||(b=!0,function(e,t){BrowserDetect.isIE()&&(k=setTimeout((function(){O(e,t)}),200))}(t,r)),"cut"===l.get_operation(r)&&(w=!0),function(t,r){return!(!(local_echo_enabled&&Util.can_element_use_lecho(r)&&e.local_input.has_pending_diff())||local_echo_config.extended&&"Enter"===t.key)}(r,t)||(c=["kbd",getFidByNode(t),getUidByNode(t),r.type,p,r.charCode,s.getKeyCode(r),s.getCode(r),_,g,y,h,T,u],e.surrogate_channel.send.apply(e.surrogate_channel,c),E=!0),local_echo_enabled&&Util.can_element_use_lecho(t)){if(n=getFidByNode(t),i=getUidByNode(t),"keydown"===r.type&&(e.lecho_regulator.set_last_keypress(n,i,p),s.LECHO_SPECIAL_KEYS.hasOwnProperty(p)&&e.lecho_regulator.lecho_enabled(n,i)))return void(t.__keypress_just_happened=!0);if("keypress"===r.type&&e.lecho_regulator.lecho_enabled(n,i))return void(r.target.__keypress_just_happened=!0)}local_echo_enabled&&local_echo_config.extended&&Util.is_content_editable(t)&&e.lecho_regulator_ext.process_keyevent_locally(r,E)||(!function(e,t,r){return e||t||r}(h,g,y)?U(t,a)?u&&r.preventDefault():(s.FUNCTION_KEYS_WITH_KEY_CTRL.hasOwnProperty(a)&&d||"keydown"!==r.type||s.SPECIAL_KEYS.hasOwnProperty(p))&&r.preventDefault():d&&r.preventDefault())}}}function F(e,t){var r=Util.calculateMouseMovement(e);c||u||setTimeout((function(){var e;u&&(e={pt_x:f[0],pt_y:f[1]},c&&c[0]===u[0]&&(e.m_x=d[0],e.m_y=d[1],e.m_btn=c[7],c=null),u.push(e),o.send_pointer_event.apply(null,u)),c&&(c.push(d[0]),c.push(d[1]),o.send_mouse_event.apply(null,c)),c=null,u=null,d=[0,0],f=[0,0]}),100),"pointermove"===e.type?(f[0]+=r.x,f[1]+=r.y,u=t):"mousemove"===e.type&&(d[0]+=r.x,d[1]+=r.y,c=t)}function P(e){return e.ctrlKey||e.shiftKey||e.metaKey}function L(e){return Util.findPredicateOnBranch(e,Util.is_node_likely_anchor_tag)}function N(t){var r;return!!e.pairing_dict.mpa_id&&(r=Util.findPredicateOnBranch(t,(function(e){var t=e.className;return"string"!=typeof t&&(t=t&&t.baseVal||""),t.toLowerCase().indexOf("sign-in-again")>=0})),Util.findPredicateOnBranch(r,(function(e){return(e.id||"").toLowerCase().indexOf("menlo_mpa")>=0})))}function B(e){var t=Util.get_node_tag(e);return!!("a"===t&&e.href||("input"===t||"button"===t)&&"submit"===e.type.toLowerCase()||"input"===t&&"image"===e.type.toLowerCase()||"input"===t&&"checkbox"===e.type.toLowerCase()||"img"===t||"map"===t)}function H(t){var r=null;!TPROXY_ENABLED&&e.pairing_dict.prepend_client_navs?r=window.location.origin+"/"+t.href:TPROXY_ENABLED&&__startswith(t.href,"ext://")&&(r=e.url_builder.buildServiceURL(t.href)),null!==r&&(setTimeout((function(e){t.href=e}),0,t.href),t.href=r)}function V(t,n,i){var o,a=Util.get_node_tag(i);if(n===r)return e.wheel_ctrl.should_prevent_default(i);if("click"===n&&"input"===a&&"file"===i.type)return!i.getAttribute("__sv_open");if("click"===n&&Util.is_supported_element_color_input(i))return!i.hasAttribute("data-sv-color-chooser-open");if(function(e){return 1===e.button&&("mousedown"===e.type||"mouseup"===e.type)}(t)&&e.readonly.allow_tab_creation()&&(o=L(i)))return H(o),!1;if(function(e,t,n){var i=Util.get_node_tag(n),o="click"===t||"mousedown"===t||"mouseup"===t;return t===r||"mouseenter"===t||"mousedown"===t||"mouseleave"===t||1===e.button||2===e.button||o&&("select"===i||("audio"===i||"video"===i)&&n.controls||"input"===i&&Util.date_time_input_types[n.type])||"input"===i&&"password"===n.type&&"click"===t&&BrowserDetect.isChromiumEdge()}(t,n,i))return!1;if("click"===n&&(o=L(i))){if(e.readonly.allow_tab_creation()&&P(t))return H(o),!1;if(Util.isMPAPortalUrl()&&"_blank"===o.target)return!1;if(N(o))return!1;if("_blank"===o.target&&!o.hasAttribute("download")&&e.tab.tabPreOpen(Util.getRawPageUrl(o.href)))return!0}return!!function(e){return!!Util.findPredicateOnBranch(e,B)}(i)||"click"===n}function W(t,r){var n=r.type,i=r.pointerId,a=r.pointerType,s=r.bubbles,l=r.altKey,c=r.ctrlKey,d=r.shiftKey,u=r.cancelBubble,f=r.cancelable,p=r.button,m=r.buttons||0,_=r.detail||1,h=Util.getRelativeMouseCoords(t,r),y=o.get_mouse_event_reltarget(n,r),v=r.tiltX,k=r.tiltY,S=r.twist,b=r.metaKey,w=r.altitudeAngle,C=r.azimuthAngle,T=r.tangentialPressure,E=r.pressure,A=r.composed,R=r.defaultPrevented,x=r.eventPhase,D=r.isPrimary,I=r.isTrusted;switch(n){case"pointermove":F(r,[t,n,i,a,s,l,c,d,u,f,p,m,_,h,y,v,k,S,b,w,C,T,E,A,R,x,D,I]);break;case"pointerleave":case"pointerout":case"pointerover":case"pointerenter":g&&g.flush_if_necessary(n)&&(g=new PointerEventQueue(e,getFidByNode(t))),g||"pointerout"!==n&&"pointerleave"!==n||(g=new PointerEventQueue(e,getFidByNode(t))),g&&g.push_pointer_event(t,n,i,a,s,l,c,d,u,f,p,m,_,h,y,v,k,S,b,w,C,T,E,A,R,x,D,I)||(g=null,setTimeout((function(){o.send_pointer_event(t,n,i,a,s,l,c,d,u,f,p,m,_,h,y,v,k,S,b,w,C,T,E,A,R,x,D,I)}),0));break;default:setTimeout((function(){o.send_pointer_event(t,n,i,a,s,l,c,d,u,f,p,m,_,h,y,v,k,S,b,w,C,T,E,A,R,x,D,I)}),0)}}function z(a,s){var l,c,d,u,f,_,h,v,k,S=s.type,b=!0;if(e.detached)e.prevent_reattach||(e.detached=!1,Util.xframe_reload());else if(m.last_mouse_time=Date.now(),"mousedown"===s.type&&(e.clipboard.piggyback(s),e.callback.fire("interaction",s)),"click"===S&&s.target.__sv_ignore_click_event)delete s.target.__sv_ignore_click_event;else if(assert(getFidByNode(a)),assert(getUidByNode(a)),l=s.detail||1,c=Util.getRelativeMouseCoords(a,s),function(e,t){var r,n,i=getFidByNode(e);for(p={x:t.clientX,y:t.clientY};i&&!isTopFrameFid(i);)(n=getWindowByFid(i).frameElement)?((r=n.getBoundingClientRect())&&(p.x+=r.left,p.y+=r.top),i=getFidByNode(n)):i=null}(a,s),d=o.get_mouse_event_reltarget(S,s),u=s.ctrlKey,f=s.altKey,_=s.shiftKey,h=s.metaKey,v=s.button,k=s.buttons||0,void 0!==s.composed&&(b=s.composed),"mousedown"===S&&e.context_menu.dismiss_if_necessary(s),"mousedown"===S&&2===k&&"img"===a.nodeName.toLowerCase()&&e.imgreq_mgr.request_image(a,s),"mousedown"===S&&0===v&&(y=!0),"mouseup"===S&&(y=!1),V(s,S,a)&&s.preventDefault(),!function(r,n,i){var o,a=Util.get_node_tag(i);if(t&&"mouseup"===n)return!1;if(1===r.button)return!0;if("click"===n){if("input"===a&&"file"===i.type)return!!i.getAttribute("__sv_open")&&(i.removeAttribute("__sv_open"),!0);if(Util.is_supported_element_color_input(i))return!!i.hasAttribute("data-sv-color-chooser-open")&&(i.removeAttribute("data-sv-color-chooser-open"),!0);if(o=L(i)){if(Util.isMPAPortalUrl()&&"_blank"===o.target)return!0;if(N(o))return!0}return e.readonly.allow_tab_creation()&&P(r)&&!!o}return"mousedown"===n&&"option"===a||"dblclick"===n}(s,S,a))switch(!g||S!==r&&"click"!==S&&"dblclick"!==S||g.flush(),S){case"mousedown":if(2===v){o.send_mouse_button_and_selection(a,S,c,u,f,_,h,v,k,d,l,b,null);break}t=a,local_echo_enabled&&Util.can_element_use_lecho(a)&&e.lecho_regulator.lock_input(),setTimeout((function(){o.send_mouse_event(a,S,c,u,f,_,h,v,k,d,l,b)}),0);break;case"mouseup":o.send_mouse_button_and_selection(a,S,c,u,f,_,h,v,k,d,l,b,t),local_echo_enabled&&setTimeout((function(){e.lecho_regulator.unlock_input()}),0),t=null;break;case r:!function(t,r,o){var a,s,l,c,d,u;switch(o){case"mousewheel":void 0===n?(s=t.wheelDelta?-t.wheelDelta:0,a=0):(s=i,a=n,n=void 0),l=0,c=0,d=t.wheelDelta,u=t.wheelDelta;break;case"wheel":s=t.deltaY,a=t.deltaX,l=t.deltaMode,c=t.wheelDeltaX,d=t.wheelDeltaY,u=t.wheelDelta;break;default:assert(!1)}(a||s)&&(assert(0===l||1===l),1===l&&(s*=40,a*=40,l=0),e.surrogate_channel.send("wheel",getFidByNode(r),getUidByNode(r),{deltaMode:l,deltaX:a,deltaY:s,cancelable:!0,bubbles:t.bubbles,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,pageX:t.pageX,pageY:t.pageY,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,wheelDeltaX:c,wheelDeltaY:d,wheelDelta:u,composed:void 0===t.composed||t.composed}))}(s,a,S);break;case"mousemove":F(s,[a,S,c,u,f,_,h,v,k,d,l,!1]);break;case"mouseover":case"mouseout":case"mouseenter":case"mouseleave":local_echo_enabled&&e.lecho_regulator.set_mouse_moved(),"mouseenter"===S&&"html"===Util.get_node_tag(a)&&isTopFrameFid(getFidByNode(a))&&delete e.last_mouse_pos,g&&g.push_mouse_event(a,S,d,v)||(g=null,setTimeout((function(){o.send_mouse_event(a,S,c,u,f,_,h,v,k,d,l,b)}),0));break;default:setTimeout((function(){o.send_mouse_event(a,S,c,u,f,_,h,v,k,d,l,b)}),0)}}function G(t,r){"touchend"===r.type&&e.callback.fire("interaction",r)}function j(t,r){var n="input"===Util.get_node_tag(t)&&"file"===t.type&&!t.disabled,i="drop"===r.type&&r.dataTransfer&&r.dataTransfer.files&&r.dataTransfer.files.length>0;assert(t),e.copy_paste_ctrl.enforce_on_user_action(t,r)||("dragstart"===r.type&&"div"===t.nodeName.toLowerCase()&&(t.className.toLowerCase().indexOf("ytp-volume-slider")>=0||t.className.toLowerCase().indexOf("ytp-progress-bar")>=0)?r.preventDefault():(e.allow_backend_dragdrop||n)&&"#text"!==t.nodeName&&(i&&e.upload.setupDroppedUpload(r.dataTransfer.files,t),"dragstart"===r.type?r.dataTransfer.items&&r.dataTransfer.items.clear():r.preventDefault(),e.surrogate_channel.send("drag",getFidByNode(t),{t:getUidByNode(t),y:r.type,p:Util.getRelativeMouseCoords(t,r),m:Util.calculateDragMovement(r),d:Util.getMouseAndKeyboardModifiers(r,a),f:Util.gen_dragdrop_file_list(r.dataTransfer),i:r.dataTransfer.items})))}function Y(t,r){var n=getWindowByFid(getFidByNode(t)),i=t,o=n&&n.__sv_surrogate_is_readonly,a=Util.findPredicateOnBranch(t,Util.is_node_likely_anchor_tag),s=Util.getTopWindowMousePosition(r);if(e.copy_paste_ctrl.enforce_on_user_action(t,r),"img"===t.nodeName.toLowerCase()&&e.imgreq_mgr.request_image(t,r),e.context_menu.set_last_pos(s),a&&o)r.preventDefault();else if(e.ctx_menu_mode&&e.ctx_menu_mode.backend_driven){if(e.ctx_menu_mode.native_menu_for_input&&(3===i.nodeType&&(i=i.parentNode),Util.is_element_input_text(i)||Util.is_elem_editable(i)))return;z(t,r),r.preventDefault()}else e.ctx_menu_mode&&e.ctx_menu_mode.hasOwnProperty("backend_driven")||z(t,r)}function X(t,r){var n=Util.get_node_tag(t);if("select"!==n)if("input"!==n||"file"!==t.type){if(Util.is_element_date_time_input(t)||Util.is_element_color_input(t))return(Util.is_unsupported_element_date_time_input(t)||Util.is_unsupported_element_color_input(t))&&e.surrogate_channel.send("input",getFidByNode(t),getUidByNode(t),t.value),void e.surrogate_channel.send("change",getFidByNode(t),getUidByNode(t),t.value);if(Util.is_element_range_input(t))e.surrogate_channel.send("change",getFidByNode(t),getUidByNode(t),t.value);else{if("input"!==n||!t.list)return t.sv_pending_autofill_change_evt?(e.surrogate_channel.send("change",getFidByNode(t),getUidByNode(t),t.value),void delete t.sv_pending_autofill_change_evt):void 0;e.surrogate_channel.send("change",getFidByNode(t),getUidByNode(t),t.value)}}else e.upload.setupUploads(t,r);else t.multiple?e.surrogate_channel.send("change",getFidByNode(t),getUidByNode(t),t.value,Util.getSelectedOptionUids(t)):e.surrogate_channel.send("change",getFidByNode(t),getUidByNode(t),t.value,t.selectedIndex)}function q(t,r){var n,i,a,s,l,c=0,d=0,u=0,f=0;t=r.target,e.http_alert.update(),s=getFidByNode(t),l=getUidByNode(t),o.ignored_events.scroll[s+"_"+l]?delete o.ignored_events.scroll[s+"_"+l]:"marquee"!==Util.get_node_tag(t)&&("#document"===t.nodeName?(n=getWindowByFid(getFidByNode(t=t.documentElement)))&&void 0!==n.pageXOffset&&(d=n.pageXOffset,c=n.pageYOffset,u=n.innerWidth,f=n.innerHeight):(d=t.scrollLeft,c=t.scrollTop,u=t.clientWidth,f=t.clientHeight),a=t.scrollHeight,(i=t.scrollWidth)&&a?(d=i>u?d/(i-u):0,c=a>f?c/(a-f):0,e.surrogate_channel.send("scroll",s,l,d,c)):reportWarnClientEvent("tc-scroll-ignored-bad-dim",{target_uid:l,x:d,y:c}))}function K(e,t){t.preventDefault(),t.stopImmediatePropagation()}function Q(e,t){}function J(t,r){var n;e.copy_paste_ctrl.enforce_on_user_action(t,r)||(Util.is_element_input_text(t)||r.preventDefault(),e.clipboard.cut_event_handler(r),t.__sv_cut_happened=!0,!TPROXY_ENABLED&&Util.is_autofill_target(t)&&setTimeout((function(){delete t.__sv_cut_happened}),100),w||(n=getFidByNode(t),e.surrogate_channel.send("execcmd",n,"cut")),w=!1)}function Z(t,r){e.copy_paste_ctrl.enforce_on_user_action(t,r)||e.clipboard.copy_event_handler(r)}function $(e,t){}function ee(t,r){BrowserDetect.isChromiumEdge()&&e.copy_paste_ctrl.has_disabled_all_ctx_menu()&&(3===t.nodeType&&t.parentElement&&t.parentElement.isContentEditable||1===t.nodeType&&t.isContentEditable||r.preventDefault())}function te(t,r){e.surrogate_channel&&e.surrogate_channel.send("acquire-focus")}function re(e,t){var r,n;if(r=getFidByNode(e),n=getUidByNode(e),r&&n)switch(t.type){case"animationstart":E[r+"_"+n]=e;break;case"animationend":case"animationcancel":delete E[r+"_"+n];break;default:reportWarnClientEvent("tc-unknown-animation-event")}}function ne(t,r){var n=e.xbrowser.getEventTarget(r);n&&!Util.IsEventTargetForeign(n,r)&&(function(e,t){return t.currentTarget&&11===t.currentTarget.nodeType&&e.getRootNode&&e.getRootNode()!==t.currentTarget?(t.type,t.currentTarget,t.currentTarget.__sv_uid,!0):!(!e.shadowRoot||!e.shadowRoot.__sv_uid)&&(t.type,e.__sv_uid,e!==t.composedPath()[0])}(n,r)||(o.ignored_events[r]?o.ignored_events[r]=!1:t(n,r)))}function ie(e,t,r){var n,i;for(n=0;n<o.window_params.length;n+=1)i=o.window_params[n],e?EventListener.addListener(t,i[0],i[1],i[2]):EventListener.removeListener(t,i[0],i[1],i[2]);for(n=0;n<o.document_params.length;n+=1)i=o.document_params[n],e?EventListener.addListener(r,i[0],i[1],i[2]):EventListener.removeListener(r,i[0],i[1],i[2])}BrowserDetect.isIE()?(r="mousewheel",EventListener.addListener(document,"wheel",(function(e){n=e.deltaX,i=e.deltaY}))):r="wheel",o.ignored_events={},o.ignored_events.scroll={},o.get_last_mouse_pos=function(){return p},o.local_text_input_in_date_time_field=function(e,t){return void 0===t&&(t=Util.get_node_tag(e)),!!Util.is_element_date_time_input(e)&&("text"===e.type||!!BrowserDetect.isChrome())},o.getTimeFromLastInput=function(){return Date.now()-Math.max(m.last_key_time,m.last_mouse_time)},o.get_mouse_event_reltarget=function(e,t){var r=null;return"pointerover"===e||"mouseover"===e?r=t.relatedTarget||t.fromElement:"pointerout"===e||"mouseout"===e?r=t.relatedTarget||t.toElement:"pointerenter"!==e&&"mouseenter"!==e&&"pointerleave"!==e&&"mouseleave"!==e||(r=t.relatedTarget),r},o.set_drop_mouse_and_pointer=function(e){_=e},o.send_mouse_and_pointer_event=function(t){_||e.surrogate_channel.send.apply(e.surrogate_channel,t)},o.send_mouse_event=function(t,r,n,i,a,s,l,c,d,u,f,p,g,m){var _,h=getFidByNode(t);"mousedown"===r&&getUidByNode(t),!C&&local_echo_enabled&&"mousedown"===r&&e.lecho_regulator.send_precheck(h,"mousedown"),"mousedown"!==r&&"click"!==r||(C=!1),_=["mouse",h,getUidByNode(t),r,n.x,n.y,n.relative_to_target,i,a,s,l,c,d,u?getUidByNode(u):null,f,p],void 0!==g&&(_.push(g),_.push(m)),o.send_mouse_and_pointer_event(_)},o.send_pointer_event=function(t,r,n,i,a,s,l,c,d,u,f,p,g,m,_,h,y,v,k,S,b,w,T,E,A,R,x,D,I){var O,U=getFidByNode(t);local_echo_enabled&&"pointerdown"===r&&(e.lecho_regulator.send_precheck(U,"pointerdown"),C=!0),BrowserDetect.isFirefox()&&(n+=1),O=["pointer",U,getUidByNode(t),r,m.x,m.y,m.relative_to_target,l,s,c,k,f,p,_?getUidByNode(_):null,g,n,i,a,d,u,h,y,v,S,b,w,T,E,A,R,x,D],void 0!==I&&O.push(I),o.send_mouse_and_pointer_event(O)},o.send_mouse_button_and_selection=function(t,r,n,i,a,s,l,c,d,u,f,p,g){setTimeout((function(){for(var m=getWindowByFid(getFidByNode(g||t)).document.activeElement;m&&m.shadowRoot&&m.shadowRoot.__sv_uid;)m=m.shadowRoot.activeElement;"mouseup"===r&&0===c&&h&&(e.selection.set_range_selection(h[0],h[1],h[2],h[3],h[4],h[5],h[6]),h=null),m&&!Util.IsEventTargetForeign(m)&&(e.surrogate_channel.send("selection",getFidByNode(m),e.selection.getSelection(m)),e.clipboard.set_last_selection_fid(getFidByNode(m))),o.send_mouse_event(t,r,n,i,a,s,l,c,d,u,f,p)}),0)},this.pointer_queue_flushed=function(){g=null},o.resize_event=function(){var t=MetricsUtils.getVisualViewportMetrics();t.width,t.height,e.surrogate_channel.send("resize",Math.round(t.width),Math.round(t.height),Util.getDeviceScaleFactor()),e.http_alert.update()},o.install_event_listeners_for_shadowroot=function(e,t){ie(e,t,t)},o.install_event_listeners=function(t,r,n){t.__handlers_installed&&!n||(ie(!0,t,r),t.__resize_cb_id=e.callback.register("window-resized",o.resize_event),e.print_handler.attachKeyEventHandler(!0),t.__handlers_installed=!0)},o.uninstall_event_listeners=function(t,r){t.__handlers_installed&&(ie(!1,t,r),e.callback.deregister(t.__resize_cb_id),t.__resize_cb_id=null,e.print_handler.attachKeyEventHandler(!1),t.__handlers_installed=!1)},o.defer_range_sel_when_mouse_down=function(t,r,n,i,o,a,s){var l,c,d=getWindowByFid(t);if(!d)return!1;for(c=d.document.activeElement;c&&c.shadowRoot&&c.shadowRoot.__sv_uid;)c=c.shadowRoot.activeElement;return!(!y||!("range"===(l=e.selection.getSelection(c)).mode&&l.start_offset!==l.end_offset||"input"===c.nodeName.toLowerCase()&&"file"===c.getAttribute("type")&&BrowserDetect.isIE()))&&(h=[t,r,n,i,o,a,s],!0)},o.has_deferred_range_sel=function(){return!!h},o.key_event=M,o.send_focus_state=te,o.is_node_animating=function(e,t){return!!E[e+"_"+t]},o.clear_animation_node=function(e,t){delete E[e+"_"+t]},o.window_params=[["scroll",function(e){ne(q,e)},!0],["dblclick",function(e){ne(z,e)},!1],["input",function(e){ne(x,e)},!1],["textInput",function(e){ne(D,e)},!1],["beforeinput",function(e){ne(I,e)},!1],["compositionstart",function(e){ne(R,e)},!1],["compositionend",function(e){ne(R,e)},!1],["compositionupdate",function(e){ne(R,e)},!1],["focus",function(e){ne(te,e)},!0]],o.document_params=[["keydown",function(e){ne(M,e)},!0],["keypress",function(e){ne(M,e)},!0],["keyup",function(e){ne(M,e)},!0],["mousedown",function(e){ne(z,e)},!1],["mouseenter",function(e){ne(z,e)},!0],["mouseleave",function(e){ne(z,e)},!0],["mouseup",function(e){ne(z,e)},!1],["mousemove",function(e){ne(z,e)},!1],["mouseover",function(e){ne(z,e)},!1],["mouseout",function(e){ne(z,e)},!1],["dragstart",function(e){ne(j,e)},!1],["dragend",function(e){ne(j,e)},!1],["dragover",function(e){ne(j,e)},!1],["drag",function(e){ne(j,e)},!1],["drop",function(e){ne(j,e)},!1],["dragenter",function(e){ne(j,e)},!1],["dragleave",function(e){ne(j,e)},!1],[r,function(e){ne(z,e)},!0],["contextmenu",function(e){ne(Y,e)},!1],["submit",function(e){ne(K,e)},!1],["reset",function(e){ne(Q,e)},!1],["cut",function(e){ne(J,e)},!1],["copy",function(e){ne(Z,e)},!1],["paste",function(e){ne(O,e)},!1],["select",function(e){ne($,e)},!1],["selectstart",function(e){ne(ee,e)},!1],["change",function(e){ne(X,e)},!1],["click",function(e){ne(z,e)},!1],["touchend",function(e){ne(G,e)},!1],["pointerup",function(e){ne(W,e)},!1],["pointerdown",function(e){ne(W,e)},!1],["pointerenter",function(e){ne(W,e)},!0],["pointerover",function(e){ne(W,e)},!1],["pointerout",function(e){ne(W,e)},!1],["pointerleave",function(e){ne(W,e)},!0],["pointercancel",function(e){ne(W,e)},!1],["pointermove",function(e){ne(W,e)},!1],["animationstart",function(e){ne(re,e)},!1],["animationend",function(e){ne(re,e)},!1],["animationcancel",function(e){ne(re,e)},!1]]}function LocalInput(){var e,t,r=this,n=new Logger("localinput",{level:"info"}),i=null,o=null,a=[],s=null,l=null,c={},d={},u=null,f=null,p=null,g=null,m=-1,_=1,h=new diff_match_patch;function y(e){var t;return Util.is_element_input_text(e)?t=e.value:3===e.nodeType&&(t=e.data),t}function v(r){return r===e||r===t}function k(r){if(!e)return!1;for(;null!==r;){if(Util.is_elem_editable(r)&&(r===e||r===t))return!0;if(r===r.parentNode||!Util.is_elem_editable(r)&&1===r.nodeType)break;r=r.parentNode}return!1}function S(e,t){void 0===t&&(t=3!==e.nodeType||getUidByNode(e)||e.__sv_client_id?y(e):""),Util.is_element_input_text(e)||3===e.nodeType||reportErrorClientEvent("tc-local-input-error",{detail:"Unexpected node type in preserve value call"}),e.prev_text=t}function b(e,t){var r,n;if(!e.parentNode)return!1;if(t&&e.parentNode!==t)return!1;for(n=e.parentNode.childNodes,r=0;r<n.length;r+=1)if(n[r]===e)return!0;return!1}function w(){var e,t,r;for(a.length&&a.length;a.length;)"add"===(e=a.shift())[0]?(e[4].data,safeview.dom_updater.add_text_node(e[1],e[2],e[3],e[4])):"remove"===e[0]?(3===(r=e[3]).nodeType?(r.__sv_uid,r.data):(r.__sv_uid,r.childNodes.length),b(e[3],e[4])&&safeview.dom_updater.remove_node(e[1],e[2],e[3],e[4])):"update"===e[0]?(t=e[1],Util.is_element_input_text(t)?t.value:t.data,Util.is_element_input_text(t)?t.value=e[2]:local_echo_enabled&&local_echo_config.extended?t.data!==e[2]&&safeview.dom_updater.apply_text_node_patch(t,t.data,e[2]):safeview.dom_updater.apply_text_node_patch(t,t.data,e[2]),S(t,e[2])):assert(!1,"IME Unknown deferred operation.");s&&(s[2],s[2].__sv_uid,s[3],s[4],s[4].__sv_uid,s[5],safeview.selection.set_range_selection(s[0],s[1],s[2],s[3],s[4],s[5],s[6]),s=null)}function C(r,n){i&&(clearTimeout(i),i=null),e=r,t=n}function T(){if(BrowserDetect.isIE()){if(g){var e=g.data;g.data=e}var t,r,n;g&&(t=g.parentNode)&&t.hasChildNodes()&&(r=t.childNodes,-1===m||m>=r.length||(n=r[m])!==g&&n.data===g.data&&(n.__sv_uid||n.__sv_client_id||(setNodeIds(n,getUidByNode(g),getFidByNode(g)),n.__sv_client_id=g.__sv_client_id,delete g.__sv_client_id,delete g.__sv_uid,delete g.__sv_fid,n.__sv_client_id,n.__sv_uid))),g=null,m=-1}}function E(r){"compositionend"===r&&(i=setTimeout((function(){e=null,t=null,T(),w(),i=null}),0))}function A(e,t){var n=function(e){var t,r,n,i,o;if(t=y(e),(r=function(e){var t=e.prev_text;return void 0===t&&(t=""),t}(e))===t)return[];for(i=0,o=(n=h.diff_main(r,t)).length;i<o;i+=1)1!==n[i][0]&&(n[i][1]=n[i][1].length);return n}(e),i=Util.hashCode(y(e)),o=r.EDIT_REASON_COMPOSITION,a=!0,s=!1;if(E(t),"paste"===t&&(o=r.EDIT_REASON_PASTE),l=(new Date).getTime(),!b(e))return e.__sv_client_id,void getUidByNode(e);if(getUidByNode(e)){if(!n.length&&function(e){var t=safeview.selection.getSelection(e);return(t.mode===c.mode||t.mode===d.mode)&&("range"===t.mode?t.start_container===c.start_container&&t.end_container===c.end_container&&t.start_offset===c.start_offset&&t.end_offset===c.end_offset||t.start_container===d.start_container&&t.end_container===d.end_container&&t.start_offset===d.start_offset&&t.end_offset===d.end_offset:"input"===t.mode&&(t.uid===c.uid&&t.selection.start===c.selection.start&&t.selection.end===c.selection.end||t.uid===d.uid&&t.selection.start===d.selection.start&&t.selection.end===d.selection.end))}(e))return;c=safeview.selection.getSelection(e),d=function(e,t){var r,n,i,o,a,s,l,c=0,d=-1;if(l=JSON.parse(JSON.stringify(e)),BrowserDetect.isFirefox())return l;if(0===(n=t.length))return l;if(1!==t[i=n-1][0]){if(n<2)return l;i=n-2}if(1!==t[i][0])return l;if(1!==(o=t[i][1]).length&&2!==o.length||!Util.is_korean_char(o))return l;for(r=0;r<=i;r+=1)switch(t[r][0]){case-1:break;case 0:c+=t[r][1];break;case 1:c+=t[r][1].length}if("input"===e.mode)a=e.selection.start,s=e.selection.end;else{if("range"!==e.mode)return reportErrorClientEvent("tc-local-input-error",{detail:"Unexpected selection mode",mode:e.mode}),l;a=e.start_offset,s=e.end_offset}return s===a+1?d=s:s===a&&s+1===c&&(d=c),-1!==d&&("input"===e.mode?(l.selection.start=d,l.selection.end=d):"range"===e.mode&&(l.start_offset=d,l.end_offset=d),l.collapsed=!0),l}(c,n),getUidByNode(e),JSON.stringify(n),JSON.stringify(c),JSON.stringify(d),Util.is_element_input_text(e)&&(a=function(e,t){var r,n=0,i=0;for(r=0;r<e.length;r+=1)switch(e[r][0]){case-1:break;case 0:n+=e[r][1];break;case 1:i=n+e[r][1].length,n+=e[r][1].length;break;default:assert(!1)}return!t.selection||t.selection.start!==t.selection.end||t.selection.start!==i}(n,d)),local_echo_enabled&&local_echo_config.extended&&Util.is_content_editable(e)&&(safeview.lecho_regulator_ext.update_local_value(e,"txtdiff"),s=!0),safeview.surrogate_channel.send("edtx",getFidByNode(e),getUidByNode(e),n,d,a,i,o,s)}else!function(e,t,r,n){var i,o,a,s,l,c,d,u=[],f=0,p=-1,h=!1,y=!1;for(void 0===e.__sv_client_id&&(e.__sv_client_id="l"+_,e.__sv_client_id,_+=1),c=e.parentNode.childNodes,i=0;i<c.length;i+=1)if((d=c[i])===e){if(!e.__sv_client_id)return void reportErrorClientEvent("tc-local-input-error",{detail:"Missing a local node with client id."});u.push(e.__sv_client_id),g=e,m=i,y=!0}else void 0!==(o=getUidByNode(d))?u.push(o):reportErrorClientEvent("tc-local-input-error",{detail:"Unexpected local node among siblings"});if(y)if(u.length){for(a=e.parentNode;a&&!(f=getFidByNode(a));)a=a.parentNode;f?((s=e.ownerDocument.defaultView.getSelection()).rangeCount?(l=s.getRangeAt(0)).endContainer===e?p=l.endOffset:reportErrorClientEvent("tc-local-input-error",{detail:"Incorrect selection for ime node"}):reportErrorClientEvent("tc-local-input-error",{detail:"Selection missing for ime node"}),local_echo_enabled&&local_echo_config.extended&&Util.is_content_editable(e)&&(h=!0,safeview.lecho_regulator_ext.update_local_value(e,"txtdiff_local")),getUidByNode(e.parentNode),JSON.stringify(u),JSON.stringify(t),safeview.surrogate_channel.send("ednt",f,getUidByNode(e.parentNode),u,t,p,r,n,h)):reportErrorClientEvent("tc-local-input-error",{detail:"fid missing for the ime node"})}else reportErrorClientEvent("tc-local-input-error",{detail:"Empty sibling list is unexpected."});else reportErrorClientEvent("tc-local-input-error",{detail:"Inconsistent state about whether there is local node."})}(e,n,i,o);S(e),!TPROXY_ENABLED&&Util.is_autofill_target(e)&&(e.sv_prev_value=e.value)}r.EDIT_REASON_COMPOSITION=1,r.EDIT_REASON_BROWSER=2,r.EDIT_REASON_PASTE=3,r.clear_local_text=function(e,t){var r,n,i=getNodeByUid(e,t),o=[];if(i&&Util.is_elem_editable(i)&&i.hasChildNodes()){for(r=0;r<i.childNodes.length;r+=1)(n=i.childNodes[r]).__sv_client_id||n.__sv_uid||o.push(n);for(o.length;o.length;)n=o.shift(),i.removeChild(n)}},r.defer_update_if_needed=function(r,n){var i,o=!1;if(r!==e&&r!==t)return!1;if(local_echo_enabled&&local_echo_config.extended){for(i=0;i<a.length;i+=1)a[i][1]===r&&(a[i][2]=n,o=!0);o||a.push(["update",r,n])}else a.push(["update",r,n]);return Util.is_element_input_text(r),!0},r.defer_add_if_needed=function(e,t,r,n){return!!k(getNodeByUid(e,t))&&(a.push(["add",e,t,r,n]),n.data,!0)},r.defer_remove_if_needed=function(e,t,r){return k(r)?(a.push(["remove",e,getWindowByFid(e).document,t,r]),1===t.nodeType?(t.__sv_uid,r.__sv_uid):3===t.nodeType&&(t.data,t.__sv_uid,r.__sv_uid),!0):(getUidByNode(t),!1)},r.defer_range_sel_if_needed=function(e,t,r,n,i,o,a){return!(!v(i)&&!k(i)&&i.parentNode)&&(s=[e,t,r,n,i,o,a],!0)},r.in_ime_mode=v,r.is_editable_in_ime_mode=function(r){var n,i,o,a=[e,t];if(o=(new Date).getTime(),l&&o-l<500)return!0;for(n=0;n<a.length;n+=1)for(i=a[n];i&&(1===i.nodeType||3===i.nodeType);){if(i===r)return!0;i=i.parentNode}return!1},r.handle_local_input_events=function(e,t){var r,i,a,s;if(t.type,t.data,!safeview.local_events.local_text_input_in_date_time_field(e)&&!Util.is_unsupported_element_color_input(e)){if("input"===t.type)return function(e,t){if(f)return t.type,clearTimeout(f),A(p,u),f=null,u=null,void(p=null);if(!v(e)&&Util.is_element_input_text(e)){if(e.__sv_ignore_input_event)return e.__sv_ignore_input_event=!1,e.tagName,void e.__sv_uid;if((!BrowserDetect.isIE()||document.activeElement===e||!e.placeholder||e.value)&&e.sv_prev_value!==e.value){if(e.__sv_cut_happened)return delete e.__sv_cut_happened,void(e.sv_prev_value=e.value);if(!TPROXY_ENABLED&&Util.is_autofill_target(e))return e.value="password"===e.type?"":e.sv_prev_value,e.sv_prev_value=e.value,void safeview.surrogate_channel.send("input",getFidByNode(e),getUidByNode(e),e.value);e.value,Util.is_autofill_target(e)&&(e.sv_pending_autofill_change_evt=!0),safeview.surrogate_channel.send("input",getFidByNode(e),getUidByNode(e),e.value),e.sv_prev_value=e.value}}}(e,t),void(local_echo_enabled&&Util.can_element_use_lecho(e)&&(a=getFidByNode(e),s=getUidByNode(e),safeview.lecho_regulator.lecho_enabled(a,s)&&safeview.lecho_regulator.update_local_value(a,s,e.value,-1)));if(Util.is_element_input_text(e)||Util.is_elem_editable(e)){if(a=getFidByNode(e),Util.is_element_input_text(e))r=e;else{if(i=getWindowByFid(a).getSelection(),DEBUG&&Util.debug_print_selection(i,n),!(r=i.focusNode))return reportErrorClientEvent("tc-local-input-error",{detail:"No focus node found for local input event",event_type:t.type}),t.type,void E(t.type);getUidByNode(r),getUidByNode(e)}if(local_echo_enabled&&local_echo_config.extended&&"compositionstart"===t.type&&function(e){var t=safeview.selection.getSelection(e);"range"!==t.mode||t.collapsed||(e.ownerDocument.execCommand("delete"),safeview.surrogate_channel.send("execcmd",getFidByNode(e),"delete"),e.parentNode&&safeview.lecho_regulator_ext.update_local_value(e,"exec_del"))}(r),"compositionstart"===t.type&&(local_echo_enabled&&local_echo_config.extended&&f&&"compositionend"===u?o=setTimeout((function(){C(e,r),o=null}),0):C(e,r)),3===r.nodeType||Util.is_element_input_text(r))if(b(r)){if("paste"!==t.type||Util.is_element_input_text(r)){if("compositionstart"===t.type||"beforeinput"===t.type||"paste"===t.type){if(f&&function(e){return void 0!==e.prev_text}(r))return;S(r)}"compositionupdate"!==t.type&&"compositionend"!==t.type&&"textInput"!==t.type&&"paste"!==t.type||function(e,t){u=t,p=e,f=setTimeout((function(){A(e,t),f=null}),0)}(r,t.type)}}else E(t.type);else E(t.type)}else E(t.type)}},r.is_node_attached=b,r.has_pending_diff=function(){return null!==f},r.preserve_value=S,r.force_reset_ime_state=function(){o&&(clearTimeout(o),o=null),w(),e=null,t=null}}function LEchoRegulator(e){var t=this,r=!1,n={},i=!1,o=!1,a=new KeyMap,s=!1,l=null;function c(e,t){return e+"_"+t}function d(e){var t=e.split("_");return{fid:t[0],uid:t[1]}}function u(e){var t=local_echo_config.tolerance,r=local_echo_config.tolerance_time,n=e.local_value_list.length;return!n||n<=t+1&&Date.now()-e.local_value_list[n-1].ts<r}function f(t,o,a,s,l,d){var f=a.remote_value,p=function(e){return assert(e,"Input state not found."),38===e.last_keypress||40===e.last_keypress||!!r}(a)||function(e,t,r){var i=c(e,t),o=getNodeByUid(e,t);return assert(n[i],"Input state not found."),assert(o,"Input element is missing when checking auto completion."),0===r.indexOf(o.value)&&(o.value,!0)}(t,o,f)||function(e,t,r){var n,i=r.replace(/[\-, \,, \., \/, \:, \(, \)]/g,"");if(t.value.length>r.length&&0===t.value.indexOf(r))return!1;for(n=0;n<e.local_value_list.length;n+=1)if(e.local_value_list[n].val===i)return e.local_value_list[n].val,!0;return!1}(a,s,f);if(a.mode=2,i=!0,s.value=f,!d){if(p||!l)return;if(u(a))return}a.require_attention=!0,e.lecho_error_alert.add_alert_for_input(t,o,(function(){delete a.require_attention}))}function p(t,r){var n=e.localization.get("ID_MODAL_LECHO_ALERT_TEXT"),i=e.localization.get("ID_MODAL_LECHO_ALERT_TITLE");reportClientEvent("tc-lecho-modal-alert",{},!0,!1),e.ui_frame.call("showAlert",n,i)}function g(e,t){var r=getNodeByUid(e,t);return r?!(!Util.can_element_use_lecho(r)||!function(e,t){var r=c(e,t);return!!n.hasOwnProperty(r)}(e,t)):(reportErrorClientEvent("tc-lecho-error-missing-element",{detail:"The precheck failure message contains an input field that does not exist."}),!1)}function m(e){return!!local_echo_config.need_confirmation&&(!!function(){var e;for(e in n)if(n.hasOwnProperty(e)&&n[e].require_attention)return!0;return!1}()&&(local_echo_config.show_alert?p():reportClientEvent("tc-lecho-modal-alert",{skipped:!0},!0,!1),function(){var e;for(e in n)n.hasOwnProperty(e)&&delete n[e].require_attention}(),!0))}t.create_input_state=function(e){var t;DEBUG&&((t=getNodeByUid(d(e).fid,d(e).uid).getAttribute("type"))||(t="text"),t=t.toLowerCase(),assert(Util.input_text_types_strict.indexOf(t)>-1)),n[e]={mode:local_echo_enabled?1:2,local_value_list:[],remote_value:null,remote_care_pos:[0,0],last_keypress:null}},t.set_mouse_moved=function(){r=!0},t.set_last_keypress=function(e,i,o){var s,l=c(e,i);r=!1,n[l]||t.create_input_state(l),(s=n[l]).last_keypress=o,s.require_attention&&!a.LECHO_SPECIAL_KEYS.hasOwnProperty(o)&&delete s.require_attention},t.update_remote_value=function(e,r,o,a,s){var l,d,u,p=c(e,r),g=!1;if(assert(l=getNodeByUid(e,r),"Input element is missing when in update_remote_value."),n[p]||(t.create_input_state(p),l.value=o,n[p].local_value_list.push({ts:Date.now(),val:o})),(d=n[p]).remote_value=o,i||2===d.mode)l.value=o;else{if(!d.had_local_input)return l.value=o,void(d.local_value_list=[{ts:Date.now(),val:o}]);if(o||l.value){if(!o&&l.value)return d.mode=2,void(l.value=o);if(a)return f(e,r,d,l,s,!1),void reportWarnClientEvent("tc-lecho-mode-switched",{reason:"backend mismatch detected"});for(function(e){var t,r=[];for(t=0;t<e.local_value_list.length;t+=1)r.push(e.local_value_list[t].val);JSON.stringify(r)}(d),u=0;u<d.local_value_list.length;u+=1)if(d.local_value_list[u].val===o){g=!0,u===d.local_value_list.length-1&&(d.remote_has_caught_up=!0,l.value!==o&&reportErrorClientEvent("tc-lecho-error-wrong-local-value",{detail:"The last reconciled value on the local value list is inconsistent with the input value."}));break}g?(d.local_value_list.splice(0,u),1===d.local_value_list.length&&3===d.mode&&(d.mode=2)):(f(e,r,d,l,s,!1),reportWarnClientEvent("tc-lecho-mode-switched",{reason:"local match not found"}))}else d.local_value_list=[{ts:Date.now(),val:""}]}},t.update_local_value=function(i,o,a,s){var d,u,f,p=c(i,o);n[p]||t.create_input_state(p),u=(d=n[p]).local_value_list.length,r=!1,d.had_local_input=!0,l=Date.now(),f=-1===s,u>=1&&d.local_value_list[u-1].non_keypress&&f?(d.local_value_list[u-1].val=a,d.local_value_list[u-1].ts=Date.now()):d.local_value_list.push({ts:Date.now(),val:a,non_keypress:f}),d.remote_has_caught_up=!1,e.surrogate_channel.send("lecho-hash",i,o,Util.hashCode(a),s,DEBUG?a:void 0),d.local_value_list.length>local_echo_config.max_typeahead+1&&(d.mode=3,reportWarnClientEvent("tc-lecho-mode-switched",{reason:"typeahead buffer limit reached"}))},t.set_remote_caret=function(e,r,o,a){var s,l,d,u=c(e,r);if(n[u]||t.create_input_state(u),d=(s=n[u]).local_value_list.length,assert(l=getNodeByUid(e,r),"Input element is missing when setting remote caret."),i||2===s.mode)try{l.selectionStart=o,l.selectionEnd=a}catch(e){}else{if(o!==a&&(l.selectionStart!==o||l.selectionEnd!==a)){try{l.selectionStart=o,l.selectionEnd=a}catch(e){}s.remote_has_caught_up||d>=1&&s.local_value_list[d-1].non_keypress||(s.mode=2,l.value=s.remote_value)}s.remote_caret_pos=[o,a]}},t.lecho_enabled=function(e,r){var o=c(e,r);return n[o]||t.create_input_state(o),!i&&1===n[o].mode},t.send_precheck=function(t,r){var i,o=200;s||m()||(i=function(){var e,t,r,i,o,a=[];for(o in n)n.hasOwnProperty(o)&&n[o].had_local_input&&2!==n[o].mode&&(e=d(o).fid,e=parseInt(e,10),t=d(o).uid,(r=getNodeByUid(e,t=parseInt(t,10)))?(i=r.value,a.push([e,t,i||""])):reportErrorClientEvent("tc-lecho-error-clean-up",{detail:"Lecho state was not cleaned up properly"}));return a}()).length&&(l&&(o=Date.now()-l),o>=0&&o<200&&e.surrogate_channel.delay_once(200-o),e.surrogate_channel.send("precheck",t,r,i))},t.on_remove_node=function(e,t){var r=c(e,t);delete n[r]},t.lock_input=function(){o=!0},t.unlock_input=function(){o=!1},t.is_input_locked=function(){return o},t.reset=function(){n={}},e.interp.registerOpcodeHandler("precheck-failure",(function(e){var t,r,i,o,a=!1;if(local_echo_enabled){for(e.length||reportErrorClientEvent("tc-lecho-error-mismatch-list-empty",{detail:"The precheck failure message contains an empty mismatch list."}),t=e.length-1;t>=0;t-=1)g(i=e[0][0],r=e[0][1])||e.splice(t,1);if(e.length){for(e.length>1?a=!0:(i=e[0][0],r=e[0][1],u(n[c(i,r)])||(a=!0)),t=0;t<e.length;t+=1)o=getNodeByUid(i=e[t][0],r=e[t][1]),f(i,r,n[c(i,r)],o,!1,!a),reportWarnClientEvent("tc-lecho-mode-switched",{reason:"precheck failed"});a&&(p(),s=!0)}}else reportErrorClientEvent("tc-lecho-error-flag-mismatch",{detail:"The precheck failure message should not be sent from the backend because the lecho mode is not enabled."})}))}function LEchoRegulatorExt(e){var t=this,r=(new KeyMap,{}),n=0,i=!0,o={End:1,Home:1,ArrowLeft:1,ArrowUp:1,ArrowRight:1,ArrowDown:1},a={Backspace:1,Tab:1,Enter:1,Delete:1};function s(e){reportWarnClientEvent("tc-lecho-ext-warn",{reason:e})}function l(e,t){return e+"_"+t}function c(e){var t=e.split("_");return assert(void 0!==t[0]&&void 0!==t[1]),[parseInt(t[0]),parseInt(t[1])]}function d(e){return 3===e.nodeType?e.data:e.value}function u(r,n,i){e.local_input.force_reset_ime_state(),3===r.nodeType?(i&&(e.text_monitor.pause_all(),t.disable_ie_textinput_evt()),r.data=n,i&&(e.text_monitor.resume_all(),t.enable_ie_textinput_evt())):r.value=n}function f(e){return 3===e.nodeType||"textarea"===Util.get_node_tag(e)}function p(t,r){assert(f(r));var n=r;if(BrowserDetect.isIE()){for(;n;){if(n.parentNode===t)return!0;n=n.parentNode}return!1}return e.xbrowser.contains(t,r)}function g(e){assert(!r[e]),r[e]={restricted:!1,typeahead_overrun:!1,node_states:{},mismatch_count:{},exclusion_list:{}}}function m(e){assert(r[e]),r[e].scan_timer&&clearTimeout(r[e].scan_timer),delete r[e]}function _(e){var t,r;if("textarea"===Util.get_node_tag(e))return e;for(3===e.nodeType&&(e=e.parentNode),assert(e.isContentEditable),t=e,r=e;t.isContentEditable;)r=t,t=t.parentNode;return r}function h(e,t){var r,n;return"textarea"===Util.get_node_tag(t)?t:(r=getWindowByFid(e),(n=Util.getShadowDomAwareSelection(r).focusNode)?(3!==n.nodeType&&n.childNodes.length>=1&&(n=n.childNodes[0]),3!==n.nodeType?null:n):(s("Focus node not found."),null))}function y(e){var t,n=getFidByNode(e),i=getUidByNode(e);for(t in assert(f(e)),assert(void 0!==n&&void 0!==i),r)if(r.hasOwnProperty(t)&&c(t)[0]===n&&r[t].node_states[i])return r[t].node_states[i];return null}function v(t){var n,i;for(n in r)if(r.hasOwnProperty(n)){if(!(i=getNodeByUid(c(n)[0],c(n)[1])))return s("Editor root node is removed."),null;if(e.xbrowser.contains(i,t))return n}return null}function k(e){var t,n=r[e];for(t in assert(n),n.node_states)if(n.node_states.hasOwnProperty(t)&&!n.node_states[t].remote_has_caught_up)return!1;return!0}function S(e){var t=r[e];assert(t),t.scan_timer||(t.scan_timer=setTimeout((function(){t.scan_timer=0,function(e){var t,n,i,o,a,l,d,f=[];for(n in o=c(e)[0],assert(i=r[e]),assert(void 0!==i.active_local_uid),soft_assert(0!==i.node_states.length,"Editor state contains 0 length node states"),i.node_states)i.node_states.hasOwnProperty(n)&&(__startswith(n,"l")||(n=parseInt(n),l=i.node_states[n],d=void 0,d=local_echo_config.tolerance_time,!l.remote_has_caught_up&&l.local_value_list.length&&Date.now()-l.local_value_list[0].ts>d&&(l.local_value_list[0].ts,1)&&((a=getNodeByUid(o,n))?(u(a,i.node_states[n].remote_value,!0),b(e),a.data,i.node_states[n].remote_value,n===i.active_local_uid&&(i.restricted=!0),f.push(n)):(s("node_states contain outdated node id"),f.push(n)))));for(t=0;t<f.length;t+=1)f[t],delete i.node_states[f[t]];k(e)||S(e)}(e)}),local_echo_config.tolerance_time))}function b(e){var t,n,i,o=r[e];assert(o),JSON.stringify(o.remote_caret_pos),o.remote_caret_pos&&(6===o.remote_caret_pos.length?function(e,t,r,n,i){var o,a,l,c;if(t&&n)try{a=(o=getWindowByFid(e)).document,(l=o.getSelection()).removeAllRanges(),(c=a.createRange()).setStart(t,r),c.setEnd(n,i),l.addRange(c)}catch(e){s("Failed to apply caret pos, range data error.")}else s("Failed to apply caret pos, node in range is removed.")}(t=o.remote_caret_pos[0],getNodeByUid(t,o.remote_caret_pos[2]),o.remote_caret_pos[3],getNodeByUid(t,o.remote_caret_pos[4]),o.remote_caret_pos[5]):2===o.remote_caret_pos.length?((n=getNodeByUid((i=c(e))[0],i[1])).selectionStart=o.remote_caret_pos[0],n.selectionEnd=o.remote_caret_pos[1]):assert(!1))}function w(t){var i,o,a,s,c,d=local_echo_config.tolerance_time;i=getFidByNode(t),(a=v(t))||(o=getUidByNode(c=_(t)),a=l(i=getFidByNode(c),o),assert(!r[a]),g(a)),assert(a),(s=r[a]).restricted=!0,n+=1,s.pending_ack=n,s.ack_deadline=Date.now()+d,e.surrogate_channel.delay_once(100),e.surrogate_channel.send("editor-seq",i,a,n)}function C(e,t){var n,i,o,a,s=!1,l=y(e);for(assert(f(e)),assert(l),getUidByNode(e),l.remote_value=t,n=0;n<l.local_value_list.length;n+=1)if(l.local_value_list[n].val===t){s=!0,n===l.local_value_list.length-1&&(getUidByNode(e),l.remote_has_caught_up=!0,d(e)!==t&&reportErrorClientEvent("tc-lecho-error-wrong-local-value",{detail:"The last reconciled value on the local value list is inconsistent with the input value."}));break}o=v(e),assert(i=r[o]),a=getUidByNode(e),s?(l.local_value_list.splice(0,n),function(e){var t,r,n=0;if(!1!==e.typeahead_overrun){for(r in e.node_states)e.node_states.hasOwnProperty(r)&&((t=e.node_states[r]).remote_has_caught_up||(n+=t.local_value_list.length));n<local_echo_config.tolerance&&(e.typeahead_overrun=!1)}}(i),i.mismatch_count[a]&&(i.mismatch_count[a]=0)):i.restricted?(u(e,t,!1),b(o),l.local_value_list.length=0,l.remote_has_caught_up=!0,l.local_value_list.push({ts:Date.now(),val:t})):(l.remote_has_caught_up||(void 0===i.mismatch_count[a]?i.mismatch_count[a]=0:i.mismatch_count[a]+=1,i.mismatch_count[a]>3&&(i.exclusion_list[a]=!0)),u(e,t,!1),b(o),delete i.node_states[a])}function T(e){var r;i&&local_echo_enabled&&local_echo_config.extended&&(r=e.target,Util.is_content_editable(r)&&(t.update_local_value(r,"ie_input_evt"),delete r.__keypress_just_happened))}function E(e){return!!y(e)}t.match_last_local_echo=function(e,t){var r,n=y(e);return!!n&&(r=n.local_value_list.length-1,n.local_value_list[r].val===t)},t.on_textnode_connect=function(e,t,n){var i,o,a;for(i in r)if(r.hasOwnProperty(i))for(o in(a=r[i]).node_states)a.node_states.hasOwnProperty(o)&&o===n&&(a.node_states[t]=a.node_states[o],delete a.node_states[o])},t.update_local_value=function(t,n){var i,o,a,c,u,f,m,y=getFidByNode(t),v=getUidByNode(t),k=t,b=!0;if(void 0===y){if(!t.__sv_client_id||3!==t.nodeType)return s("Event node is not mapped: "+!!t.__sv_client_id+", "+t.nodeType===3),!1;assert("txtdiff_local"===n),b=!1,y=getFidByNode(t.parentNode),v="<local>"}return v=getUidByNode(m=_(t)),!!(i=b?h(y,m):t)&&(o=d(i),assert(p(m,i)),(a=getUidByNode(i))||(a=i.__sv_client_id),a?(c=l(y,v),r[c]||g(c),!r[c].exclusion_list[a]&&(r[c].node_states[a]||function(e,t,n){assert(r[e]);var i={local_value_list:[],remote_value:n};r[e].node_states[t]=i}(c,a,o),(f=(u=r[c].node_states[a].local_value_list).length)>=1&&u[f-1].val===o?u[f-1].ts=Date.now():(u.push({ts:Date.now(),val:o}),r[c].node_states[a].remote_has_caught_up=!1,k.__keypress_just_happened&&e.local_input.preserve_value(i)),r[c].active_local_uid=a,S(c),!0)):(s("Focus node is not mapped."),!1))},t.try_handle_remote_update=function(e,t){return!(!local_echo_enabled||!local_echo_config.extended)&&(!(3!==e.nodeType&&"textarea"!==Util.get_node_tag(e)||!E(e))&&(C(e,t),!0))},t.defer_range_sel_if_needed=function(e,t,n,i,o,a){var s,l;return!("range"!==t||3!==n.nodeType||!E(n)||n!==o||i!==a)&&(assert(l=v(o)),(s=r[l]).remote_caret_pos=[e,t,getUidByNode(n),i,getUidByNode(o),a],JSON.stringify(s.remote_caret_pos),!s.restricted)},t.set_remote_caret=function(e,t,n,i){var o,a,s,c=!1;a=l(e,t),r[a]||(g(a),c=!0),(o=r[a]).remote_caret_pos=[n,i],o.node_states[t]||(c=!0),o.node_states[t]&&o.node_states[t].remote_has_caught_up&&(c=!0),c&&(assert(s=getNodeByUid(e,t)),s.selectionStart===n&&s.selectionEnd===i||(s.selectionStart=n,s.selectionEnd=i)),JSON.stringify(o.remote_caret_pos)},t.on_remove_node=function(e,t){var n,i,o=getNodeByUid(e,t);if(o){if(f(o)){if(!E(o))return;assert(n=v(o)),(i=r[n]).node_states[t]&&delete i.node_states[t]}else if(1===o.nodeType){if(!o.isContentEditable)return;if(!(n=function(e){var t;for(t in r)if(r.hasOwnProperty(t)&&getNodeByUid(c(t)[0],c(t)[1])===e)return t;return null}(o)))return;m(n)}}else s("missing node in cleanup for removal")},t.process_keyevent_locally=function(n,i){var l,c,d,u,f=!1;return c=("keydown"===n.type||"keypress"===n.type)&&a.hasOwnProperty(n.key),n.type,n.key,n.target,d="keypress"===n.type&&!c,u=o.hasOwnProperty(n.key),assert(n.target),!function(e){var t,n,i=getFidByNode(e),o=v(e);return void 0===i?(s("Input event node is not mapped yet."),!1):!(!o||!(t=h(i,e=_(e)))||(p(e,t)?void 0===(n=getUidByNode(t))||!r[o].exclusion_list[n]:(s("Focused text node is not a child of the editor"),1)))}(n.target)&&(!function(e){var t,n,i,o,a=0;if(!(t=v(e)))return!1;if((n=r[t]).typeahead_overrun)return!0;for(o in n.node_states)n.node_states.hasOwnProperty(o)&&((i=n.node_states[o]).remote_has_caught_up||(a+=i.local_value_list.length));return a>local_echo_config.max_typeahead&&(n.typeahead_overrun=!0),n.typeahead_overrun}(n.target)&&((l=v(n.target))&&r[l].restricted?(n.type,i&&(c||d)&&w(n.target),!1):i&&c?(w(n.target),!1):(u?f=!0:d&&(t.update_local_value(n.target,"key_evt")?(n.target.__keypress_just_happened=!0,e.text_monitor.pause_all(),setTimeout((function(){e.text_monitor.resume_all()}),0),n.type,f=!0):i&&w(n.target)),f)))},t.apply_config=function(){local_echo_config.extended&&"Explorer"===browser.name&&EventListener.addListener(window,"textinput",T,!1)},t.cleanup=function(){local_echo_config.extended&&"Explorer"===browser.name&&EventListener.removeListener(window,"textinput",T,!1)},t.enable_ie_textinput_evt=function(){i=!0},t.disable_ie_textinput_evt=function(){i=!1},e.interp.registerOpcodeHandler(e.interp.OPCODES.EDITOR_SEQ_ACK,(function(e,t,n){var i=r[t];i?n===i.pending_ack&&Date.now()<=i.ack_deadline&&k(t)&&(i.restricted=!1,function(e){var t=r[e];assert(t),!1===t.restricted&&0===Object.keys(t.node_states).length&&0===Object.keys(t.mismatch_count).length&&0===Object.keys(t.exclusion_list).length&&m(e)}(t)):s("missing editor for the sequence ack")}))}function TextMonitor(e){var t=this,r={attributes:!1,childList:!0,characterData:!0,subtree:!0,characterDataOldValue:!0},n={},i=!0,o=0,a=null,s={},l=new diff_match_patch;function c(t,r,n,i){var o,a,s,c;if(null===n&&(n=""),null===i&&(i=""),n!==i){for(o=l.diff_main(n,i),JSON.stringify(o),s=0,c=o.length;s<c;s+=1)1!==o[s][0]&&(o[s][1]=o[s][1].length);a=Util.hashCode(i),e.surrogate_channel.send("edtx",t,r,o,e.selection.getSelection(getNodeByUid(t,r)),!0,a,e.local_input.EDIT_REASON_BROWSER,!0)}}function d(e,t){for(var r=[];t&&t!==t.parentNode&&(1===t.nodeType||3===t.nodeType||8===t.nodeType)&&t!==e;)r.unshift(t),t=t.parentNode;return r.unshift(e),r}function u(e){var t,r={};for(assert(e),t=0;t<e.attributes.length;t+=1)r[e.attributes[t].name]=e.attributes[t].value;return r}function f(e,t){var r,n,i,o=[];for(r=0;r<e.childNodes.length;r+=1)3===(n=e.childNodes[r]).nodeType||1===n.nodeType?(o.push(n.nodeName),3===n.nodeType?o.push(n.nodeValue):1===n.nodeType?o.push(u(n)):assert(!1),i={},t&&t.startContainer===n&&(i.startOffset=t.startOffset),t&&t.endContainer===n&&(i.endOffset=t.endOffset),o.push(i),o.push(f(n,t))):reportWarnClientEvent("tc-text-monitoring-error",{node_type:n.nodeType,error:"Unexpected node type"});return o}function p(e,t){var r,n;for(r=0;r<e.childNodes.length;r+=1)getUidByNode(n=e.childNodes[r])?p(n,t):t.push(n)}function g(r,n,i){var o,a,s=getNodeByUid(r,n);if(i.length){for(o=function(e,t){var r,n,i,o=[],a=-1;for(assert(!!t&&t.length>=1),r=0;r<t.length;r+=1)o.push(d(e,t[r]));for(;;){for(n=a+1,i=o[0][n],r=0;r<t.length;r+=1)if(o[r].length<=n||o[r][n]!==i)return-1===a?null:o[0][a];a+=1}}(s,i);o&&!getUidByNode(o);)o=o.parentNode;if(o){for(o.nodeName,getUidByNode(o),a=function(e){var t=e.ownerDocument.defaultView.getSelection();return t.rangeCount?t.getRangeAt(0):null}(o),e.surrogate_channel.send("graft",r,getUidByNode(o),f(o,a)),t.pause_all();o.firstChild;)o.removeChild(o.firstChild);t.resume_all()}else reportErrorClientEvent("tc-text-monitoring-error",{error:"No common ancestor",root_editable:getNodeByUid(r,n).nodeName})}else reportErrorClientEvent("tc-text-monitoring-error",{error:"No DOM node add/remove detected",root_editable:getNodeByUid(r,n).nodeName})}function m(t){return t?!e.local_input.is_editable_in_ime_mode(t):(reportErrorClientEvent("tc-text-monitoring-error",{error:"Root editable no longer exists"}),!1)}function _(t,r,n){var i=!1,o=[],a=getNodeByUid(t,r);m(a)&&(!function(e){var t;for(t=0;t<e.length;t+=1)e[t].type,"childList"===e[t].type&&(e[t].addedNodes.length,e[t].removedNodes.length)}(n),function(e){var t;for(t=0;t<e.length;t+=1)if("characterData"!==e[t].type)return!1;return!0}(n)&&(i=function(t,r,n){var i,o,a={};for(i=0;i<n.length;i+=1)if(assert("characterData"===n[i].type),!(local_echo_enabled&&local_echo_config.extended&&e.lecho_regulator_ext.match_last_local_echo(n[i].target,n[i].target.data))){if(!(o=getUidByNode(n[i].target)))return!1;a[o]||(a[o]=n[i])}for(o in Object.keys(a).length,a)a.hasOwnProperty(o)&&c(t,parseInt(o,10),a[o].oldValue,a[o].target.nodeValue);return!0}(t,0,n)),i||(p(a,o),g(t,r,o)))}function h(e,t,r){var n,i;if(m(getNodeByUid(e,t))){if(n=getUidByNode(r.target),"DOMCharacterDataModified"===r.type&&n){if(s[i=e+"_"+n])return;s[i]={text_node_id:n,old_text:r.prevValue}}else;a||(a=setTimeout((function(){!function(e,t){var r,n,i,o=[];if(p(getNodeByUid(e,t),o),o.length)g(e,t,o);else for(n in s)s.hasOwnProperty(n)&&(i=getNodeByUid(e,r=s[n].text_node_id).nodeValue,c(e,r,s[n].old_text,i));s={}}(e,t),a=null}),100))}}function y(e,t){EventListener.addListener(e,"DOMCharacterDataModified",t),EventListener.addListener(e,"DOMNodeInserted",t),EventListener.addListener(e,"DOMNodeRemoved",t)}function v(e,t){EventListener.removeListener(e,"DOMCharacterDataModified",t),EventListener.removeListener(e,"DOMNodeInserted",t),EventListener.removeListener(e,"DOMNodeRemoved",t)}t.monitor_text_change=function(e,a){var s,l=a;for(assert(Util.is_elem_editable(a));l.parentNode&&1===l.parentNode.nodeType&&Util.is_elem_editable(l.parentNode);)l=l.parentNode;(s=getUidByNode(l))?function(e,a){var s,l;if(t.in_effect=!0,s=getNodeByUid(e,a),n[e+"_"+a])return s.nodeName,void s.textContent;s.nodeName,s.textContent,i?(l=new MutationObserver((function(t){_(e,a,t)})),o||l.observe(s,r)):(l=function(t){h(e,a,t)},o||y(s,l)),n[e+"_"+a]={node:s,observer:l}}(e,s):reportErrorClientEvent("tc-text-monitoring-error",{error:"Root editable node is not a mapped node",root_editable:l.nodeName})},t.on_remove_node=function(e,r){var o;t.in_effect&&(o=n[e+"_"+r])&&(i?o.observer.disconnect():v(o.node,o.observer),delete n[e+"_"+r],Object.keys(n).length||(t.in_effect=!1))},t.pause_all=function(){var e,r;if(assert((o+=1)>0),t.in_effect)for(r in n)n.hasOwnProperty(r)&&(e=n[r],i?e.observer.disconnect():v(e.node,e.observer))},t.resume_all=function(){var e,a;if(0===o)return reportErrorClientEvent("tc-text-monitoring-error",{error:"Pause/resume count does not match"}),void soft_assert(!1);if(!(o-=1)&&t.in_effect)for(a in n)n.hasOwnProperty(a)&&(e=n[a],i?e.observer.observe(e.node,r):y(e.node,e.observer))},i=!!window.MutationObserver&&"Explorer"!==browser.name,t.in_effect=!1}function CSSManager(e){var t=this,r=[],n=[],i=1,o=2,a=3,s=0,l=!1,c={},d={},u=1,f=2,p=[],g=null,m={};function _(e){var t,n=[];for(e&&s&&clearTimeout(s),s=0,t=0;t<r.length;t+=1)h(r[t],n);r=n}function h(t,r){var n,l,c,d=getNodeByUid(t[1],t[2]);return d?(BrowserDetect.isIE()||"link"!==Util.get_node_tag(d)||__startswith(d.href,"data:")||(t[0]===a?(l=(n=d).parentNode,(c=n.cloneNode(!0)).setAttribute("crossorigin","anonymous"),c.href="data:text/css;base64,",setNodeIds(c,getUidByNode(n),getFidByNode(n)),l.insertBefore(c,n),c.removeAttribute("crossorigin"),n.remove(),d=c):reportErrorClientEvent("tc-css-unexpected-cmd",{cmd:t[0]})),d.sheet?(t[0]===i?function(e,t,r){try{e.sheet.insertRule(t,r)}catch(n){reportClientEvent("tc-css-insert-rule-exception",{rule:t},!0);try{e.sheet.insertRule("#_sv_dummy {}",r)}catch(e){}}}(d,t[3],t[4]):t[0]===o?function(e,t){try{e.sheet.deleteRule(t)}catch(e){reportClientEvent("tc-css-delete-rule-exception",{},!0)}}(d,t[3]):t[0]===a&&function(e,t){var r;t.length;try{for(;e.sheet.cssRules.length;)e.sheet.deleteRule(0);for(r=0;r<t.length;r+=1)e.sheet.insertRule(t[r],e.sheet.cssRules.length)}catch(e){reportClientEvent("tc-css-overwrite-rules-exception",{},!0)}}(d,t[3],t[4]),void e.dom_updater.adjustShadowDom(t[1],t[2])):(t[2],r.push(t),void(d.__sv_onload_installed||(EventListener.addListener(d,"load",_),d.__sv_onload_installed=!0)))):(t[2],r.push(t),void(s||(s=setTimeout(_,100))))}function y(){var e,t=[];for(g&&(clearTimeout(g),g=null);p.length;)v((e=p.shift())[0],e[1],e[2])||t.push(e);(p=t).length&&(g=setTimeout(y,100))}function v(e,t,r){var n=getNodeByUid(t,r);if(!n)return!1;switch(e){case u:n.classList.add("_sv_target");break;case f:n.classList.remove("_sv_target");break;default:reportErrorClientEvent("tc-pseudo-target-unknown-command")}return!0}function k(e,t,r){p.push([e,t,r]),y()}function S(e){var t,r;if(e)for(t=0;t<e.children.length;t+=1)(r=e.children[t]).__sv_css_constr&&e.removeChild(r)}function b(e,t,r){var n,i="",o=getWindowByFid(e);o?(r.forEach((function(t){var r=e+"_"+t;c[r]&&(i+=c[r])})),(n=o.document.createElement("style")).setAttribute("type","text/css"),n.setAttribute("class","__safly_css_constr"),n.textContent=i,n.__sv_css_constr=!0,9===t.nodeType?(t.head||t.body).appendChild(n):t.appendChild(n)):reportErrorClientEvent("tc-css-invalid-fid",{op:"adopt"})}function w(e,t,r){var n=getNodeByUid(e,t);return!!n&&(l?function(e,t,r){var n=E(e),i=n?[n]:[];r.forEach((function(t){var r=e+"_"+t;c[r]&&i.push(c[r])})),t.adoptedStyleSheets=i}(e,n,r):(b(e,n,r),function(e,t,r){d[e+"_"+t]=r}(e,t,r)),!0)}function C(e,t){Util.forEachItem(d,(function(r,n){var i,o=function(e){var t=e.split("_");return assert(2===t.length),{fid:parseInt(t[0],10),uid:parseInt(t[1],10)}}(r),a=o.fid,s=o.uid;return a===e&&(-1!==n.indexOf(t)&&(!!(i=getNodeByUid(e,s))&&(9===i.nodeType?(S(i.head),S(i.body)):S(i),b(e,i,n),!1)))}))}function T(){var e,t=n;for(n=[];t.length;)w((e=t.shift())[0],e[1],e[2])||(n.push(e),e[0],e[1])}function E(e){var t,r,n=getWindowByFid(e);if(m.hasOwnProperty(e))return m[e];if(n)try{return r=n.document.getElementById("__safly_default_style"),(t=new n.CSSStyleSheet).replaceSync(r.textContent||""),m[e]=t,t}catch(e){}return null}t.reset=function(){c={},m={}},t.apply_adoption_cmds=T,t.initialize_style_for_root=function(e,t){var r=getNodeByUid(e,t),n=E(e);r&&n&&(r.adoptedStyleSheets=r.adoptedStyleSheets.concat([n]))},e.interp.registerOpcodeHandler(e.interp.OPCODES.CSS_INSERT_RULE,(function(e,t,n,o){_(!0),h([i,e,t,n,o],r)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.CSS_DELETE_RULE,(function(e,t,n){_(!0),h([o,e,t,n],r)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.CSS_OVERWRITE_RULES,(function(e,t,n){_(!0),h([a,e,t,n],r)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.CONSTR_CSS_CREATE,(function(e,t){var r=e+"_"+t,n=getWindowByFid(e);if(n){if(c[r]&&reportErrorClientEvent("tc-css-sheet-id-duplicated",{}),n.CSSStyleSheet)try{c[r]=new n.CSSStyleSheet,l=!0}catch(e){}l||(c[r]="")}else reportErrorClientEvent("tc-css-invalid-fid",{op:"create"})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.CONSTR_CSS_DISPOSE,(function(e,t){var r=e+"_"+t;void 0===c[r]&&reportErrorClientEvent("tc-css-sheet-id-missing",{op:"dispose"}),delete c[r]})),e.interp.registerOpcodeHandler(e.interp.OPCODES.CONSTR_CSS_REPLACE_TEXT,(function(e,t,r,n){var i=e+"_"+t;void 0!==c[i]?l?n?c[i].replaceSync(r):c[i].replace(r):(c[i]=r,C(e,t)):reportErrorClientEvent("tc-css-sheet-id-missing",{op:"replace"})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.CONSTR_CSS_ADOPT_STYLE_SHEETS,(function(e,t,r){n.push([e,t,r]),T()})),e.interp.registerOpcodeHandler(e.interp.OPCODES.PSEUDO_TARGET_ADD,k.curry(u)),e.interp.registerOpcodeHandler(e.interp.OPCODES.PSEUDO_TARGET_REMOVE,k.curry(f))}function AnimationManager(e){var t=0,r=[],n=1,i=2,o=3,a=4,s=5,l={},c={};function d(){var e,n=[];for(t&&(clearTimeout(t),t=0),e=0;e<r.length;e+=1)u(r[e],n);r=n}function u(e,r){var u=getNodeByUid(e[1],e[2]),f=e[1]+"_"+e[3],p=l[f];function g(n){r.push(e),t||(t=setTimeout(d,100))}if(e[0]===i){if(!u)return void g(e[2]);if(e[5].pseudoElement&&!function(e,t){"::before"!==t&&"::after"!==t&&reportWarnClientEvent("tc-animation-unexpected-pseudo-element",{"pseudo-element":t});var r=window.getComputedStyle(e,t);return"none"!==r.content&&""!==r.content}(u,e[5].pseudoElement))return void g(e[2]);!function(e,t,r,n,i){var o,a=getNodeByUid(e,t),s=e+"_"+t,d=e+"_"+r;if(!n||!i)return;if(BrowserDetect.isIE())return;i.iterations=parseFloat(i.iterations),o=a.animate(n,i),c[s]||(c[s]=new Array);c[s].push(r),l[d]=o}(e[1],e[2],e[3],e[4],e[5])}else{if(!p)return void g(e[3]);switch(e[0]){case n:p.cancel();break;case o:p.finish();break;case a:p.pause();break;case s:p.play()}}}this.cleanAnimationDict=function(e,t){c[e+"_"+t]&&(c[e+"_"+t].forEach((function(t){delete l[e+"_"+t]})),delete c[e+"_"+t])},e.interp.registerOpcodeHandler(e.interp.OPCODES.ANIMATION_CREATE,(function(e,t,n,o,a){d(),u([i,e,t,n,o,a],r)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ANIMATION_CANCEL,(function(e,t,i){d(),u([n,e,t,i],r)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ANIMATION_FINISH,(function(e,t,n){d(),u([o,e,t,n],r)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ANIMATION_PAUSE,(function(e,t,n){d(),u([a,e,t,n],r)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ANIMATION_PLAY,(function(e,t,n){d(),u([s,e,t,n],r)}))}function PopoverManager(e){var t=1,r=2,n=3,i=[],o=null,a=1,s=2,l=[],c=null;function d(){var e,t=[];for(o&&(clearTimeout(o),o=null);i.length;)u((e=i.shift())[0],e[1],e[2])||t.push(e);(i=t).length&&(o=setTimeout(d,100))}function u(e,i,o){var a=getNodeByUid(i,o);if(!a)return!1;switch(e){case t:a.show();break;case r:a.removeAttribute("open"),a.showModal();break;case n:a.hasAttribute("open")||a.setAttribute("open",""),a.close();break;default:reportWarnClientEvent("tc-dialog-unknown-command")}return!0}function f(){var e,t=[];for(c&&(clearTimeout(c),c=null);l.length;)p((e=l.shift())[0],e[1],e[2])||t.push(e);(l=t).length&&(c=setTimeout(f,100))}function p(e,t,r){var n=getNodeByUid(t,r);if(!n||!n.hasAttribute("popover"))return!1;if(!n.showPopover||!n.hidePopover)return!0;switch(e){case a:n.showPopover();break;case s:n.hidePopover();break;default:reportWarnClientEvent("tc-popover-unknown-command")}return!0}function g(e,t,r){i.push([e,t,r]),d()}function m(e,t,r){l.push([e,t,r]),f()}e.interp.registerOpcodeHandler(e.interp.OPCODES.DIALOG_SHOW,g.curry(t)),e.interp.registerOpcodeHandler(e.interp.OPCODES.DIALOG_SHOW_MODAL,g.curry(r)),e.interp.registerOpcodeHandler(e.interp.OPCODES.DIALOG_CLOSE,g.curry(n)),e.interp.registerOpcodeHandler(e.interp.OPCODES.POPOVER_SHOW,m.curry(a)),e.interp.registerOpcodeHandler(e.interp.OPCODES.POPOVER_HIDE,m.curry(s))}function ShadowDomSupport(e,t){var r=this,n=!BrowserDetect.isIE(),i={},o={};function a(e){var t,r;for(t=0;t<e.childNodes.length;t+=1)!(r=e.childNodes[t]).__sv_shadow_root&&r.style&&"none"!==r.style.display&&(r.style.display="none")}function s(e,t,r){var n,i,o,s,l,c,d,u,f=getNodeByUid(e,r),p=["width","height","max-width","max-height"],g=!1,m=!1;if(f){for(assert((n=getNodeByUid(e,t))===f.parentNode),a(n),o=(i=f.contentWindow.document).body.scrollWidth,s=i.body.scrollHeight,l=0;l<p.length;l+=1)c=p[l],(d=n.style.getPropertyValue(c))&&f.style.getPropertyValue(c)!==d&&(u=n.style.getPropertyPriority(c),f.style.setProperty(c,d,u?"important":""),"width"===c&&(m=!0),"height"===c&&(g=!0));m||f.getAttribute("width")===o.toString()||f.setAttribute("width",o),g||f.getAttribute("height")===s.toString()||f.setAttribute("height",s)}else reportWarnClientEvent("tc-shadow-root-missing",{fid:e,shadow_root_id:r})}function l(t,n,l){var d,u=getWindowByFid(t),f=getNodeByUid(t,n);(d=u.document.createElement("iframe")).setAttribute("name","sv-shadow-root"),d.setAttribute("src","about:blank"),d.setAttribute("style","border:none; margin: 0px; padding: 0px"),d.setAttribute("scrolling","no"),d.setAttribute("sv_frame_id",l),d.__sv_shadow_root=!0,d.onload=function(){!function(t,n,o,a){var l=t.contentWindow;assert(Util.isIframeReady(t)),assert(i[n]),assert(i[n][a]),i[n][a].is_ready=!0,setFidToWindow(l,a),e.local_events.install_event_listeners(l,l.document,!1),l.onbeforeunload=function(){},r.loading_shadow_root(n)||e.update_queue.deliver(n,e.interpretQueued),i[n][a].timer=setInterval((function(){s(n,o,a)}),1e3)}(d,t,n,l)},c(t,n,f),setNodeIds(d,l,t),i[t]||(i[t]={}),i[t][l]={},i[t][l].is_ready=!1,o[t+"_"+n]=l,a(f),f.insertBefore(d,f.firstChild)}function c(e,t,r){var n,a;i[e]&&(n=o[e+"_"+t])&&i[e][n]&&((a=getNodeByUid(e,n))&&(a.remove?a.remove():a.removeNode(!0)),clearInterval(i[e][n].timer),delete i[e][n],delete o[e+"_"+t],Object.keys(i[e]).length||delete i[e])}r.loading_shadow_root=function(e){var t,r=i[e];if(!r)return!1;for(t in r)if(r.hasOwnProperty(t)&&!r[t].is_ready)return!0;return!1},r.adjust_parent_fragment_size=function(e,t){var r,i,o,a,l;n||(r=getNodeByUid(e,t),i=getWindowByFid(e),r&&r.ownerDocument&&(a=r.ownerDocument.defaultView),a&&a!==i&&(l=a.frameElement)&&l.__sv_shadow_root&&(o=getUidByNode(l),s(e,getUidByNode(l.parentNode),o)))},r.on_node_remove=function(t,r,i){n?function(t,r,n){n&&n.shadowRoot&&e.local_events.install_event_listeners_for_shadowroot(!1,n.shadowRoot)}(0,0,i):c(t,r)},r.add_shadow_root=function(r,i,o,a){var s=getNodeByUid(r,i);s?(s.attachShadow||(n=!1),n?function(r,n,i,o){var a,s=getNodeByUid(r,n);s.shadowRoot?reportErrorClientEvent("tc-shadow-root-already-exists",{fid:r,host_uid:n,shadow_root_uid:i}):(setNodeIds(a=s.attachShadow({mode:"open",slotAssignment:o}),i,r),e.local_events.install_event_listeners_for_shadowroot(!0,a),t.initialize_style_for_root(r,i),t.apply_adoption_cmds())}(r,i,o,a):l(r,i,o)):reportErrorClientEvent("tc-shadow-host-missing",{fid:r,host_uid:i,shadow_root_uid:o})},r.slot_assign=function(e,t,r){var n=[],i=null;function o(e,t,r){var n,i,o=getNodeByUid(e,t),a=[];if(!o)return!1;for(n=0;n<r.length;n++){if(!(i=getNodeByUid(e,r[n])))return!1;if(1!==i.nodeType&&3!==i.nodeType)return!0;a.push(i)}return o.assign.apply(o,a),!0}n.push([e,t,r]),function e(){var t,r=[];for(i&&(clearTimeout(i),i=null);n.length;)o((t=n.shift())[0],t[1],t[2])||r.push(t);(n=r).length&&(i=setTimeout(e,100))}()},r.reset=function(){var e,t,r;for(e in i)if(i.hasOwnProperty(e)){for(t in r=i[e])r.hasOwnProperty(t)&&(clearInterval(r[t].timer),delete r[t]);delete i[e]}}}function DOMUpdater(e){var t,r=this,n=new CSSManager(e),i=new AnimationManager(e),o=(new PopoverManager(e),null),a={script:1,embed:1,applet:1},s=new diff_match_patch,l={},c=null,d={},u=null,f=!0;function p(t,r,n,i){var o,a=[];if("Explorer"!==browser.name||!e.xbrowser.processIECharacterData(n,i,"remove",void 0))try{n===r.head||n===r.body?((o=e.feedback_bar.feedbackElementIDs()).push(DOM_LOADED_ELEM_ID),o.push("__safly_mwtc"),o.push("__safly_default_style"),o.push("__safly_custom_style"),o.push("__safly_ro_css_id"),o.push("__safly_bw_css_id"),a.push("__safly_css_constr"),a.push("__safly_external_svg"),function(e,t,r){var n,i;if(e)for(n=e.childNodes.length-1;n>=0;n-=1)(i=e.childNodes[n]).id&&t.indexOf(i.id)>-1||i.className&&r.indexOf(i.className)>-1?(i.id,i.className):e.removeChild(i)}(n,o,a),n.firstChild?(!function(e){for(var t=0,r=e.attributes.length;e.attributes.length-t;)e.removeAttribute(e.attributes[t].name),r===e.attributes.length&&("Explorer"!==browser.name&&reportWarnClientEvent("tc-dom-attribute-remove-failure",{node:e.nodeName,attribute:e.attributes[t].name}),t+=1),r=e.attributes.length}(n),n.__sv_saved_for_feedback=!0):i.removeChild(n)):i.removeChild(n)}catch(e){if(i.isContentEditable)return;soft_assert(!1,"parent_node.removeChild() raised exception : "+e)}}function g(t){var r,n,o,a;if(!t.__sv_unmapped_frame){if(o=getFidByNode(t),a=getUidByNode(t),void 0!==o&&void 0!==a&&(local_echo_enabled&&local_echo_config.extended&&Util.is_content_editable(t)&&e.lecho_regulator_ext.on_remove_node(o,a),"CANVAS"===t.nodeName&&e.canvas.on_remove_node(o,a),removeUidNodeEntry(o,a),local_echo_enabled&&Util.can_element_use_lecho(t)&&e.lecho_regulator.on_remove_node(o,a),e.wheel_ctrl.on_remove_node(o,a),e.key_ctrl.on_remove_node(o,a),i.cleanAnimationDict(o,a),e.local_events.clear_animation_node(o,a)),Util.is_frame_owner(t)){if(!(n=getFrameFidByNode(t)))return void reportWarnClientEvent("tc-dom-unexpected-iframe",{node_detail:t.outerHTML});removeFidWindowEntry(n),removeFidToIframe(n),removeUidNodeEntriesForFid(n),removeSvgRootUidsForFid(n),e.callback.fire("frame-node-removed",n,t)}for(c&&t.shadowRoot&&g(t.shadowRoot),r=0;r<t.childNodes.length;r+=1)g(t.childNodes[r])}}function m(e){return e&&(__startswith(e,"cof-server:")||__startswith(e,"safeview")||__startswith(e,"__safly_")||__startswith(e,"safemail"))}function _(e){var t,r,n,i=mf.document;for(assert(e===i.documentElement||e===i.body),t=(n=e.querySelectorAll("iframe, frame")).length-1;t>=0;t-=1)m(n[t].id)||g(n[t]);for(t=e.childNodes.length-1;t>=0;t-=1)m((r=e.childNodes[t]).id)||(r===i.body?_(r):p(mf.window.__sv_fid,i,r,e))}function h(e){var t=e.target.window.feedback_bar;t&&t.updateReadonlyUI()}function y(t,r,n){return"href"===t?n=function(t,r){var n=r,i=r[0],o=t.localName.toLowerCase();return TPROXY_ENABLED?"link"!==o&&"/"===i&&(n=r.substr(1)):e.pairing_dict.mpa_id&&"link"!==o&&"/"===i&&(n=Util.same_origin(window.location.href,r.substr(1))?r.substr(1):"/mpa/"+(e.pairing_dict.mpa_id||"1")+r),n}(r,n):"action"===t&&(-1!==n.toLowerCase().indexOf("javascript")&&(n=""),"form"===r.localName.toLowerCase()&&(n="about:blank")),n}function v(e,t,r,n){if(soft_assert(t,"Node is null for insertion."),soft_assert(r,"Parent is null for insertion."),r.hasChildNodes()){if(n){var i=getNodeByUid(e,n);t.previousSibling!==i&&r.insertBefore(t,i.nextSibling)}else r.firstChild!==t&&r.insertBefore(t,r.firstChild);return!0}return!1}function k(e,t){return 0===t.length||Util.makeSet(["id","class","style","width","height","name","hspace","vspace","align","title","tabindex","data-sv-src","hidden"]).hasOwnProperty(e)}function S(e,t,r){return"meta"===Util.get_node_tag(e)&&"name"===t&&"referrer"===r||"referrerpolicy"===t}function b(t,r,n,i,o){var a,s,l,c,d=[];for(a=0;a<o.length;a+=1)if(l=o[a][0],s=o[a][1],c=o[a][2],("src"!==l||"audio"!==i&&"video"!==i||!e.media_source_extensions.get_media_source_or_falsy(getFidByNode(r),n))&&(!e.resync_in_progress||void 0===r.__sv_paused||"src"!==l||"audio"!==i&&"video"!==i)&&(window.TPROXY_ENABLED||!S(r,l,s))&&(tabstore_is_reliable()||"meta"!==Util.get_node_tag(r)||!S(r,l,s))&&("Explorer"===browser.name&&"input"===i&&"value"===l&&d.push([l,s]),"safely_embed"!==i||k(l,s))){"value"===l&&"textarea"===i&&(DEBUG&&r.value,r.value=s),s=y(l,r,s),Util.is_frame_node_name(i)&&"src"===l&&(s="about:blank"),"Explorer"===browser.name&&browser.version>=10&&"textarea"===i&&"placeholder"===l&&(r.__sv_ignore_input_event=!0);try{"xmlns"===l&&(c=null),e.xbrowser.setAttribute(t,r,c,l,s)}catch(e){reportClientEvent("tc-set-attribute-exception",{node_name:r.nodeName,attribute_name:l},!0)}}return d}function w(t,r,n,i,o,a,s,l){var c,d,u,f=!1,p=!1,g=!1;if("object"===Util.get_node_tag(n)&&n.backend_object_created&&1===i.nodeType&&i.style&&(i.style.display="none"),Util.is_frame_node_name(a)||"safely_embed"===a)!function(e,t){var r;Util.is_frame_node_name(e)&&(r=getFrameFidByNode(t))&&setFidToIframe(t,r)}(a,i),e.callback.fire("frame-node-inserted",i,o);else if(("img"===a||"input"===a)&&e.xbrowser.hasAttribute(i,null,"height")&&e.xbrowser.hasAttribute(i,null,"width")){for(u=0;u<s.length;u+=1)"height"===s[u][0]?f=!0:"width"===s[u][0]?p=!0:"type"===s[u][0]&&"image"===s[u][1]&&(g=!0);("img"===a||"input"===a&&g)&&(!f&&e.xbrowser.hasAttribute(i,null,"height")&&i.removeAttribute("height"),!p&&e.xbrowser.hasAttribute(i,null,"width")&&i.removeAttribute("width"))}else"animate"===a&&"Explorer"===browser.name?"path"===Util.get_node_tag(n)&&e.xbrowser.hasAttribute(i,null,"to")&&e.xbrowser.hasAttribute(i,null,"attributeName")&&"d"===i.getAttribute("attributeName")&&e.xbrowser.hasAttribute(n,null,"d")&&e.xbrowser.setAttribute(r,n,"","d",i.getAttribute("to")):Util.is_element_date_time_input(i)&&"text"===i.type?e.xbrowser.hasAttribute(i,null,"placeholder")||e.xbrowser.setAttribute(r,i,"","placeholder",Util.date_time_input_types[i.getAttribute("type")]):Util.is_unsupported_element_color_input(i)?i.hasAttribute("placeholder")||i.setAttribute("placeholder","#000000"):"form"===a?(e.xbrowser.setAttribute(r,i,"","action","about:blank"),EventListener.addListener(i,"submit",(function(e){e.preventDefault()}))):"head"!==Util.get_node_tag(n)||"link"!==a&&"style"!==a||((c=r.document.getElementById("__safly_default_style"))&&c.parentNode===n&&"style"===Util.get_node_tag(c)&&c!==n.firstChild&&n.insertBefore(c,n.firstChild),(d=r.document.getElementById("__safly_custom_style"))&&d.parentNode===n&&"link"===Util.get_node_tag(d)&&d!==n.childNodes[1]&&n.insertBefore(d,n.firstChild.nextSibling));"input"!==a||"text"!==i.type&&"search"!==i.type||(i.classList.add("__safly_input_chrome"),i.classList.add("__safly_input_ms")),"input"===a&&"file"===i.type&&EventListener.addListener(i,"cancel",(function(e){i.removeAttribute("__sv_open")})),b(r,i,o,a,l),function(e){e.hasOwnProperty||(e.hasOwnProperty=Object.prototype.hasOwnProperty)}(i),n.__sv_svg_container&&(i.getAttribute("width")||i.setAttribute("width","100%"),i.getAttribute("height")||i.setAttribute("height","100%"))}function C(t,r,n,i,o,s,d){var u,f,g,m,_,h=getWindowByFid(t),y=getIframeByFid(t),k=n.toLowerCase(),S=l[t+"_"+r],C=[],T=!1;if(soft_assert(f=getNodeByUid(t,o),"Unknown parent "+o),c&&f.__sv_shadow_root&&(f=(_=f.contentDocument).body,h=_.defaultView),y&&Util.is_frame_owner(y)&&("svg"===k||__startswith(k,"svg:"))&&"#document"===f.nodeName&&function(e){e&&e.document&&e.document.documentElement&&e.document.removeChild(e.document.documentElement)}(h),"html"===k&&"#document"===f.nodeName)u=function(t,r){var n,i=t.document;return assert(i),(n=i.getElementsByTagName("html")[0])||(n=e.xbrowser.createElement(t,r,"html"),i.appendChild(n)),i.head&&p(t.__sv_fid,i,i.head,i.head.parentNode),i.body&&p(t.__sv_fid,i,i.body,i.body.parentNode),assert(n),n}(h,d),!0,e.local_events.install_event_listeners(h,h.document,true),C=b(h,u,r,k,i);else{if(S)u=S;else if(!(u=function(t,r,n,i,o){var s,l;if("safely_embed"===r?s=t.document.createElement("object"):(s=function(e){var r=null;return t.document?("head"===e&&t.document.head&&t.document.head.__sv_saved_for_feedback?r=t.document.head:"body"===e&&t.document.body&&t.document.body.__sv_saved_for_feedback&&(r=t.document.body),r&&delete r.__sv_saved_for_feedback,r):null}(r))||(s=e.xbrowser.createElement(t,o,n)),assert(s),l=s.localName.toLowerCase().trim(),!a.hasOwnProperty(l))return s;reportClientEvent("tc-blocked-element",{name:r})}(h,k,n,0,d)))return;if("body"===k&&document.body&&(document.body===u?T=!0:getUidByNode(document.body)||h!==window||(document.body.parentNode.removeChild(document.body),T=!0)),C=b(h,u,r,k,i),g=!1,-1!==s)try{g=v(t,u,f,s)}catch(e){reportWarnClientEvent("tc-dom-insert-sibling-error",{node:u.nodeName,error:e.toString()})}if(!g)try{f.appendChild(u)}catch(t){(m=e.xbrowser.appendChildThatHandlesIE8CornerCase(h,k,r,i,f))?u=m:reportWarnClientEvent("tc-dom-alternate-append-child-failed",{child:k,parent:Util.get_node_tag(f)})}}setNodeIds(u,r,t),w(0,h,f,u,r,k,i,C),c&&c.adjust_parent_fragment_size(t,r),Util.is_elem_editable(u)&&e.text_monitor.monitor_text_change(t,u),e.callback.fire("add-element",h,u,k,d),"video"===k||"audio"===k?e.callback.fire("new-media-node",t,r):"canvas"===k&&e.canvas.on_add_node(t,r),u===S&&function(e){void 0!==e.__sv_paused&&(e.paused&&!1===e.__sv_paused?e.play():e.paused||!0!==e.__sv_paused||e.pause(),delete e.__sv_paused)}(u),T&&e.ui_frame.reload()}function T(e,t,r,n,i,o){C(e,t,r,n,i,o,"http://www.w3.org/2000/svg")}function E(t,r,n,i){var o=getNodeByUid(t,r);e.local_input.clear_local_text(t,r);try{v(t,i,o,n)||o.appendChild(i)}catch(e){reportWarnClientEvent("tc-dom-char-data-add-error",{error:e.toString()}),soft_assert(0,"Exception adding characterData element")}}function A(e,t){var r;if("style"===Util.get_node_tag(t))for(r=0;r<t.childNodes.length;++r)3===t.childNodes[r].nodeType&&x(e,getUidByNode(t.childNodes[r]),getUidByNode(t))}function R(e,t,r){var n,i,o,a,l=s.diff_main(t,r),c=0;for(n=0,i=l.length;n<i;n+=1)o=l[n][0],a=l[n][1],-1===o?e.deleteData(c,a.length):(0===o||e.insertData(c,a),c+=a.length);e.parentNode&&e.parentNode.isContentEditable&&e.data!==r&&(reportErrorClientEvent("tc-local-input-error",{detail:"Value not consistent after text node update."}),e.data,e.data=r)}function x(t,r,n){var i,o=getNodeByUid(t,r);if(e.text_monitor.on_remove_node(t,r),o!==mf.document.documentElement&&o!==mf.document.body){if(!o){if((i=getNodeByUid(t,n))&&"TEXTAREA"===i.nodeName)return;if(i&&"style"===Util.get_node_tag(i))return void A(t,i)}if(soft_assert(o,"Unknown node"),g(o),n){if(i=getNodeByUid(t,n),e.local_input.defer_remove_if_needed(t,o,i))return;soft_assert(i,"Unknown parent"),p(0,getWindowByFid(t).document,o,i)}c&&c.on_node_remove(t,r,o)}else _(o)}function D(){var e,t,r=d;for(e in d={},u=null,r)r.hasOwnProperty(e)&&((t=getNodeByUid(r[e].fid,r[e].uid)).sheet?t.sheet.disabled=r[e].disabled:(r[e].tried+=1,100===r[e].tried?reportErrorClientEvent("tc-dom-node-sheet-missing",{fid:r[e].fid,uid:r[e].uid}):I(r[e].fid,r[e].uid,r[e].disabled,r[e].tried)))}function I(e,t,r,n){d[e+"_"+t]={fid:e,uid:t,disabled:r,tried:n},u||(u=setTimeout(D,200))}r.addRetainedNode=function(e,t,r){l[e+"_"+t]=r},r.removeRetainedNode=function(e,t){delete l[e+"_"+t]},r.adjustShadowDom=function(e,t){c&&c.adjust_parent_fragment_size(e,t)},r.apply_text_node_patch=R,r.add_text_node=E,r.remove_node=p,r.clear_dom=_,r.has_pending_shadow_root=function(e){return c&&c.loading_shadow_root(e)},e.media_objects.setClient({new_media_node:function(t,n,i){var o=getNodeByUid(n,i);return o||setNodeIds(o=document.createElement(t),i,n),r.addRetainedNode(n,i,o),e.callback.fire("media-node-inserted",i,n),o},did_remove_media_node:function(e,t){r.removeRetainedNode(e,t)},get_media_node:function(e,t){var r=l[e+"_"+t];return void 0===r&&(r=getNodeByUid(e,t)),r}}),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_ELEMENT,(function(e,t,r,n,i,o){C(e,t,r,n,i,o,"http://www.w3.org/1999/xhtml")})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_CHARACTER_DATA,(function(t,r,n,i,o,a,s){var l,d,u,f,p=getWindowByFid(t),g=!1;if(p)if("#text"===(n=n.toLowerCase())){if(soft_assert(u=getNodeByUid(t,o),"Unknown parent"),l=p.document,c&&u.__sv_shadow_root&&(u=(l=u.contentDocument).body),s)!function(t,r,n,i){var o,a,s=getNodeByUid(t,n);if(s.hasChildNodes)for(a=s.childNodes,o=0;o<a.length;o+=1)if(a[o].__sv_client_id===i)return getUidByNode(a[o].parentNode),a[o].data,setNodeIds(a[o],r,t),local_echo_enabled&&local_echo_config.extended&&e.lecho_regulator_ext.on_textnode_connect(t,r,i),!0}(t,r,o,s);else if(d=l.createTextNode(i),"TEXTAREA"!==u.nodeName){if(A(t,u),"Explorer"===browser.name&&(g=e.xbrowser.processIECharacterData(d,u,"add",i)),!g){if(e.local_input.defer_add_if_needed(t,o,a,d))return void setNodeIds(d,r,t);E(t,o,a,d)}setNodeIds(d,r,t),"option"===Util.get_node_tag(u)&&(f=u.parentNode,"select"===Util.get_node_tag(f)&&f.hasOwnProperty("__safely_select_value")&&f.__safely_select_value===u.value&&e.xbrowser.setSelectValue(f,f.__safely_select_value)),c&&c.adjust_parent_fragment_size(t,r)}}else e.fatalError("tc-unsupported_character-data",{name:n})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MODIFY_PROP_VALUE,(function(t,r,n,i,o,a,s,l){var u,f,p,g=getNodeByUid(t,r),m=!1;soft_assert(g,"Unknown node"),p=Util.get_node_tag(g),i=i.toLowerCase(),"select"===p?"value"===i?e.xbrowser.setSelectValue(g,o):"selectedindex"===i&&(g.selectedIndex=o):"option"===p&&"selected"===i?g.selected=o:"input"===p&&"checked"===i?g.checked=o:"value"===i&&Util.is_element_range_input(g)||"value"===i&&Util.is_element_color_input(g)||"value"===i&&Util.is_element_date_time_input(g)?g.value=o:"value"===i&&Util.is_element_input_text(g)?(u=s,f=l,DEBUG&&g.value,(m=e.lecho_regulator_ext.try_handle_remote_update(g,o))||(m=e.local_input.defer_update_if_needed(g,o)),m||(local_echo_enabled&&Util.can_element_use_lecho(g)?e.lecho_regulator.update_remote_value(t,r,o,u,f):g.value=o),!TPROXY_ENABLED&&Util.is_autofill_target(g)&&(g.sv_prev_value=o)):"input"===p&&"file"===g.type?o?reportErrorClientEvent("tc-dom-unexpected-property-update",{op:n,name:i,value:o,node_value:g.value,value_on_TC:g.value||"(unset)"}):(g.value="",g.removeAttribute("__sv_open")):"__sv_ss_disabled"===i?"link"===p?g.sheet?(g.sheet.disabled=o,function(e,t){var r=e+"_"+t;d.hasOwnProperty(r)&&delete d[r]}(t,r)):I(t,r,o,1):"style"===p&&(g.disabled=o):"img"===p&&"currentsrc"===i?g.src=o:soft_assert(0,"modify-prop: unknown property: op="+n+" tag="+p+" name="+i+" value="+o),Util.is_elem_editable(g)&&e.text_monitor.monitor_text_change(t,g),c&&c.adjust_parent_fragment_size(t,r)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MODIFY_ATTR_VALUE,(function(t,r,n,i,o,a){var s,l,d,u,f,p=getNodeByUid(t,r),g=getWindowByFid(t),m=i.toLowerCase();if(soft_assert(p,"Unknown node"),"object"!==(s=Util.get_node_tag(p))||"remove"===n||k(m,o)){if("img"===s&&"src"===m&&e.imgreq_mgr.reset(p),"add"===n){if("canvas"===s&&e.canvas.hasCanvasPicture(t,r)&&("width"===m||"height"===m||"style"===m))return;if(("xmlns"===m||__startswith(m,"xmlns:"))&&(a=null),o=y(m,p,o),!window.TPROXY_ENABLED&&S(p,m,o))return;if(!tabstore_is_reliable()&&"meta"===Util.get_node_tag(p)&&S(p,m,o))return;g=getWindowByFid(getFidByNode(p)),f="class"===m&&p.hasAttribute(m),e.xbrowser.setAttribute(g,p,a,i,o),f&&e.local_events.is_node_animating(t,r)&&p.offsetWidth}else"remove"===n&&p.removeAttribute(i);if("input"!==s||"text"!==p.type&&"search"!==p.type||"class"!==m||(p.classList.add("__safly_input_chrome"),p.classList.add("__safly_input_ms")),"link"===s&&"disabled"===m)for(l=document.getElementsByTagName("link"),u=0;u<l.length;u+=1)(d=l[u]).hasAttribute("disabled")?d.disabled=!0:d.getAttribute("rel")&&-1!==d.getAttribute("rel").indexOf("style")&&d.getAttribute("title")&&(d.disabled=!0,d.disabled=!1);Util.is_elem_editable(p)&&e.text_monitor.monitor_text_change(t,p),c&&c.adjust_parent_fragment_size(t,r)}})),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOVE_ELEMENT,x),e.interp.registerOpcodeHandler(e.interp.OPCODES.MODIFY_CHARACTER_DATA,(function(t,r,n,i){var o,a,s=getNodeByUid(t,r),l=getNodeByUid(t,i),d=!1,u=0;if(!s&&"style"===Util.get_node_tag(l)){for(o=0;o<l.childNodes.length;++o)3===l.childNodes[o].nodeType&&getUidByNode(l.childNodes[o])&&(u++,s=l.childNodes[o]);if(u>1)return void reportErrorClientEvent("Style node has more than two text nodes.",{fid:t,style_uid:i,number_text_nodes:u})}if(soft_assert(s,"Unknown node"),soft_assert(l,"Unknown parent"),getUidByNode(s),"Explorer"!==browser.name||!e.xbrowser.processIECharacterData(s,l,"modify",n)){if((a=s.data)===n&&!(local_echo_enabled&&local_echo_config.extended&&Util.is_content_editable(s)))return;(d=e.lecho_regulator_ext.try_handle_remote_update(s,n))||(d=e.local_input.defer_update_if_needed(s,n)),d||R(s,a,n)}c&&c.adjust_parent_fragment_size(t,r)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_SVG_ELEMENT,T),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_NS_ELEMENT,(function(e,t,r,n,i,o,a){C(e,t,r,n,i,o,a)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.FOCUS_ELEMENT,(function(e,t,r,n){var i,o=!1;if(soft_assert(i=null===t?getWindowByFid(e):getNodeByUid(e,t),"Unknown node"),i.focus){if(document.body&&document.activeElement===i)return;f&&r&&!Util.elementIsInsideViewport(i)&&isTopFrameFid(e)&&0===getWindowByFid(e).pageYOffset&&(o=!0),n||o?Util.safeFocus(i):i.focus()}})),e.interp.registerOpcodeHandler(e.interp.OPCODES.BLUR_ELEMENT,(function(e,t){var r;if(soft_assert(r=null===t?getWindowByFid(e):getNodeByUid(e,t),"Unknown node"),r.blur){if(document.body&&document.activeElement!==r)return;r.blur()}else reportWarnClientEvent("tc-dom-unable-to-blur",{node:r.nodeName})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.SCROLL_ELEMENT,(function(t,r,n,i,o){var a=getWindowByFid(t),s=getNodeByUid(t,r);soft_assert(s,"Unknown node"),e.local_events.ignored_events.scroll[t+"_"+r]=!0,"#document"===s.nodeName?(n=Math.floor(s.documentElement.scrollWidth*n),i=Math.floor(s.documentElement.scrollHeight*i),BrowserDetect.isIE()||!o?a.scrollTo(n,i):a.scrollTo({left:n,top:i,behavior:o})):(n=Math.floor(s.scrollWidth*n),i=Math.floor(s.scrollHeight*i),s.scrollTop=i,s.scrollLeft=n)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_DOCUMENT,(function(t,r,i,o){var a,s=getWindowByFid(t);s&&(a=s.document,i&&a.documentElement&&(_(a.documentElement),e.callback.fire("dom-reset",t),"image/svg+xml"===o&&((a=a.body).setAttribute("style","border: none; margin: 0px; padding: 0px"),a.__sv_svg_container=!0)),setNodeIds(a,r,t),n.apply_adoption_cmds())})),e.interp.registerOpcodeHandler("DOM_init",(function(t,r,n,i,o,a,s){e.preload_indicator.dismiss(),e.callback.fire("dom-init",r,i,o,a,s)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.LOADED,(function(t,r){e.stats.stop("t_tdl"),e.stats.stop("t_tnl"),(r=r||{}).mode="r1",r.fs=Util.getFramingStatus(),r.pxy=window.TPROXY_ENABLED?1:0,e.callback.fire("dom-loaded",r)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.SCROLL_CONTROL,(function(t,r,n){e.wheel_ctrl.on_elem_wheel_ctrl_msg(t,r,n)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.DESIGN_MODE,(function(e,t){var r=getWindowByFid(e).document;"Explorer"===browser.name||browser.version<=10?"on"===t?r.body.setAttribute("contenteditable"):"off"===t&&r.body.removeAttribute("contenteditable"):r.designMode=t})),e.interp.registerOpcodeHandler(e.interp.OPCODES.READONLY_STATUS_CHANGED,(function(t,r,n,i){var o,a=getWindowByFid(t);a&&(reportClientEvent("readonly-status-update",{is_readonly:n,is_parent_readonly:i,is_top_isolated_frame:r,fid:t,tclevel:"tc-local-stats"},!1,!0),r?o=e.feedback_bar:a.feedback_bar?o=a.feedback_bar:(EventListener.addListener(a,"resize",h,!1),o=new FeedbackBar(e,a,!1),a.feedback_bar=o),o.setReadonlyUI(n,i),a.__sv_surrogate_is_readonly=n)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.RESYNC_PREPARE,(function(t){e.resync_in_progress=!0,e.frameset_wrapper&&(t=e.frameset_wrapper.get_original_fid(t),delete e.frameset_wrapper),isTopFrameFid(t)&&(__re_init_id_state(),e.sheet_loader.reset(),c&&c.reset(),n.reset(),o&&o.reset(),e.lecho_regulator.reset(),function(e){var t;for(t in e)e.hasOwnProperty(t)&&(e[t].__sv_paused=e[t].paused,window.document.body.appendChild(e[t]))}(l))})),e.interp.registerOpcodeHandler(e.interp.OPCODES.RESYNC_COMPLETE,(function(t){var r,n=document.getElementById(DOM_LOADED_ELEM_ID);n&&((r=JSON.parse(n.value)).resync=!0,n.value=JSON.stringify(r),e.sheet_loader.set_dom_resync_completed(),delete e.resync_in_progress)})),e.interp.registerOpcodeHandler("favicon",(function(e){var t="__sv_favicon",r=document.getElementById(t);document.head&&(r||((r=document.createElement("link")).type="image/x-icon",r.rel="shortcut icon",r.id=t,document.head.appendChild(r)),(__startswith(e,"data:image/")||__startswith(e,"https://"))&&(r.href=e))})),e.interp.registerOpcodeHandler("using_frameset",(function(t){isTopFrameFid(t)?e.frameset_wrapper=new FramesetWrapper(e,mf.window,t,(function(){e.update_queue.deliver(t,e.interpretQueued)})):soft_assert(!1,"using_frameset command sent to a wrong frame.")})),e.interp.registerOpcodeHandler("add_shadow_root",(function(t,r,i,o){c||(c=new ShadowDomSupport(e,n)),c.add_shadow_root(t,r,i,o)})),e.interp.registerOpcodeHandler("slot_assign",(function(t,r,i){c||(c=new ShadowDomSupport(e,n)),c.slot_assign(t,r,i)})),e.interp.registerOpcodeHandler("add_external_svg",(function(e,t,r,n,i){var o,a,s,l=getWindowByFid(e);l.document.body&&((a=getSvgRootUidForFid(e,n))&&(assert(a!==r),(o=getNodeByUid(e,a))&&o.parentElement&&o.parentElement.removeChild(o)),(s=getNodeByUid(e,t))&&s!==l.document||(t=getUidByNode(l.document.body)),T(e,r,"svg",i,t,-1),soft_assert(o=getNodeByUid(e,r),"Unknown node"),addSvgRootUidForFid(e,n,r),o.setAttribute("class","__safly_external_svg"),o.setAttribute("width","0px"),o.setAttribute("height","0px"),o.style.display="none")})),e.interp.registerOpcodeHandler("display_copy_paste_modal",(function(){e.ui_frame.call("showCopyPasteModal",BrowserDetect.isMac())})),e.interp.registerOpcodeHandler("validate_form",(function(e,t,r,n){var i=getNodeByUid(e,t);i&&(i.setCustomValidity&&i.validationMessage!==r&&i.setCustomValidity(r),i.reportValidity&&n&&i.reportValidity())})),e.interp.registerOpcodeHandler("key_ctrl",(function(t,r,n,i,o,a,s,l,c){e.key_ctrl.on_elem_key_ctrl_msg(t,r,n,i,o,a,s,l,c)})),e.interp.registerOpcodeHandler("datetime_chooser",(function(e,t){var r=getNodeByUid(e,t);r&&Util.is_element_date_time_input(r)&&Util.is_supported_element_date_time_input(r)&&r.showPicker&&r.showPicker()})),e.interp.registerOpcodeHandler("color_chooser",(function(e,t,r){var n=getNodeByUid(e,t);n&&Util.is_element_color_input(n)&&(Util.is_supported_element_color_input(n)?n.hasAttribute("data-sv-color-chooser-open")||(n.setAttribute("data-sv-color-chooser-open",""),n.click()):n.value!==r&&(n.value=r))})),e.callback.registerOneShot("dom-loaded",1e4,{on_success:function(){setTimeout((function(){f=!1}),1e4)},on_timeout:function(){f=!1}}),t=window.SvCustomElemReg?(o=new SvCustomElemReg).handle_define_elem:function(){},e.interp.registerOpcodeHandler(e.interp.OPCODES.DEFINE_CUSTOM_ELEM,t),e.interp.registerOpcodeHandler(e.interp.OPCODES.CONTENT_LOADED,(function(t){!function(t){var r=getIframeByFid(t),n=null;function i(){return!(!r||!r.__sv_is_ready_for_updates||r.__sv_frame_owner&&(setTimeout((function(){""===r.width&&""===r.height&&(r.setAttribute("width","0"),r.setAttribute("height","0"),setTimeout((function(){r.setAttribute("width",""),r.setAttribute("height","")}),0))}),50),n&&e.callback.deregister(n),0))}i()||(n=e.callback.register("frame-ready-for-updates",i))}(t)}))}function DownloadSupport(e){var t=this,r=new Logger("download",{level:"info"}),n=BrowserDetect.isIE(),i={},o={},a={},s=Object.freeze({NOT_START:0,STARTING:1,STARTED:2}),l={1:"download was cancelled by the user",2:"max download file size exceeded",3:"early file block due to file type policy"};function c(t){i.hasOwnProperty(t)&&(delete i[t],e.surrogate_channel.send("dl-tc-ui-finished",t))}function d(t,r){var n,i,o,a,s;r&&r.block_reasons&&-1!==r.block_reasons.indexOf("dlp")?(i=r.block_details.dlp,o={block_files:t.filename},void 0!==i&&i.length>0&&(o.block_app=i[0].app_name,o.block_message=i[0].custom_block_message),a="",Util.forEachItem(o,(function(e,t){a=Util.addQueryValue(a,e,t)})),s=e.url_builder.buildVanityFileTransferURL("/file_transfer/block/dlp/"+t.uri+a),e.ui_frame.call("hideDownloadModal"),e.ui_frame.call("showDownloadDlpBlockPage",s)):e.pairing_dict.client_caps.custom_file_block_page?Util.locationSet(window,e.url_builder.buildVanityFileTransferURL("/file_transfer/block/"+t.uri)):(t.total&&(n=A(t.total)),e.ui_frame.call("showDownloadBlocked",e.localization.get("ID_DOWNLOAD_POLICY_BLOCK"),t.filename,n))}function u(t){return e.serverCall({op_name:"get_download_action",url:e.url_builder.buildFileServerUrl("/safeview-fileserv/tc_status",!1,{file_id:t.key}),data:JSON.stringify({file_id:t.key})})}function f(){e.ui_frame.call("renderDownloadProgressMessageText",e.localization.get("ID_MODAL_DOWNLOAD_PROGRESS_ANALYZING"))}function p(t){u(t).done((function(r){var n,o,a=i[t.id];a?"preq"===r.action?(a.preq||(e.ui_frame.call("showDownloadPassword",r.file_id,t.filename),a.preq=!0,r.is_arch_subfile&&(a.is_arch_subfile=!0)),setTimeout(p.curry(t),500)):"pending"===r.action||"processing"===r.action?("pending"===r.action?f():(a.processing_status_calls%10==0&&(0===a.processing_status_calls&&a.preq&&e.ui_frame.call("hideDownloadPassword"),a.processing_status_calls/10%2==0?f():e.ui_frame.call("renderDownloadProgressMessageText",e.localization.get("ID_MODAL_DOWNLOAD_PROGRESS_PLEASE_WAIT"))),a.processing_status_calls+=1),o=.5,r.plugins&&(o+=.5*function(e){var t=0,r=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t++,"FINISHED"===e[n].status&&r++);return 0===t?1:r/t}(r.plugins)),o!==t.progress&&(t.progress=o,e.ui_frame.call("renderDownloadProgressBar",t.progress)),r.file_size&&!t.total&&(t.total=r.file_size,n=A(t.total),e.ui_frame.call("renderFileSize",n)),a.errors=0,setTimeout(p.curry(t),500)):("block"===r.action&&"error"===r.action||a.is_arch_subfile&&"allow"!==r.action&&window.close(),T(t,r)):T(t,{action:"cancel"})})).fail((function(){var e=i[t.id],r=15;reportErrorClientEvent("tc-download-failed-to-get-policy",{download:JSON.stringify(t)}),e&&(r=e.errors,e.errors=r+1),r<15?setTimeout(p.curry(t),500):T(t,{error:"connection_lost"})}))}function g(t,n){var i;return-1!==t.fid&&(!t.is_main_frame&&((i=e.useRemotingV2()?function(t,r){var n,i;if(assert(e.compositor),assert(e.compositor.getIframeDelegate()),n=e.compositor.getIframeDelegate(),m(t)){if(!(i=n.getIframeNodeForFrame(t.fid,t.frame_token)))return!1;i.setAttribute("src",r),v(t.fid,r)}else Util.windowOpen(r,t.filename);return!0}(t,n):function(e,t){var r,n,i;if(m(e)){if(!(r=getNodeByFrameFid(e.fid)))return!1;if(!(n=getNodeByUid(r.fid,r.uid)))return!1;if("iframe"!==(i=Util.get_node_tag(n))&&"object"!==i)return!1;if("object"===i&&!(n=function(e){var t,r,n,i,o;for(t=e.children,o=0;o<t.length;o++)if((r=t[o]).__sv_unmapped_frame)return r;if(!(n=getWindowByFid(getFidByNode(e))))return null;for(o=0;o<t.length;o++)(r=t[o]).style&&(r.style.display="none");e.style.fontSize="0px",e.contentWindow&&e.hasAttribute("data")&&e.removeAttribute("data");return(i=n.document.createElement("iframe")).style.width="100%",i.style.height="100%",i.style.border="0px",i.style.margin="0px",i.__sv_unmapped_frame=!0,e.appendChild(i),i}(n)))return!1;n.setAttribute("src",t),v(e.fid,t)}else Util.windowOpen(t,e.filename);return!0}(t,n))?(e.ui_frame.call("hideDownloadModal"),e.ui_frame.hide()):r.error({event:"tc-failed-to-handle-iframe-download",remoting_v2:e.useRemotingV2(),inline_pdf:m(t),fid:t.fid,frame_token:t.frame_token}),i))}function m(e){return _(e)&&h(e)}function _(e){return"application/pdf"===e.mime_type}function h(e){return"navigation"===e.download_source&&!e.content_disposition.startsWith("attachment")}function y(e){return!e.is_blank_frame&&function(e){return _(e)&&!h(e)}(e)}function v(e,t){o[e]=t,S(e)}function k(e){delete o[e],S(e)}function S(e){a.hasOwnProperty(e)&&(setTimeout(a[e],0),delete a[e])}function b(t,r){var n,i,o={},a="/safeview-fileserv/tc_download/"+t.key+"/";"Explorer"!==browser.name&&"Firefox"!==browser.name||(a+=encodeURIComponent(t.filename)),INSPECT_DOMAIN!==CLUSTER_DOMAIN&&(r.file_url?(o.file_url=encodeURIComponent(r.file_url),o.type="pdf"===r.type?"pdf":"original"):(o.file_url=encodeURIComponent(t.uri),o.type="original")),i=e.url_builder.buildFileServerUrl(a,!0,o),e.ui_frame.call("setDownloadHref",i),e.ui_frame.call("hideDownloadModal"),e.ui_frame.call("hideScanProgress"),e.ui_frame.hide(),setTimeout((function(){if(g(t,i))c(t.id);else{if(y(t))return Util.windowOpen(i,t.filename),void c(t.id);"Firefox"!==browser.name?Util.locationSet(window,i):((n=document.getElementById("safeview-file-download-container"))||((n=document.createElement("iframe")).style="visibility:hidden;display:none",n.id="safeview-file-download-container",n=document.body.appendChild(n)),n.onload=function(){n.onload=null,Util.locationSet(window,i)},n.src=i),setTimeout(c.curry(t.id),2e3)}}),200)}function w(t){u(t).done((function(r){var n=i[t.id],o=A(t.total);n?"done"===r.drive_progress&&"allow"===r.action?(e.ui_frame.call("renderDownloadCompleted",t.filename,o),c(t.id)):"processing"===r.drive_progress&&"allow"===r.action?(n.errors=0,setTimeout(w.curry(t),500)):C(t,r.drive_progress):C(t,"unexpected-error")})).fail((function(){var e=i[t.id],r=15;reportErrorClientEvent("tc-download-failed-to-get-drive-coping-status",{download:JSON.stringify(t)}),e&&(r=e.errors,e.errors=r+1),r<15?setTimeout(w.curry(t),500):C(t,"connection_lost")}))}function C(t,r){var n,i;t.id,"storage_full"===r?(n=e.localization.get("ID_MODAL_DOWNLOAD_STORAGE_FULL_ERROR_HEADER"),i=e.localization.get("ID_MODAL_DOWNLOAD_STORAGE_FULL_ERROR_MESSAGE")):"invalid_filename"===r?(n=e.localization.get("ID_MODAL_DOWNLOAD_TO_DRIVE_ERROR_HEADER"),i=e.localization.get("ID_MODAL_DOWNLOAD_TO_DRIVE_INVALID_FILENAME_ERROR_MESSAGE")):(n=e.localization.get("ID_MODAL_DOWNLOAD_TO_DRIVE_ERROR_HEADER"),i=e.localization.get("ID_MODAL_DOWNLOAD_TO_DRIVE_ERROR_MESSAGE")),e.ui_frame.call("showDownloadError",n,i,!0),c(t.id)}function T(r,n){"cancel"!==n.action?n.error?(e.ui_frame.call("showDownloadError"),c(r.id)):"safedoc"===n.action?e.serverCall({op_name:"tc_isolate_document",type:"GET",url:e.url_builder.buildFileServerUrl("/safeview-fileserv/tc_isolate_document/"+r.key+"/",!0,{file_url:encodeURIComponent(r.uri),type:"isolate"}),data:{}}).always((function(o){var a,s=i[r.id];if(e.ui_frame.call("hideScanProgress"),s&&s.preq)return e.ui_frame.hide(),void c(r.id);if("full"!==n.viewer&&(e.pairing_dict.client_caps.docview_modal||"modal"===n.viewer)){if(a=e.url_builder.buildFileServerUrl(n.url,!0),g(r,a))return r.pdf_print&&t.emulateIframePrint(r.fid,null,!1),void c(r.id);e.ui_frame.call("showDocviewModal",a)}else{if(a=TPROXY_ENABLED?e.url_builder.buildLoginURL(n.url):n.url,g(r,a))return r.pdf_print&&t.emulateIframePrint(r.fid,null,!1),void c(r.id);e.ui_frame.call("hideDownloadModal"),e.ui_frame.hide(),y(r)?Util.windowOpen(a,r.filename):Util.locationAssign(window,a)}c(r.id)})):"allow"===n.action?(1!==r.progress&&(r.progress=1),function(r,n){var o=A(r.total);e.ui_frame.call("renderDownloadProgress",1,e.localization.get("ID_MODAL_DOWNLOAD_PROGRESS_SUCCESS"),void 0,void 0,e.url_builder.buildAssetURL("/safeview-static/img/icon-check.png")),i[r.id].result=n,setTimeout((function(){"any"===n.downloads_to?e.ui_frame.call("renderDownloadSaveOptions",r.filename,o):"cloud"===n.downloads_to?t.renderDriveDownload(!0,r.id):b(r,n)}),1500)}(r,n)):"block"===n.action?(d(r,n),c(r.id)):"error"!==n.action&&"expired"!==n.action||(e.ui_frame.call("showDownloadError"),c(r.id)):assert(!i.hasOwnProperty(r.id))}function E(t){var n="",o=null;t.nav_session_id&&(o=t.nav_session_id),t.uri.length<4096&&(__startswith(t.uri,"http:")||__startswith(t.uri,"https:"))&&(n=t.uri),i.hasOwnProperty(t.id)&&(i[t.id].scan_status=s.STARTING),e.serverCall({url:e.url_builder.buildFileServerUrl("/safeview-fileserv/tc_processing"),data:JSON.stringify({download_id:t.id,file_id:t.key,rid:e.pairing_dict.rid,src_uri:n,referrer:t.document_url,nav_session_id:o,is_prepend:!TPROXY_ENABLED,read_only:t.readonly_tab,category:t.category,is_mobile:BrowserDetect.isMobile()})}).done((function(e){i.hasOwnProperty(t.id)?(i[t.id].scan_status=s.STARTED,p(t)):T(t,{action:"cancel"})})).fail((function(){r.error({event:"tc-download-failed-to-start-processing",download:t}),T(t,{error:"connection_lost"})}))}function A(e){var t,r=[" B"," KB"," MB"];for(e=parseFloat(e),t=0;t<r.length;t+=1){if(e<1024)return e.toFixed(1)+r[t];e/=1024}return e.toFixed(1)+" GB"}function R(t){var r,i,o,a=e.localization.get("ID_MODAL_DOWNLOAD_PROGRESS_PREPARING"),s=A(t.received);t.total&&(s+=" / "+(r=A(t.total))),n?o=e.url_builder.buildAssetURL("/safeview-static/img/spinner.gif"):i="download-modal-spinner download-modal-spinner-18",e.ui_frame.call("updateDownloadProgress",t.id,t.filename,r,t.progress,a,s,i,o)}function x(t){TPROXY_ENABLED&&t.cat_check_enabled?function(t,r,n){if(!t||t.length<1)return n("error");var i=e.pairing_dict.s_nid,o=new Util.xmlHttpRequest;o.open("GET",t,!0),o.setRequestHeader("Cache-Control","no-cache"),o.timeout=1e4,o.withCredentials=!0,o.setRequestHeader("Accept","msip/category,cid/"+i+",key/"+r+",*/*"),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?n(null,!0):n("error"))},o.send()}(t.xhr_url,t.key,(function(e,r){E(t),e&&reportWarnClientEvent("tc-downstream-cat-check-failed",{xhr_uri:t.xhr_url})})):E(t)}t.saveDownloadProgress=function(){e.surrogate_channel.send("dl-save-prog",i)},t.cancelDownload=function(t){var r=i[t];r&&("finished"!==r.status?e.surrogate_channel.send("cancel-download",t,1):c(t),r.is_arch_subfile&&window.close())},t.emulateIframePrint=function(t,r,n){var i=function(){o.hasOwnProperty(t)&&e.ui_frame.call("showDocviewModal",o[t]),r&&r()};!o.hasOwnProperty(t)&&n?(S(t),a[t]=i):i()},t.renderDriveDownload=function(t,r){var n,o,a,s,l=i[r];l?(o=l.download,a=l.result,s=A(o.total),n=o.drive_uuid?"."+o.drive_uuid:"",t?e.serverCall({op_name:"request_download_to_drive",url:e.url_builder.buildFileServerUrl("/safeview-fileserv/download_to_drive",!1,{file_id:o.key}),data:JSON.stringify({file_id:o.key,src_uri:o.uri,drive_uuid:n})}).done((function(){e.ui_frame.call("renderDownloadToDriveProgress",o.filename,s)})).always((function(){w(o)})):b(o,a)):C(o,"unexpected-error")},e.interp.registerOpcodeHandler("download_requested",(function(n){if(void 0===n.frame_token&&(n.frame_token=""),void 0===n.download_source&&(n.download_source="navigation"),n.frame_token=n.frame_token.toLowerCase(),r.info({event:"tc-download-requested",uri:n.uri,id:n.id,filename:n.filename,key:n.key,fid:n.fid,frame_token:n.frame_token,dl_source:n.download_source}),function(t){assert(!i.hasOwnProperty(t.id)),t.document_url=document.URL,t.readonly_tab=e.readonly.isShowingBanner(),i[t.id]={download:t,status:"not-started",scan_status:s.NOT_START,errors:0,preq:!1,is_arch_subfile:!1,processing_status_calls:0}}(n),"pubmatic"===n.filename)return reportWarnClientEvent("tc-spurious-download-requested"),t.cancelDownload(n.id),void c(n.id)})),e.interp.registerOpcodeHandler("download_ignored",(function(t){e.ui_frame.call("showModal","DownloadDisabled",t)})),e.interp.registerOpcodeHandler("download_status_updated",(function(e,t,r){var n,o=i[e];o&&(o.status=t,"started"===t?(o.download.received=r.received,o.download.progress=.5*((n=o.download).received?n.total?n.received/n.total:.5:0),R(o.download)):"finished"===t&&(o.download.mime_type=r.mime_type,o.download.pdf_print=r.pdf_print,x(o.download)))})),e.interp.registerOpcodeHandler("download_cancelled",(function(t){var r,n=i[t.id];n&&(c(t.id),assert(l.hasOwnProperty(t.reason_code)),l[t.reason_code],n.download.filename,2===t.reason_code&&(n.download.total&&(r=A(n.download.total)),e.ui_frame.call("showDownloadBlocked",e.localization.get("ID_DOWNLOAD_FILE_SIZE_EXCEEDED"),n.download.filename,r)),3===t.reason_code&&d(t))})),e.interp.registerOpcodeHandler("download_restore_prog",(function(t){Util.forEachItem(t,(function(t,r){return assert(!i.hasOwnProperty(t)),i[t]=r,"started"===r.status?R(r.download):"finished"===r.status&&(R(r.download),r.preq&&e.ui_frame.call("showDownloadPassword",r.download.key,r.download.filename),r.scan_status===s.NOT_START?setTimeout(x.curry(r.download),0):setTimeout(p.curry(r.download),0)),!1}))})),e.callback.register("dom-init",(function(){assert(e.surrogate_channel),e.surrogate_channel.send("dl-resume")})),e.callback.register("frame-node-removed",(function(e,t){k(e)})),e.callback.register("ftim-updated",(function(e,t,r){r&&k(t)}))}var COF_MPFD_MAX_SIZE=209715200,fileChooserTargetFid=null,fileChooserTargetUid=null,fileChooserTargetNode=null;function UploadSupport(e){var t,r=this,n=new Logger("upload",{level:"info"}),i=0,o=0,a=-1,s=!1,l=null,c=null,d=null,u=[],f={},p=!1,g=0,m=0,_=0,h="n/a",y=-1,v=null,k=null,S=null,b=null,w=!1;function C(){p&&(e.ui_frame.call("hideUploadProgress"),p=!1)}function T(t){var r=100,n=c?c.file.name:d?d.file.name:t||"-";m<o&&((r=Math.ceil(100*m/o))>y||n!==h)&&(!function(t,r){p=!0,e.ui_frame.call("updateUploadProgress",a,t,r)}(n,r),y=r,h=n)}function E(){fileChooserTargetNode&&(fileChooserTargetNode.value="",fileChooserTargetNode.removeAttribute("__sv_open"))}function A(){if(c&&(d=c,c=null),u.length){(c=u.shift()).id,c.file.name,c.file.size;var t=c.file.lastModified||(c.file.lastModifiedDate?c.file.lastModifiedDate.getTime():(new Date).getTime());e.surrogate_channel.send("upload",a,c.id,c.file.size,c.file.name,c.file.type||"n/a",t,c.file.webkitRelativePath||"")}}function R(t,r,n){var i,o=e.pairing_dict&&e.pairing_dict.client_caps||{};r=r||"DLPOrNetworkUploadBlocked",E(),C(),i="DLPBlocked"!==r||!n||!n.length||o.dlp_do_not_show_block_payload_uploads,e.surrogate_channel.send("abort-upload",a,"DLPBlocked"===r,!i,t||0,n||""),reportErrorClientEvent("tc-upload-error",{file_id:c.id,size:c.file&&c.file.size,name:c.file&&c.file.name,status:t,upload_id:a,dialog:r}),a=-1,i&&e.ui_frame.call("showModal",r)}function x(e){m+=e-g,g=e,T()}function D(t,r){var n=e.pairing_dict&&e.pairing_dict.client_caps||{},i="DLPBlocked";if(200!==t||"MSIP_OK"!==r)return c.xhr=null,n.dlp_block_codes&&n.dlp_block_codes.length&&-1===n.dlp_block_codes.indexOf(t)&&(i="DLPOrNetworkUploadBlocked"),void R(t,i,r);T(),A()}function I(t){assert(t===a),-1!==a&&(e.surrogate_channel.send("file-chooser-cancelled",a,!1,!1,0,""),a=-1)}function O(e,t){fileChooserTargetFid=e,a=t}function U(e){r.setupUploads(fileChooserTargetNode,e)}function M(){fileChooserTargetUid||(document.body.removeChild(fileChooserTargetNode),EventListener.removeListener(fileChooserTargetNode,"change",U),EventListener.removeListener(fileChooserTargetNode,"cancel",M)),I(a)}function F(e){e.stopPropagation()}function P(r,n,i,o){var a,s,l,c=e.pairing_dict&&e.pairing_dict.client_caps||{},d=i&&i.length&&__startswith(i,"MSIP_ERROR:");n=n||0,!(!c.dlp_retry_input||c.dlp_retry_codes_input&&c.dlp_retry_codes_input.length&&-1===c.dlp_retry_codes_input.indexOf(n))&&f.hasOwnProperty(r)&&((a=f[r]).attempts+=1,a.attempts<=c.dlp_retry_input)?window.setTimeout(t,40*Math.pow(2,a.attempts),r,a.target_url,a.data,a.content_type):(delete f[r],!c.dlp_ignore_error_input||c.dlp_ignore_error_codes_input&&c.dlp_ignore_error_codes_input.length&&-1===c.dlp_ignore_error_codes_input.indexOf(n)?(l=(s=!i||!i.length||d||c.dlp_do_not_show_block_payload||c.dlp_show_block_payload_codes&&c.dlp_show_block_payload_codes.length&&-1===c.dlp_show_block_payload_codes.indexOf(n))&&c.dlp_soft_error_input&&!(c.dlp_soft_error_codes_input&&c.dlp_soft_error_codes_input.length&&-1===c.dlp_soft_error_codes_input.indexOf(n)),e.surrogate_channel.send("inspect-failed",r,n,i||"",!s),reportErrorClientEvent("tc-inspect-failed",{status:n,input_count:r,show_error:s,soft_error:l}),s&&e.ui_frame.call("showModal",d?"Refresh":l||o?"DLPSoftBlocked":"DLPBlocked")):e.surrogate_channel.send("inspect-ignore-failed",r,n))}function L(e){delete f[e]}return r.abortUpload=function(t){C(),c&&c.xhr&&c.xhr.abort&&c.xhr.abort(),w&&e.cof.call(["doUploadAbort"],null),e.surrogate_channel.send("abort-upload",a,!1,!1,0,""),-1!==a&&(a!==t&&reportWarnClientEvent("tc-upload-user-abort",{upload_id:t,cur_upload:a}),a=-1),E()},r.setupUploads=function(t,r){assert("input"===Util.get_node_tag(t)),assert("file"===t.type.toLowerCase());var n,s,l=t.files;if(fileChooserTargetUid||(document.body.removeChild(t),EventListener.removeListener(fileChooserTargetNode,"change",U),EventListener.removeListener(fileChooserTargetNode,"cancel",M)),u=[],i=0,o=0,m=0,y=-1,!l||!l.length)return reportErrorClientEvent("tc-upload-no-files-specified",{}),void I(a);for(l.length,n=0;n<l.length;n+=1)s=l[n],i+=1,o+=s.size,u.push({file:s,id:i,upload:a}),l.length;assert(u.length===i),e.surrogate_channel.send("upload",a,0,i),A()},r.setupDroppedUpload=function(e,t){var r,s;if(t&&"input"===Util.get_node_tag(t)&&"file"===t.type&&!t.disabled&&(v=getFidByNode(t),k=getUidByNode(t),S=e),u=[],i=0,o=0,m=0,y=-1,e&&e.length){for(e.length,r=0;r<e.length;r+=1)s=e[r],i+=1,o+=s.size,u.push({file:s,id:i,upload:a}),n.info("Queued upload ID# "+i+" (of "+e.length+")");assert(u.length===i)}else reportErrorClientEvent("tc-drop-upload-no-files-specified",{})},r.dismissConfirmUpload=function(e){var t,r;e?(r=!1,assert(a===a),fileChooserTargetNode=null,fileChooserTargetUid&&((t=getNodeByUid(fileChooserTargetFid,fileChooserTargetUid))?(r=!0,(fileChooserTargetNode=t).setAttribute("__sv_open","true")):reportErrorClientEvent("tc-upload-show-file-chooser-error",{uid:fileChooserTargetUid,fid:fileChooserTargetFid})),fileChooserTargetNode||((fileChooserTargetNode=document.createElement("input")).setAttribute("type","file"),fileChooserTargetNode.setAttribute("style","display:none"),document.body.appendChild(fileChooserTargetNode),EventListener.addListener(fileChooserTargetNode,"change",U),EventListener.addListener(fileChooserTargetNode,"cancel",M),r=!0),fileChooserTargetNode.multiple=s,l&&l.length>0&&(fileChooserTargetNode.accept=l.join(",")),r&&BrowserDetect.isIE()?(EventListener.addListener(fileChooserTargetNode,"click",F),fileChooserTargetNode.click()):r&&fileChooserTargetNode.dispatchEvent(new MouseEvent("click"),{bubbles:!1})):I(a)},r.dismissConfirmUploadLocation=function(t,r){t?"cloud"===r?(e.surrogate_channel.send("show-drive-ext-upload",a),BrowserDetect.isIE()||(b=new DataTransfer)):e.ui_frame.call("showModal","ConfirmUpload"):I(a)},t=function(t,r,n,i){var o,a,s;if(!(e.pairing_dict&&e.pairing_dict.client_caps||{}).dlp_disable_cof)return o={cid:e.pairing_dict.cid,tab_id:e.pairing_dict.tab_id,safe_rid:e.pairing_dict.safe_rid,mpa_id:e.pairing_dict.mpa_id,ic:t,page_url:encodeURIComponent(Util.getPageUrl())},e.pairing_dict.cluster_id&&(o.cl=e.pairing_dict.cluster_id),void e.cof.call(["doInspect",o,t,n,i]);s=new Util.xmlHttpRequest,a=e.url_builder.buildInspectURL("/r/user_input?cid="+e.pairing_dict.cid+"&tab_id="+e.pairing_dict.tab_id+"&mpa_id="+e.pairing_dict.mpa_id+"&safe_rid="+e.pairing_dict.safe_rid+"&ic="+t+"&page_url="+encodeURIComponent(Util.getPageUrl())),e.pairing_dict.cluster_id&&(a+="&cl="+e.pairing_dict.cluster_id),s.open("POST",a),s.withCredentials=!0,s.onload=function(e){200!==s.status||"MSIP_OK"!==s.responseText?P(t,s.status,s.responseText):L(t)},s.onerror=function(){P(t,s.status)},s.setRequestHeader("Content-Type",i||"application/x-www-form-urlencoded"),s.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"),s.send(n)},e.interp.registerOpcodeHandler("inspect",(function(e,r,n,i){f[e]={attempts:0,target_url:r,data:n,content_type:i},t(e,r,n,i)})),e.interp.registerOpcodeHandler("upload_dropped_files",(function(t,r){e.copy_paste_ctrl.enforce_on_file_upload()||(O(t,r),assert(u.length===i),e.surrogate_channel.send("upload",a,0,i),A())})),e.interp.registerOpcodeHandler("run_file_chooser",(function(t,r,n,i,o,c){e.copy_paste_ctrl.enforce_on_file_upload()||(O(t,n),l=c,s=i,fileChooserTargetUid=-1===r?null:r,"any"===o?e.ui_frame.call("showModal","ConfirmUploadLocation"):"cloud"===o?(e.surrogate_channel.send("show-drive-ext-upload",a),BrowserDetect.isIE()||(b=new DataTransfer)):e.ui_frame.call("showModal","ConfirmUpload"))})),e.interp.registerOpcodeHandler("uploads_disabled",(function(t){a=t,E(),e.ui_frame.call("showModal","UploadDisabled")})),e.interp.registerOpcodeHandler("upload_blocked",(function(t,r){a=t,C(),E(),u=[],c&&c.xhr&&c.xhr.abort&&c.xhr.abort(),w&&e.cof.call(["doUploadAbort"],null),(!Array.isArray(r)||r.indexOf("dlp")<0)&&e.ui_frame.call("showModal","UploadBlocked")})),e.interp.registerOpcodeHandler("upload_complete",(function(e){var t;a=e,C(),fileChooserTargetNode&&(fileChooserTargetNode.removeAttribute("__sv_open"),BrowserDetect.isIE()&&EventListener.removeListener(fileChooserTargetNode,"click",F)),v&&k&&((t=getNodeByUid(v,k))&&"input"===Util.get_node_tag(t)&&"file"===t.type&&(t.files=S),v=null,k=null,S=null),b&&fileChooserTargetFid&&fileChooserTargetUid&&((t=getNodeByUid(fileChooserTargetFid,fileChooserTargetUid))&&"input"===Util.get_node_tag(t)&&"file"===t.type&&(t.files=b.files),fileChooserTargetFid=null,fileChooserTargetUid=null,b=null)})),e.interp.registerOpcodeHandler("upload_ack",(function(t,n,i,s){if(!(a!==t||n<=0)){if(_=m,c)(w=c.file.size<COF_MPFD_MAX_SIZE||Util.areAuthTokensInUse())?function(t){var n,i;i={cid:e.pairing_dict.cid,mpa_id:e.pairing_dict.mpa_id,tab_id:e.pairing_dict.tab_id,upload_id:a,file_id:t.id,page_url:encodeURIComponent(Util.getPageUrl())},e.pairing_dict.cluster_id&&(i.cl=e.pairing_dict.cluster_id),(n=new FileReader).filename=t.file.name,n.onloadend=function(){n.result&&e.cof.call(["doUpload",i,n.filename,n.result],null,[n.result])},n.onerror=function(){reportErrorClientEvent("tc-upload-read-failed",{name:t.file.name,size:t.file.size,error:n.error&&n.error.name,message:n.error&&n.error.message}),r.abortUpload(a)};try{n.readAsArrayBuffer(t.file)}catch(e){reportErrorClientEvent("tc-upload-read-failed",{name:t.file.name,size:t.file.size,error:e.toString()}),r.abortUpload(a)}}(c):function(t){var r,n=new FormData,i=new XMLHttpRequest;g=0,n.append("file",t.file),r=e.url_builder.buildInspectURL("/r/upload?cid="+e.pairing_dict.cid+"&mpa_id="+e.pairing_dict.mpa_id+"&tab_id="+e.pairing_dict.tab_id+"&upload_id="+a+"&file_id="+t.id+"&page_url="+encodeURIComponent(Util.getPageUrl())),e.pairing_dict.cluster_id&&(r+="&cl="+e.pairing_dict.cluster_id),i.open("POST",r),i.withCredentials=!0,i.onload=function(){D(i.status,i.responseText)},i.upload.onprogress=function(e){x(e.loaded)},i.onerror=function(){t.xhr=null,R(i.status)},i.onabort=function(){t.xhr=null,E()},t.xhr=i,i.send(n)}(c);else if(i&&s){if(!BrowserDetect.isIE()){var l=new File([],i);b.items.add(l)}o=s,m=s-1}T(i)}})),e.interp.registerOpcodeHandler("upload_aborted",(function(e){C(),a===e?a=-1:-1!==a&&reportErrorClientEvent("tc-upload-mismatch",{upload_id:e,cur_upload:a})})),e.interp.registerOpcodeHandler("upload_progress",(function(e,t,r){var n=_+r;a===e&&c&&t===c.id&&n>m&&(m=n,T())})),e.interp.registerOpcodeHandler("upload_password",(function(t,r,n){var i=t?"showUploadPassword":"hideUploadPassword";e.ui_frame.call(i,r,n)})),r.onerror=R,r.onload=D,r.onprogress=x,r.oninspecterror=P,r.oninspectsuccess=L,r}function XBrowserHelpers(){var e,t=["tel","email","number"],r=(e=0,function(){return"invalid_name_replaced_"+(e+=1)}),n=new Logger("xbrowser",{level:"info"}),i=this;function o(e,t,r){return"http://www.w3.org/1999/xhtml"===t?e.createElement(r):e.createElementNS(t,r)}function a(e){this.buffer="",this.createBlobSrc=e}function s(e){var t,r,n,i=e.split(","),o=[];for(n=0;n<i.length;++n)(r=(t=i[n].trim()).split(" ",1)[0]).startsWith("https://")?o.push(this.createBlobSrc(r).then(function(e,t){return t+e}.bind(null,t.substring(r.length))).catch(function(e){return e}.bind(null,i[n]))):o.push(window.Promise.resolve(i[n]));return window.Promise.all(o).then((function(e){return e.join(",")}))}this.isInputTypeAttr=function(e,t,r){return("Chrome"===browser.name||"ChromiumEdge"===browser.name||"Firefox"===browser.name)&&"input"===Util.get_node_tag(e)&&"type"===t},this.isIEQuirksMode=function(){return"Explorer"===browser.name&&null===document.doctype},this.supportsWebSockets=function(){return window.WebSocket||window.MozWebSocket},this.hasAttribute=function(e,t,r){return e.hasAttributeNS&&t?e.hasAttributeNS(t,r):e.hasAttribute?e.hasAttribute(r):e[r]},this.createElement=function(e,t,i){var a,s=null,l=e.document;if(l.createElementNS&&t)try{s=o(l,t,i)}catch(c){if(!(c instanceof e.DOMException)||c.code!==c.INVALID_CHARACTER_ERR&&c.code!==c.NAMESPACE_ERR)throw n.info("ex.code="+c.code+" ICE="+c.INVALID_CHARACTER_ERR),c;s=o(l,t,a=r()),reportWarnClientEvent("tc-xbrowser-invalid-attribute",{name:i,sanitized:a})}else try{s=l.createElement(i)}catch(t){if(!(t instanceof e.DOMException&&t.code===t.INVALID_CHARACTER_ERR))throw n.info("ex.code="+t.code+" ICE="+t.INVALID_CHARACTER_ERR),t;a=r(),s=l.createElement(a),reportWarnClientEvent("tc-xbrowser-invalid-attribute",{name:i,sanitized:a})}return s},this.doSetAttributeWork=function(e,r,n,i){var o,a,s=!1;if("type"===n.toLowerCase()&&"submit"===i.toLowerCase()&&(a=e.value,s=!0),this.isInputTypeAttr(e,n,i)&&(t.indexOf(i)>-1?(e.__sv_original_input_type=i.toLowerCase(),i="text"):delete e.__sv_original_input_type),e.setAttributeNS&&r)e.setAttributeNS(r,n,i);else if(this.isIEQuirksMode())switch(n.toLowerCase()){case"style":e.style.cssText=i;break;case"class":e.className=i;break;case"for":e.htmlFor=i;break;case"scrolling":case"frameborder":case"type":case"method":case"rowspan":case"colspan":e.setAttribute(n,i);break;default:(o=document.createAttribute(n)).value=i,e.setAttributeNode(o)}else e.setAttribute(n,i);s&&e.value!==a&&(e.value=a)},a.prototype.transform=function(e,t){for(var r,n,i=this.buffer+e,o=0,a=0,s=[],l=new window.RegExp("[-a-zA-Z0-9:/~_?&=%.]*"),c="https://";-1!==(o=i.indexOf(c,o))&&-1!==(r=i.indexOf("/",o+c.length));)if(i.substring(o,r+1).startsWith("https://")){if((n=o+l.exec(i.substring(o))[0].length)===i.length&&e.length)break;s.push(window.Promise.resolve(i.substring(a,o))),s.push(this.createBlobSrc(i.substring(o,n)).catch(function(e){return e}.bind(null,i.substring(o,n)))),a=n,o=n}else o+=c.length;return e.length?-1===o&&i.length-a>c.length?(s.push(window.Promise.resolve(i.substring(a,i.length-c.length))),this.buffer=i.substring(i.length-c.length)):this.buffer=i.substring(a):(i.length>a&&s.push(window.Promise.resolve(i.substring(a))),this.buffer=""),window.Promise.all(s).then((function(e){var r;for(r=0;r<e.length;r++)t.enqueue(e[r])}))},a.prototype.flush=function(e){e.enqueue(this.buffer)},this.createBlobSrc=function(e){var t=this.createBlobSrc.bind(this);return new window.Promise((function(r,n){e.startsWith("https://")?safeview.cof.call(["fetchResource",e],(function(e){null===e?n():e.type.startsWith("text/css")?(void 0===e.stream&&(e.stream=new window.Blob([e.buffer],{type:e.type}).stream()),r(new window.Response(e.stream.pipeThrough(new window.TextDecoderStream).pipeThrough(new window.TransformStream(new a(t))).pipeThrough(new window.TextEncoderStream)).blob())):void 0===e.stream?r(new window.Blob([e.buffer],{type:e.type})):r(new window.Response(e.stream).blob())})):n()})).then((function(e){return window.URL.createObjectURL(e)}))},this.setAttribute=function(e,t,i,o,a){var l;if(Util.areAuthTokensInUse()&&("src"===o||"href"===o&&"LINK"===t.nodeName)&&t.__sv_auth_fetch_src!==a&&Util.requiresCofRequest(a)){if("LINK"===t.nodeName&&"preload"===t.getAttribute("rel"))return;return t.__sv_auth_fetch_src=a,void this.createBlobSrc(a).catch((function(){return a})).then(this.setAttribute.bind(this,e,t,i,o))}if(Util.areAuthTokensInUse()&&"srcset"===o&&t.__sv_auth_fetch_src!==a)return t.__sv_auth_fetch_src=a,void s.apply(this,[a]).then(this.setAttribute.bind(this,e,t,i,o));try{this.doSetAttributeWork(t,i,o,a)}catch(s){if(s instanceof e.DOMException&&s.code===s.INVALID_CHARACTER_ERR)l=r(),this.doSetAttributeWork(t,i,l,a),reportWarnClientEvent("tc-xbrowser-invalid-attribute",{name:o,sanitized:l});else{if(-1===s.toString().toLowerCase().indexOf("not implemented"))throw s;n.info("Ignoring setAttribute exception: "+s.toString())}}},this.processIECharacterData=function(e,t,r,n){var i=!0;switch(t.nodeName){case"STYLE":browser.version<9||9===browser.version&&safeview.xbrowser.isIEQuirksMode()?t.cssText="remove"===r?" ":n:i=!1;break;case"TITLE":t.text="remove"===r?"":n;break;default:i=!1}return i},this.appendChildThatHandlesIE8CornerCase=function(e,t,r,n,i){var o=Util.get_node_tag(i);if("Explorer"===browser.name&&8===browser.version){if("embed"===t&&"object"===o)return function(e,t,r,n,i){var o=function(e,t){var r;for(e=e.toLowerCase(),r=0;r<t.length;r+=1)if(t[r][0].toLowerCase()===e)return t[r][1]}("id",n);return o||(o=r,n.push(["id",o])),i.altHtml=function(e,t,r){var n,i="<"+e+" ";for(n=0;n<t.length;n+=1)i+=t[n][0].toLowerCase()+'="'+t[n][1]+'" ';return(i+='__uid="'+r+'"')+">"}(t,n,r),e.document.getElementById(o)}(e,t,r,n,i);reportWarnClientEvent("tc-xbrowser-IE8-append-fail",{child:t,parent:o})}else reportWarnClientEvent("tc-xbrowser-general-append-fail",{name:t})},this.setSelectValue=function(e,t){var r,n=e.options.length;if(e.__safely_select_value=t,"Explorer"===browser.name){for(r=0;r<n;r+=1)if(e.options[r].value===t)return void(e.selectedIndex=r)}else e.value=t},this.getControlNode=function(e){var t;return e.hasOwnProperty("control")?e.control:e.htmlFor?document.getElementById(e.htmlFor):(t=e.getElementsByTagName("input")).length?t[0]:null},this.isDocumentInstance=function(e){if(!e)return!1;if("#document"===Util.get_node_tag(e))return!0;try{return e instanceof Document||e instanceof HTMLDocument}catch(e){return!1}},this.getEventTarget=function(e){var t,r=e.target||e.srcElement;return i.isDocumentInstance(r)&&(t=getWindowByFid(getFidByNode(r)))&&(r=t.document.body),"Edge"===browser.name&&r&&r.correspondingUseElement&&(r=r.correspondingUseElement),r},this.exitFullscreen=document.exitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitExitFullscreen,this.requestFullscreen=function(e){var t=e.requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitRequestFullscreen;t?t.apply(e):reportErrorClientEvent("tc-xbrowser-full-screen-fail")},this.fullscreenchange=[],void 0!==document.onwebkitfullscreenchange&&(this.fullscreenchange.push("webkitfullscreenchange"),this.fullscreenElement="webkitFullscreenElement"),void 0!==document.onmozfullscreenchange&&(this.fullscreenchange.push("mozfullscreenchange"),this.fullscreenElement="mozFullScreenElement"),void 0!==document.onmsfullscreenchange&&(this.fullscreenchange.push("MSFullscreenChange"),this.fullscreenElement="msFullscreenElement"),void 0!==document.onfullscreenchange&&(this.fullscreenchange.push("fullscreenchange"),this.fullscreenElement="fullscreenElement"),this.isBrokenSameSite=function(){return BrowserDetect.isChrome()&&BrowserDetect.version<67||BrowserDetect.isIOS()&&BrowserDetect.OSVersion[0]<13||BrowserDetect.isMac()&&BrowserDetect.isSafari()&&10===BrowserDetect.OSVersion[0]&&BrowserDetect.OSVersion[1]<15},this.contains=function(e,t){if("Explorer"===browser.name){for(;t&&t!==e;)t=t.parentNode;return t===e}return e.contains(t)}}function CrossOriginHistory(e){var t=this,r=new Logger("location",{level:"info"}),n=!1,i=location.href,o=null,a=null,s=!1;function l(t,r){setTimeout((function(){var e,n,i,o;Util.same_origin(location.href,t)&&safeview.event_reporter.notify_cross_site_nav(),r?Util.locationAssign(window,t):Util.locationReplace(window,t),e=location.href,n=t,i=new ParsedURL(e),o=new ParsedURL(n),i.defrag()===o.defrag()&&o.hasHash()&&window.location.reload()}),10),t.match(/^(http|https):\/\//)?e.on_hard_update(t):safeview.exit_handler.openingLocalApp()}function c(e,t,r){n=!0,o=e,r?window.history.pushState(t,"",e):window.history.replaceState(t,"",e)}function d(t,r,n,i){var o=!1;if(i&&Util.same_origin(location.href,t))c(t,r,n),e.on_soft_update_for_html4_op(t);else{if(BrowserDetect.isIE()||BrowserDetect.isEdge())try{o=decodeURIComponent(location.href)===decodeURIComponent(t)}catch(e){}n&&t!==location.href&&!o||window.history.replaceState({},"",location.href),safeview.tab.letChildrenGo(),l(t,n)}}function u(){o=location.href,a?(a(),a=null):!n&&location.href===i?r.info("dropped spurious popstate event"):e.on_soft_traversal(s),n=!0}function f(){new ParsedURL(location.href).hasHash()||new ParsedURL(o).hasHash()||u()}function p(e){var t=window.history.state;assert(!t||t.url),t&&t.url!==location.href&&(s=!0),u(),s=!1}t.assign=function(e,t,r){d(e,t,!0,r)},t.replace=function(e,t,r){d(e,t,!1,r)},t.pushState=function(e,t){assert(Util.same_origin(location.href,e)),c(e,t,!0)},t.replaceState=function(e,t){assert(Util.same_origin(location.href,e)),c(e,t,!1)},t.updateState=function(e,t){window.history.replaceState(t,document.title,e)},t.setPopstateAction=function(e){a=e},assert(e.on_soft_traversal),assert(e.on_soft_update_for_html4_op),assert(e.on_hard_update),"Explorer"===browser.name?(EventListener.addListener(window,"hashchange",p,!1),EventListener.addListener(window,"popstate",f,!1)):EventListener.addListener(window,"popstate",u,!1)}function HistorySupport(e){var t,r=this,n=new Logger("history",{level:"info"}),i=[],o=[],a=null;function s(e,t){var r=e,n="__blob__http__",i="__blob__https__",o="blob:http://",a="blob:https://",s=window.location.hostname;return t?(TPROXY_ENABLED&&(n+=s,i+=s,o+=s,a+=s),-1!==e.indexOf(n)?r=r.slice(e.indexOf(n)).replace(n,o):-1!==e.indexOf(i)&&(r=r.slice(e.indexOf(i)).replace(i,a))):e.startsWith(o)?r=r.replace(o,n):e.startsWith(a)&&(r=r.replace(a,i)),r}function l(t,r){if(assert(t),JSON.stringify({url:t,hid:r}),t=s(t,!0),!e.surrogate_channel)return JSON.stringify({url:t,hid:r}),void i.push({url:t,hid:r});e.surrogate_channel.send("navigate",t,r)}function c(e,t,n,i,o,a,s,l,c,d){var u=r.getSafeUrl(e,i,l[0]);return a&&Util.same_origin(location.href,u)}function d(){var e,t=[];for(a&&(clearTimeout(a),a=null),o.length>=2&&reportWarnClientEvent("tc-history-unexpected-queue-depth");o.length;)u(e=o.shift())||t.push(e);(o=t).length&&(a=setTimeout(d,100))}function u(t){if(e.ui_frame&&e.ui_frame.isModalOpened("popup-modal")&&("update_navbar"!==t[0]||!c.apply(this,t.slice(1))))return!1;switch(t[0]){case"update_navbar":try{h.apply(this,t.slice(1))}catch(t){if("shutdown-tc"===t.name)return e.finish(),!0;throw t}break;case"history_jump":p.apply(this,t.slice(1));break;default:reportErrorClientEvent("tc-history-unknown-navigation-command")}return!0}function f(){o.push([].slice.call(arguments)),d()}function p(e){window.history.go(e)}function g(){var t;for(assert(e.surrogate_channel),JSON.stringify(i),t=0;t<i.length;t+=1)l(i[t].url,i[t].hid);i=[]}function m(t,r,n){var i,o,a=n.split("&"),s=t.document.createElement("form"),l=0;if(s.setAttribute("method","post"),s.setAttribute("action",r),""!==n)for(l=0;l<a.length;l+=1)o=a[l].split("="),(i=t.document.createElement("input")).setAttribute("type","hidden"),i.setAttribute("name",Util.formDecode(o[0])),i.setAttribute("value",Util.formDecode(o[1])),s.appendChild(i);t.document.body.appendChild(s),t===window&&e.tab.letChildrenGo(),s.submit()}function _(t){var i,o=e.tab.childWin(t.tab);if("initial"===t.action&&o){t.pp&&!t.mpa_id&&t.pp.switch_access&&(t.rip="prepend"===t.pp.switch_access),i=new ParsedURL(r.getSafeUrl(t.url,t.rip,t.mpa_id)).href(),t.pp&&!t.mpa_id&&"prepend"===t.pp.switch_access&&(TPROXY_ENABLED?i=e.url_builder.buildLoginURL("/"+i):reportWarnClientEvent("sticky-double-prepend"));try{t.hasOwnProperty("b")?m(o,i,t.b):Util.locationReplace(o,i)}catch(e){n.error("Failed to set child tab location")}}}function h(n,i,o,a,s,l,c,d,u,f){var g,_={hid:o,persistent_policy:s||{}};if(s&&!d[0]&&s.switch_access&&(a="prepend"===s.switch_access),g=new ParsedURL(r.getSafeUrl(n,a,d[0])).href(),s&&!d[0]&&"prepend"===s.switch_access&&(TPROXY_ENABLED?g=e.url_builder.buildLoginURL("/"+g):reportWarnClientEvent("sticky-double-prepend")),"Explorer"===browser.name&&(_.url=g),c)return assert(l),t.setPopstateAction((function(){setTimeout((function(){h(n,i,o,a,s,l,0,d,u,f)}),0)})),void p(c);if(JSON.stringify({target_raw_page_url:n,turl:g,state:_,is_same_page:l,kind:i,mpa_tag:d,prepend:a,hid:o}),assert(g),!__startswith(Util.getRawPageUrl(),"http://doc/")&&!__startswith(Util.getRawPageUrl(),"http://drive/")){if(u)return e.download.saveDownloadProgress(),void m(window,g,f);switch(i){case"add":e.download.saveDownloadProgress(),Util.restoreLocationHint(),t.assign(g,_,l);break;case"replace":e.download.saveDownloadProgress(),t.replace(g,_,l);break;case"reload":e.download.saveDownloadProgress(),t.replace(g,_,!1);break;case"pushstate":t.pushState(g,_);break;case"replacestate":t.replaceState(g,_);break;case"stateupdate":Util.getRawPageUrl();try{t.updateState(g,_)}catch(e){reportWarnClientEvent("tc-history-invalid-stateupdate"),t.replace(g,_)}break;default:assert(0)}e.readonly.configBanners()}}function y(t){e.surrogate_channel.send("resume_client_update")}function v(e){var t=new Error(JSON.stringify({target_url:e}));throw t.name="shutdown-tc",t}function k(e){var t=Util.getPageUrl(),n=e?null:r.getHID();JSON.stringify({turl:t,thid:n}),l(t,n)}function S(n,i,o){var a=Util.getUrlHint(o);o=o||{},r.getHID()===i&&Util.persistentPolicy()===o||(t.updateState(window.location.href,{hid:i,url:window.location.href,persistent_policy:o}),a&&Util.removeParam(a.key,a.value),e.readonly.configBanners())}function b(n){var i=Util.getUrlHint(n);n=n||{},t.updateState(window.location.href,{hid:r.getHID(),url:window.location.href,persistent_policy:n}),i&&Util.removeParam(i.key,i.value),e.readonly.configBanners()}function w(e,t){Util.setUrlHint(e,t)}r.getHID=function(){var e=window.history.state;return e?e.hid:null},r.getSafeUrl=function(t,r,n){var i="/";return t="about:blank"===t||t.startsWith("about:blank?dt=")?t.replace("about:blank","__about_~_blank__"):s(t,!1),n&&(i="/mpa/"+n+"/",TPROXY_ENABLED&&(t=e.url_builder.buildLoginURL(i+t))),t.startsWith("__blob__http__")||t.startsWith("__blob__https__")?i+t:TPROXY_ENABLED||!r?t:i+t},e.interp.registerOpcodeHandler("set_url_hint",w),e.interp.registerOpcodeHandler("update_navbar",f.curry("update_navbar")),e.interp.registerOpcodeHandler("client_loc",_),e.interp.registerOpcodeHandler("history_jump",f.curry("history_jump")),e.interp.registerOpcodeHandler("persistent-policy",b),e.callback.register("surrogate-channel-connected",g,!0),e.callback.register("dom-init",S),e.callback.register("safeview-exit",(function(){setTimeout((function(){Util.restoreLocationHint()}),0)})),t=new CrossOriginHistory({on_soft_traversal:k,on_soft_update_for_html4_op:y,on_hard_update:v})}function TabSupport(e){var t=new Logger("tab",{level:"info"}),r=this,n=["width","height","left","top","menubar","toolbar","location","status","fullscreen","scrollbars","resizable"],i=[],o=[],a={},s=!1,l=!1;function c(e){var t=e.split("?")[0];return a.hasOwnProperty(t)}function d(){var r=o.shift();return r&&(s?(o.unshift(r),r=void 0):c(r.uri)&&(t.info("Denying repeated popup request for "+r.uri),e.surrogate_channel.send("allow-tab-open",!1,!1,r.pairing_dict.tab_id),r=d())),r}function u(){var e,t;for(e=0;e<window.__sv_tracked_tabs.length;e+=1)try{(t=window.__sv_tracked_tabs[e].window).hasOwnProperty("TARGET_URL")&&Util.locationReplace(t,t.TARGET_URL)}catch(e){}}function f(t){var n=window.navigator.userActivation&&window.navigator.userActivation.isActive,o=!0;t.user_initiated&&(0!==i.length||n)&&(o=!r.tabOpenAction(t,"allow",!1)),o&&(s=!0,e.ui_frame.call("showPopupOpenModal",t))}function p(){var e=d();e&&(o.length,i.length,f(e))}function g(){var e=i.shift();if(e)try{e.close()}catch(e){}}function m(r,n,o){if(assert(window===window.top),!e.detached){for(;0!==i.length;)g();u(),r?(t.info("Detached"),e.restore_on_reattach.save_state(),e.detached=!0,e.prevent_reattach=o,n||e.surrogate_channel.close("client-detach"),clearPairingState(e)):window.close()}}r.safeview=e,r.detachAfterChannelClose=function(){t.info("Detaching from channel failure"),m(!0,!0,!1)},r.tabPreOpen=function(e){var t;return!c(e)&&!window.navigator.userActivation&&((t=Util.windowOpen())&&i.push(t),!!t)},r.tabOpenAction=function(r,n,o){var l;if(e.ui_frame.hide(),!r.pairing_dict)return"allow"===n&&((l=i.shift())?Util.locationReplace(l,r.target_uri):l=r.feature_str?Util.windowOpen(r.target_uri,"",r.feature_str):Util.windowOpen(r.target_uri)),s=!1,!0;if("allow"===n)if(r.user_initiated&&(l=i.shift()),l||(l=Util.windowOpen("","",r.feature_str)),l)l.name=function(t){return e.tab_store.format(t.pairing_dict)}(r),r.defer_initial_nav?l.TARGET_URL=r.target_uri:Util.locationReplace(l,r.target_uri),window.__sv_tracked_tabs.push({window:l,tab_id:r.pairing_dict.tab_id});else{if(!o)return t.info("Falling-back to open new tab with modal."),!1;t.warn("Failed to open new tab"),n="blocked"}else"deny"===n&&(a[r.uri.split("?")[0]]=!0);return e.surrogate_channel.send("allow-tab-open","allow"===n,o,r.pairing_dict.tab_id),s=!1,setTimeout(p,0),!0},r.openTabWithInfo=f,r.letChildrenGo=u,r.childWin=function(e){var t;for(t=0;t<window.__sv_tracked_tabs.length;t+=1)if(window.__sv_tracked_tabs[t].tab_id===e)return window.__sv_tracked_tabs[t].window;return null},window.__sv_tracked_tabs=window.__sv_tracked_tabs||[],e.interp.registerOpcodeHandler("TAB_open",(function(t,a,s,c,d,u){var f,m,_,h={},y="",v="__about_~_blank__",k=new ParsedURL(a),S=k.origin(),b={new_popup:!0,tab_id:t,cid:r.safeview.pairing_dict.cid,safe_rid:r.safeview.pairing_dict.safe_rid};if(r.safeview.pairing_dict.cluster_id&&(b.cluster_id=r.safeview.pairing_dict.cluster_id),c)try{h=JSON.parse(c)}catch(e){reportErrorClientEvent("tc-tab-invalid-features-json",{features_json:c})}for(m=0;m<n.length;m+=1)void 0!==h[f=n[m]]&&(y&&(y+=","),y+=f+"="+h[f]);"about:blank"!==a&&"about:blank#blocked"!==a||(e.pairing_dict.mpa_id&&(v="mpa/"+e.pairing_dict.mpa_id+"/"+v),a=TPROXY_ENABLED?window.location.origin+"/"+v:v,S="about:blank"),"doc"!==k.hostname&&"viewer.documentisolation"!==k.hostname||(S="safedocs",k.hostname="doc",k.port="",a=k.href()),_={user_initiated:!s,uri:a,uri_origin:S,target_uri:d?a:Util.rewriteRawHref(a),feature_str:y,pairing_dict:b,defer_initial_nav:u},i.length,""!==y&&_.user_initiated&&0!==i.length&&g(),_.user_initiated?o.unshift(_):o.push(_),l&&p()})),e.interp.registerOpcodeHandler("TAB_init",(function(t){var r,n="__about_~_blank__",i=new ParsedURL(t),a=i.origin();"about:blank"!==t&&"about:blank#blocked"!==t||(e.pairing_dict.mpa_id&&(n="mpa/"+e.pairing_dict.mpa_id+"/"+n),t=TPROXY_ENABLED?window.location.origin+"/"+n:n,a="about:blank"),"doc"!==i.hostname&&"viewer.documentisolation"!==i.hostname||(a="safedocs",i.hostname="doc",i.port="",t=i.href()),(r={user_initiated:!0,uri:t,uri_origin:a,target_uri:Util.rewriteRawHref(t)}).user_initiated?o.unshift(r):o.push(r),l&&p()})),e.interp.registerOpcodeHandler("TAB_close",(function(e,t,r){m(t,!1,r)})),e.interp.registerOpcodeHandler("TAB_denied",g),e.interp.registerOpcodeHandler("WINDOW_new",(function(e){reportErrorClientEvent("tc-interp-unknown-opcode",{opcode:"WINDOW_new",url:e})})),e.callback.register("dom-reset",(function(){l=!0,p()})),e.callback.register("remoting-v2-activated",(function(){l=!0})),setInterval((function(){var t;for(t=0;t<window.__sv_tracked_tabs.length;t+=1)try{window.__sv_tracked_tabs[t].window.closed&&(e.surrogate_channel.send("tab_close",window.__sv_tracked_tabs[t].tab_id),window.__sv_tracked_tabs.splice(t,1),t-=1)}catch(e){window.__sv_tracked_tabs.splice(t,1),t-=1}}),400),setTimeout((function t(){var r,n,i=!1;try{if(!window.opener||window.opener.closed||!window.opener.__sv_tracked_tabs)return;for(r=e.pairing_dict.tab_id,n=0;n<window.opener.__sv_tracked_tabs.length;n++)if(window.opener.__sv_tracked_tabs[n].tab_id===r){i=!0;break}i||window.opener.__sv_tracked_tabs.push({window:window,tab_id:r})}catch(e){return}setTimeout(t,400)}),400)}function WebSocketTester(e,t,r,n){var i,o,a,s,l=new Logger("ws-tester",{level:"info"}),c=__randstr(16),d=!1,u=!1;function f(n,i,a){var l=(new Date).getTime()-s;u||(n||r&&r("websock-test",{subtype:"failure",request_url:e,reason:i,detail:a,elapsed_ms:l}),o&&(clearTimeout(o),o=null),u=!0,t(n))}this.start=function(){o=setTimeout((function(){try{a&&(a.close(),a=null)}catch(e){l.info({event:"tc-websock-tester-timeout-exception"})}f(!1,"test timed out")}),n),function(){s=(new Date).getTime(),a=null;try{a=Util.safeCreateWebSocket(e,!0)}catch(e){f(!1,"open exception",e.name+": "+e.message)}a?(a.onopen=function(){a.send(c)},a.onmessage=function(e){d=!0,i=e.data===c,a.close()},a.onclose=function(e){e.code,d?i?f(!0):f(!1,"bad response"):f(!1,"close before response",Util.wsCloseDiags(e))},a.onerror=function(e){l.info({event:"tc-websock-tester-connect-error",details:"Is server reachable via WebSockets?"}),f(!1,"websocket error",Util.wsCloseDiags(e))}):f(!1,"open failed")}()}}function ChannelException(e){this.message=e}function LatencyDetector(e,t){var r=0,n=null,i=[];function o(){var n,o;assert(t),o=Date.now(),n=i.length?o-i[0][1]>e+5e3?2:o-i[0][1]>e?1:0:0,r!==n&&t(n),r=n}this.update_msg_seq=function(e){var t=[e,Date.now()];i.push(t)},this.shutdown=function(){clearInterval(n),n=null,safeview.interp.deregisterOpcodeHandler(safeview.interp.OPCODES.CHANNEL_ACK)},safeview.interp.registerOpcodeHandler(safeview.interp.OPCODES.CHANNEL_ACK,(function(e,t){!function(e){if(i.length)if(i[0][0]>e)reportWarnClientEvent("tc-channel-ack-error",{reason:"ack on old seq number",ack_seq:e,expected_ack_seq:i[0][0],pending_ack_length:i.length});else{if(i[0][0]<e)for(;i.length&&i[0][0]<e;)i.shift();i.shift(),o()}else reportWarnClientEvent("tc-channel-ack-error",{reason:"No pending ack",ack_seq:e})}(t)})),n=setInterval((function(){o()}),1e3)}function Channel(e,t){var r,n,i=this,o=safeview.perf.pull_timeout_ms,a=safeview.perf.push_timeout_ms,s=safeview.perf.pong_timeout_ms,l=safeview.perf.high_rtt_threshold_ms,c=0,d=12e3,u=safeview.perf.latency_notif_threshold_ms,f=null,p=null,g=[],m=[],_=null,h=null,y=null,v=null,k=!1,S=!0,b="pending",w="connected",C="dead",T=b,E=!1,A=!1,R=!1,x=!1,D=!1,I=null,O=null,U=__randstr(16),M=!1,F=0,P=0,L=0,N=void 0===t.max_retries?3:t.max_retries,B=0,H=null,V=null,W=!1,z=!1,G=new Logger("channel",{level:"info",header:function(){return{name:e,id:U,status:T,websockets_active:!!h}}});if(void 0===o||void 0===a||void 0===s||void 0===l||o<=d)throw new Error("Invalid parameters for Channel object.");function j(e,t,r){var n="";return assert(e),(r=r||{}).chid=U,r.msg_nr=F,t&&(n+=t),n+="/"+e+"?"+Util.buildQueryStr(r)}function Y(e,r,n){var i=j(e,r,n);return t.url_builder?t.url_builder(i):"https://"+location.hostname+i}function X(e,r,n){var i=j(e,r,n);return t.url_builder?t.url_builder(i,!0):"wss://"+location.hostname+i}function q(e){var t=e.slice(0);return t.unshift((assert((_+=1)>=0),_)),t}function K(e){z||(z=!0,i.send("perf-metrics",{ping_max:e.max,ping_min:e.min,ping_avg:e.avg,ping_count:e.count,channel_mode:h?"websocket":"polling",access:window.TPROXY_ENABLED?"proxy":"prepend",node_id:safeview.pairing_dict?safeview.pairing_dict.s_nid:"unknown"}))}function Q(t){var r;r=safeview.stats.agg_get("t_tc_ping"),Object.keys(r).length>0&&(5===r.count&&"surrogate"===e&&K(r),r.mode=t,reportClientEvent("tc-ping-stats",{ping:r,tclevel:"tc-ping-stats"},!1,!0))}function J(){c=0,d=12e3}function Z(){c=3e3,d=0}function $(e,r){if(T!==C)switch(T=e,t.silent_reconnect||Util.hide_message_bar(),e){case b:break;case w:t.on_connect&&t.on_connect(i,S),S=!1,he();break;case C:t.on_disconnect&&t.on_disconnect(r);break;default:assert(0,"invalid status "+e)}else assert(!1,"cannot move from STATUS.DEAD")}function ee(){return T===w}function te(){return T===C}function re(e){e&&e.abort()}function ne(){re(p),re(f),f=p=null}function ie(){M=!0}function oe(){h&&h.pong_deadline_timer&&(clearTimeout(h.pong_deadline_timer),h.pong_deadline_timer=null)}function ae(){y&&(clearTimeout(y),y=null)}function se(){h&&(h&&h.ping_timer&&(clearTimeout(h.ping_timer),h.ping_timer=null),oe(),ae(),v&&(clearTimeout(v),v=null),h.close(),h=null)}function le(){I&&(safeview&&safeview.callback.deregister(I),I=null),O&&(safeview&&safeview.callback.deregister(O),O=null),ne(),se(),safeview.callback.register("safeview-exit",ie)}function ce(r,n){var i=n||{};T!==C&&(i.reason=r,function(r,n){t.on_report&&(n.chname=e,n.chid=U,n.chstat=T,n.ws=!!h,t.on_report(r,n))}("tc-channel-died",i),$(C,r),le(),H&&H.shutdown())}function de(e){safeview.cof.call(["setWSSupportState",e])}function ue(){return BrowserDetect.isFirefox()&&BrowserDetect.version>=110&&BrowserDetect.version<=120}function fe(e,t){var n=(new Date).getTime()-r;reportWarnClientEvent(safeview.perf.allow_xhr_polling?"tc-channel-fallback":"tc-channel-no-fallback",{reason:e,elapsed_ms:n,detail:t,chid:U,chstat:T,nr_msgs_received:F,ws_retry_count:P}),de("ERR"),x=!0,safeview.perf.allow_xhr_polling?(se(),te()||($(b),ye())):ce("no-fallback-to-xhr")}function pe(e){h.ping_timer=setTimeout((function(){var e=s;A?(A=!1,e=0):(B=Util.now(),h.send(JSON.stringify({ping:{ping_time:B}}))),h.pong_deadline_timer||(h.pong_deadline_timer=setTimeout((function(){fe("ping timeout")}),e)),pe(12e3)}),e)}function ge(r,n,i){var o=X("websocket",t.service_prefix,t.query_params);if(r)return!1;if(!(h=Util.safeCreateWebSocket(o,!1)))return!1;return h.binaryType="arraybuffer",h.onopen=function(){h&&pe(0)},EventListener.addListener(h,"message",(function(r){var a=r.data,s="string"==typeof a&&a.startsWith("pong");safeview.stats.add("c_tc"+(e?e.charAt(0):"")+"db",a.length),i&&(a="session_not_found",de("OK")),a&&"session_not_found"!==a?"session_found"===a?($(w),n||(ae(),safeview.perf.ws_reconnect_timeout_ms&&(v=setTimeout((function(){G.info({event:"tc-channel-websock-reconnect",timeout_secs:safeview.perf.ws_reconnect_timeout_ms/1e3}),v=null,k=!0,h.close()}),safeview.perf.ws_reconnect_timeout_ms)))):(!function(e,t){var r,n;oe(),e&&(r=t.length>4?Number(t.substr(4)):B,(n=Util.now()-r)>=0&&(safeview.stats.agg("t_tc_ping",n),Q("websockets")),n>l&&reportWarnClientEvent("tc-channel-ws-high-rtt",{rtt_ms:n,threshold_ms:l}))}(s,a),t.on_recv&&!s&&(F+=1,t.on_recv(a))):ce("session-not-found",{subtype:"session-not-found",context:"ws.onmessage",request_url:o})}),!1),h.onclose=function(e){if(!x){var t=1001===e.code||M,r=-1===[1e3,1001,1005].indexOf(e.code)&&!te()||k||safeview.exit_handler.isLocalAppOpening();e.code,r?k||P<N?(reportClientEvent("tc-channel-websock-retry",{c_code:e.code,reason:k?"reconnect":"error",retry_count:P,tclevel:k?"tc-info":"tc-warn",max_retries:N},!0,!0),k?k=!1:P+=1,se(),$(b),ge()):fe("too many retries",Util.wsCloseDiags(e)):ce(t?"client-close":"websocket-close",{subtype:"websocket_closed",close_event_code:e.code,request_url:o})}},h.onerror=function(e){reportWarnClientEvent("tc-channel-websock-error",{})},y=setTimeout((function(){y=null,fe("session_found timeout")}),safeview.perf.ws_session_found_timeout_ms),!0}function me(t,r,n,i,o){var a={subtype:"push_pull_failure",service_prefix:n,status:r,xhr_status:t.status,request_url:i};if(te())return t.status,void t.statusText;switch(r){case"parsererror":case"timeout":case"abort":case"error":L<N&&!M&&!te()?(reportWarnClientEvent("tc-channel-long-poll-retry",{is_pull:o,retry_count:L,report_dict:a}),L+=1,o?_e(e):he()):(M||de("UNK"),ce(M?"client-close":"network-error",a));break;default:ce("server-error",a)}}function _e(e){var r,n,i=null;te()||W&&!D&&ee()&&($(b),W=!1,V&&clearTimeout(V),ge()||(de("ERR"),$(w),he(),0))||(safeview.stats.inc("c_tc"+(e?e.charAt(0):"")+"p"),(i=t.query_params||{}).tms=ee()?d:0,r=Y("p",t.service_prefix,i),safeview.stats.start("t_tc"+(e?e.charAt(0):"")+"pw"),(f=new Util.xmlHttpRequest).open("POST",r),f.responseType="arraybuffer",f.timeout=o,f.withCredentials=!0,f.onload=function(r){var i,o;200===f.status?(void 0!==f.getResponseHeader&&(o=f.getResponseHeader("X-Backend-Delay")),null!==o&&(i=Util.now()-n-Number(o))>=0&&(safeview.stats.agg("t_tc_ping",i),Q("polling")),safeview.stats.stop("t_tc"+(e?e.charAt(0):"")+"pw"),L=0,te()||(ee()||(assert(T===b),$(w)),f.response&&safeview.stats.add("c_tc"+(e?e.charAt(0):"")+"db",f.response.byteLength),F+=1,setTimeout((function(){_e(e)}),c),setTimeout((function(e){t.on_recv(e.response)}),0,f))):f.onerror(r)},f.onerror=function(n){var i={};safeview.stats.stop("t_tc"+(e?e.charAt(0):"")+"pw"),!f.aborted||R?(R=!1,i.status=f.status,i.textStatus=f.timedout?"timeout":f.aborted?"abort":"error",me(i,i.textStatus,t.service_prefix,r,!0)):_e(e)},f.ontimeout=function(e){f.timedout=!0,f.onerror(e)},f.onabort=function(e){f.aborted=!0,f.onerror(e)},n=Util.now(),f.send())}function he(){var e,r;ee()&&0!==g.length&&(D||(h?(r=q(g),e=JSON.stringify(r),h.send(e),H&&H.update_msg_seq(r[0]),g=[]):function(){var e,r=Y("push",t.service_prefix,t.query_params);m.length?(G.warn({event:"tc-channel-push-xhr-retry",payload_size:JSON.stringify(m).length}),e=m):(e=q(g),g=[]),assert(e.length),E&&(E=!1,R=!0,r="BROKEN"),D=!0,p=t.ajax({url:r,dataType:"json",data:JSON.stringify(e),timeout:a,success:function(){D=!1,m=[],he()},error:function(e,n){D=!1,me(e,n||"error",t.service_prefix,r,!1)}}),H&&H.update_msg_seq(e[0]),m=e}()))}function ye(){ne(),W=!1,_e(e)}i.delay_once=function(e){V&&clearTimeout(V),V=setTimeout((function(){ee()&&he(),V=null}),e)},i.send=function(e){var t=ee(),r=te(),n=argumentsToArray(arguments);JSON.stringify(n),r||(g.push([e].concat(n.slice(1))),t&&!V&&he())},i.injectError=function(e){if(reportWarnClientEvent("tc-channel-inject-error",{kind:e}),h)"websock-close"===e?h.close(4999):"network-unplugged-1"===e&&(A=!0);else if("pull-error"===e){var t=f;t&&(reportWarnClientEvent("tc-channel-abort"),R=!0,t.abort())}else"push-error"===e&&(E=!0)},i.setRetryCount=function(e){P=e,L=e},i.close=function(e){ce(e||"client-close")},i.isPolling=function(){return null===h},i.getWSExtensions=function(){return null===h?void 0:h.extensions},i.isMixedMode=function(){return!(!(!!window.WebSocket||!!window.MozWebSocket)||!t.use_websockets)},i.isLongPolling=function(){return i.isPolling()&&0===c},safeview.callback.register("safeview-exit",ie),function(){if(!t.ajax)throw new ChannelException("must specify a jQuery-like AJAX implementation")}(),I=safeview.callback.register("window-became-active",J,!0),O=safeview.callback.register("window-became-passive",Z,!0),_=-1,u&&(H=new LatencyDetector(u,t.on_latency_change)),safeview.perf.allow_xhr_polling?t.use_websockets?(n=function(e){e?("OK"===e.state?(r=(new Date).getTime(),ge(e.inject_open_error,e.inject_response_error,e.inject_session_not_found_error)||de("ERR")):("UNK"===e.state||(new Date).getTime()-e.time>safeview.perf.ws_backoff_period_ms)&&new WebSocketTester(X("wsecho",t.service_prefix,t.query_params),(function(e){e?(de("OK"),W=!0):(de("ERR"),G.info({event:"tc-channel-websock-test-failed",detail:"WebSockets background test failed."}))}),t.on_report,safeview.perf.ws_test_timeout_ms).start(),h||ye()):ye()},ue()?n({state:"ERR"}):safeview.cof.call(["getWSSupportState",safeview.perf.ws_assume_working],n),"surrogate"===e&&EventListener.addListener(window,"beforeunload",(function(){var e=safeview.stats.agg_get("t_tc_ping");e&&e.count&&K(e)}))):ye():ue()?ce("websock-startup-failed-and-no-xhr"):ge()||(de("ERR"),ce("websock-startup-failed-and-no-xhr"))}function Interpreter(e){this.OPCODES={ADD_ELEMENT:1,ADD_CHARACTER_DATA:2,MODIFY_PROP_VALUE:3,MODIFY_ATTR_VALUE:4,REMOVE_ELEMENT:5,MODIFY_CHARACTER_DATA:6,ADD_SVG_ELEMENT:7,ADD_NS_ELEMENT:8,CHANNEL_ACK:9,FOCUS_ELEMENT:10,BLUR_ELEMENT:11,SCROLL_ELEMENT:12,FULLSCREEN_CHANGE:13,MEDIA_BLOB:14,MEDIA_UPDATE:15,MEDIA_NEW_NODE:16,ADD_DOCUMENT:17,SET_SELECTIONS:18,LOADED:19,SCROLL_CONTROL:21,DESIGN_MODE:22,READONLY_STATUS_CHANGED:23,MEDIA_REMOVE_NODE:24,REMOTING_V2_SET_SELECTIONS:25,REMOTING_V2_FOCUS_ELEMENT:26,REMOTING_V2_FOCUS_OUT:27,REMOTING_V2_CARET_POS:28,REMOTING_V2_INPUT_VALUE:29,REMOTING_V2_INPUTS_UPDATE:30,RESYNC_PREPARE:31,RESYNC_COMPLETE:32,EDITOR_SEQ_ACK:33,ADD_CUES:34,TEXT_TRACK_MODE:35,MEDIA_ATTEMPT_PLAY:36,CONTENT_LOADED:37,MEDIA_CLEAR:38,REMOTING_V2_SET_READONLY_EXCEPTION:101,WEB_AUDIO_SOURCE_NODE:501,WEB_AUDIO_DATA:502,WEB_AUDIO_STATE_CHANGE:503,WEB_AUDIO_HTTP_STREAM:504,CSS_INSERT_RULE:511,CSS_DELETE_RULE:512,CSS_OVERWRITE_RULES:513,CONSTR_CSS_CREATE:514,CONSTR_CSS_DISPOSE:515,CONSTR_CSS_REPLACE_TEXT:516,CONSTR_CSS_ADOPT_STYLE_SHEETS:517,PSEUDO_TARGET_ADD:518,PSEUDO_TARGET_REMOVE:519,DEFINE_CUSTOM_ELEM:521,ANIMATION_CREATE:531,ANIMATION_PLAY:532,ANIMATION_PAUSE:533,ANIMATION_FINISH:534,ANIMATION_CANCEL:535,DIALOG_SHOW:551,DIALOG_SHOW_MODAL:552,DIALOG_CLOSE:553,POPOVER_SHOW:561,POPOVER_HIDE:562};var t,r=this,n=new Logger("interpreter",{level:"info"}),i={};function o(e,t){assert(e),i[e]&&n.error({event:"tc-opcode-already-registered",opcode:e}),i[e]=t}function a(t){return!(!(e.frameset_wrapper&&isTopFrameFid(t)&&e.frameset_wrapper.is_pending())||e.useRemotingV2())||(!!e.dom_updater.has_pending_shadow_root(t)||getWindowByFid(t)!==mf.window&&!e.frame_loader.isFrameReadyForUpdates(t)&&!e.useRemotingV2())}function s(e,t){var r,n=Util.getFramingStatus();if(e&&n&&(2!==e||2!==n))throw reportWarnClientEvent("tc-blocked-framing",{restriction:e,fs:n}),window.setTimeout(Util.show_message_bar,0,"Disallowed framing"),(r=new Error("Disallowed framing")).name="shutdown-tc",r}function l(t){var r,o=t[0],a=i[o];if(e.stats.inc("c_tic"),!a)return n.warn({e:"unknown-opcode",opcode:o}),!0;try{r=a.apply(this,t.slice(1))}catch(t){if("shutdown-tc"===t.name)return e.finish(),!1;if("notfounderror"===t.toString().toLowerCase().trim())return n.info({event:"tc-interp-element-not-found-error",error:t.toString(),stacktrace:printStackTrace(t)}),!0;if(t instanceof SoftAssertException)return!0;throw t}return"fupd"!==o||(assert("boolean"==typeof r),r)}t=function(e,t){return reportWarnClientEvent("tc-unhandled-binary-message"),!0},r.surrogate_visible_tree=null,r.bounding_rect=null,o("visible_tree",(function(e){r.surrogate_visible_tree=e})),o("bounding_rect",(function(e,t){r.bounding_rect=t})),o("site_caps",(function(t){t.disable_local_echo&&(local_echo_enabled=!1),t.disable_local_echo_ext&&local_echo_config&&(local_echo_config.extended=!1),t.hasOwnProperty("print_enabled")&&e.print_handler.setPrintEnabled(t.print_enabled),t.hasOwnProperty("framing_restriction")&&s.apply(this,t.framing_restriction),t.hasOwnProperty("prevent_local_all_keys")&&e.key_ctrl.set_prevent_local_all_keys(t.prevent_local_all_keys),t.hasOwnProperty("key_ctrl_wait")&&e.key_ctrl.set_wait_for_key_ctrl(t.key_ctrl_wait),t.hasOwnProperty("allow_client_canvas_src")&&e.canvas.setAllowClientCanvasSrc(!0)})),o("ftimu",(function(t,r,n){e.callback.fire("ftimu",t,r,n)})),o("fupd",(function(t,r){var n;return e.text_monitor.pause_all(),e.lecho_regulator_ext.disable_ie_textinput_evt(),n=function(t,r){var n,i,o;for(n=e.frameset_wrapper?e.frameset_wrapper.map_fid_if_necessary(t):t,o=0;o<r.length;++o)if((i=r[o]).splice(1,0,n),!l(i))return!1;return!0}(t,r),e.text_monitor.resume_all(),e.lecho_regulator_ext.enable_ie_textinput_evt(),n})),o("rfc",(function(t,r,n){setFrameFidForNode(t,r,n),e.useRemotingV2()||e.callback.fire("frame-attached")})),o("disconnect",(function(t){e.finish(),Util.show_message_bar(t)})),r.registerOpcodeHandler=o,r.deregisterOpcodeHandler=function(e){delete i[e]},r.hasOpcodeHandler=function(e){return!!i[e]},r.processOneCommand=function(r,n){var o,s;if(!Util.isDataOrCtrlMessage(r))return t(r,n);if(o=n[0],s=n[1],!i.hasOwnProperty(o))return reportWarnClientEvent("tc-interp-unknown-opcode",{opcode:o}),!0;switch(o){case"fupd":if(a(s))return e.update_queue.queue(s,[r,n]),!0;n=[n[0],n[1],n.slice(2)];break;case"add_shadow_root":if(a(s))return e.update_queue.queue(s,[r,n]),!0;break;case"set_doctype":n[7]&&getWindowByFid(s)!==mf.window&&e.update_queue.discard(s)}return l(n)},r.registerBinaryHandler=function(e){t=e}}function FeedbackBar(e,t,r){function n(t){var r,n=this,i=mf.document,o={feedback_menu:{id:"feedback-menu-host",css_url:e.url_builder.buildAssetURL("/safeview-static/css/feedback-menu.css"),link_id:"__safly_feedback_menu_css_link"}},a={feedback_bar_menu:new function(e){var t=this;t.show=function(e){var r,n;t.visible||("0"===e.style.opacity&&(e.style.opacity=""),t.visible=!0,assert(e),r=e,(n=mf.document.getElementById(t.shadow_host_id))?n.shadowRoot.appendChild(r):mf.document.body.appendChild(r))},t.hide=function(){var e,r=mf.document.getElementById(t.shadow_host_id);if(t.visible){if(!(e=r?r.shadowRoot.getElementById(t.element_id):mf.document.getElementById(t.element_id)))return l.warning("Feedback bar menu host root already removed!"),void(t.visible=!1);e.style.visibility="hidden",r?r.shadowRoot.removeChild(e):mf.document.body.removeChild(e),t.visible=!1}},function(){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);assert(t.shadow_host_id)}()}({element_id:"__safly_feedback_menu",shadow_host_id:o.feedback_menu.id})};function s(e){var t=i.getElementById(e.shadow_host_id);return t&&t.shadowRoot?t.shadowRoot:i}n.setOptionEnabled=function(e,t){var r=s(a.feedback_bar_menu).getElementById(e);return r&&(t?r.classList.remove:r.classList.add)("disabled"),!!r},n.toggle=function(){a.feedback_bar_menu.visible?("function"==typeof r&&EventListener.removeListener(i.body,"click",r,!0),a.feedback_bar_menu.hide()):(!function(){var e=(o=a.feedback_bar_menu,s(o).getElementById(o.element_id));var o;e||((e=i.createElement("div")).setAttribute("id",a.feedback_bar_menu.element_id),function(e){var t,r,o,a,s=i.getElementById(u);if(!s)return;var l=i.createElement("ul");for(l.className="feedback-menu",l.style.bottom=s.offsetHeight+7+"px",e.appendChild(l),t=0;t<H.length;t++)(r=H[t]).isEnabled&&!r.isEnabled()||(o=r.getConfig(),(a=i.createElement("li")).id=o.id,V.indexOf(o.id)>-1&&a.classList.add("disabled"),"divider"===o.type?a.classList.add("feedback-menu-divider"):(a.classList.add("feedback-menu-item"),a.textContent=o.label,a.setAttribute("data-action",o.action),o.tooltip&&a.setAttribute("alt",o.tooltip),function(e,t){EventListener.addListener(e,"click",(function(){e.classList.contains("disabled")||(t.callback(),n.toggle())}))}(a,o)),l.appendChild(a))}(e));l=e,c=function(){a.feedback_bar_menu.hide()},r=function(e){!l||l.contains(e.target)||t.contains(e.target)||e.composedPath().includes(l)||c()},a.feedback_bar_menu.show(e);var l,c}(),EventListener.addListener(i.body,"click",r,!0))},n.load=function(){i.body?mf.window.customElements&&Util.forEachItem(o,(function(e,r){var n,o,a,s,l;mf.window.customElements.get(r.id)||(new SvCustomElemReg).handle_define_elem_in_frame(mf.window,r.id),(n=i.getElementById(r.id))||((n=i.createElement(r.id)).id=r.id,t.appendChild(n)),n.shadowRoot||n.attachShadow({mode:"open"}),o=r,(l=(a=n)?a.shadowRoot.getElementById(a.link_id):i.getElementById(a.link_id))||((l=i.createElement("link")).id=o.link_id,l.type="text/css",l.rel="stylesheet",l.href=o.css_url,a?a.shadowRoot.appendChild(l):(s=i.head)?s.appendChild(l):reportErrorClientEvent("tc-shadow-host-load-failed",{detail:"Cannot load the shadow host because the page does not have a head.",id:a.id}))})):reportErrorClientEvent("tc-shadow-host-load-failed",{detail:"Cannot load the shadow host because the page does not have a body."})},n.load()}var i,o=this,a=t.document,s=100,l=new Logger("feedback-bar",{level:"info"}),c={cloud_debug:!1,enable_feedback:!1,enable_bypass:!1,enable_logo:!1,enable_flash:!1,indicate_readonly:!1},d=0,u="__safly_actions",f="__safly_recording",p="__safly_recording_text",g="__safly_recording_indicator",m="__safly_recording_armed",_="__safly_recording_on",h="__safly_icon",y="__safly_icon_container",v="__safly_actions_menu_dots",k="__safly_web_readonly_mode",S="__safly_feedback_css_link",b="__safly_bypass",w="__safly_feedback_arrow_down",C="__safly_custom_link",T="__safly_isolation_text",E=!1,A=!1,R=!1,x=0,D="",I="",O="notification_customization",U=e.url_builder.buildAssetURL("/safeview-static/css/feedback.css"),M=e.url_builder.buildAssetURL("/safeview-static/images/menlo-icon.png"),F=0,P=1,L=2,N=null,B=null,H=[{isEnabled:function(){return r&&c.cloud_debug&&c.cloud_debug.reports&&c.cloud_debug.reports.enabled},getConfig:function(){return{id:"debug-record-option",label:e.localization.get("ID_FEEDBACK_MENU_GENERATE_REPORT_TEXT"),action:"debug-record",tooltip:e.localization.get("ID_FEEDBACK_MENU_GENERATE_REPORT_TOOLTIP"),callback:function(){e.cloud_debug.showRecordOptionsModal()}}}},{isEnabled:function(){return r&&c.cloud_debug&&c.cloud_debug.devtools&&c.cloud_debug.devtools.local&&c.cloud_debug.devtools.local.enabled},getConfig:function(){return{id:"devtools-option",label:e.localization.get("ID_FEEDBACK_MENU_DEVTOOLS_TEXT"),action:"devtools",tooltip:e.localization.get("ID_FEEDBACK_MENU_DEVTOOLS_TOOLTIP"),callback:function(){var t,r="/r/devtools/";e.pairing_dict.mpa_id&&(r="/r/devtools/mpa/"),t=e.url_builder.buildClusterURL(r),Util.windowOpen(t,"Developer Tools","scrollbars=no,status=no,location=no,toolbar=no,menubar=no,width=640,height=480")}}}},{getConfig:function(){return{id:"hide-option",label:e.localization.get("ID_FEEDBACK_MENU_HIDE_TEXT"),action:"hide",tooltip:e.localization.get("ID_FEEDBACK_MENU_HIDE_TOOLTIP"),callback:function(){var r=a.getElementById(u);r&&(null!==B&&clearTimeout(B),r.style.setProperty("bottom","-100px","important"),e.pairing_dict.client_caps&&!e.pairing_dict.client_caps.no_feedback_bar_springback?B=t.setTimeout((function(){B=null,r.style.setProperty("bottom","0px","important")}),5e3):EventListener.addListener(r,"transitionend",(function e(){r.style.setProperty("display","none"),EventListener.removeListener(r,"transitionend",e)})))}}}}],V=[];function W(e){var t,r;e&&e.token&&e.domain?(t="https:"===new ParsedURL(Util.getRawPageUrl()).protocol,r=new Date(Date.now()+12e5),e.token,e.domain,Util.setCookie("_sc_bypass",e.token,r,"/",e.domain,t),Util.xframe_reload()):l.info({event:"tc-feedback-no-bypass",details:"No bypass token or domain found in server response."})}function z(e,r){a.body?e():r>=4e3?(a.documentElement.insertBefore(a.createElement("body"),null),a.body.__sv_saved_for_feedback=!0,e()):(r+=200,t.setTimeout((function(){z(e,r)}),200))}function G(){var t,r,n,i,o=a.getElementById(u);if(o){var s=a.getElementById(f),l=x!==F;if(l)if(t=e.feedback_bar_customizations.browsing_forensics_capture_indicator||{},s)x===L&&((n=a.getElementById(g)).classList.remove(m),n.classList.add(_),(r=a.getElementById(p)).setAttribute("data-tooltip",t.tooltip||e.localization.get("ID_FORENSICS_RECORDING_TOOLTIP")));else{var c=t.tooltip||e.localization.get("ID_FORENSICS_RECORDING_TOOLTIP");if(x===P){var d=e.localization.get("ID_FORENSICS_RECORDING_CAVEAT");(c=c.trim()).endsWith(d.charAt(0))&&(d=d.substr(1)),c+=d}(s=a.createElement("div")).setAttribute("id",f),s.classList.add(f),(r=a.createElement("div")).classList.add(p),r.textContent=t.text||e.localization.get("ID_FORENSICS_RECORDING"),r.setAttribute("id",p),r.setAttribute("data-tooltip",c),(n=a.createElement("div")).setAttribute("id",g),n.classList.add(g);var h=x===P?m:_;n.classList.add(h),s.appendChild(n),i=a.getElementById(w),o.insertBefore(s,i),o.insertBefore(r,i)}else s&&!l&&(o.removeChild(s),(r=a.getElementById(p))&&o.removeChild(r))}else R||z(Y,0)}function j(){var t,i,s,l,f,p,g,m,_=a.getElementById(u),E=a.getElementById(S);e.text_monitor.pause_all(),R=!0,a.head||o.addHeadNode(a),p=new UX(e,a),BrowserDetect.isMobile()&&"wide"===p.getIndicatorType(e.feedback_bar_customizations)&&(e.feedback_bar_customizations.content.indicator_type="regular"),i=(e.feedback_bar_customizations.isolate_indicator||{}).display_text||!1,s=(e.feedback_bar_customizations.custom_link||{}).show_link||!1,l=p.getIndicatorType(e.feedback_bar_customizations),f=i&&!c.indicate_readonly&&"wide"===l,E||(assert(a.head),(E=a.head.querySelector("[href='"+U+"']"))||((E=a.createElement("link")).type="text/css",E.rel="stylesheet",E.href=U,a.head.appendChild(E)),E.id||E.setAttribute("id",S)),_||((_=a.createElement("div")).setAttribute("id",u),_.classList.add(u),""!==(m=e.localization.get("ID_LOCALIZATION_CLASS"))&&_.classList.add(m),_.setAttribute("style","display:none"),a.body.appendChild(_),(t=a.createElement("div")).setAttribute("id",y),t.classList.add(y),_.appendChild(t),(g=a.createElement("img")).setAttribute("id",h),g.setAttribute("src",M),g.classList.add(h),t.appendChild(g)),G(),c.indicate_readonly&&!a.getElementById(k)?((g=a.createElement("div")).setAttribute("id",k),g.classList.add(k),g.textContent=r&&!BrowserDetect.isMobile()?e.localization.get("ID_TC_WEB_READONLY"):e.localization.get("ID_TC_WEB_READONLY_SHORT"),g.setAttribute("data-tooltip",e.localization.get("ID_TC_WEB_READONLY_TOOLTIP")),_.insertBefore(g,a.getElementById(y).nextSibling),d+=1):!c.indicate_readonly&&a.getElementById(k)&&(_.removeChild(a.getElementById(k)),d-=1),c.enable_bypass&&!a.getElementById(b)?((g=a.createElement("a")).setAttribute("id",b),g.setAttribute("href","#"),g.classList.add(b),g.textContent=e.localization.get("ID_TC_BYPASS"),g.setAttribute("data-tooltip",e.localization.get("ID_TC_BYPASS_TOOLTIP")),EventListener.addListener(g,"click",o.onBypassClick),_.insertBefore(g,a.getElementById(w)),d+=1):!c.enable_bypass&&a.getElementById(b)&&(_.removeChild(a.getElementById(b)),d-=1),s&&!a.getElementById(C)?((g=a.createElement("a")).setAttribute("id",C),g.setAttribute("href","#"),g.setAttribute("target","_blank"),_.insertBefore(g,a.getElementById(w)),d+=1):!s&&a.getElementById(C)&&(_.removeChild(a.getElementById(C)),d-=1),f&&!a.getElementById(T)?((g=a.createElement("div")).setAttribute("id",T),_.insertBefore(g,a.getElementById(y).nextSibling),d+=1):!f&&a.getElementById(T)&&(_.removeChild(a.getEdddlementById(T)),d-=1),d<=1?_.classList.add("__safly_single_action"):_.classList.remove("__safly_single_action"),g=a.getElementById(y),c.enable_feedback||c.enable_bypass||!c.enable_logo?g.classList.remove("__safly_isolation_logo"):(g.classList.add("__safly_isolation_logo"),g.setAttribute("data-tooltip",e.localization.get("ID_TC_ISOLATE_TOOLTIP"))),a.getElementById(v)||((g=a.createElement("div")).setAttribute("id",v),g.insertAdjacentHTML("beforeend",e.template.get("feedback-menu-icon")),e.callback.registerOnFirst("dom-loaded",(function(){N=new n(_)})),EventListener.addListener(g,"click",o.toggleFeedbackMenu),_.appendChild(g)),p.customizeFeedbackBar(e.feedback_bar_customizations,u,k,b,h,C,T,y,r),BrowserDetect.isMobile()&&!c.indicate_readonly||e.template.has("custom-indicator-template")||(_.style.display="block",_.style.setProperty("bottom","0px","important")),e.text_monitor.resume_all()}function Y(){a.head||o.addHeadNode(a),R?j():head.load([U],j),c.enable_bypass&&e.readonly&&e.readonly.showBypassSecurity()}function X(){var e=a.getElementById(u);e&&e.parentNode.removeChild(e)}function q(){var t,n,o;void 0!==e.feedback_bar_policy&&void 0!==i&&(Object.keys(e.feedback_bar_policy).forEach((function(t){c.hasOwnProperty(t)&&(e.feedback_bar_policy[t],c[t]=e.feedback_bar_policy[t])})),c.indicate_readonly=i,i||!r?(c.enable_feedback=!1,c.enable_bypass=!1,c.enable_logo=!1):D&&TPROXY_ENABLED&&(c.enable_bypass=!0),r||(c.cloud_debug=!1),t=Util.getRawPageUrl(),n=new ParsedURL(t).hostname,o=H.some((function(e){return e.isEnabled&&e.isEnabled()})),!(c.enable_feedback||c.enable_bypass||c.enable_logo||c.indicate_readonly||o||x!==F)||t&&"docs.menlosecurity.com"===n?X():!Util.is_in_iframe()||c.indicate_readonly?z(Y,0):X())}function K(t){e.feedback_bar_policy=t,e.feedback_bar_customizations=(t.notification_customization||{}).default||{},delete e.feedback_bar_policy.notification_customization,q()}function Q(){e.feedback_bar_policy?q():--s>0&&t.setTimeout(Q,100)}o.onBypassClick=function(){return D?TPROXY_ENABLED&&W({token:D,domain:I}):e.policy.setAction("bypass",null,null,{},W),!1},o.addHeadNode=function(e){var t;assert(!e.head),t=e.createElement("head"),assert(e.body),assert(e.documentElement),t.__sv_saved_for_feedback=!0,e.documentElement.insertBefore(t,e.body)},o.indicateRecord=function(t){x=t,e.feedback_bar_policy&&G()},o.removeFeedbackBar=X,o.getBypassPolicy=function(){return c.enable_bypass},o.updateReadonlyUI=function(){i=!e.readonly.isShowingReadonlyBanner()&&E&&(r||!A&&t.innerWidth>=200&&t.innerHeight>=200),t.innerWidth<200&&t.innerHeight<200?X():q()},o.setReadonlyUI=function(e,t){E=e,A=t,o.updateReadonlyUI()},o.toggleFeedbackMenu=function(){null!==N&&N.toggle()},o.enableMenuOption=function(e){var t;null!==N&&N.setOptionEnabled(e,!0)||(t=V.indexOf(e))>-1&&V.splice(t,1)},o.disableMenuOption=function(e){null!==N&&N.setOptionEnabled(e,!1)||V.push(e)},o.feedbackElementIDs=function(){return[u,S]},r&&(e.interp.registerOpcodeHandler("bypass_token",(function(e,t){D=e,I=t,q()})),e.callback.register("enable_readonly_bar",o.setReadonlyUI)),t.setTimeout((function(){var t;r?(t=["enable_feedback","enable_bypass","enable_logo",O],BrowserDetect.isIE()||t.push("cloud_debug"),e.policy.getValues(t,K)):Q()}),2e3)}function AlertSupport(e){function t(){return new ParsedURL(Util.getRawPageUrl()).hostname}this.dismissAlert=function(){e.surrogate_channel.send("alert-dismiss")},this.dismissConfirm=function(t){e.surrogate_channel.send("confirm-dismiss",t)},this.dismissPrompt=function(t,r){e.surrogate_channel.send("prompt-dismiss",t,r)},this.dismissHttpAuthChallenge=function(t,r,n){e.surrogate_channel.send("httpauth-challenge-dismiss",t,r,n)},this.dismissInvalidCert=function(t,r,n){t?e.surrogate_channel.send("accept-cert",r,n):window.history.back()},e.interp.registerOpcodeHandler("alert_show",(function(r){e.ui_frame.call("showAlert",r,t())})),e.interp.registerOpcodeHandler("confirm_show",(function(r){e.ui_frame.call("showConfirm",r,t())})),e.interp.registerOpcodeHandler("prompt_show",(function(r,n,i){e.ui_frame.call("showPrompt",r,t(),n,i)})),e.interp.registerOpcodeHandler("httpauth_challenge_show",(function(t,r,n,i){var o=__startswith(r.toLowerCase(),"https://")?"":e.localization.get("ID_TC_HTTPAUTH_WARNING_MSG",t);e.ui_frame.call("showHttpAuthChallenge",e.localization.get("ID_TC_HTTPAUTH_CHALLENGE_MSG",r,n),o,i)})),e.interp.registerOpcodeHandler("invalid_certificate",(function(t,r,n,i,o,a){a?Util.locationSet(window,a):e.ui_frame.call("showInvalidCert",t,r,n,i,o)})),e.interp.registerOpcodeHandler("tab_limit",(function(t){e.ui_frame.call("showTabLimit",!0)})),e.interp.registerOpcodeHandler("password_input_on_http",(function(){}))}function UIFrame(e){var t,r=this,n=null,i="safeview-ui-host",o="safeview-ui-frame-wrapper",a="safeview-ui-frame",s=0,l=[],c=!1;function d(){return!!window.customElements}function u(){return document.getElementById(i)}function f(){return d()&&u()?u().shadowRoot.getElementById(a):document.getElementById(a)}function p(t){assert(r);var n,s,l=f();return l||((l=document.createElement("iframe")).id=a,l.frameborder="0",l.border="0",l.src="about:blank",l.style.position="fixed",l.scrolling="no",l.allowtransparency="true",l.style.top="0",l.style.left="0",l.style.width="100%",l.style.height="100%",l.style.overflow="visible !important",l.style.border="0",l.style.display="none",l.style.visibility="visible",l.style.zIndex="2147483647",l.style.pointerEvents="auto",(n=document.getElementsByTagName("html")[0])||(document.write("<!DOCTYPE html><html></html>"),document.close(),assert(n=document.getElementsByTagName("html")[0])),(s=document.body)||(s=document.createElement("body"),n.appendChild(s)),e.text_monitor.pause_all(),function(e){var t,r,n;c?((n=document.createElement("dialog")).id=o,n.style.cssText="width:100vw; height:100vh; background:transparent; pointer-events: none;",n.appendChild(e),r=n):r=e;d()?(window.customElements.get("safeview-ui-host")||(new SvCustomElemReg).handle_define_elem(getFidByNode(window),"safeview-ui-host"),(t=document.createElement("safeview-ui-host")).id=i,t.attachShadow({mode:"open"}),t.shadowRoot.appendChild(r),document.body.appendChild(t)):document.body.appendChild(r)}(l),e.text_monitor.resume_all(),l.contentDocument.write(t),l.contentDocument.close()),l.onload=function(){var e,t=l.contentDocument,r=t.getElementById("custom-logo-data-url").getAttribute("content"),n=t.getElementsByClassName("custom-logo");for(e=0;e<n.length;++e)n[e].setAttribute("src",r)},l}function g(){return c?d()&&u()?u().shadowRoot.getElementById(o):document.getElementById(o):null}function m(t,r){var n;if("none"===window.getComputedStyle(document.body).display)switch(t){case"showAlert":return window.alert(r[0]),e.surrogate_channel.send("alert-dismiss"),!0;case"showConfirm":return n=window.confirm(r[0]),e.surrogate_channel.send("confirm-dismiss",n),!0;case"showPrompt":return(n=window.prompt(r[0],r[2]))?e.surrogate_channel.send("prompt-dismiss",!0,n):e.surrogate_channel.send("prompt-dismiss",!1,""),!0}return!1}this.load=function(t){var i;!function(t){var r=e.url_builder.buildProtocolUrl("/safeview-template/ui.html?o="+window.location.origin+"&h="+e.pairing_dict.ui_frame_hash+"&a="+TC_API_VERSION);assert(t),n?t(n):e.serverCall({op_name:"ui_html",type:"GET",url:r,no_tracking_label:!0,success:function(e,r){n=e,t(e)},error:function(){reportErrorClientEvent("tc-ui-frame-fetch-failed")}})}((function(e){assert(i=p(e)),t&&"function"==typeof t&&(i&&i.contentWindow&&i.contentWindow.is_frame_loaded?t(i):setTimeout((function(){r.load(t)}),100))}))},this.callInFrame=function(t){var n=f(),i=t.toString(),o=n.contentWindow[i],a=g();assert(o),m(i,argumentsToArray(arguments).slice(1))||(e.local_events.set_drop_mouse_and_pointer(!0),a&&!a.open&&a.showModal(),n.style.display="block",r.savedFocus=document.activeElement,o.apply(n.contentWindow,argumentsToArray(arguments).slice(1)))},this.call=function(){var e=this,t=arguments,n={};2!==s?(l.push({saved_this:e,saved_args:t}),0===s&&(s=1,r.load((function(){for(s=2;l.length;)n=l.shift(),r.callInFrame.apply(n.saved_this,n.saved_args)})))):r.callInFrame.apply(e,t)},this.hide=function(){var t=f(),n=g();r.isMultiDialogOpened()||(t&&(t.style.display="none",t.blur(),r.savedFocus?(r.savedFocus.id,document.activeElement&&document.activeElement!==r.savedFocus&&document.activeElement.blur(),BrowserDetect.isEdge()&&window.focus(),r.savedFocus.focus()):document.body.focus(),n&&n.open&&n.close()),document.activeElement.id,e.local_events.set_drop_mouse_and_pointer(!1))},this.active=function(){var e=f(),t=g();return t?t.open:e&&"none"!==e.style.display},this.isModalOpened=function(e){var t,r;return 2===s&&(!(!(r=f())||!r.contentDocument)&&((t=r.contentDocument.getElementById(e))&&t.open))},this.findParentDialogModal=function(e){for(;e;)if((e=e.parentElement)&&"dialog"===e.tagName)return e;return e},this.isMultiDialogOpened=function(){var e,t,r=0;if(2!==s)return!1;for(e=f().contentDocument.getElementsByTagName("dialog"),t=0;t<e.length;t++)if(e[t].open&&(r+=1),r>1)return!0;return!1},r.reload=function(){var e,t,i;d()?(e=u())&&e.parentNode.removeChild(e):c?(i=g())&&i.parentNode.removeChild(i):(t=f())&&t.parentNode.removeChild(t),n=null,s=0,r.load()},t=document.createElement("dialog"),c="undefined"!=typeof HTMLDialogElement&&"function"==typeof t.showModal&&"function"==typeof t.close,e.callback.registerOnFirst("dom-loaded",r.load)}function ContextMenu(e){var t,r,n,i,o,a,s=this,l=[],c=e.url_builder.buildAssetURL("/safeview-static/css/context-menu.css"),d="__safly_contextmenu_css_link",u=null,f=["click","mousedown","contextmenu","keydown"],p="menlo-context-disabled",g="menlo-context-menu",m="data-menlo-menu-item-index";function _(t){var r,n,i;if(t){for(e.copy_paste_ctrl.has_paste_restriction()&&Util.filterPasteDataList(t),i=0;i<t.length;i+=2)if(r=t[i],n=t[i+1],r&&n&&e.copy_paste_ctrl.enforce_on_cb_api_data("paste",r,n))return;e.surrogate_channel.send("paste",0,0,t,!1,!1)}else e.ui_frame.call("showCopyPasteModal",BrowserDetect.isMac())}function h(t,r){switch(t){case"undo":case"redo":return function(){e.surrogate_channel.send("execcmd",r.fid,t)};case"select_all":return function(){e.surrogate_channel.send("execcmd",r.fid,"selectAll")};case"copy":case"cut":return function(){e.copy_paste_ctrl.enforce_on_cb_api_data(t)||e.surrogate_channel.send("execcmd",r.fid,t)};case"paste":return function(){a?a.requestData(_):e.ui_frame.call("showCopyPasteModal",BrowserDetect.isMac())};case"back":case"forward":case"reload":return function(){"forward"===t?window.history.forward():"back"===t?window.history.back():"reload"===t&&e.reload(0)};case"link_open_new_tab":case"link_open_new_window":case"link_copy_address":return function(){var n,i,o=r.link_url;!TPROXY_ENABLED&&e.pairing_dict.mpa_id&&(o="mpa/"+e.pairing_dict.mpa_id+"/"+o),TPROXY_ENABLED||e.pairing_dict.prepend_client_navs||(o=e.url_builder.getServiceDomain()+"/"+o),"link_copy_address"===t?e.ui_frame.call("showCopyLinkModal",{link:o}):"link_open_new_tab"===t?Util.windowOpen(o,"_blank"):"link_open_new_window"===t&&(BrowserDetect.isIE()?Util.windowOpen(o,"_blank"):(n=new window.MouseEvent("click",{bubbles:!0,shiftKey:!0,button:0}),(i=document.createElement("a")).setAttribute("href",o),i.setAttribute("target","_blank"),i.dispatchEvent(n)))};case"image_open_new_window":case"image_copy_address":return function(){var n=r.src_url;!TPROXY_ENABLED&&e.pairing_dict.mpa_id&&(n="mpa/"+e.pairing_dict.mpa_id+"/"+n),TPROXY_ENABLED||(n=e.url_builder.getServiceDomain()+"/"+n),"image_open_new_window"===t?Util.windowOpen(n,"_blank"):e.ui_frame.call("showCopyLinkModal",{link:n})};case"image_save":return function(){!function(t){"image"!==t.media_type&&"canvas"!==t.media_type||e.surrogate_channel.send("cmcb","dl",t.fid,t.media_type,t.x,t.y,t.src_url,t.frame_url,t.referrer_policy)}(r)};case"divider":return function(){};default:assert(!1)}}function y(e,t){var r=t.src_url;switch(e){case"copy":case"cut":case"paste":case"redo":case"undo":case"select_all":return-1!==t.edit_enum.indexOf(e);case"image_copy_address":case"image_open_new_window":return r&&(0===r.indexOf("http:")||0===r.indexOf("https:"));case"link_open_new_tab":case"link_open_new_window":case"link_copy_address":return!!t.link_url;case"back":case"forward":default:return!0}}function v(r,n){var i,o;for(i=0;i<r.length;i+=1)o="divider"===r[i]?"divider":e.localization.get(t[r[i]]),l.push({token:r[i],text:o,enabled:y(r[i],n),cb:h(r[i],n)})}function k(e){return!!Util.findPredicateOnBranch(e,(function(e){return e.className&&e.className.indexOf&&-1!==e.className.indexOf(g)}))}function S(e){var t,r;switch(e.type,e.target,t=e.target,e.type){case"click":if(!k(t))break;for(;-1===["DIV","UL","LI"].indexOf(t.nodeName);)t=t.parentNode;if(!(r=t.getAttribute(m)))break;(r=parseInt(r,10))>=0&&r<l.length&&-1===t.className.indexOf(p)&&(s.dismiss(),l[r].cb());break;case"mousedown":k(t)||s.dismiss(),e.preventDefault();break;case"contextmenu":e.preventDefault();break;case"keydown":27===e.keyCode&&s.dismiss()}}function b(e,t,n){var i,o,a,s=t.token;"divider"===s?e.classList.add("menlo-context-divider"):(r[s]?((i=document.createElement("span")).classList.add("menlo-key-command"),i.textContent=t.text,(o=document.createElement("span")).classList.add("menlo-shortcut"),(a=document.createElement("span")).classList.add("menlo-key"),a.textContent=function(e){return BrowserDetect.isMac()?"redo"===e?"":"":"redo"===e?"Shift+Ctrl+":"Ctrl+"}(s),o.appendChild(a),o.appendChild(document.createTextNode(r[s])),e.appendChild(i),e.appendChild(o)):e.textContent=t.text,e.setAttribute(m,n)),t.enabled||e.classList.add(p)}function w(e,t){!function(){var e;for(e=0;e<f.length;e+=1)EventListener.addListener(document,f[e],S,!1)}(),i=function(){var e,t,r=document.createElement("div"),n=document.createElement("ul");for(r.classList.add(g),o&&r.classList.add(g+"-"+o),t=0;t<l.length;t+=1)b(e=document.createElement("li"),l[t],t),n.appendChild(e);return r.appendChild(n),r.setAttribute("sv-prevent-push",!0),r}(),document.body.appendChild(i),function(e,t,r){var n=e.getBoundingClientRect(),i=n.width,o=n.height,a=Util.getScreenWidth(),s=Util.getScreenHeight(),l=window.scrollX||window.pageXOffset,c=window.scrollY||window.pageYOffset;a-t<i&&(t=a-i-1),s-r<o&&(r=s-o-1),e.style.top=Math.round(r.toString())+c+"px",e.style.left=Math.round(t.toString())+l+"px",e.style.visibility="visible"}(i,e,t)}s.set_last_pos=function(e){u=e},s.dismiss_if_necessary=function(e){"mousedown"!==e.type||k(e.target)?"keydown"===e.type&&27===e.keyCode&&s.dismiss():s.dismiss()},s.dismiss=function(){i&&(document.body.removeChild(i),function(){var e;for(e=0;e<f.length;e+=1)EventListener.removeListener(document,f[e],S,!1)}(),e.useRemotingV2()&&e.compositor.selection.enable(),i=null)},s.display=function(t,r,i,o,a,f,p,g,m,_,h,y,k){var S,b,C,T={fid:t,frame_url:r,referrer_policy:i,media_type:o,suggested_filename:a,link_url:f,src_url:p,has_selection:g,is_editable:m,edit_enum:_.split(","),can_nav_flag:h,x:y,y:k};e.ctx_menu_mode&&e.ctx_menu_mode.backend_driven&&(e.copy_paste_ctrl.has_disabled_all_ctx_menu()||(!e.useRemotingV2()&&u&&(T.x=u.x,T.y=u.y,u=null),T.x,T.y,l=[],s.dismiss(),m?((S=n.edit.slice()).push("divider"),v(S=S.concat(n.cut_copy_paste),T)):"image"===o&&f?((S=n.image.slice()).push("divider"),v(S=S.concat(n.link),T)):v("image"===o||"canvas"===o?n.image:f?n.link:g?n.copy_only:n.regular,T),l.length&&(b=function(){e.useRemotingV2()&&e.compositor.selection.disable(),w(T.x,T.y)},document.getElementById(d)?b():((C=document.createElement("link")).type="text/css",C.rel="stylesheet",C.href=c,C.setAttribute("id",d),C.onload=function(){C.onload=null,b()},document.head.appendChild(C)))))},t={undo:"ID_MENU_UNDO",redo:"ID_MENU_REDO",copy:"ID_MENU_COPY",cut:"ID_MENU_CUT",paste:"ID_MENU_PASTE",back:"ID_MENU_BACK",forward:"ID_MENU_FORWARD",reload:"ID_MENU_RELOAD",select_all:"ID_MENU_SELECT_ALL",link_open_new_tab:"ID_MENU_LINK_OPEN_NEW_TAB",link_open_new_window:"ID_MENU_LINK_OPEN_NEW_WINDOW",link_copy_address:"ID_MENU_LINK_COPY_ADDRESS",image_open_new_window:"ID_MENU_IMAGE_OPEN_NEW_WINDOW",image_copy_address:"ID_MENU_IMAGE_COPY_ADDRESS",image_save:"ID_MENU_IMAGE_SAVE"},r={copy:"C",cut:"X",paste:"V",select_all:"A",undo:"Z",redo:"Z"},n={edit:["undo","redo"],copy_only:["copy"],cut_copy_paste:["cut","copy","paste","select_all"],regular:["back","forward","reload","select_all"],link:["link_open_new_tab","link_open_new_window","link_copy_address"],image:["image_open_new_window","image_copy_address","image_save"]},"Windows"===browser.os&&(o="Explorer"===browser.name&&browser.version<=10?"windows8":"windows10"),"Explorer"!==browser.name&&window.ClipboardApi&&(a=new ClipboardApi)}function ActiveTab(e){var t,r,n=["focus","focusin","keydown","mousemove","scroll"],i=__randstr(16),o=this;function a(s){var l;if(e.detached)e.prevent_reattach||(e.detached=!1,Util.xframe_reload());else if(!o.is_active){for(o.is_active=!0,e.cof.call(["setActiveCookie",i],(function(e){assert(e)})),s.type,l=0;l<n.length;l+=1)EventListener.removeListener(window,n[l],a,!1);r=setTimeout(t,200),e.callback.fire("window-became-active")}}function s(){e.surrogate_channel&&(document.visibilityState,"hidden"===document.visibilityState&&e.context_menu.dismiss(),e.surrogate_channel.send("hidden"===document.visibilityState?"hide-tab":"show-tab"))}t=function(){r=null,e.cof.call(["getActiveCookie"],(function(s){s!==i?function(){var t;if(o.is_active){for(o.is_active=!1,r&&(clearTimeout(r),r=null),t=0;t<n.length;t+=1)EventListener.addListener(window,n[t],a,!1);e.callback.fire("window-became-passive")}}():r=setTimeout(t,200)}))},assert(e.cof),EventListener.addListener(document,"visibilitychange",s,!0),e.callback.register("surrogate-channel-connected",(function(t){t&&(s(),e.local_events.send_focus_state())}),!0),e.cof.call(["setActiveCookie",i],(function(e){assert(e)})),o.is_active=!0,r=setTimeout(t,200)}function TabStorageException(e){this.message=e}function tabstore_is_reliable(e){return!window.TPROXY_ENABLED&&!e}function TabStorage(){this.format=function(e){return"JSON:"+JSON.stringify(e)},this.save=function(e){window.name=this.format(e)},this.load=function(){var e;if(-1===window.name.indexOf("JSON:",0))throw new TabStorageException("storage is empty or invalid");return e=window.name.substr(5),JSON.parse(e)},this.clear=function(){window.name="",assert(0===window.name.length)}}function Pairing(e,t){var r,n,i,o,a,s,l,c,d={},u=this,f={},p=0,g=t&&t.max_timeout_ms||3e3,m=!1;function _(e){var t=Util.parseURL(e);return t.protocol+"//"+t.hostname}function h(e){return e.hasOwnProperty("safe_rid")?e.safe_rid:""}function y(e,t,r){u.safeview.reset("repair XHR failed")}function v(e,t,n){var i,s=g,l=function(t){reportWarnClientEvent(t,{target_url:a,xhr_url:n,textStatus:e.response,statusCode:e.status,retry_count:p,timeout_ms:s})};!e.status&&(navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("MSIE 10.0")>=0||navigator.userAgent.indexOf("Edge")>=0)&&(i=_(r),f[i]||(f[i]=1,document.createElement("img").src=i+"/safeview-static/img/indicator.png?fie="+__randstr(10))),u.safeview.preload_indicator.showPreloadIndicator(),"pairing_retry"===e.response?(s=Math.min(g,50*Math.pow(2,p)),l("tc-pairing-retry")):"global_pool_depleted"===e.response?l("tc-global-pool-depleted"):p<3?l("tc-pairing-slow-retry"):Util.showError(u.safeview.localization.get("ID_TC_NETWORK_ISSUE",Math.abs(Util.hashCode(e.response))),u.safeview.localization.get("ID_TC_NETWORK_RETRY"),{statusCode:e.status,responseText:e.response,status:e.status,retry_count:p,timeout_ms:s},u.safeview.template),p+=1,setTimeout((function(){Util.xhrRequest(n,o,k,v,u.safeview.perf.xhr_timeout_ms)}),s)}function k(e){var t;function n(t){0!==t?(2===t&&Util.setAuthTokensInUse(),Util.xhrRequest(r,o,k,v,u.safeview.perf.xhr_timeout_ms+u.safeview.perf.pre_pair_xhr_ms)):k(e)}e.retry_nid?(t=r+"?cid="+e.retry_nid,e.cluster_id&&(t+="&cl="+e.cluster_id),Util.xhrRequest(t,o,k,v,u.safeview.perf.xhr_timeout_ms+u.safeview.perf.pre_pair_xhr_ms)):e.login_url&&window.AUTH_TOKEN?(m=!0,u.safeview.cof.call(["doBounceAuth",window.AUTH_TOKEN,window.LOGIN_DOMAIN,location.href],n),delete window.AUTH_TOKEN):e.login_url&&!m?(m=!0,u.safeview.cof.call(["getAuthTokens"],n)):(e.origin=_(a),function(e){var t;e.login_url?(t=e.pa_tok?Util.addQueryValueToLocation(location,"_sv_p_id",window.PID):location.href,E(e,(function(){!function(e,t){var r;window.USE_BOUNCE?u.safeview.cof.call(["generateKey",t.login_url],(function(){u.safeview.cof.call(["doLoginPost",t,e],(function(){}))})):(r=Util.buildLoginForm(t,e),Util.submitLoginForm(r,"_self"))}(t,e)}))):e.posture_url?E(e,(function(){Util.locationReplace(window,e.posture_url)})):e.direct_access?Util.locationReplace(window,e.direct_access):e.error||e.block?c(e):b(e)?function(e){var t;s&&e.safe_rid!==s&&e.mpa_id===l&&reportWarnClientEvent("tc-pairing-repaired-to-new-surrogate",{original_safe_rid:s,safe_rid:e.safe_rid});d&&(e.surrogate_view_active=d.surrogate_view_active);e.client_caps&&e.client_caps.dlp_show_block_payload_codes&&(-1!==(t=e.client_caps.dlp_show_block_payload_codes).indexOf(12345)&&(e.client_caps.dlp_retry_input=3,e.client_caps.dlp_soft_error_input=!0),-1!==t.indexOf(12346)&&(e.client_caps.dlp_ignore_error_input=!0));C(e),d=e,u.safeview.cof.call(["setNidCookie",e.s_nid,e.cluster_id],(function(){c(e)}))}(e):(reportErrorClientEvent("tc-pairing-unexpected-response",{pairing_response:JSON.stringify(e)}),u.safeview.reset("invalid pairing state"))}(e))}function S(t,n,i,s,l,c,f,p){var g,m,_,S,b,w,C,T=!h(f),E=Util.parseSpecialUrlParts(t,T);return f.is_pending_doctype_correction&&(g=Util.getUrlHint(Util.persistentPolicy()))&&Util.removeParam(g.key,g.value),m=e.url_builder.getDomain("cluster")!==e.url_builder.getDomain("inspect")?e.url_builder.buildClusterURL:e.url_builder.buildProtocolUrl,a=E.url,(o=function(e,t,r,n){var i,o,a,s;if(i=window.IS_POST||!1,a=navigator.userAgent.indexOf("MSIE 10.0")>=0||navigator.userAgent.indexOf("Trident")>=0?jstz.determine().name():Intl.DateTimeFormat().resolvedOptions().timeZone,o={url:e,transparent_mode:TPROXY_ENABLED,read_only_entry:r.ro||window.XEMAIL_ENTRY,pid:window.PID,mpa_id:r.mpa_id,pair_node:r.pair_node,persistent_policy:Util.persistentPolicy(),timezone:a,build_id:BUILD_ID,top_frame_doctype:t,language:Util.getLanguage(),languages:Util.getLanguages(),platform:window.navigator.platform,referrer:document.referrer,framing_status:n,viewport_bounds:MetricsUtils.getVisualViewportMetrics(),render_params:MetricsUtils.getAllMetrics(),supports_mse:Util.isMseSupported(),unsupported_media_formats:Util.getUnsupportedMediaFormats(),force_isolate:window.FORCE_ISOLATE||!1,is_post:i,host:window.HOST,reload_allowed:d.reload_allowed||!1,tc_api:window.TC_API_VERSION},window.PA_TOK&&(o.pa_tok=window.PA_TOK),window.DOC_HEADERS&&(o.doc_headers=window.DOC_HEADERS),window.FLOW_ID&&(o.flow_id=window.FLOW_ID),window.XHEADERS&&(o.xheaders=window.XHEADERS),i&&(o.body=window.BODY||"",o.content_type=window.CONTENT_TYPE||""),!window.TPROXY_ENABLED&&r.mpa_id)try{(s=localStorage.getItem("chrome_posture"))&&(o.chrome_posture=JSON.parse(s),o.chrome_posture||delete o.chrome_posture)}catch(e){s&&reportErrorClientEvent("tc-posture-unexpected-value",{chrome_posture:s})}return o}(a,n,E,l)).client_hints=c,r=m("/r/pair"),T?(_=r,S=v,C=u.safeview.perf.xhr_timeout_ms+u.safeview.perf.pre_pair_xhr_ms):(assert(f.cid&&f.safe_rid,"bad pairing state"),_=m("/r/repair")+"?cid="+f.cid,f.cluster_id&&(_+="&cl="+f.cluster_id),o.tab_id=f.tab_id||-1,o.hid=p,o.safe_rid=f.safe_rid,o.dnt=!tabstore_is_reliable(),o.popup_initial_pair=f.hasOwnProperty("new_popup"),o.doctype_correction=f.is_pending_doctype_correction,S=y,C=u.safeview.perf.xhr_timeout_ms),i?(b=i,w=s):(b=k,w=S),{on_load:k,on_error:S,xhr:Util.xhrRequest.curry(_,o,b,w,C)}}function b(e){return e&&(e.safe_rid&&e.cid||e.posture_url)}function w(e){function t(e){return e.split(".").slice(-2).join(".")}return Util.isIpAddress(window.location.hostname)||assert(!Util.isIpAddress(CLUSTER_DOMAIN)),!e||t(e)===t(CLUSTER_DOMAIN)}function C(e){assert(b(e)),e.protocol_domain=d.protocol_domain||PROTOCOL_DOMAIN,e.cluster_domain=d.cluster_domain||CLUSTER_DOMAIN,e.inspect_domain=d.inspect_domain||INSPECT_DOMAIN,u.safeview.tab_store.save({safe_rid:e.safe_rid,mpa_id:e.mpa_id,cid:e.cid,cluster_id:e.cluster_id,tab_id:e.tab_id,protocol_domain:e.protocol_domain,cluster_domain:e.cluster_domain,inspect_domain:e.inspect_domain,surrogate_view_active:e.surrogate_view_active}),u.safeview.cof&&u.safeview.cof.call(["setSurrogateInfo",e.mpa_id,JSON.stringify({protocol_domain:e.protocol_domain,cluster_domain:e.cluster_domain,inspect_domain:e.inspect_domain,safe_rid:e.safe_rid,cid:e.cid,nid:e.s_nid,cluster_id:e.cluster_id,surrogate_view_active:e.surrogate_view_active})])}function T(e){e.protocol_domain=e.protocol_domain||PROTOCOL_DOMAIN,e.cluster_domain=e.cluster_domain||CLUSTER_DOMAIN,e.inspect_domain=e.inspect_domain||INSPECT_DOMAIN,w(e.protocol_domain)&&w(e.cluster_domain)&&w(e.inspect_domain)||(console.error("tc-pairing-tab-storage-invalid"),e.protocol_domain=PROTOCOL_DOMAIN,e.cluster_domain=CLUSTER_DOMAIN,e.inspect_domain=INSPECT_DOMAIN)}function E(e,t){var r,n,i=null;if(u.safeview.cof.call(["setPAToken",window.PID,e.pa_tok]),u.safeview.itok)u.safeview.cof.call(["doITok",u.safeview.itok,e.integrity_hosts,e.inspect_host,window.location.href],(function(e){var t;e||((t=document.createElement("button")).innerText="Try again!",document.body.appendChild(t),EventListener.addListener(t,"click",(function(){Util.windowOpen(window.location.href,"_blank")})))}));else if(e.use_integrity_token&&navigator.userAgent.indexOf("Trident")>=0)u.safeview.cof.call(["doToksAuth",e,location.href],(function(){}));else{if(e.mpa_id&&!e.through&&!TPROXY_ENABLED)try{localStorage.removeItem("authLoopCount"),localStorage.removeItem("authLoopWindowStartTimestamp")}catch(e){}e.pa_tok?((r=u.safeview.url_builder.buildInspectURL(Util.COFPath()))===u.safeview.url_builder.buildClusterURL(Util.COFPath())&&(r=(r=r.replace("-view","")).replace(".","-inspect.")),n=function(){null!==i&&i.deregister(),u.safeview.cof.reregister(),t()},u.safeview.cof.deregister((function(){(i=new CrossOriginFrame(u.safeview,r)).register(),i.call(["setPAToken",window.PID,e.pa_tok],n),delete e.pa_tok})),setTimeout(n,u.safeview.cof.registration_timeout_ms())):t()}}function A(){var t;(t=new ClientEventReporterCore(e)).send_events({items:[t.make_event_dict("tc-blocked-tiny-iframe")]})}function R(e,t,r){return!!i&&(d&&d.reload_allowed&&(e.reload_allowed=!0),d=e,t&&r&&(window.PID=t,window.PA_TOK=r),i(),i=null,!0)}u.setSafeview=function(e){u.safeview=e},u.withSurrogateDo=function(e,t,r,o,a,f){var p,g,m,_,y,v,k;if(a=a||Util.getRawPageUrl(),void 0===f)try{f=window.history.state?window.history.state.hid:null}catch(e){f=null}return l=(g=d).hasOwnProperty("mpa_id")?g.mpa_id:"",s=h(d),c=e.on_complete,p=S(a,t,e.on_load,e.on_error,r,o,d,f),n&&(EventListener.removeListener(window,"resize",n),EventListener.removeListener(window,"beforeunload",A)),k=1,window.TPROXY_ENABLED&&0!==Util.getFramingStatus()&&window.IGNORE_TINY_IFRAME&&window.IGNORE_TINY_IFRAME.enabled&&!Util.isFrameBuster()&&(m=parseInt(window.IGNORE_TINY_IFRAME.dimension,10),isNaN(m)||(k=m),navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("Edge")>=0?(_=document.body.style.msOverflowStyle,document.body.style.msOverflowStyle="none",y=window.innerWidth,v=window.innerHeight,document.body.style.msOverflowStyle=_):(y=window.innerWidth,v=window.innerHeight),v<=k&&y<=k||0===v||0===y)?(n=u.withSurrogateDo.curry(e,t,r,o,a,f),EventListener.addListener(window,"resize",n),EventListener.addListener(window,"beforeunload",A),p):s||i?(p.xhr(),p):(i=u.withSurrogateDo.curry(e,t,r,o,void 0,f),p)},u.safeview=e,u.loadPairingState=function(){var e;assert(u.safeview.tab_store);try{b(d=u.safeview.tab_store.load())||(u.safeview.tab_store.clear(),d={})}catch(e){e instanceof TabStorageException&&(d={})}return d.is_pending_doctype_correction&&(e=d.is_pending_doctype_correction,d.is_pending_doctype_correction=!1,C(d),d.is_pending_doctype_correction=e),T(d),d},u.savePairingState=C,u.initPairingState=function(e){b(d=e)||(d={})},u.doCheckRequest=function(t){var r,n,i;(u.safeview.active_tab||{}).is_active&&u.safeview.pairing_dict.sb&&(i=e.url_builder.getDomain("cluster"),r=(n=e.url_builder.getDomain("inspect"))!==i?[i,n]:[i],u.safeview.cof.call(["doAuthCheck",{check_hosts:r,sb:u.safeview.pairing_dict.sb,timeout:u.safeview.perf.xhr_timeout_ms,transparent_mode:window.TPROXY_ENABLED},t,u.safeview.itok],(function(e){})))},u.doRecookie=function(e){var t;t=Util.buildLoginForm(e,e.url),Util.submitLoginForm(t,"_self")},u.onPairingComplete=function(){u.safeview.cof.call(["setPAToken",window.PID,void 0])},u.surrogateInfoRecovery=function(e,t){var r=Util.getParam("_sv_p_id");Util.removeParam("_sv_p_id",r),b(e)||(e={}),T(e),e.tab_id=-1,(R(e,r,t)||tc_kernel.defered_pairing(e,r,t))&&(d=e)},u.doDeferedPairing=R}function clearPairingState(e){var t;try{delete(t=e.tab_store.load()).safe_rid,delete t.cid,delete t.cluster_id,delete t.tab_id,delete t.protocol_domain,delete t.cluster_domain,delete t.inspect_domain,e.tab_store.save(t)}catch(e){}}function Stats(e){var t={},r={},n={},i={},o=this;function a(e,t,r){e.hasOwnProperty(t)||(e[t]=0),e[t]+=r}e.callback.register("dom-loaded",(function(e){i={},Util.simpleExtend(i,e),Util.simpleExtend(i,t),reportClientEvent("tc-dom-loaded",i)})),this.inc=function(e){a(t,e,1)},this.add=function(e,r){a(t,e,r)},this.agg=function(e,t){var r,i;n.hasOwnProperty(e)?((r=n[e]).last=t,r.sum+=t,r.count+=1,i=r.avg,r.avg=r.sum/r.count,r.min=Math.min(r.min,t),r.max=Math.max(r.max,t),r.var=((r.count-1)*r.var+(t-r.avg)*(t-i))/r.count):r={last:t,min:t,avg:t,max:t,sum:t,count:1,var:0},n[e]=r},this.agg_get=function(e){if(!n.hasOwnProperty(e))return{};var t=n[e];return{last:t.last,min:t.min,avg:t.avg,max:t.max,count:t.count,stdev:Math.sqrt(t.var)}},this.start=function(e){r[e]=Util.now()},this.stop=function(e){var n=Util.now()-r[e];a(t,e,n),delete r[e]},this.on_xframe_stats_msg=function(e){switch(e.op){case"inc":o.inc(e.counter_name);break;case"add":o.add(e.counter_name,e.val);break;case"agg":o.agg(e.counter_name,e.val);break;case"start":o.start(e.timer_name);break;case"stop":o.stop(e.timer_name);break;default:assert(0)}},this.getRawStatsAsJSON=function(){return JSON.stringify(i)},this.setNavStartTime=function(e){r.t_tnl=e},r.t_tdl=load_time,r.t_tnl=load_time}function MediaObjects(e){var t,r={},n={},i={},o=["canplay","canplaythrough","error","pause","play","ratechange","seeking","volumechange","loadedmetadata","durationchange","resize","webkitneedkey"],a=["playsinline","webkit-playsinline"],s=["touchend","click"],l=["loop"],c={},d=this,u={},f=!1,p=Object.freeze({HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4}),g={};function m(e){return e.src&&(-1!==e.src.indexOf("m3u8=true")||0===e.src.indexOf("data:")&&(t=e.src.split(";")[0].substr(5),-1!==["application/x-mpegurl","application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl"].indexOf(t.toLowerCase())));var t}function _(e,r,i,o,a,s,l,c){var d,u,f=window.VTTCue?window.VTTCue:window.TextTrackCue,p=n[getNodeKey(e,i)];return p?(reportWarnClientEvent("tc-media-error",{detail:"create new text track on mirrored uid",media_uid:r,track_uid:i}),p):(d=t.get_media_node(e,r))?((p=d.addTextTrack(o,a,s)).mode=l,c.forEach((function(e){(u=new f(e[0],e[1],e[2])).align=e[3],u.line=e[4],u.pauseOnExit=e[5],u.position=e[6],u.size=e[7],u.snapToLines=e[8],u.vertical=e[9],p.addCue(u)})),n[getNodeKey(e,i)]=p,p):null}function h(e,t){e.surrogate_current_time=[t,Util.now(),0]}function y(t){var n=e.xbrowser.getEventTarget(t),i=getFidByNode(n),o=getUidByNode(n),a=getNodeKey(i,o),s=r[a],l=0;void 0!==c[a]||n.paused||void 0!==u[a]||(s&&s.surrogate_current_time&&(l=Math.abs(n.currentTime-s.surrogate_current_time[0]-(Util.now()-s.surrogate_current_time[1])*n.playbackRate/1e3)),l>1&&(n.currentTime,Util.now(),s.surrogate_current_time[1],s.surrogate_current_time[0],s.surrogate_current_time[2],s.surrogate_current_time[2]++,s.surrogate_current_time[2]>2&&(e.surrogate_channel.send("client-media-drift",i,o,n.currentTime),h(s,n.currentTime))))}function v(t){var n,i=getFidByNode(t),o=getUidByNode(t),a=r[getNodeKey(i,o)];a&&a.readyState!==t.readyState&&(clearTimeout(a.readyStateTimeout),a.readyStateTimeout=setTimeout((function(){a.readyState=t.readyState,n=null,t.getStartDate&&(n=t.getStartDate().getTime(),isNaN(n)&&(n=null)),a.readyState,a.source_id,e.surrogate_channel.send("client-media-hls",i,o,"state",a.readyState,n,a.source_id)}),1))}function k(t,r,n){e.surrogate_channel.send("client-media-hls",t,r,"duration",n.duration!==1/0?n.duration:-1,n.currentTime)}function S(t,r,n){e.surrogate_channel.send("client-media-hls",t,r,"size",n.videoWidth,n.videoHeight)}function b(t){var n,i,o,a,s,l,u,f=e.xbrowser.getEventTarget(t),g={};if(assert(f,"No target"),l=getNodeKey(a=getFidByNode(f),s=getUidByNode(f)),n=r[l]){switch("play"===t.type&&n.pending_play_callback&&(n.pending_play_callback(""),delete n.pending_play_callback),assert(o=n.state,"No state"),assert(t.type,"No event type"),i=!0===n.ignore[t.type],t.type,f.currentTime,f.readyState,delete n.ignore[t.type],u=m(f),v(f),t.type){case"canplay":n.pending_play_callback?(d.callPlay(f,a,s,n.pending_play_callback),delete n.pending_play_callback):!o.paused&&f.paused&&d.callPlay(f,a,s),c[l]&&0===f.currentTime&&T(f,a,s,c[l],n),delete c[l];break;case"canplaythrough":break;case"loadedmetadata":c[l]&&T(f,a,s,c[l],n);break;case"durationchange":u&&n.duration!==f.duration&&(n.duration=f.duration,f.duration,k(a,s,f)),c[l]&&T(f,a,s,c[l],n);break;case"resize":!u||n.videoWidth===f.videoWidth&&n.videoHeight===f.videoHeight||(f.videoWidth,f.videoHeight,n.videoWidth=f.videoWidth,n.videoHeight=f.videoHeight,S(a,s,f));break;case"webkitneedkey":e.surrogate_channel.send("client-media-hls",a,s,"encrypted",Util.Uint8ArrayToBase64(t.initData));break;case"error":f.error&&(f.currentSrc.startsWith("blob:")&&!e.media_source_extensions.get_media_source_or_falsy(a,s)||e.surrogate_channel.send("client-media-error",a,s,n.source_id,f.error.code,f.error.message));break;default:if(e.wa_manager.mute_if_wa_src_node(a,s)&&(i=!0),"seeking"!==t.type&&"play"!==t.type||delete c[l],i||"pause"!==t.type||o.paused||!f.ended||(o.paused=!0),!i&&(f.controls||f.autoplay&&"play"===t.type)){switch(g.type=t.type,t.type){case"pause":if(f.ended)return;break;case"ratechange":g.playbackRate=f.playbackRate;break;case"seeking":g.currentTime=f.currentTime,h(n,f.currentTime);break;case"volumechange":g.muted=f.muted,g.volume=f.volume}t.type,JSON.stringify(g),e.surrogate_channel.send("client-media",getFidByNode(f),s,g)}}"pause"===t.type&&i&&n.pending_play_callback&&(f.readyState>=p.HAVE_CURRENT_DATA||""===f.currentSrc)&&(d.callPlay(f,a,s,!1,n.pending_play_callback),delete n.pending_play_callback)}}function w(t){var r,n;for(r=0;r<o.length;r+=1)n=o[r],EventListener.addListener(t,n,b,!1);!function(e){var t=getNodeKey(getFidByNode(e),getUidByNode(e));g[t]=new MutationObserver(d.processMutationRecords),g[t].observe(e,{attributes:!0,attributeFilter:l,attributeOldValue:!0})}(t),EventListener.addListener(t,"timeupdate",y,!1),e.fullscreen.installListeners(t),v(t)}function C(t){var r,n;for(r=0;r<o.length;r++)n=o[r],EventListener.removeListener(t,n,b,!1);!function(e){var t=getNodeKey(getFidByNode(e),getUidByNode(e));g[t].disconnect(),delete g[t]}(t),EventListener.removeListener(t,"timeupdate",y,!1),e.fullscreen.removeListeners(t)}function T(e,t,r,n,i){var o=getNodeKey(t,r);e.currentTime,e.readyState<p.HAVE_METADATA?c[o]=n:(e.currentTime=n,i.ignore.seeking=!0,e.paused||(i.ignore.pause=!0,i.ignore.play=!0))}function E(e,n){var i,o=!1,a=(getWindowByFid(e)||window).document,l=function(){var i,c,d,u=r[getNodeKey(e,n)];if(!o){for(o=!0,d=0;d<s.length;d++)EventListener.removeListener(a,s[d],l,!0,!0);(i=t.get_media_node(e,n))&&u&&(i.paused?c=i.play():i.muted||(u.flags.has_unmuted_gesture=!0)),c&&c.then((function(){u.state.paused&&i.pause(),i.muted||(u.flags.has_unmuted_gesture=!0)})).catch((function(){}))}};for(i=0;i<s.length;i++)EventListener.addListener(a,s[i],l,!0,!0)}function A(t,n,i,o,s){var l,f,g,m=getNodeKey(n,i),_=r[m];if(d.last_updated_node=t,void 0!==_)for(l in s&&s.hasOwnProperty("currentTime")?h(_,s.currentTime):o.hasOwnProperty("currentTime")&&h(_,o.currentTime),o.muted&&!1===o.paused&&(t.muted=!0),o)if(o.hasOwnProperty(l))if(-1===a.indexOf(l))if(l in t)switch(o[l],_.state[l]=o[l],l){case"paused":if(clearTimeout(u[m]),delete u[m],o.paused)_.pending_play_callback&&(_.pending_play_callback("AbortError"),delete _.pending_play_callback),t.paused||(s.currentTime&&s.currentTime>t.currentTime?((g=s.currentTime-t.currentTime).toFixed(2),u[m]=setTimeout((function(){delete u[m],t.pause(),_.ignore.pause=!0}),1e3*g)):(t.pause(),_.ignore.pause=!0));else if(t.paused){if(s.currentTime&&s.currentTime>t.currentTime)if(_.pending_play_callback){T(t,n,i,s.currentTime,_);var y=_.pending_play_callback;_.pending_play_callback=function(e){y(e),""===e&&h(_,s.currentTime)}}else c[m]=s.currentTime;t.readyState>=p.HAVE_METADATA?_.pending_play_callback||d.callPlay(t,n,i):"none"!==t.preload||_.flags.manual_loaded_once||(t.load(),_.flags.manual_loaded_once=!0)}break;case"currentSrc":if(o.currentSrc=o.currentSrc||"",f=t.src||"",!o.currentSrc)break;d.set_source_id(n,i,s.source_id),f===o.currentSrc||!s.forceCurrentSrc&&e.media_source_extensions.get_media_source_or_falsy(n,i)?(s.source_id,v(t)):(t.src,o.currentSrc,s.source_id,"#"===o.currentSrc?t.src=Resource.videoDataUri:Util.requiresCofRequest(o.currentSrc)?e.xbrowser.createBlobSrc(o.currentSrc).catch((function(){return o.currentSrc})).then(function(e,r){o.currentSrc===e&&(t.src=r)}.bind(null,o.currentSrc)):t.src=o.currentSrc,_.flags.has_unmuted_gesture=!1,t.load());break;case"currentTime":_.readyState>p.HAVE_METADATA&&(_.readyState=p.HAVE_METADATA),T(t,n,i,o.currentTime,_);break;case"controls":if(e.useRemotingV2())break;default:switch(t[l],o[l],t[l]=o[l],l){case"volume":case"muted":_.ignore.volumechange=!0,!BrowserDetect.isSafari()||t[l]||_.has_unmuted_gesture||E(n,i);break;case"playbackRate":t.defaultPlaybackRate=o[l],_.ignore.ratechange=!0}}else reportWarnClientEvent("tc-media-state-update-missing-property",{node:i,missing_property:l});else t.setAttribute(l,o[l])}function R(e,n){var i=getNodeKey(e,n);delete r[i],C(t.get_media_node(e,n)),t.did_remove_media_node(e,n)}d.processMutationRecords=function(t,n){var i,o,a,s={},l=t[0].target,c=getFidByNode(l),d=getUidByNode(l),u=getNodeKey(c,d),f=r[u];if(void 0!==f){for(o=0;o<t.length;o+=1)a=l[(i=t[o]).attributeName],l.getAttribute(i.attributeName)!==i.oldValue&&a!==f.state[i.attributeName]&&(s[i.attributeName]=a);Util.isDictEmpty(s)||e.surrogate_channel.send("client-media",c,d,{type:"mutations",mutations:s})}},d.callPlay=function(t,n,i,o){var a,s=getNodeKey(n,i),l=r[s];if(f)return e.surrogate_channel.send("client-media",n,i,{type:"pause"}),void(o&&o("NotAllowedError"));a=t.play(),l&&(l.ignore.play=!0),a?a.then((function(){o&&o("")})).catch((function(r){"NotAllowedError"!==r.name||!BrowserDetect.isSafari()||l.state.muted||l.has_unmuted_gesture||(E(n,i),!o)?(o?o(r.name?r.name:"NotAllowedError"):t.paused&&e.surrogate_channel.send("client-media",getFidByNode(t),getUidByNode(t),{type:"pause"}),l&&delete l.ignore.play):o("")})):o&&o("")},d.setClient=function(e){t=e},d.backendValuesForNode=function(e,t){var n=r[getNodeKey(e,t)];return n?n.state:void 0},d.stopAllMedia=function(){f=!0,Util.forEachItem(r,(function(r,n){var i,o=splitNodeKey(r);(i=t.get_media_node(o.fid,o.uid))&&(i.pause(),e.surrogate_channel.send("client-media",o.fid,o.uid,{type:"pause"}))}))},d.mark_manually_loaded=function(e,t){var n=r[getNodeKey(e,t)];n&&n.flags&&(n.flags.manual_loaded_once=!0)},d.set_source_id=function(e,t,n){var i=r[getNodeKey(e,t)];i&&i.source_id<n&&(i.source_id=n,i.readyState=p.HAVE_NOTHING,delete i.duration,delete i.videoWidth,delete i.videoHeight)},d.getNodesCount=function(){return Object.keys(r).length},e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_NEW_NODE,(function(n,o,a,s,l){var c=t.new_media_node(s,n,o),d=getNodeKey(n,o),u=i[getNodeKey(n,o)];c?(JSON.stringify(a),r[d]={state:{},ignore:{},flags:{manual_loaded_once:!1,has_unmuted_gesture:!1},source_id:l,readyState:0},BrowserDetect.isIOS()&&a.autoplay&&c.setAttribute("playsinline","1"),A(c,n,o,a,{source_id:l}),w(c),e.callback.fire("new-media-node",n,o),u&&(_(n,o,u.uid,u.kind,u.label,u.language,u.mode,u.cues)||reportWarnClientEvent("tc-media-error",{detail:"unable to create new text track, media node is ready",media_uid:o,track_uid:u.uid}),delete i[getNodeKey(n,o)])):reportWarnClientEvent("tc-media-unknown-node",{uid:o,tag_name:s})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_UPDATE,(function(e,r,n,i){var o=t.get_media_node(e,r);o?A(o,e,r,n,i):reportWarnClientEvent("tc-media-unknown-node",{uid:r})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_BLOB,(function(e,r,n,i){var o=t.get_media_node(e,r);d.set_source_id(e,r,i),o?o.src=n:reportWarnClientEvent("tc-media-unknown-node",{fid:e,uid:r})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_REMOVE_NODE,R),e.interp.registerOpcodeHandler(e.interp.OPCODES.ADD_CUES,(function(e,t,r,n,o,a,s){var l="showing";_(e,t,r,n,o,a,l,s)||(i[getNodeKey(e,t)]={uid:r,kind:n,label:o,language:a,mode:l,cues:s})})),e.interp.registerOpcodeHandler(e.interp.OPCODES.TEXT_TRACK_MODE,(function(e,t,r,o){var a,s=n[getNodeKey(e,r)];s?s.mode=o:(a=i[getNodeKey(e,t)])&&(a.mode=o)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_ATTEMPT_PLAY,(function(n,i,o,a){var s=t.get_media_node(n,i),l=getNodeKey(n,i),c=r[l],u=function(t){c&&""===t&&void 0!==a&&h(c,a),s&&s.currentSrc.substring(0,512),!!s&&s.muted,s&&s.parentElement,s&&s.currentTime,e.surrogate_channel.send("client-media-play",n,i,t,o)};if(s)if(s.paused){if(c&&(c.pending_play_callback&&c.pending_play_callback("AbortError"),c.pending_play_callback=u,Math.abs(a-s.currentTime)>.5&&T(s,n,i,a,c),c.ignore.pause||s.readyState<p.HAVE_CURRENT_DATA&&""!==s.currentSrc))return;if(BrowserDetect.isSafari()&&s.readyState===p.HAVE_NOTHING&&""!==s.currentSrc)return;d.callPlay(s,n,i,u),c&&delete c.pending_play_callback}else u("");else u("AbortError")})),e.interp.registerOpcodeHandler(e.interp.OPCODES.MEDIA_CLEAR,(function(e,n,i){var o=r[getNodeKey(e,n)],a=t.get_media_node(e,n);o&&a&&o.source_id===i&&(a.readyState>p.HAVE_NOTHING&&(o.readyState=p.HAVE_NOTHING,v(a)),m(a)&&(void 0===a.duration||isNaN(a.duration)||k(e,n,a),void 0!==a.videoWidth&&a.videoWidth>0&&S(e,n,a)))})),e.interp.registerOpcodeHandler("clear_media_nodes",(function(e){var t,n=e+"_";for(t in r)r.hasOwnProperty(t)&&__startswith(t,n)&&R(e,splitNodeKey(t).uid)}))}function MediaSourceExtensions(e){var t={},r=0,n=["mode","timestampOffset","appendWindowStart","appendWindowEnd"],i=this;function o(t,r){return e.useRemotingV2()?"1_"+r:t+"_"+r}function a(e,t){var r,n=e.source_buffers;for(r in n)if(n.hasOwnProperty(r)&&!t(n[r]))return!1;return!0}function s(e,t){var r=i.get_media_source_or_falsy(e,t);return r||reportErrorClientEvent("tc-mse-no-media-source-found-error",{fid:e,uid:t}),r}function l(e){clearInterval(e.advance_poller),e.so_callback&&(EventListener.removeListener(e.ms_object,"sourceopen",e.so_callback),delete e.so_callback),e.sc_callback&&(EventListener.removeListener(e.ms_object,"sourceclose",e.sc_callback),delete e.sc_callback),a(e,(function(e){return e.ue_callback&&(e.sb_object&&EventListener.removeListener(e.sb_object,"updateend",e.ue_callback),delete e.ue_callback),e.error_callback&&(e.sb_object&&EventListener.removeListener(e.sb_object,"error",e.error_callback),delete e.error_callback),!0})),e.object_url&&(URL.revokeObjectURL(e.object_url),delete e.object_url)}function c(e){l(e),e.error=!0,delete e.ms_object,delete e.source_buffers,delete e.queue}function d(t,n,i){var o,a,l,u={cid:e.pairing_dict.cid,rid:e.pairing_dict.rid,mpa_id:e.pairing_dict.mpa_id,tab_id:e.pairing_dict.tab_id};e.pairing_dict.cluster_id&&(u.cl=e.pairing_dict.cluster_id),o={safe_rid:e.pairing_dict.safe_rid,tab_id:e.pairing_dict.tab_id,fid:t,uid:n,src_buf_id:i.src_bfr_id,seq_id:i.seq_id},i.aborted&&(o.ack_only=!0),a="/r/mse?"+Util.buildQueryStr(u),a=e.url_builder.buildProtocolUrl(a),(l=new Util.xmlHttpRequest).withCredentials=!0,l.responseType="arraybuffer",l.open("POST",a),l.onload=function(){delete i.fetch_req,r=0,function(e,t,r,n){var i,o,a=0,l=[],c=[],d=0,u=new DataView(n);for(r.src_bfr_id,n&&n.byteLength;a+d<n.byteLength;)o=u.getUint32(d),l.push(o),a+=o,d+=4;l.forEach((function(e){c.push(n.slice(d,d+e)),d+=e})),r.data=c,(i=s(e,t))&&!i.error&&(i.source_buffers[r.src_bfr_id]?y(i):reportWarnClientEvent("tc-mse-no-source-buffer-found-segment-fetch-error",{src_buf_id:r.src_bfr_id}))}(t,n,i,l.response)},l.onerror=function(e){if(delete i.fetch_req,r<10)return r+=1,void setTimeout((function(){d(t,n,i)}),1e3);!function(e,t,r){var n;reportWarnClientEvent("tc-mse-segment-fetch-error",{evt:r}),(n=s(e,t))&&c(n)}(t,n,e)},l.onabort=function(e){var r=s(t,n);delete i.fetch_req,i.src_bfr_id,r&&c(r)},i.fetch_req=l,JSON.stringify(o),l.send(JSON.stringify(o)),l.responseType="arraybuffer"}function u(r,n){var i,s,d=r.ms_object;return!(!d||(i=d.readyState,"remove_src_bfr"===(s=n.cmd)||"src_close"===s?"open"!==i&&"ended"!==i:"open"!==i))&&(n.cmd,"add_src_bfr"===n.cmd?function(t,r,n){var i,o=t.ms_object,a={id:r,media_type:n,seq_id:0},s=n;t.source_buffers[r]=a,a.ue_callback=function(e){y(t)},a.error_callback=function(n){e.stats.inc("mse_src_exception"),e.surrogate_channel.send("mse-src-exception",t.fid,t.uid,r,n.name)},-1!==s.indexOf("avc3")&&"Explorer"===browser.name&&(s=s.replace("avc3","avc1"));try{i=o.addSourceBuffer(s),a.sb_object=i,EventListener.addListener(i,"updateend",a.ue_callback),EventListener.addListener(i,"error",a.error_callback)}catch(e){a.error_callback(e),delete t.source_buffers[r]}return!0}(r,n.id,n.media_type):"remove_src_bfr"===n.cmd?function(e,t){var r=e.source_buffers[t];if(r&&r.sb_object){r.ue_callback&&EventListener.removeListener(r.sb_object,"updateend",r.ue_callback),r.error_callback&&EventListener.removeListener(r.sb_object,"error",r.error_callback);try{e.ms_object.removeSourceBuffer(r.sb_object)}catch(t){reportErrorClientEvent("tc-mse-sourcebuffer-remove-error",{error:t.toString()}),c(e)}delete e.source_buffers[t]}else reportWarnClientEvent("tc-mse-no-source-buffer-found-to-remove-error",{src_buf_id:t});return!0}(r,n.id):"set_duration"===n.cmd?function(e,t){var r=e.ms_object;if(!a(e,(function(e){var t=e.sb_object;return!(t&&t.updating)})))return!1;try{"inf"===t&&(t=1/0),r.duration=t}catch(t){reportErrorClientEvent("tc-mse-set-duration-error",{error:t.toString()}),c(e)}return!0}(r,n.duration):"src_close"===n.cmd?function(e){var r,n=!0;return a(e,(function(e){var t=e.sb_object;return!(t&&t.updating)}))||(n=!1),l(e),e.fid&&e.uid&&(void 0!==(r=getNodeByUid(e.fid,e.uid))&&(r.src=""),delete t[o(e.fid,e.uid)]),n}(r):"end_of_stream"===n.cmd?function(e,t){var r=!0;if(a(e,(function(e){var t=e.sb_object;return!(t&&t.updating)}))||(r=!1),!r)return!1;try{t?e.ms_object.endOfStream(t):e.ms_object.endOfStream()}catch(t){reportErrorClientEvent("tc-mse-end-of-stream-error",{error:t.toString()}),c(e)}return!0}(r,n.error):(reportErrorClientEvent("tc-mse-unrecognized-media-source-command-error",{item:n}),c(r),!0))}function f(e,t,r){e&&!e.error&&(e.queue.push(t),r||y(e))}function p(e){var t,r=e.buffered,n=[];for(t=0;t<r.length;t++)n.push(r.start(t),r.end(t));return n}function g(e,t){var r,n,i,o=t.buffered,a=getNodeByUid(e.fid,e.uid).currentTime-.2,s=a+60.2,l=[];for(r=0;r<o.length;r++)n=o.start(r),i=o.end(r),n>s||i<a?l.push([n,i]):(n<a&&l.push([n,a]),i>s&&l.push([s,i]));for(r=0;r<l.length;r++)n=l[r][0],(i=l[r][1])-n<.5?(l.splice(r,1),r--):i-n>30.6&&(n+=30,l.push([n,i]),l[r][1]=n);return l.sort((function(e,t){return e[0]<a||t[0]<a?e[0]-t[0]:t[0]-e[0]})),l}function m(e,t){var r,n,i=e.queue,o="report-buffered",a=i.length-1;for(n=0;n<i.length;n++)if((r=i[n]).src_bfr_id===t)if("append"===r.cmd||"remove"===r.cmd)a=n;else if(i[n].cmd===o)return;i.splice(a+1,0,{cmd:o,src_bfr_id:t})}function _(e,t){var r,n,i=e.queue;if(i)for(n=0;n<i.length;n++)if("report-buffered"===(r=i[n]).cmd&&r.src_bfr_id===t)return void i.splice(n,1)}function h(t,r){var i,o,a,s=t.source_buffers[r.src_bfr_id];if(!s)return reportWarnClientEvent("tc-mse-no-source-buffer-found-run-command-error",{src_buf_id:r.src_bfr_id}),!0;if("append"===r.cmd&&void 0===r.seq_id)return r.seq_id=s.seq_id++,d(t.fid,t.uid,r),!1;if(i=t.ms_object,o=s.sb_object,!i||!o||o.updating||"closed"===i.readyState)return!1;r.cmd,s.media_type,r.src_bfr_id;try{if("append"===r.cmd){if(!r.data)return r.src_bfr_id,assert(r.fetch_req),!1;if(!r.aborted){if(!function(t,r,n){for(var i,o=!1;!r.updating;)try{return r.appendBuffer(n.data[0]),n.data.shift(),0===n.data.length}catch(a){if("QuotaExceededError"!==a.name)throw a;if(!1===o&&(e.stats.inc("mse_quota_exceeded"),o=!0),void 0===i&&(i=g(t,r)),0===i.length)throw e.stats.inc("mse_quota_exceeded_unrecoverable"),a;i[0][0],i[0][1],n.src_bfr_id,r.remove(i[0][0],i[0][1]),e.stats.add("mse_removed_range",Math.ceil(i[0][1]-i[0][0])),i.splice(0,1)}return!1}(t,o,r))return!1;m(t,r.src_bfr_id)}}else if("report-buffered"===r.cmd)o.buffered.length>0&&(a=p(o),JSON.stringify(a),e.surrogate_channel.send("mse-report-buffered",t.fid,t.uid,r.src_bfr_id,a));else if("abort"===r.cmd)"open"===i.readyState&&(o.abort(),m(t,r.src_bfr_id));else if("remove"===r.cmd){try{o.remove(r.start,r.end)}catch(e){if("TypeError"!==e.name)throw e;o.remove(Math.floor(1e5*r.start)/1e5,Math.ceil(1e5*r.end)/1e5)}m(t,r.src_bfr_id)}else"attr"===r.cmd&&-1!==n.indexOf(r.attr_name)?(a="inf"===r.attr_value?1/0:r.attr_value,o[r.attr_name]=a):"type"===r.cmd?o.changeType(r.content_type):(reportErrorClientEvent("tc-mse-unrecognized-source-buffer-command-error",{item:r}),c(t))}catch(e){reportErrorClientEvent("tc-mse-source-buffer-action-error",{cmd:r.cmd,error:e.toString(),type:s.media_type}),c(t)}return!0}function y(t){var r,n=t.queue;if(n.length,!t.error&&void 0===t.ms_object&&n.length&&getNodeByUid(t.fid,t.uid))!function(t){var r,n=t.fid,i=t.uid,o=getNodeByUid(n,i),a=function(){y(t)},d=function(){l(t),t.error=!0,delete t.queue};try{r=new MediaSource,t.ms_object=r,t.object_url=URL.createObjectURL(r),e.media_objects.set_source_id(n,i,t.source_id),o.src=t.object_url,EventListener.addListener(r,"sourceopen",a),t.so_callback=a,EventListener.addListener(r,"sourceclose",d),t.sc_callback=d,e.media_objects.mark_manually_loaded(n,i)}catch(e){reportErrorClientEvent("tc-mse-mediasource-init-error",{error:e.toString()}),c(t)}t.advance_poller=setInterval((function(){!function(t,r){var n,i,o,a,l,c,d=getNodeByUid(t,r),u=s(t,r),f="Explorer"===browser.name||"Edge"===browser.name?2:.2;if(!d&&u)return void clearInterval(u.advance_poller);if(!d)return;if(d.paused)return void(!1===(e.media_objects.backendValuesForNode(t,r)||{}).paused&&e.media_objects.callPlay(d,t,r));i=d.currentTime,l=d.prev_currentTime,d.prev_currentTime=i,l&&l===i?u.same_currentTime_count++:u.same_currentTime_count=0;if(u.same_currentTime_count<2)return;for(n=d.buffered,a=0,c=0;c<n.length&&i>=a;c++){if((o=n.start(c))>i&&o-i<f&&n.end(c)-o>5){d.currentTime=n.start(c)+.01;break}a=n.end(c)}}(n,i)}),200)}(t);else for(;!t.error&&n.length;){if(!((r=n[0]).src_bfr_id?h:u)(t,r))return;n.shift()}}function v(e,r,n){var a=i.get_media_source_or_falsy(e,r);a&&(a.queue&&a.queue.length&&a.queue[0].fetch_req&&a.queue[0].fetch_req.abort(),l(a)),function(e,r,n){var i=o(e,r),a={key:i,source_buffers:{},queue:[],fid:e,uid:r,source_id:n};t[i]=a}(e,r,n)}i.get_media_source_or_falsy=function(e,r){return t[o(e,r)]},i.get_buffered_ranges=function(){var e,r,n,i,o,a,s={},l=0;for(e in t)if(t.hasOwnProperty(e)){for(i in r={},a=0,n=t[e].source_buffers)n.hasOwnProperty(i)&&(o=p(n[i].sb_object),r[a]=o,a++);s[l]=r,l++}return JSON.stringify(s)},i.remove_range=function(e,r){var n,i,o;1===(n=Object.getOwnPropertyNames(t)).length&&(i=t[n[0]],1===(o=Object.getOwnPropertyNames(i.source_buffers)).length&&f(i,{cmd:"remove",src_bfr_id:o[0],start:e,end:r}))},e.interp.registerOpcodeHandler("mse_end_of_stream",(function(e,t,r){f(s(e,t),{cmd:"end_of_stream",error:r})})),e.interp.registerOpcodeHandler("mse_attach_media_src",(function(e,t,r){v(e,t,r)})),e.interp.registerOpcodeHandler("mse_add_src_bfr",(function(e,t,r,n){f(s(e,t),{cmd:"add_src_bfr",id:r,media_type:n})})),e.interp.registerOpcodeHandler("mse_remove_src_bfr",(function(e,t,r){f(s(e,t),{cmd:"remove_src_bfr",id:r})})),e.interp.registerOpcodeHandler("mse_set_duration",(function(e,t,r){f(s(e,t),{cmd:"set_duration",duration:r})})),e.interp.registerOpcodeHandler("mse_add_to_src_bfr",(function(e,t,r){var n,i,o,a,l=s(e,t),c=[];if(l&&!l.error){for(o=(n=l.queue).length;o>1&&(i=n[o-1]).src_bfr_id&&i.src_bfr_id!==r;)"append"===i.cmd&&-1===c.indexOf(i.src_bfr_id)&&c.push(i.src_bfr_id),o--;for(1===o&&"append"===n[0].cmd&&-1!==(a=c.indexOf(n[0].src_bfr_id))&&c.splice(a,1);o<n.length&&c.length>0;)"append"===(i=n[o]).cmd&&-1!==(a=c.indexOf(i.src_bfr_id))&&c.splice(a,1),o++;n.length,n.splice(o,0,{cmd:"append",src_bfr_id:r}),_(l,r),y(l)}})),e.interp.registerOpcodeHandler("mse_abort_src_bfr",(function(e,t,r){var n,i,o,a,l=s(e,t);if(void 0!==l&&void 0!==l.source_buffers&&l.source_buffers.hasOwnProperty(r)){i=l.source_buffers[r];try{n=0!==i.sb_object.buffered.length}catch(e){n=!0}if(n&&l.queue)for(o=0;o<l.queue.length;o++)(a=l.queue[o]).src_bfr_id!==r||a.fetch_req||(a.aborted=!0);f(l,{cmd:"abort",src_bfr_id:r})}})),e.interp.registerOpcodeHandler("mse_remove_from_src_bfr",(function(e,t,r,n,i){var o=s(e,t);f(o,{cmd:"remove",src_bfr_id:r,start:n,end:i}),o&&_(o,r)})),e.interp.registerOpcodeHandler("mse_set_src_bfr_attr",(function(e,t,r,n,i){f(s(e,t),{cmd:"attr",src_bfr_id:r,attr_name:n,attr_value:i})})),e.interp.registerOpcodeHandler("mse_src_bfr_change_type",(function(e,t,r,n){f(s(e,t),{cmd:"type",src_bfr_id:r,content_type:n})})),e.interp.registerOpcodeHandler("mse_src_close",(function(e,t){f(s(e,t),{cmd:"src_close"})})),e.interp.registerOpcodeHandler("decoding_info",(function(t,r,n){navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo?navigator.mediaCapabilities.decodingInfo(n).then((function(n){var i={is_supported:n.supported,is_smooth:n.smooth,is_power_efficient:n.powerEfficient};e.surrogate_channel.send("promise-response",t,r,i)})).catch((function(){e.surrogate_channel.send("promise-response",t,r,{})})):e.surrogate_channel.send("promise-response",t,r,{})})),e.callback.register("new-media-node",(function(t,r){var n=i.get_media_source_or_falsy(t,r);void 0!==n&&(e.media_objects.mark_manually_loaded(t,r),y(n))})),window.EncryptedMediaExtensions||(e.interp.registerOpcodeHandler("eme_request",(function(){})),e.interp.registerOpcodeHandler("eme_set_element",(function(){})))}function Mp3Session(e,t,r,n,i,o,a){var s,l,c,d,u,f=this,p=!1,g=[],m={};a.logger;function _(){s.currentTime;s.buffered.length&&s.buffered.end(s.buffered.length-1),s.seekable.length&&s.seekable.end(s.seekable.length-1),f.session_type()}function h(t){f.session_type(),s&&(u&&clearInterval(u),a.test_mode&&(s.buffered.length&&(m.buffer_time=s.buffered.end(s.buffered.length-1)),m.reason=t,m.current_time=s.currentTime,m.complete=!0),s.parentNode.removeChild(s),s=null,o&&o(e))}function y(){var e;if(g.length&&!c.updating&&(e=g.shift()).byteLength)try{c.appendBuffer(e)}catch(e){reportErrorClientEvent("tc-wa-mse-append-error",{error:e.toString()}),h("append error")}}function v(){c=l.addSourceBuffer("audio/mpeg"),EventListener.addListener(c,"updateend",y)}function k(e){var t;switch(e.type,a.test_mode&&(m.event_history+=" "+e.type+":"+Math.floor((new Date).getTime()%1e6)),e.type){case"canplay":f.is_primed?s.play():p=!0;break;case"error":case"abort":s.error&&(t=s.error.code),h(e.type+" error="+t),reportWarnClientEvent("tc-wa-mp3-playback-error",{session_type:f.session_type(),event_type:e.type});break;case"ended":h(e.type)}}function S(){var e,t=["canplay","error","abort","ended"];for(s=document.createElement("audio"),document.body.appendChild(s),e=0;e<t.length;e+=1)EventListener.addListener(s,t[e],k);DEBUG&&a.log_detail&&(u=setInterval(_,a.detail_log_interval_ms))}f.append_audio_data=function(r){assert(null===t),s?(l||(l=new MediaSource,EventListener.addListener(l,"sourceopen",v),s.src=URL.createObjectURL(l)),g.push(r),c&&!c.updating&&y()):reportErrorClientEvent("tc-wa-invalid-context",{ctx_id:e,reason:"session has ended"})},f.handle_webaudio_state_change=function(e){var r,n,i=0;assert(null===t),"close"===e&&(s&&s.buffered.length&&(r=s.buffered.end(s.buffered.length-1))>(n=s.currentTime)&&(i=Math.round(1e3*(r-n))),setTimeout((function(){l&&l.endOfStream()}),i+1e3))},f.session_type=function(){return null!==t?"mp3_http":"mp3_mse"},f.get_stats=function(){return m},f.on_audio_primed=function(){f.is_primed=!0,p&&(s.play(),p=!1)},f.manage_latency=function(){var e=0;s&&(s.buffered.length&&(e=s.buffered.end(s.buffered.length-1)),e-s.currentTime>(i+d)/1e3&&(s.currentTime,s.currentTime=e-(i-d)/1e3,s.currentTime))},n.callback.registerOnFirst("dom-loaded",(function(){var e,i,o;a.test_mode&&(m.buffer_time=0,m.current_time=0,m.event_history="init:"+Math.floor((new Date).getTime()%1e6),m.complete=!1),f.is_primed=r,null!==t?(o={cid:n.pairing_dict.cid,stream_id:t,rand:__randstr(8)},n.pairing_dict.cluster_id&&(o.cl=n.pairing_dict.cluster_id),d=200,e=n.url_builder.buildClusterURL("/c/wa/?"+Util.buildQueryStr(o)),S(),(i=document.createElement("source")).setAttribute("type","audio/mpeg"),i.setAttribute("src",e),s.appendChild(i)):(d=75,S())}))}function AdpcmSession(e,t,r,n,i){var o,a=this,s=[],l=0,c=0,d=.1,u=!1,f=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],p=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767],g=[0,0,0,0,0,0],m=[0,0,0,0,0,0],_={},h=0,y=!0;i.logger;function v(e,t,r,n){var i,a,s,l,c,d,u=r.length/e;for(d=o.createBuffer(e,u,t),l=0;l<e;l+=1)if(c=r.subarray(l*u,(l+1)*u),d.copyToChannel)d.copyToChannel(c,l);else for(s=d.getChannelData(l),a=0;a<c.length;a+=1)s[a]=c[a];(i=o.createBufferSource()).onended=function(){k()},i.buffer=d,i.connect(o.destination),i.start(n)}function k(){for(var e,t,n,i,a,l,u;s.length&&(e=s[0][0],t=s[0][1],n=s[0][2],i=s[0][3],u=c,l=o.currentTime,(u+=e/1e3)+d<l&&(o.currentTime,d=l-u+.1),DEBUG&&!y&&o.currentTime,(a=u+d)-l<=r/1e3);)v(t,n,i,a),c=u+i.length/t/n,s.shift()}function S(e,t){var r,n=m[t],i=p[n],o=i>>3;return 4&e&&(o+=i),2&e&&(o+=i>>1),1&e&&(o+=i>>2),r=8&e?g[t]-o:g[t]+o,(n+=f[e])<0?n=0:n>88&&(n=88),r>32767?r=32767:r<-32768&&(r=-32768),g[t]=r,m[t]=n,r/32768}a.handle_webaudio_state_change=function(t){switch(t){case"close":setTimeout((function(){o&&(o.close(),o=null),i.test_mode&&(_.complete=!0),n&&n(e)}),1e3*(d+.5));break;case"suspend":if(l&&reportWarnClientEvent("tc-wa-invalid-transition",{state_change:t}),!o){l=-1;break}l=o.currentTime;break;case"resume":if(-1===l){l=0;break}if(!l){reportWarnClientEvent("tc-wa-invalid-transition",{state_change:t});break}c+=o.currentTime-l,l=0;break;default:assert(!1)}},a.append_audio_data=function(e,t,r,n,a){var l,c,d,f,p,g;switch(l=new Uint8Array(a),n){case"f32le":g=(c=new Float32Array(a)).length/t;break;case"s16le":for(g=(d=new Int16Array(a)).length/t,c=new Float32Array(d.length),p=0;p<d.length;p+=1)f=d[p],c[p]=f<32768?f/32768:-(65535-f)/32768;break;case"adpcm":g=2*l.length/t,c=function(e,t){var r,n,i,o,a=0,s=0,l=2*t.length/e,c=new Float32Array(l*e);for(n=0;n<e;n+=1)for(i=t.subarray(n*l/2,(n+1)*l/2),o=c.subarray(n*l,(n+1)*l),s=0,a=0;a<i.length;a+=1)r=i[a],o[s]=S(r>>4&15,n),o[s+1]=S(15&r,n),s+=2;return c}(t,l);break;default:assert(!1)}if(DEBUG&&(h<=0?(y=!1,h=i.detail_log_interval_ms):y=!0,h-=1e3*g/r),o){if(DEBUG&&!y&&(a.length,l.length,c&&c.length),i.test_mode)for(_.silence_skip_ms+=e,p=0;p<c.length;p+=1)_.energy+=c[p]*c[p];u&&(u=!1,e=0),function(e,t,r,n){s.push([e,t,r,n]),k()}(e,t,r,c)}},a.session_type=function(){return"adpcm"},a.get_audio_context=function(){return o},a.set_audio_context=function(e){assert(!o),o=e,u=!0},a.manage_latency=function(){var e,t,r,n,i=0;if(s.length){for(;s.length;)t=(e=s.shift())[0],r=e[1],n=e[2],i+=t/1e3+e[3].length/r/n;DEBUG&&o.currentTime,c+=i,d-=i,DEBUG&&o.currentTime}},a.get_stats=function(){return _},i.test_mode&&(_.silence_skip_ms=0,_.energy=0,_.complete=!1),o=t}function WebAudioManager(e){var t=this,r={},n={},i=!1,o=BrowserDetect.isSafari(),a=BrowserDetect.isSafari(),s=null,l=window.AudioContext||window.webkitAudioContext,c=5,d=new Logger("webaudio",{level:"info"}),u={test_mode:!1,logger:d,log_detail:!1,detail_log_interval_ms:2e3};function f(e,t){c>0&&(reportErrorClientEvent(e,t),c-=1)}function p(e){u.test_mode||delete r[e]}t.mute_if_wa_src_node=function(e,t){var r,i=e+"_"+t;return void 0!==n[i]&&(!1===n[i]&&(r=getNodeByUid(e,t))&&(r.muted=!0,n[i]=!0),!0)},t.set_delivery_method=function(t){if(-1===["mp3_mse","mp3_http","adpcm"].indexOf(t))return!1;u.test_mode=!0,e.surrogate_channel.send("set_wa_params",t,5,1e3)},t.get_stats=function(){var e,t={};for(e in t.mp3_mse=[],t.mp3_http=[],t.adpcm=[],r)r.hasOwnProperty(e)&&t[r[e].session_type()].push(r[e].get_stats());return JSON.stringify(t)},e.interp.registerOpcodeHandler(e.interp.OPCODES.WEB_AUDIO_DATA,(function(e,t,n,i,o,a,s){var l,c,d,u,p;for(l=window.atob(s),c=new ArrayBuffer(l.length),d=new Uint8Array(c),u=0;u<l.length;u+=1)d[u]=l.charCodeAt(u);switch(p=e+"_"+t,a){case"mp3":if(!r[p]||"mp3_mse"!==r[p].session_type())return void f("tc-wa-invalid-context",{ctx_id:t,type:a,session_found:!!r[p]});r[p].append_audio_data(d);break;case"f32le":case"s16le":case"adpcm":if(!r[p]||"adpcm"!==r[p].session_type())return void f("tc-wa-invalid-context",{ctx_id:t,type:a,session_found:!!r[p]});r[p].append_audio_data(n,i,o,a,c);break;default:f("tc-wa-unknown-type",{ctx_id:t,type:a})}})),e.interp.registerOpcodeHandler(e.interp.OPCODES.WEB_AUDIO_STATE_CHANGE,(function(t,n,c,d,f){var g,m=t+"_"+n;switch(c){case"start":if(r[m])return void reportErrorClientEvent("tc-wa-invalid-context",{ctx_id:n,reason:"session exists"});d?r[m]=new Mp3Session(m,null,!o,e,f,p,u):(i=!0,a?(g=s,s=null):g=new l,r[m]=new AdpcmSession(m,g,f,p,u));break;case"close":case"suspend":case"resume":if(!r[m]||"mp3_http"===r[m].session_type())return void reportErrorClientEvent("tc-wa-invalid-context",{ctx_id:n,state_change:c,session_found:!!r[m]});r[m].handle_webaudio_state_change(c);break;default:reportErrorClientEvent("tc-wa-invalid-state",{ctx_id:n,state:c})}})),e.interp.registerOpcodeHandler(e.interp.OPCODES.WEB_AUDIO_SOURCE_NODE,(function(e,t){var r=e+"_"+t,i=getNodeByUid(e,t);i?(i.muted=!0,n[r]=!0):n[r]=!1})),e.interp.registerOpcodeHandler(e.interp.OPCODES.WEB_AUDIO_HTTP_STREAM,(function(t,n,i){var a=t+"_"+n;r[a]?reportErrorClientEvent("tc-wa-invalid-context",{ctx_id:a,stream_id:n,reason:"stream session exists"}):r[a]=new Mp3Session(a,n,!o,e,i,p,u)})),e.callback.register("interaction",(function(e){var t,n,c,d,u;e.type;try{n=!!o&&((u=new Audio(Resource.dummyAudioUri))?(u.play(),o=!1,!0):(o=!1,reportErrorClientEvent("tc-wa-audio-prepare-error",{error:"Failed to create audio element"}),!1)),function(){var e;if(!s&&i&&a){if(!(s=new l))return a=!1,void reportErrorClientEvent("tc-wa-audio-prepare-error",{error:"Failed to create audio context"});(e=s.createBufferSource()).buffer=s.createBuffer(1,24,24e3),e.connect(s.destination),e.start(),"running"!==s.state&&(e.disconnect(s.destination),e=null,s.close(),s=null,f("tc-wa-audio-prepare-error",{error:"Audio context failed to run"}))}}()}catch(e){a=!1,o=!1,reportErrorClientEvent("tc-wa-audio-prepare-error",{error:e.toString()})}for(t in r)r.hasOwnProperty(t)&&("mp3_mse"!==(d=(c=r[t]).session_type())&&"mp3_http"!==d||!n?"adpcm"===d&&!c.get_audio_context()&&s&&(c.set_audio_context(s),s=null):c.on_audio_primed(),r[t].manage_latency())}))}function RestoreOnReattach(e){var t,r="__SV_SCROLL_POSITION",n=0,i=0;function o(){var e=(t||{}).scroll,r=document.documentElement;!e||(!e.X||e.X<=0)&&(!e.Y||e.Y<=0)||(r?e.X>0&&r.scrollWidth!==r.clientWidth||e.Y>0&&r.scrollHeight!==r.clientHeight?(window.scrollTo(e.X,e.Y),++n<20&&setTimeout(o,100)):i<50&&(i++,setTimeout(o,100)):setTimeout(o,100))}this.save_state=function(){var t=!1;if(e&&e.pairing_dict&&e.pairing_dict.client_caps&&(t=(e.pairing_dict.client_caps.restore_tab||{}).enabled),t){var n,i=document.documentElement;if(i&&(n=Util.getBrowserScrollOffset(i,i.getBoundingClientRect()))&&(n.x>0||n.y>0))try{sessionStorage.setItem(r,JSON.stringify({scroll:{X:n.x,Y:n.y}}))}catch(e){}}},function(){try{(t=JSON.parse(sessionStorage.getItem(r)))&&setTimeout(o,100),sessionStorage.removeItem(r)}catch(e){}}()}function RateMonitor(e,t,r){var n,i,o=Math.floor(1e3/30),a=!1,s=0;function l(e){var r,n=.5*t.getFPS();return r=e||1e3/n,Math.min(Math.max(r,o),1e3)}function c(i){var o,c,d=l(i);o=d,(o=Math.floor(o))!==n&&(n=o,e.surrogate_channel.send("set-canvas-delay",o)),a||((c=t.getFPS())<30?s+=1:s=0,s>=3&&(a=!0,r(c)))}this.isFallbackMode=function(){return a},this.release=function(){i&&clearInterval(i)},i=setInterval(c,1e3),c(o)}function CanvasSupport(e){var t,r,n,i,o=new Logger("canvas",{level:"info"}),a={},s={},l=this,c=!1,d=!1,u=new Util.BiMap,f={},p={},g={},m={},_=10;function h(){var e,r=s;for(e in s={},t=null,r)r.hasOwnProperty(e)&&y.apply(l,r[e])}function y(e,r,n,i){var o,l=r+"_"+n,c=getNodeByUid(r,n);if(!c)return s[l]=[e,r,n,i],void(t||(t=window.setTimeout(h,1e3)));"canvas"===c.nodeName.toLowerCase()?a[l][0]>i||(a[l][0]=i,(o=c.getContext("2d")).globalCompositeOperation="copy",o.drawImage(e,0,0,c.width,c.height),window.URL.revokeObjectURL(e.src)):reportWarnClientEvent("tc-canvas-mismatch",{fid:r,uid:n,node:c.nodeName})}function v(){var t={};d=!1,Util.forEachItem(p,(function(e,r){var n=e.split("_"),i=Number(n[0]),o=Number(n[1]);t[i]||(t[i]=[]),t[i].push(o),r.setAllowClientCanvasSrc(d)})),o.info({event:"remote-canvas-src",canvas_dict:t}),Util.forEachItem(t,(function(t,r){e.surrogate_channel.send("remote-canvas-src",Number(t),r)}))}function k(){var t,r,n,i;e.callback.fire("will-draw");try{Util.forEachItem(p,(function(e,t){t.processPendingPictures(),t.updateTexture()}))}catch(r){t={stacktrace:printStackTrace(r),exception:r?r.toString():null},e.fatalError("tc-draw-canvas-exception",t)}r=Sk.getOrCreateHiddenCanvasCache(),n=0,i=0,Util.forEachItem(f,(function(e,t){var o=r.peek(e),a=o?o.value:null;a?a.hasPendingDelta()||(t&Compositor.DiscardResourceProviderFlags.kResize?a.willResize():(i+=1,n+=o.value.getMemoryUsage(),r.remove(e)),delete f[e]):delete f[e]})),i&&(n/=1024).toFixed(2)}function S(e,t){var r;Util.forEachItem(p,(function(t,n){r=t.split("_"),e===Number(r[0])&&(n.release(),delete p[t],m[t]&&delete m[t])}))}function b(t){t&&e.local_events&&e.local_events.getTimeFromLastInput()<1e3?i=setTimeout((function(){b(t)}),_):(assert_unimplemented(!d),i=null,Util.forEachItem(g,(function(t,r){var n=t.split("_"),i=Number(n[0]),o=Number(n[1]);e.surrogate_channel.send("redraw-canvas",i,o,Sk.Rect.getX(r),Sk.Rect.getY(r),Sk.Rect.getWidth(r),Sk.Rect.getHeight(r))})),g={},_=10)}function w(t,r,n){var i=[25,25,3];return r?e.local_events&&e.local_events.getTimeFromLastInput()<1e3?[25,25,0]:i:[100,100,100]}function C(t){var r;Util.forEachItem(p,(function(t,n){n.clearPendingPictures(),r=t.split("_"),e.surrogate_channel.send("force-canvas-snapshot",Number(r[0]),Number(r[1]),!0)})),reportClientEvent("set-force-canvas-snapshot",{fps:t},!0)}l.getFrameTreeNodeId=function(e){return u.getKeyByVal(e)},l.getFrameToken=function(e){return u.getValByKey(e)},l.callback=e.callback,l.setNeedsDrawFrame=function(){},l.hasCanvasPicture=function(e,t){return!!p[e+"_"+t]},l.setAllowClientCanvasSrc=function(e){e!==d&&(Sk.setRemoteCanvasSrcCallback(v),d=e,Util.forEachItem(p,(function(t,r){r.setAllowClientCanvasSrc(e)})))},l.allowClientCanvasSrc=function(){return d},l.waitForCanvasNode=function(e,t,r){var n=e+"_"+t;assert(r),getNodeByUid(e,t)?r():m[n]=r},l.on_add_node=function(t,r){var n=t+"_"+r;m[n]&&(m[n](),delete m[n]),e.surrogate_channel.send("redraw-canvas",t,r)},l.on_remove_node=function(e,t){var r=e+"_"+t,n=p[r];n&&(n.release(),delete p[r]),m[r]&&delete m[r]},l.setNeedsRepaint=function(e,t,r){var n=g[e];n||(n=Sk.Rect.makeEmpty()),Sk.Rect.join(n,t),g[e]=n,r&&10===_&&(_=1e3,i&&(clearTimeout(i),i=null)),i||(i=setTimeout((function(){b(r)}),_))},l.setBackendDsf=function(t){var r=Util.getDeviceScaleFactor();!c&&isTopFrameFid(t)&&1!==r&&(e.surrogate_channel.send("set-rendering-dsf",r),c=!0)},l.setForceSnapshot=C,l.release=function(){l.rate_monitor&&(l.rate_monitor.release(),l.rate_monitor=null),l.anim_frame&&(l.anim_frame.release(),l.anim_frame=null),n&&(n=e.callback.deregister(n),n=null),i&&(clearTimeout(i),i=null),g={},Util.forEachItem(p,(function(e,t){t.release(),p[e]=null})),p={},r&&(r.release(),r=null),f={},Sk.fini()},e.interp.registerBinaryHandler((function(t,i){var o,s,c,d,u,f,g,m;return t===MSG_KIND_CANVAS_PICTURE?(m={},l.anim_frame||(window.mat3=glMatrix.mat3,window.mat4=glMatrix.mat4,window.vec2=glMatrix.vec2,window.vec3=glMatrix.vec3,window.vec4=glMatrix.vec4,m.Logger=Logger,m.assert=assert,m.assertUnimplemented=assert_unimplemented,m.Set=Compositor.Set,m.OrderedMap=Compositor.OrderedMap,m.fetchImage=function(e,t){window.fetch(e).then((function(e){t(!0,e.headers.get("content-type")||"",e.body)}))},Sk.init({"dom-canvas":1<<29,invisible:1<<29,rcache:1<<25,shader:1<<24,"save-layer":1<<24},m),Sk.Util.init(Compositor,Util),r=new Sk.ImageLoader(w),n=e.callback.register("frame-node-removed",S),l.anim_frame=new Compositor.RequestAnimationFrame(k),l.anim_frame.start(),l.rate_monitor=new RateMonitor(e,l.anim_frame,C)),function(t){var n,i,o,a,s=new Sk.BinaryReader(t),c=s.readUint32(),d=s.readUint32();for(i=0;i<d;i+=1)n=s.readUint32(),(a=p[o=c+"_"+n])||(a=new CanvasPicture(e,c,n,r,l),p[o]=a),a.queueCanvasPicture(s)}(i),!0):(s=(c=(d=new window.DataView(i.buffer,i.byteOffset,8)).getUint32(0,!1))+"_"+(f=d.getUint32(4,!1)),o=new window.Blob([new window.Uint8Array(i.buffer,i.byteOffset+8)],{type:"image/png"}),a[s]?a[s][1]+=1:a[s]=[0,1],g=a[s][1],(u=new Image).onload=y.curry(u,c,f,g),u.src=window.URL.createObjectURL(o),!0)})),e.interp.registerOpcodeHandler("rucv",(function(e,t,r){var n=!!(r&Compositor.DiscardResourceProviderFlags.kInTreeScope),i=Sk.Util.getNodeKey(l.getFrameToken(e),t);n||(f[i]=r)})),e.callback.register("ftimu",(function(e,t,r){assert(e),e=e.toLowerCase(),r?u.erase(t,e):u.set(t,e)}))}function CanvasPicture(e,t,r,n,i){var o,a,s,l,c,d,u,f=this,p=new Logger("canvas-picture",{level:"info"}),g=[],m=!1,_=Object.freeze({kInitialize:1,kResetCache:2,kDirtySize:4,kDirtyStyle:8,kDirtyPicture:16}),h=Object.freeze({kLoadNotStarted:0,kLoadStarted:1,kLoadComplete:2}),y=!1,v=!1;function k(){var e;l&&y&&(e=i.getFrameToken(t),l.setCanvasKey(Sk.Util.getNodeKey(e,r)))}function S(e,n,o){var a=t+"_"+r;Sk.Rect.isEmpty(e)||(y?v=!0:i.setNeedsRepaint(a,e,o))}function b(e){var t=e.getCullRect();assert(l),l.save(),l.clipRect(t),l.translate(Sk.Rect.getX(t),Sk.Rect.getY(t)),e.playback(l),l.restore(),e.getProperties()&Sk.PictureFlags.kHintNeedsTextureSync&&S(t,0,!0)}function w(t){assert(t.state===h.kLoadNotStarted),t.state=h.kLoadStarted,function(t,r){var i=0,o=0;i+=1;try{t.skr=new Sk.SafeviewRecording(t.skr_u8a,(function(){i===(o+=1)&&r()}),d,a,s,e.url_builder.asSkHelperFuncs(),n,!1)}catch(e){p.error("Unable to load picture: "+e.stack)}}(t,(function(){t.state=h.kLoadComplete}))}function C(){var e,n={};assert(c=getNodeByUid(t,r)),assert_unimplemented(!l),(e=new Sk.HTMLCanvasDevice("dom-canvas",Sk.Rect.fromWH(c.width,c.height),{x:0,y:0},1,c)).tryAlloc()&&(n.use_raster_cache=!0,n.text_boxes=!1,l=new Sk.Canvas(e,S,n),k())}f.getDisplay=function(){return i},f.getActiveAssetCache=function(){return a},f.getFid=function(){return t},f.isCanvasPicture=function(){return!0},f.setAllowClientCanvasSrc=function(e){y=e,k()},f.updateTexture=function(){y&&v&&(v=!1,u.playback((function(e){var t;return b(e),t=l.needsRedraw(),l.clearNeedsRedraw(),t})))},f.processPendingPictures=function(){var e,r;if(l&&c)for(;g.length>0&&(e=g[0]).state===h.kLoadComplete;)g.shift(),e.reset_cache&&(s.flush(),e.old_asset_cache&&(r=!0,Sk.getOrCreateHiddenCanvasCache().forEachEntry((function(t,n){var i=n.value;i&&(r&=i.clearTextureUpdates(e.old_asset_cache))})),r?(e.old_asset_cache.release(),e.old_asset_cache=null):e.old_asset_cache.setNeedsRelease())),void 0!==e.width&&(c.width=e.width),void 0!==e.height&&(c.height=e.height),void 0!==e.style&&c.setAttribute("style",e.style),e.skr&&(i.setBackendDsf(t),y?(u.recordTextureUpdate(e.skr),S(e.skr.getCullRect())):(b(e.skr),l.clearNeedsRedraw()));else g.length},f.queueCanvasPicture=function(e){var n,i=t+"_"+r,s=e.readUint32(),l=!!(s&_.kResetCache),c=a;if(!m){if(!(s&_.kInitialize))return;m=!0}a&&!l||(o=new Sk.TypefaceDelegate(i),a=new Sk.Deduper.Cache(o,i)),n={state:h.kLoadComplete},s&_.kDirtySize&&(n.width=e.readUint32(),n.height=e.readUint32()),s&_.kDirtyStyle&&(n.style=e.readString()),s&_.kDirtyPicture&&(n.skr_u8a=e.readByteArray(),n.state=h.kLoadNotStarted),l&&(n.reset_cache=!0,n.old_asset_cache=c),g.push(n),n.skr_u8a&&w(n)},f.clearPendingPictures=function(){g=[]},f.release=function(){v=!1,c=null,l&&(l.release(),l=null),g=[],a&&(a.release(),a=null),s&&(s.flush(),s=null),o&&(o.release(),o=null),u&&(u.release(),u=null),d&&(d.release(),d=null)},s=new Sk.RasterCacheClass,y=i.allowClientCanvasSrc(),d=new Compositor.ImageDelegate(f),u=d.allocNewTextureLayerClient(),i.waitForCanvasNode(t,r,C)}function URLBuilder(e){var t=this;function r(e){return"/"!==e.substr(0,1)&&(e="/"+e),e}function n(e){var t,r="";for(t=0;t<e.byteLength;t+=1)r+=String.fromCharCode(e[t]);return r}function i(e){return window.btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"~")}t.getDomain=function(t){if(!window.TPROXY_ENABLED&&Util.isIpAddress(window.location.hostname))return window.location.hostname;switch(t){case"service":return window.TPROXY_ENABLED?CLUSTER_DOMAIN:window.location.hostname;case"login":return window.LOGIN_DOMAIN;case"cluster":case"inspect":case"cluster-protocol":return"cluster"===t?e.pairing_dict.hasOwnProperty("cluster_domain")&&e.pairing_dict.cluster_domain||CLUSTER_DOMAIN:"cluster-protocol"===t?e.pairing_dict.hasOwnProperty("protocol_domain")&&e.pairing_dict.protocol_domain||PROTOCOL_DOMAIN:e.pairing_dict.hasOwnProperty("inspect_domain")&&e.pairing_dict.inspect_domain||INSPECT_DOMAIN;default:throw new Error("invalid domain kind "+t)}},t.buildProtocolUrl=function(e,n){return assert(e),(n?"wss://":"https://")+t.getDomain("cluster-protocol")+r(e)},t.buildFileServerUrl=function(r,n,i){var o,a=n?t.buildInspectURL:t.buildProtocolUrl,s={cid:e.pairing_dict.s_nid,rid:e.pairing_dict.rid};if(e.pairing_dict.cluster_id&&(s.cl=e.pairing_dict.cluster_id),i)for(o in i)i.hasOwnProperty(o)&&(s[o]=i[o]);return a(r+"?"+Util.buildQueryStr(s,!1))},t.buildClusterURL=function(n){return __startswith(n,"/c/")&&(n="/c/"+(e.pairing_dict.mpa_id?"mpa-"+e.pairing_dict.mpa_id:"0")+n.substr(2)),"https://"+t.getDomain("cluster")+r(n)},t.buildInspectURL=function(e){return"https://"+t.getDomain("inspect")+r(e)},t.urlSafeBase64Enc=i,t.buildImageURLFromU8Array=function(e,r){var o,a="",s=n(e).split("|sv_bid="),l=s[0],c=s[1];return o=i((s=l.split("|sv_tok="))[0]),a=s[1]?"?k="+s[1]:"",r&&c&&(a+=(s[1]?"&b=":"?b=")+c),t.buildClusterURL("/c/i/"+o)+a},t.asSkHelperFuncs=function(){return{get_resource_url:t.buildImageURLFromU8Array,get_url_str:n}},t.buildAssetURL=function(e){return!1===window.TC_BUNDLED&&0===e.indexOf("/safeview-static/")?t.buildClusterURL("/safeview-static/tc/"+window.TC_API_VERSION+e.substr("/safeview-static".length)):t.buildClusterURL(e)+"?v="+BUILD_ID},t.buildServiceURL=function(e){return"https://"+t.getDomain("service")+r(e)},t.buildLoginURL=function(e){return"https://"+t.getDomain("login")+r(e)},t.buildVanityFileTransferURL=function(e){return window.TPROXY_ENABLED?t.buildLoginURL(e):t.buildServiceURL(e)},t.getServiceDomain=function(){return"https://"+t.getDomain("service")}}function Template(){var e=this,t={};e.get=function(r,n){var i,o;if(!e.has(r))throw new Error('Invalid template "'+r+'"');if(i=t[r],n)for(o in n)n.hasOwnProperty(o)&&(i=i.replace("{{"+o+"}}",n[o]));return i},e.has=function(e){return t.hasOwnProperty(e)},function(){var e,r,n,i,o;for(r=document.getElementsByTagName("sv-template"),e=0;e<r.length;e+=1)assert(n=r[e].id),t[n]=(i=r[e],o=void 0,assert(o=i.getAttribute("content")),Util.b64Decode(o)),assert(t[n]);assert(t)}()}function Localization(e,t){var r={};this.get=function(e){var t,n=r[e];if(void 0===n)return reportErrorClientEvent("tc-localization-no-entry",{id:e}),e;for(t=1;t<arguments.length;t+=1)n=n.replace("$"+t,arguments[t]);return n},this.get_localization_data=function(){return r},function(){if(t)r=t;else{var n=e.template.get("localization-template");n=Util.replaceAll(n,"&#39;","'"),r=JSON.parse(n)}}()}function ServerCall(){this.call=function(e){return function(e){var t=e.type||(e.data?"POST":"GET"),r=new SCContext(0,e),n=new Util.xmlHttpRequest;return n.open(t,e.url),n.withCredentials=!0,e.timeout&&(n.timeout=e.timeout),n.onreadystatechange=function(){var e;if(4===n.readyState){if(n.status>=200&&n.status<300)for(e=0;e<r.done_cbs.length;e+=1)r.done_cbs[e](n.responseText?JSON.parse(n.responseText):n.responseText,n);else for(e=0;e<r.fail_cbs.length;e+=1)r.fail_cbs[e](n,n.statusText);for(e=0;e<r.always_cbs.length;e+=1)r.always_cbs[e](n,n.statusText)}},e.data?n.send(e.data):n.send(),r.abort=function(){n.abort()},r}(function(e){var t;return assert((t=__object_assign({},e)).url),t.no_tracking_label||(t.url=Util.addTrackingLabel(t.url)),t.type=t.type||"POST",t.dataType="json",t.timeout||(t.timeout=safeview.perf.xhr_timeout_ms),t.success&&(t.success=t.success.bind(e)),t.complete&&(t.complete=t.complete.bind(e)),assert(!t.orig_error_func),t.orig_error_func=t.error,t.error=function(r,n){t.skip_report||reportClientEvent("tc-server-call-failed",{url:t.url,method:t.type,dataType:t.dataType,timeout:t.timeout,textStatus:n,responseHeaders:r.getAllResponseHeaders(),statusCode:r.status}),t.orig_error_func&&t.orig_error_func.call(e,r,n)},t}(e))}}function SCContext(e,t){var r=this;r.call_id=e,r.done_cbs=[],r.fail_cbs=[],r.always_cbs=[],r.done=function(e){return r.done_cbs.push(e),r},r.fail=function(e){return r.fail_cbs.push(e),r},r.always=function(e){return r.always_cbs.push(e),r},t.success&&r.done_cbs.push(t.success),t.error&&r.fail_cbs.push(t.error),t.complete&&r.always_cbs.push(t.complete)}function CrossOriginFrameCore(e){this.createServerFrame=function(t){var r=document.createElement("iframe");return r.id="cof-server:"+e,r.src=t,r.width="0",r.height="0",r.loaded=!1,r.sandbox="allow-same-origin allow-scripts allow-popups allow-top-navigation allow-forms allow-downloads",EventListener.addListener(r,"load",(function(){r.loaded=!0})),r.style.display="none",r.tabindex="-1",r},this.attachServerFrame=function(t){document.getElementById("cof-server:"+e)||(t.parentNode||document.documentElement.appendChild(t),assert(t.parentNode))}}function CrossOriginFrame(e,t,r){var n,i,o=this,a=null,s=0,l={},c=[],d=Util.origin_of(t),u=null;o.register=function(){EventListener.addListener(window,"message",o.onReceiveMessage,!1)},o.deregister=function(e){void 0!==e&&function(){var e;for(e in l)if(l.hasOwnProperty(e)&&l[e])return!0;return!1}()?u=e:(u=null,clearTimeout(i),EventListener.removeListener(window,"message",o.onReceiveMessage,!1),a.is_registered=!1,c=[],!r&&a.iframe.parentNode&&a.iframe.parentNode.removeChild(a.iframe),void 0!==e&&e())},o.reregister=function(){var e;for(o.register(),a.is_registered=!0,r||a.iframe.parentNode||n.attachServerFrame(a.iframe),e=0;e<c.length;e++)c[e](a)},o.onReceiveMessage=function(t){var r;if(t.origin===d){try{r=t.data}catch(e){return void reportWarnClientEvent("tc-cof-client-unexpected-message",{detail:t.data,error:e.toString()})}switch(r.kind){case"register-server":!function(t){var r;for(assert(a),assert(a.iframe.contentWindow),e.pairing.surrogateInfoRecovery(t.surrogate_info,t.pa_tok),a.iframe.contentWindow.postMessage({kind:"register-ack"},d),a.is_registered=!0,r=0;r<c.length;r+=1)c[r](a);c=[]}(r);break;case"call-result":!function(e){var t=l[e.call_id];delete l[e.call_id],t&&t(e.result),null!==u&&o.deregister(u)}(r);break;case"auth-check-reauth":e.pairing.doRecookie(r.result[0]);break;case"inspect-onerror":e.upload.oninspecterror.apply(null,r.result);break;case"inspect-onsuccess":e.upload.oninspectsuccess.apply(null,r.result);break;case"upload-onerror":e.upload.onerror(r.result[0]);break;case"upload-onload":e.upload.onload(r.result[0],r.result[1]);break;case"upload-onprogress":e.upload.onprogress(r.result[0]);break;default:assert(0)}}else reportWarnClientEvent("tc-cof-client-unexpected-origin",{expected_origin:d,actual_origin:t.origin})},o.call=function(e,t,r){var n={kind:"call",call_id:s,call_args:e};l[s]=t,s+=1,function(e){a&&a.iframe.contentWindow&&a.is_registered?e(a):c.push(e)}((function(e){var t=e.iframe.contentWindow;assert(e.is_registered),assert(t),t.postMessage(n,d,r)}))},o.registration_timeout_ms=function(){return 2500},assert(window.postMessage),assert(/^http(s)?:\/\//.test(d)),r?a={iframe:r,is_registered:!1}:(n=new CrossOriginFrameCore(d),a={iframe:n.createServerFrame(t),is_registered:!1},n.attachServerFrame(a.iframe)),i=setTimeout((function(){if(!a.iframe.loaded){document.documentElement.contains(a.iframe)&&document.documentElement.removeChild(a.iframe),t=e.url_builder.buildClusterURL(Util.COFPath());let r=Util.origin_of(t);reportWarnClientEvent("tc-cof-client-inspect-host-unreachable",{blocked_origin:d,retry_origin:r}),n=new CrossOriginFrameCore(d=r),a.iframe=n.createServerFrame(t),n.attachServerFrame(a.iframe)}}),o.registration_timeout_ms())}function makeURLParams(e){var t,r="";for(t in e)if(e.hasOwnProperty(t)){if(!/^[a-z_]+$/.test(t))continue;if(!/^[a-zA-Z0-9-_.!~*'()%]+$/.test(e[t]))continue;r&&(r+="&"),r+=t+"="+e[t]}return r}function doLoginXHR(e,t,r){var n=new XMLHttpRequest;n.open("POST",t),n.target_url=t,n.withCredentials=!0,n.onload=function(e){var t;if(200===n.status)try{return t=JSON.parse(n.response),void r(t.use_inspect_host)}catch(e){}r()},n.onerror=function(e){r()},n.send(JSON.stringify(e))}function isCurrentHostAllowedForInspection(){return window.INSPECT_DOMAIN===window.CLUSTER_DOMAIN||__startswith(window.location.href,window.INSPECT_DOMAIN)}function record_auth_check(){try{window.localStorage.setItem("ac_last",(new Date).getTime())}catch(e){}}function record_auth_check_result(e){var t=0;try{e||(t=(parseInt(window.localStorage.getItem("ac_fail"),10)||0)+1),window.localStorage.setItem("ac_fail",t)}catch(e){}}function should_auth_check(){var e,t;try{return e=parseInt(window.localStorage.getItem("ac_fail"),10)||0,t=parseInt(window.localStorage.getItem("ac_last"),10)||0,e<3||t+3e5<(new Date).getTime()}catch(e){return!0}}function RPCHandlers(e){var t=this,r="ws_support",n=null,i={};function o(){}function a(){return window.indexedDB&&window.Promise?new Promise((function(e,t){var r=window.indexedDB.open("safeview",1);r.onupgradeneeded=function(e){e.target.result.createObjectStore("pair_key",{keyPath:"id"}),e.target.result.createObjectStore("tokens",{keyPath:"host"})},r.onerror=t,r.onsuccess=function(t){e(t.target.result)}})):new o}function s(e){var t=new ParsedURL(e).hostname;return a().then((function(e){return new window.Promise((function(r,n){var i;try{i=e.transaction(["tokens"],"readonly").objectStore("tokens").get(t)}catch(e){return void n(e)}i.onsuccess=function(e){e.target.result&&e.target.result.token?r(e.target.result.token):n(null)},i.onerror=n}))}))}function l(e,t,r,n){s(r).then((function(r){t.setRequestHeader("x-auth-token",btoa(e)+":"+r),n()})).catch(n)}function c(e){return new window.Promise((function(t,r){var n;try{n=e.transaction(["tokens"],"readonly").objectStore("tokens").getAll()}catch(e){return void r()}n.onsuccess=function(e){var n,i={};if(e.target.result){for(n=0;n<e.target.result.length;n++)i[e.target.result[n].host]=e.target.result[n].token;t(i)}else r()},n.onerror=function(){r()}}))}function d(e){return"surrogate_info"+(e=e?"~"+e:"")}function u(e,r,n,i,o,a,s,c,d){var u=new XMLHttpRequest,f="https://"+r+"/safeview-auth-server/check";u.open("POST",f),u.timeout=n,u.withCredentials=!0,u.onerror=function(e){record_auth_check_result(!1),console.error("auth check "+r+" response failure")},u.onload=function(e){var n,i;if(200===u.status)if((n=JSON.parse(u.response)).success){if(record_auth_check_result(!n.reauth),n.reauth){if(c)return void t.doITok(null,c,s,null,a.url);i=o&&n.use_integrity_token&&navigator.userAgent.indexOf("Trident")>=0,reportWarnClientEvent("tc-attempt-recookie",{target_url:a.url,login_url:a.login_url,host:r,do_toks:i,redirect_list:a.redirect_list}),i?t.doToksAuth(null,a,a.url):d.postToController({kind:"auth-check-reauth",result:[a]})}}else u.onerror(e);else u.onerror(e)},l(e,u,f,(function(){u.send(JSON.stringify({sb:i})),record_auth_check()}))}function f(e,t){a().then((function(r){var n;try{n=r.transaction(["pair_key"],"readonly").objectStore("pair_key").get(1)}catch(e){return void t(null)}n.onsuccess=function(r){var n=r.target.result?r.target.result.key:null;n&&r.target.result.login_domain===e?t(n):t(null)},n.onerror=function(){t(null)}})).catch((function(){t(null)}))}o.prototype.then=function(){return this},o.prototype.catch=function(e){return e(),this},t.fetchResource=function(e,t,r){s(r).then((function(e){var n={headers:{"x-auth-token":btoa(t)+":"+e}};return window.fetch(new window.Request(r,n))})).then((function(t){var r=t.headers.get("content-type")||"",n=t.body;try{return void e({stream:n,type:r},[n])}catch(e){}return t.arrayBuffer().then((function(t){e({buffer:t,type:r},[t])}))})).catch((function(){e(null)}))},t.fetchResource.is_async=!0,t.xhrRequest=function(e,t,r,n,o,a,l,c,d){var u=new XMLHttpRequest;u.open(a||"POST",r),null!==o&&(u.timeout=o),u.withCredentials=!0,i[t+"_"+d]=u,u.onload=function(){delete i[t+"_"+d],200===u.status?e({response:u.response,status:u.status},"arraybuffer"===l?[u.response]:[]):e({status:u.status})},void 0!==c&&Util.forEachItem(c,u.setRequestHeader.bind(u)),u.ontimeout=function(){delete i[t+"_"+d],e({response:"",status:408})},u.onabort=u.onerror=function(){delete i[t+"_"+d],e(null)},s(r).then((function(e){u.setRequestHeader("x-auth-token",btoa(t)+":"+e),"GET"===a||null===n?u.send():u.send(n),"arraybuffer"===l&&(u.responseType=l)})).catch((function(){e(null)}))},t.xhrRequest.is_async=!0,t.xhrRequestAbort=function(e,t){var r=i[e+"_"+t];void 0!==r&&r.abort()},t.getActiveCookie=function(e){return Util.getCookie("active")},t.setActiveCookie=function(e,t){return Util.setCookie("active",t,null,null,null,!0,"None")},t.setNidCookie=function(e,t,r){return r&&Util.setCookie("cl",r,null,"/",null,!0,"None"),Util.setCookie("nid",t,null,"/",null,!0,"None")},t.setWSSupportState=function(e,t,n){var i;void 0===n&&(n=(new Date).getTime()),i={state:t,time:n};try{localStorage.setItem(r,JSON.stringify(i))}catch(e){throw new Error("tc-localstorage-setitem-error")}return i},t.getWSSupportState=function(e,n){var i;try{i=JSON.parse(localStorage.getItem(r))}catch(e){throw new Error("tc-localstorage-getitem-error")}return i||(i=t.setWSSupportState(e,n?"OK":"ERR",0)),i},t.getFeatureReport=function(e){try{return localStorage.getItem("feature_report")}catch(e){return null}},t.setFeatureReport=function(e,t){localStorage.setItem("feature_report",t)},t.setSurrogateInfo=function(e,t,r){localStorage.setItem(d(t),r)},t.setPAToken=function(e,t,r){var n,i;try{if(t&&r)localStorage.setItem("pid:"+t,Date.now()+6e5+":"+r+":"+document.referrer);else for(localStorage.removeItem("pid:"+t),n=0;n<localStorage.length;n++)localStorage.key(n).startsWith("pid:")&&(i=(i=localStorage.getItem(localStorage.key(n))).slice(0,i.indexOf(":")),Date.now()>Number(i)&&localStorage.removeItem(localStorage.key(n)))}catch(e){}},t.getPAToken=function(e){var t,r,n,i,o=document.createElement("a");try{if(o.href=document.referrer,t=Util.getQueryValue(o.search,"_sv_p_id"),n=(r=localStorage.getItem("pid:"+t)||"").slice(0,r.indexOf(":")),r=r.slice(r.indexOf(":")+1),Date.now()>Number(n))return;if(i=r.slice(r.indexOf(":")+1),44!==(r=r.slice(0,r.indexOf(":"))).length||!__startswith(o.href,i)||o.href.length!==i.length+26)return}catch(e){return}return r},t.getSurrogateInfo=function(e,t){try{return JSON.parse(localStorage.getItem(d(t)))}catch(e){return{}}},t.doToksAuth=function(e,t,r){var n,i=__randstr(43,!0),o=Util.buildLoginForm(t,r);try{window.localStorage.setItem("tok_s",i),(n=document.createElement("input")).type="hidden",n.name="tok_s",n.value=i,o.appendChild(n)}catch(e){console.error("Failed to use local storage.")}Util.submitLoginForm(o,"_parent")},t.doAuthCheck=function(t,r,n,i){var o,a;if(a=window.location.hostname.substring(window.location.hostname.indexOf(".")),r.check_hosts&&should_auth_check())for(o=0;o<r.check_hosts.length;o+=1)r.check_hosts[o].endsWith(a)&&-1===r.check_hosts[o].indexOf("/")&&-1===r.check_hosts[o].indexOf("%")&&u(t,r.check_hosts[o],r.timeout,r.sb,r.transparent_mode,n,r.check_hosts,i,e)},t.doITok=function(e,t,r,n,i){var o,a,s,l=r.length,c=!1;o=new ParsedURL(i).host();try{s=window.localStorage.getItem("tok_s")}catch(e){console.log("Failed to get tok_s from local storage.")}if(!s)return!1;function d(e){l-=1,e&&!c&&(c=!0,l+=1,doLoginXHR({itok:t,tok_s:s,host:o},"https://"+n+"/safeview-auth-server/do_itok_auth",d)),0===l&&Util.locationSet(window.top,i)}for(a=0;a<r.length;a+=1)doLoginXHR({itok:t,tok_s:s,host:o},"https://"+r[a]+"/safeview-auth-server/do_itok_auth",d);return!0},t.getAuthTokens=function(e){a().then(c).then((function(t){e(Util.isDictEmpty(t)?0:2)})).catch((function(){e(0)}))},t.getAuthTokens.is_async=!0,t.doBounceAuth=function(e,r,n,i,o){function s(){t.getAuthTokens(e)}function l(e){a().then((function(t){var r,n,i=[];for(r in e)e.hasOwnProperty(r)&&i.push({host:r,token:e[r]});!function e(){if(0===i.length)s();else try{(n=t.transaction(["tokens"],"readwrite").objectStore("tokens").put(i.pop())).onsuccess=e,n.onerror=e}catch(t){e()}}()})).catch(s)}function c(t){t&&t.success?Util.xhrRequest("https://"+i+"/safeview-auth-server/check",{},(function(r){r.success?function(t){var r,n=0;function i(){--n||e(1)}for(r in t)t.hasOwnProperty(r)&&(++n,Util.xhrRequest("https://"+r+"/safeview-auth-server/login",{token:t[r],url:o},i,i,3e4))}(t.redirect_tokens):l(t.tokens)}),(function(){l(t.tokens)}),3e4):s()}0!==o.indexOf(r)&&(o=r),function(e,t,r){window.crypto&&window.crypto.subtle&&window.indexedDB?f(e,(function(e){var n,i,o;if(null!==e){try{n=JSON.parse(t),i=Util.base64_to_array_buffer(n.bounce_auth),o=i.slice(0,16),i=i.slice(16)}catch(e){return void r(null)}window.crypto.subtle.decrypt({name:"AES-CBC",iv:o},e,i).then((function(e){r(JSON.stringify({identifier:n.identifier,bounce_auth:Util.array_buffer_to_base64(Util.join_array_buffers([o.slice(0,12),e]))}))})).catch((function(){r(null)}))}else r(null)})):r()}(i,n,(function(e){null===e?s():Util.xhrRequest("https://"+i+"/safeview-auth-server/login",{token:e,url:o},c,(function(){c({})}),3e4)}))},t.doBounceAuth.is_async=!0,t.generateKey=function(e,t,r){var n,i,o;n=new URL(r).hostname,i=function(){e([])},window.crypto&&window.crypto.subtle&&window.Promise&&window.Promise.all?(o=window.crypto.subtle.generateKey({name:"AES-CBC",length:256},!0,["encrypt","decrypt"]),window.Promise.all([o,a()]).then((function(e){var t=e[1].transaction(["pair_key"],"readwrite").objectStore("pair_key").put({id:1,key:e[0],login_domain:n});t.onsuccess=i,t.onerror=i})).catch(i)):i()},t.generateKey.is_async=!0,t.doLoginPost=function(e,t,r){!function(e,t){window.crypto&&window.crypto.subtle&&window.indexedDB?f(e,(function(e){null===e?t(null):window.crypto.subtle.exportKey("raw",e).then((function(e){t(Util.array_buffer_to_base64(e))})).catch((function(){t(null)}))})):t(null)}(new URL(t.login_url).hostname,(function(e){var n,i=Util.buildLoginForm(t,r);null!==e&&((n=document.createElement("input")).type="hidden",n.name="bounce_key",n.value=e,i.appendChild(n),(n=document.createElement("input")).type="hidden",n.name="pnr",n.value="2",i.appendChild(n)),Util.submitLoginForm(i,"_parent")}))},t.doUpload=function(t,r,i,o,a){if(isCurrentHostAllowedForInspection()){var s=new FormData,c=new XMLHttpRequest,d=new Blob([a],{type:"application/octet-stream"});i.pm_origin=encodeURIComponent(r),s.append("file",d,o),c.open("POST",window.location.origin+"/r/upload?"+makeURLParams(i)),c.withCredentials=!0,c.onload=function(t){n=null,e.postToController({kind:"upload-onload",result:[c.status,c.responseText]})},c.upload.onprogress=function(t){e.postToController({kind:"upload-onprogress",result:[t.loaded]})},c.onerror=function(){e.postToController({kind:"upload-onerror",result:[c.status]}),n=null},c.onabort=function(){n=null},l(r,c,window.location.origin,(function(){n=c,c.send(s),t()}))}else e.postToController({kind:"upload-onerror",result:[400]})},t.doUpload.is_async=!0,t.doUploadAbort=function(e){n&&n.abort&&n.abort()},t.doInspect=function(t,r,n,i,o){if(isCurrentHostAllowedForInspection()){var a=new XMLHttpRequest;r.pm_origin=encodeURIComponent(t),a.open("POST",window.location.origin+"/r/user_input?"+makeURLParams(r)),a.input_count=n,a.onload=function(t){200!==a.status||"MSIP_OK"!==a.responseText?e.postToController({kind:"inspect-onerror",result:[a.input_count,a.status,a.responseText]}):e.postToController({kind:"inspect-onsuccess",result:[a.input_count]})},a.onerror=function(){e.postToController({kind:"inspect-onerror",result:[a.input_count,a.status]})},a.setRequestHeader("Content-Type",o||"application/x-www-form-urlencoded"),a.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"),l(t,a,window.location.origin,(function(){a.send(i)}))}else e.postToController({kind:"inspect-onerror",result:[n,400,"",!0]})},t.setDebugFlag=function(e,t){window.DEBUG=t}}function CrossOriginFrameServer(e){var t,r=this,n=new Logger("cof-server",{level:"info"}),i=new RPCHandlers(r),o={getActiveCookie:i.getActiveCookie,setActiveCookie:i.setActiveCookie,setNidCookie:i.setNidCookie,getFeatureReport:i.getFeatureReport,setFeatureReport:i.setFeatureReport,setSurrogateInfo:i.setSurrogateInfo,setPAToken:i.setPAToken,getWSSupportState:i.getWSSupportState,setWSSupportState:i.setWSSupportState,doToksAuth:i.doToksAuth,doAuthCheck:i.doAuthCheck,doITok:i.doITok,doUpload:i.doUpload,doUploadAbort:i.doUploadAbort,doInspect:i.doInspect,setDebugFlag:i.setDebugFlag,generateKey:i.generateKey,doLoginPost:i.doLoginPost,doBounceAuth:i.doBounceAuth,getAuthTokens:i.getAuthTokens,fetchResource:i.fetchResource,xhrRequest:i.xhrRequest,xhrRequestAbort:i.xhrRequestAbort};function a(e){window.parent.postMessage(e,"*")}function s(e,t){a({kind:"call-result",call_id:e,result:t})}function l(){var e=Util.mpa_id_from_url(document.referrer);a({kind:"register-server",domain:location.hostname,surrogate_info:i.getSurrogateInfo(window.origin,e),pa_tok:i.getPAToken(window.origin)})}function c(e){var r,a,l,c,d=!1;if("register-ack"!==(r=e.data).kind){assert("call"===r.kind);try{l=r.call_args[0]}catch(t){return void reportWarnClientEvent("tc-cof-server-unexpected-message",{detail:e.data,error:t.toString()})}if(o.hasOwnProperty(l)){try{(c=r.call_args.slice(1)).unshift(e.origin),o[l].is_async&&c.unshift(s.curry(r.call_id)),a=o[l].apply(i,c)}catch(e){n.error({event:"tc-cof-rpc-exception",e:e.toString()}),a=null,d=!0}JSON.stringify(r.call_args),o[l].is_async&&!d||s(r.call_id,a)}else reportWarnClientEvent("tc-cof-server-unexpected-method",{method_name:l})}else clearInterval(t)}r.init=function(){Util.parseConfig(),r.perf=window.CLIENT_PERF,r.url_builder=new URLBuilder(r),r.event_reporter=new ClientEventReporter(r),r.xbrowser=new XBrowserHelpers,Util.getRawPageUrl=function(){return window.location.href},EventListener.addListener(window,"message",c,!1),l(),t=setInterval(l,200)},r.postToController=a}function BrowserVoodoo(e){function t(){setInterval((function(){var e,t;for(e in fidToIframeNode)fidToIframeNode.hasOwnProperty(e)&&(t=fidToIframeNode[e])&&t.contentDocument&&t.contentDocument.close()}),5e3)}"Chrome"===browser.name&&45===browser.version&&e.callback.registerOneShot("dom-loaded",6e3,{on_success:t,on_timeout:t})}function PolicySupport(e){this.getValues=function(t,r){var n={},i="/r/policy/query";n.url=Util.removePrefix(Util.getRawPageUrl()),n.policy_keys=t,n.transparent_mode=TPROXY_ENABLED,n.host=window.HOST,e.serverCall({op_name:"query_policy",url:e.url_builder.buildProtocolUrl(i),data:JSON.stringify(n),timeout:e.perf.xhr_timeout_ms+e.perf.pre_pair_xhr_ms,success:function(e){JSON.stringify(e),r(e)},error:function(e,t){reportClientEvent("tc-policy-query-failed",{status:t,xhr_status:e.status,request_url:i}),r({})}})},this.setAction=function(t,r,n,i,o){var a="/r/policy/"+t+(r?"?cid="+r:"");n&&(a+=(r?"&":"?")+"cl="+n),void 0===i&&(i={}),i.url=Util.removePrefix(Util.getRawPageUrl()),i.host=window.HOST,e.serverCall({op_name:"policy_action",action:t,cid:r,url:e.url_builder.buildProtocolUrl(a),data:JSON.stringify(i),success:function(e){o(e)},error:function(e,r){reportClientEvent("tc-policy-action-failed",{action:t,status:r,xhr_status:e.status,request_url:a}),o({})}})}}function HttpAlertSupport(e){var t,r,n,i=this,o=[],a="menlo-http-alert-css";function s(){var e,n,i=document.documentElement.clientWidth,o=r?r.offsetHeight:0,a=r?r.offsetWidth:0,s=Util.getTopWindowPosition(r),l=0,c=0;t&&"hide"!==t.style.display&&(e=t.offsetHeight,n=t.offsetWidth,s.x+a+n>i&&s.y+o/2-e/2>=1?(t.classList.remove("menlo-http-alert-bottom"),t.classList.add("menlo-http-alert-top"),l=s.x+a/2-n/2,(c=s.y-e-12)<1&&(t.classList.remove("menlo-http-alert-top"),t.classList.add("menlo-http-alert-bottom"),l=s.x+a/2-n/2,c=s.y+o+16)):(t.classList.remove("menlo-http-alert-top"),t.classList.remove("menlo-http-alert-bottom"),l=s.x+a+12,(c=s.y+o/2-e/2)<1&&(t.classList.remove("menlo-http-alert-top"),t.classList.add("menlo-http-alert-bottom"),l=s.x+a/2-n/2,c=s.y+o+16)),t.style.left=l+"px",t.style.top=c+"px")}function l(){r=null,t&&(t.style.display="none")}function c(e){t&&(r=e.target,t.style.display="block",s())}function d(){var i;for(t&&t.parentNode.removeChild(t),n&&e.callback.deregister(n),i=0;i<o.length;i+=1)EventListener.removeListener(o[i],"focus",c),EventListener.removeListener(o[i],"blur",l);r&&r.focus(),t=null,r=null,n=null,o=[]}function u(r,n,i,s){var u,f,p,g;Util.is_element_input_text(n)&&(t||(document.getElementById(a)||document.head.appendChild((f="/safeview-static/css/http-alert.css",p=e.url_builder.buildAssetURL(f),(g=document.createElement("link")).type="text/css",g.id=a,g.rel="stylesheet",g.href=p,g.media="all",g)),document.body.insertAdjacentHTML("beforeend",e.template.get("http-alert-template")),u=document.getElementById("menlo-http-alert-close"),EventListener.addListener(u,"mousedown",d),(t=document.getElementById("menlo-http-alert")).classList.add("menlo-http-alert-hidden"),t.style.display="none"),EventListener.addListener(n,"focus",c),EventListener.addListener(n,"blur",l),o.push(n))}i.configHttpAlert=function(t){!window.TPROXY_ENABLED&&t.client_caps&&t.client_caps.insecure_form_warning&&!t.secure_backend&&(n=e.callback.register("add-element",u))},i.update=function(){t&&s()},i.dismiss=function(){d()}}function LEchoErrorAlert(e){var t,r,n,i,o="menlo-mismatch-alert-css";function a(){var e,n,i=document.documentElement.clientWidth,o=r?r.offsetHeight:0,a=r?r.offsetWidth:0,s=Util.getTopWindowPosition(r),l=0,c=0;t&&"none"!==t.style.display&&(e=t.offsetHeight,n=t.offsetWidth,s.x+a+n>i&&s.y+o/2-e/2>=1?(t.classList.remove("menlo-mismatch-alert-bottom"),t.classList.add("menlo-mismatch-alert-top"),l=s.x+a/2-n/2,(c=s.y-e-12)<1&&(t.classList.remove("menlo-mismatch-alert-top"),t.classList.add("menlo-mismatch-alert-bottom"),l=s.x+a/2-n/2,c=s.y+o+16)):(t.classList.remove("menlo-mismatch-alert-top"),t.classList.remove("menlo-mismatch-alert-bottom"),l=s.x+a+12,(c=s.y+o/2-e/2)<1&&(t.classList.remove("menlo-mismatch-alert-top"),t.classList.add("menlo-mismatch-alert-bottom"),l=s.x+a/2-n/2,c=s.y+o+16)),t.style.left=l+"px",t.style.top=c+"px")}function s(){t&&t.parentNode.removeChild(t),i&&e.callback.deregister(i),n(),n=null,r&&r.focus(),t=null,r=null,i=null}function l(r,n,i,a){var l,c,d,u;Util.can_element_use_lecho(n)&&document.body&&(t||(document.getElementById(o)||document.head.appendChild((c="/safeview-static/css/mismatch-alert.css",d=e.url_builder.buildAssetURL(c),(u=document.createElement("link")).type="text/css",u.id=o,u.rel="stylesheet",u.href=d,u.media="all",u)),document.body.insertAdjacentHTML("beforeend",e.template.get("mismatch-alert-template")),l=document.getElementById("menlo-mismatch-alert-close"),EventListener.addListener(l,"mousedown",s),(t=document.getElementById("menlo-mismatch-alert")).classList.add("menlo-mismatch-alert-hidden"),t.style.display="none"))}function c(){setTimeout((function(){r&&t&&"none"!==t.style.display&&(r.parentNode?(a(),c()):s())}),500)}this.config_alert=function(t){t&&(i=e.callback.register("add-element",l))},this.add_alert_for_input=function(e,i,o){var s=getNodeByUid(e,i);local_echo_config.show_alert?s&&Util.can_element_use_lecho(s)&&(reportClientEvent("tc-lecho-bubble-alert",{},!0,!1),n=o,function(e,n){(r=getNodeByUid(e,n))&&t&&(t.style.display="block",a())}(e,i),c(),DEBUG&&(s.style.background="aqua",s.style.border="solid",s.style.borderColor="red")):reportClientEvent("tc-lecho-bubble-alert",{skipped:!0},!0,!1)}}function PreloadIndicator(e){var t=this,r=[];function n(){var t,n,i,o;r.length>0||(r.push(document.head.appendChild((n="/safeview-static/css/loader.css",i=e.url_builder.buildAssetURL(n),(o=document.createElement("link")).type="text/css",o.id="menlo-loader-css",o.rel="stylesheet",o.href=i,o.media="all",o))),(t=document.createElement("div")).id="menlo-loader-spinner",t.className="menlo-loader-spinner",r.push(document.body.appendChild(t)),(t=document.createElement("div")).id="menlo-loader-info",t.className="menlo-loader-info",r.push(document.body.appendChild(t)))}t.configPreloadIndicator=function(e){e.client_caps&&e.client_caps.preload_indicator&&n()},t.showPreloadIndicator=function(){n()},t.dismiss=function(){!function(){var e;for(e=r.length-1;e>=0;e-=1)r[e]&&r[e].parentNode&&r[e].parentNode.removeChild(r[e]);r=[]}()}}function ReadonlySupport(e){var t,r=this,n=!1,i=e.url_builder.buildAssetURL("/safeview-static/images/logo.png"),o={ro:{hidden:!1,has_banner:!1,hide_class:" safemail-banner-hidden",div_id:"safemail-readonly-banner",button_id:"safemail-disable-btn",logo_id:"safemail-logo",hide_id:"safemail-hide",div:null,template:"ro-banner-template",css:"/safeview-static/css/readonly.css",css_id:"__safly_ro_css_id",css_link:null},bw:{hidden:!1,has_banner:!1,hide_class:" bandwidth-banner-hidden",div_id:"bandwidth-banner",button_id:"bandwidth-disable-btn",logo_id:"bandwidth-logo",hide_id:"bandwidth-hide",div:null,template:"bw-banner-template",css:"/safeview-static/css/bandwidth.css",css_id:"__safly_bw_css_id",css_link:null},isolation:{hidden:!1,has_banner:!1,hide_class:" isolation-banner-hidden",div_id:"isolation-banner",button_id:"isolation-disable-btn",btn_hide_class:" isolation-hidden",logo_id:null,hide_id:"isolation-hide",div:null,template:"custom-indicator-template",css:"/safeview-static/css/isolation.css",css_id:"__safly_ro_css_id",css_link:null}},a={};function s(){return"read_only"===Util.persistentPolicy().entry_action}function l(t){o[t].div.className.indexOf(o[t].hide_class)<0?(o[t].hidden=!0,o[t].div.className+=o[t].hide_class):(o[t].hidden=!1,o[t].div.className=o[t].div.className.replace(o[t].hide_class,"")),"ro"===t&&e.surrogate_channel.send("banner_hidden",o[t].hidden)}function c(){Util.persistentPolicy().exit_url,e.surrogate_channel.send("readonly-mode-relax")}function d(e){o[e].div&&(o[e].div.parentNode.removeChild(o[e].div),o[e].div=void 0),o[e].css_link&&(document.head.removeChild(o[e].css_link),o[e].css_link=void 0),o[e].has_banner=!1}function u(){var t=Util.persistentPolicy(),r=e.tab_store.load();t.upgrade_action,d("ro"),e.policy.setAction("readonly_exit",r.cid,r.cluster_id,{safe_rid:r.safe_rid,tab_id:r.tab_id,exit_mode:t.upgrade_action,persistent_policy:t},c)}function f(t){if("bw"===t)return d(t),void e.surrogate_channel.send("bandwidth-acknowledge");if("isolation"!==t){var r=Util.persistentPolicy();"coach"===r.user_experience_banner&&r.explain&&r.explain.length>0?e.ui_frame.call("showCoachModeModal",r.explain,e.pairing_dict.customization,r.exit_url?u:null,s(),r.upgrade_action):u()}else e.feedback_bar.onBypassClick()}function p(n){var a,c=e.pairing_dict.customization,d=Util.persistentPolicy();document.body.insertAdjacentHTML("beforeend",e.template.get(o[n].template)),o[n].logo_id&&(document.getElementById(o[n].logo_id).src=i),c&&("ro"===n?e.ux.customizeBanner(function(){var e=Util.persistentPolicy();return{explain:e.explain,experience_mode:e.user_experience_banner}}(),c,s(),d.upgrade_action,d.exit_url,d.user_experience_banner_custom_text):"bw"===n&&(e.ux.customizeBandwidthBanner(c),e.ux.customizeBandwidthBannerText(c,o.bw.exceed))),t=document.getElementById(o[n].button_id),EventListener.addListener(t,"click",f.curry(n)),"isolation"===n&&e.feedback_bar.getBypassPolicy()&&r.showBypassSecurity(),o[n].div=document.getElementById(o[n].div_id),a=document.getElementById(o[n].hide_id),EventListener.addListener(a,"click",l.curry(n)),o[n].hidden&&(o[n].div.className+=o[n].hide_class)}function g(t){o[t].has_banner||document.getElementById(o[t].div_id)?"bw"===t&&e.ux.customizeBandwidthBannerText(e.pairing_dict.customization,o.bw.exceed):(Util.ensureElementPresent("head"),Util.ensureElementPresent("body"),document.head.appendChild(function(t,r,n){var i=e.url_builder.buildAssetURL(t),a=document.createElement("link");return a.type="text/css",a.rel="stylesheet",a.href=i,a.id=o[n].css_id,o[n].css_link=a,EventListener.addListener(a,"load",r),a}(o[t].css,p.curry(t),t)),o[t].has_banner=!0)}function m(){switch(a.action){case"warn":case"exceed":o.bw.exceed="exceed"===a.action,a.acknowledge?d("bw"):g("bw");break;case"allow":d("bw");break;case"block":d("bw"),e.media_objects.stopAllMedia()}}r.showBypassSecurity=function(){var e;document.getElementById(o.isolation.button_id)&&((e=document.getElementById(o.isolation.button_id).parentNode).className=e.className.replace(o.isolation.btn_hide_class,""))},r.configBanners=function(){r.isShowingBanner()&&(o.ro.hidden=e.pairing_dict.banner_hidden,n?g("ro"):e.callback.registerOneShot("dom-loaded",0,{on_success:g.curry("ro")})),e.feedback_bar.updateReadonlyUI(),e.template.has(o.isolation.template)&&(n?g("isolation"):e.callback.registerOneShot("dom-loaded",0,{on_success:g.curry("isolation")}))},r.isShowingBanner=function(){var e=Util.persistentPolicy();return!__startswith(Util.getRawPageUrl(),"http://doc/")&&(("read_only"===e.entry_action||"read_write"===e.entry_action)&&"none"!==e.user_experience_banner)},r.isShowingReadonlyBanner=function(){var e=Util.persistentPolicy();return!__startswith(Util.getRawPageUrl(),"http://doc/")&&("read_only"===e.entry_action&&"none"!==e.user_experience_banner)},r.allow_tab_creation=function(){return!s()},e.callback.register("dom-loaded",(function(){n=!0,r.configBanners()})),e.callback.register("dom-init",(function(t,r,i,o){a=o,n?m():e.callback.registerOneShot("dom-loaded",0,{on_success:m})})),e.interp.registerOpcodeHandler("bandwidth_action",(function(t,r){a={action:t,acknowledge:r},n?m():e.callback.registerOneShot("dom-loaded",0,{on_success:m})}))}function FrameLoader(e){var t=this;function r(e,t){assert(Util.is_frame_owner(t)),t.__timeoutId&&(clearTimeout(t.__timeoutId),t.__timeoutId=null)}function n(i,a,s,l,c){var d=a.contentWindow;if(void 0===c&&(r(0,a),c=0),a.src,c+=1,d&&d.document&&d.document.documentElement&&(o(a)||d.document.documentElement.getAttribute("tc-nonce")===s))l();else{if(void 0===e.perf.max_nr_load_checks)throw new Error("Invalid max_nr_load_checks value.");c>e.perf.max_nr_load_checks?(e.update_queue.discard(i),e.callback.fire("tc-frame-load-timed-out",i,c,s)):a.__timeoutId=setTimeout((function(){a.__timeoutId=null,n(i,a,s,l,c)}),t.FRAME_LOAD_CHECK_INTERVAL_MS)}}function i(e,t){assert(Util.is_frame_owner(e)),e.__sv_is_ready_for_updates=!!t}function o(e){return"object"===e.localName&&BrowserDetect.isSafari()}function a(t,r,a){var s=getFrameFidByNode(t),l=(getUidByNode(t),getFidByNode(t),__randstr(8));assert(s),assert(Util.is_frame_owner(t)),assert("string"==typeof r),function(e,t,r,n){e.__frame_helper_poller&&e.__frame_helper_poller.stop(),e.__frame_helper_poller=new Poller({max_nr_polls:500,poll_interval_ms:100,cond_func:function(){return!!e.contentWindow&&!!e.contentDocument&&"complete"===e.contentDocument.readyState},success_cb:function(){if(assert(e.contentWindow),e.__frame_helper_poller=null,i(e,!1),!o(e)){var a=window.location.toString();Util.locationReplace(e.contentWindow,Util.getIframeHelperURL(t,r,n,a))}},timeout_cb:function(){reportErrorClientEvent("tc-frame-helper-load-timed-out",{current_src:e.src,readyState:e.readyState})}}),e.__frame_helper_poller.start()}(t,r,l,s),n(s,t,l,(function(){var n=t.contentWindow;assert(n),o(t)||Util.getDoctypeDecl(n)===r||reportWarnClientEvent("tc-doctype-load-mismatch",{expected:r,actual:Util.getDoctypeDecl(n)}),setFidToWindow(n,s),setFidToIframe(t,s),i(t,!0),e.update_queue.deliver(s,e.interpretQueued),e.callback.fire("frame-ready-for-updates")}))}t.FRAME_LOAD_CHECK_INTERVAL_MS=100,e.callback.register("tc-frame-load-timed-out",(function(e,t,r){reportErrorClientEvent("tc-frame-load-timed-out",{fid:e,nr_polls:t,nonce:r})})),t.isFrameReadyForUpdates=function(e){var t=getIframeByFid(e);return t&&t.__sv_is_ready_for_updates},e.interp.registerOpcodeHandler("set_doctype",(function(t,r,n,s,l,c,d){var u;l?Util.getDoctypeDecl(window)!==s&&((u=e.tab_store.load()).is_pending_doctype_correction=!0,e.tab_store.save(u),e.finish(),Util.xframe_reload()):function(t,r){var n=null,i=null;function o(){var o,a,s=getNodeByFrameFid(t);return!!s&&(o=s.fid,e.frameset_wrapper&&(o=e.frameset_wrapper.map_fid_if_necessary(o)),!!(a=getNodeByUid(o,s.uid))&&(n&&e.callback.deregister(n),i&&e.callback.deregister(i),r(a),!0))}o()||(n=e.callback.register("frame-attached",o),i=e.callback.register("frame-node-inserted",o))}(t,(function(e){(Util.is_frame_node(e)||"object"===e.localName)&&("object"===e.localName&&(e.data="about:blank",e.type=c,e.__sv_frame_owner=!0,i(e,!1)),o(e)?function(e,t,r){EventListener.addListener(e,"load",(function r(){a(e,t),EventListener.removeListener(e,"load",r)}))}(e,s):a(e,s))}))})),e.callback.register("frame-node-removed",(function(t,n){r(0,n),e.update_queue.discard(t)}))}function FramesetWrapper(e,t,r,n){var i,o=t.document,a=__randstr(8),s="pending",l="sv-wrapper-fid",c="sv-wrapper-uid",d=this;function u(e,t,r){var n,i=getFidByNode(t),o=getUidByNode(t);9===t.nodeType?setNodeInMap(r,e.document,o,i):1!==t.nodeType&&3!==t.nodeType||getUidByNode(t)===c?Util.get_node_tag(t):(setNodeInMap(r,n=t.cloneNode(!1),o,i),Util.get_node_tag(n))}function f(e,t){var n,i,o,a={},s=getNodeMapForFrame(r);for(i in s)s.hasOwnProperty(i)&&(u(t,o=s[i],a),9===o.nodeType&&(n=o));return function(e,t){for(var r,n,i,o,a,s,l,d=[e];d.length;)for(l=getUidByNode(n=d.shift()),r=0;r<n.childNodes.length;r+=1)(s=getUidByNode(i=n.childNodes[r]))&&s!==c&&(o=t[s],9===(a=t[l]).nodeType&&a.documentElement&&a.removeChild(a.documentElement),a.appendChild(o)),d.push(i)}(n,a),a}d.uninstall_event_listeners=function(){var t=i.contentWindow;e.local_events.uninstall_event_listeners(t,t.document)},d.is_pending=function(){return"pending"===s},d.map_fid_if_necessary=function(e){return isTopFrameFid(e)&&"ready"===s?l:e},d.get_original_fid=function(e){return e===l?r:e},function(e){var t,n=o.documentElement;if(!n)return reportWarnClientEvent("tc-dom-frameset-error",{error:"Missing html node."}),void(s="error");n.style.setProperty("margin","0","important"),n.style.setProperty("padding","0","important"),n.style.setProperty("height","100%","important"),n.style.setProperty("overflow","hidden","important"),o.body?reportWarnClientEvent("tc-dom-frameset-error",{error:"There should not be a body element in frameset document."}):(t=o.createElement("body"),n.appendChild(t)),(t=o.body).style.setProperty("margin","0","important"),t.style.setProperty("padding","0","important"),t.style.setProperty("height","100%","important"),t.style.setProperty("overflow","hidden","important"),(i=o.createElement("iframe")).setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("frameborder","0"),i.setAttribute("src",Util.getIframeHelperURL("<!DOCTYPE html>",e)),i.style.setProperty("position","absolute","important"),i.style.setProperty("left","0px","important"),i.style.setProperty("right","0px","important"),i.style.setProperty("bottom","0px","important"),i.style.setProperty("top","0px","important"),setNodeIds(i,c,r),t.appendChild(i)}(a),new Poller({max_nr_polls:100,poll_interval_ms:100,cond_func:Util.isIframeReady.curry(i,a),success_cb:function(){var t,r=i.contentWindow;try{t=f(0,r)}catch(e){return reportWarnClientEvent("tc-dom-frameset-error",{error:"Failed to replicate nodes from top frame.",exception:e.toString()}),s="error",void n()}s="ready",e.local_events.install_event_listeners(r,r.document,!1),setNodeMapForFrame(l,t),setFidToWindow(r,l),n()},timeout_cb:function(){s="error",reportWarnClientEvent("tc-dom-frameset-error",{error:"Frameset wrapper frame failed to load."})}}).start()}function UX(e,t){var r,n=this,i=new Logger("ux",{level:"info"}),o="safemail-readonly-banner",a="safemail-disable-btn",s="safemail-banner-",l=e.url_builder.buildAssetURL("/safeview-static/images/logo.png"),c={arial:"Arial, Helvetica, sans-serif",georgia:"Georgia, serif",gotham:'Gotham, "Helvetica Neue", Helvetica, Arial, sans-serif',helvetica:'"Helvetica Neue", Helvetica, Arial, sans-serif',lucida:'"Lucida Sans Unicode", "Lucida Grande", sans-serif',tahoma:"Tahoma, Geneva, sans-serif",times:'"Times New Roman", Times, serif',verdana:"Verdana, Geneva, sans-serif"};function d(e,r,n){var o,a,s;function l(e,r){for(var n,i,o=!1,a=e.length;r.firstChild;)r.removeChild(r.firstChild);for(n=0;n<a;n+=1)(i=t.createElement(o?"strong":"span")).textContent=e[n],r.appendChild(i),o=!o}function c(e,r){for(var n;r.firstChild;)r.removeChild(r.firstChild);(n=t.createElement("span")).textContent=e[1],r.appendChild(n)}if(o=t.getElementById("ro-ux-"+e)){for(a in r)r.hasOwnProperty(a)&&((s=t.getElementById("ro-ux-"+e+"-"+a))?r[a].hasOwnProperty("type")?"array"===r[a].type&&r[a].val?s.textContent=r[a].val.join(", "):reportWarnClientEvent("tc-ux-unknown-type",{type:r[a].type}):"phishTarget-short"===e?c(r[a],s):l(r[a],s):i.info({event:"tc-ux-no-placeholder",id:"ro-ux-"+e+"-"+a}));t.getElementById(n).appendChild(o)}else reportWarnClientEvent("tc-ux-no-template",{id:"ro-ux-"+e})}function u(e,t){return function(r,n){var i,o;if(!(n&&t.indexOf(n)<0)){for(o=r.className,i=0;i<t.length;i+=1)o=o.replace(e+t[i],"");o=o.replace(/ {2}/g," "),r.className=o+" "+e+n}}}function f(e,t){e.textContent=t}function p(e){return function(t,r){t.setAttribute(e,r)}}function g(e){return e.replace(/[<>"\/]/gim,"")}function m(e){return e.replace(/[<>"]/gim,"")}function _(e){return __startswith(e,"http://")||__startswith(e,"https://")?encodeURI(e):""}function h(e){return e.match(/^\#[0-9a-fA-F]{3}$/)||e.match(/^\#[0-9a-fA-F]{6}$/)?e:""}function y(e){var t=e.split(";"),r=t[0].split("/");return 2===t.length&&2===r.length&&"data:image"===r[0]&&__startswith(t[1],"base64,")&&["gif","png","jpeg","svg+xml"].indexOf(r[1])>=0?e:""}function v(e){var t,n=e.split("."),i=r;for(t=0;t<n.length;t+=1){if(!i||!i.hasOwnProperty(n[t]))return"";i=i[n[t]]}return i}function k(e,r,n,i){var o=t.getElementById(e),a=v(r);!o||!a&&r||n(o,a=i?i(a):a)}function S(e,r,n){var i;(i=t.getElementById("UX-INLINE-STYLE-SHEET"))||((i=t.createElement("style")).id="UX-INLINE-STYLE-SHEET",t.head.appendChild(i)),i.innerHTML+="."+e+" {"+r+": "+n+" !important;}"}function b(e,t,r,n){var i=v(r);i&&S(e,t,i)}function w(e){return e?"read_only_banner.":"read_write_banner."}function C(e,t){return e&&"read_write"===t?w(e)+"exit_action.read_write.":"direct"===t?w(e)+"exit_action.direct.":w(e)+"exit_action.not_allowed."}n.getIndicatorType=function(e){return(e.content||{}).indicator_type||"regular"},n.customizeBanner=function(e,n,i,l,c,m){var h,T=w(i),E=C(i,l),A=e&&e.explain&&e.explain.length>0&&("coach"===e.experience_mode||"educate"===e.experience_mode),R=m&&m.length>0&&"custom"===e.experience_mode;if(r=n,k(o,"banner_theme",u(s,["white","yellow","red"]),g),k(o,T+"css.banner_type",u(s,["wide","regular"]),g),b("safemail-background","background",T+"css.background_color"),k(o,T+"css.font_family",u("safemail-font-",["arial","georgia","gotham","helvetica","lucida","tahoma","times","verdana"]),g),k("safemail-logo",T+"logo_icon.base64_img",p("src"),y),v(T+"logo_icon.link")&&k("safemail-logo-link",T+"logo_icon.url",p("href"),_),b("safemail-link","color",T+"css.link_color"),k("safemail-main-text",E+"banner_text",f),b("safemail-text","color",T+"css.text_color"),b("safemail-border","border-color",T+"css.border_color"),v(T+"custom_link.show_link")&&v(T+"custom_link.link_url").length>7&&(k("safemail-policy","",u("",["safemail-hidden"]),g),k("safemail-policy-link",T+"custom_link.link_text",f),k("safemail-policy-link",T+"custom_link.link_url",p("href"),_)),c||A?(k(o,T+"css.button_type",u("safemail-",["outline","regular"]),g),c?k(a,E+"button_label",f):t.getElementById(a).textContent="Details",b("safemail-button","color",T+"css.button_text_color"),b("safemail-button","background-color",T+"css.button_background_color"),b("safemail-button","border-color",T+"css.button_border_color")):t.getElementById(a).style.display="none",R)f(t.getElementById("safemail-details-0"),m),S("safemail-details","font-weight","bold"),k("safemail-details","",u("",["safemail-hidden"]));else if(A){for(h=0;h<e.explain.length&&h<3;h+=1)d(e.explain[h].factor_name+"-short",e.explain[h].attributes,"safemail-details-"+h);k("safemail-details","",u("",["safemail-hidden"]))}},n.customizeCoachModeModal=function(e,n,i,o,a){var s;if(r=n,e)for(s=0;s<e.length&&s<3;s+=1)d(e[s].factor_name,e[s].attributes,"coach-mode-modal-body");k("coach-mode-modal","warning_modal_theme",u("",["white","yellow","red"]),g),k("coach-mode-modal-body","warning_modal.modal_text",f),b("coach-mode-text","color","warning_modal.css.text_color"),b("coach-mode-button-1","color","warning_modal.css.button_one_text_color"),b("coach-mode-button-1","background-color","warning_modal.css.button_one_background_color"),b("coach-mode-button-1","border-color","warning_modal.css.button_one_border_color"),k("coach-mode-cancel","warning_modal.css.button_one_type",u("",["outline"]),g),b("coach-mode-button-2","color","warning_modal.css.button_two_text_color"),b("coach-mode-button-2","background-color","warning_modal.css.button_two_background_color"),b("coach-mode-button-2","border-color","warning_modal.css.button_two_border_color"),k("coach-mode-proceed","warning_modal.css.button_two_type",u("",["outline"]),g),v("warning_modal.logo_icon.base64_img")?k("coach-mode-logo","warning_modal.logo_icon.base64_img",p("src"),y):t.getElementById("coach-mode-logo").src=l,v("warning_modal.logo_icon.link")&&k("coach-mode-logo-link","warning_modal.logo_icon.url",p("href"),_),k("coach-mode-modal","warning_modal.css.font_family",u("font-",["arial","georgia","gotham","helvetica","lucida","tahoma","times","verdana"]),g),b("custom-highlight strong","color","warning_modal.css.highlight_color"),i?(t.getElementById("coach-mode-cancel").setAttribute("class","hide"),t.getElementById("coach-mode-proceed").textContent="OK"):k("coach-mode-proceed",C(o,a)+"button_label",f)},n.customizeFeedbackBar=function(e,t,n,i,o,a,s,l,d){var _,w,C;r=e,b(t,"background","css.background_color"),e.css&&e.css.border_color&&(S(t,"border-left",_=h(e.css.border_color)+" 1px solid"),S(t,"border-right",_),S(t,"border-top",_)),b(t,"color","css.text_color"),b(t+" > *","color","css.text_color"),b(t+" > #__safly_feedback_arrow_down.__safly_arrow_down","border-top-color","css.text_color"),(w=v("css.font_family"))&&(C=c[w])&&S(t+" > div","font-family",C),k(o,"logo_icon.base64_img",p("src"),y),k(n,d&&!BrowserDetect.isMobile()?"readonly_indicator.text":"readonly_indicator.iframe_text",f,m),k(n,"readonly_indicator.tooltip",p("data-tooltip"),g),k(i,"bypass_indicator.text",f,g),k(i,"bypass_indicator.tooltip",p("data-tooltip"),g),k(l,"isolate_indicator.tooltip",p("data-tooltip"),g),k(t,"content.indicator_type",u("__safly_",["wide","regular"]),g),k(s,"isolate_indicator.text",f,g),k(a,"custom_link.link_url",p("href"),m),k(a,"custom_link.link_text",f,g)},n.customizeBandwidthBanner=function(e){var t="bandwidth-banner",n="bandwidth-banner-";r=e,k(t,"bandwidth.theme",u(n,["white","yellow","red"]),g),e.bandwidth&&e.bandwidth.content&&!e.bandwidth.content.use_custom_styling||(k(t,"bandwidth.css.banner_type",u(n,["wide","regular"]),g),b("bandwidth-background","background","bandwidth.css.background_color"),k(t,"bandwidth.css.font_family",u("bandwidth-font-",["arial","georgia","gotham","helvetica","lucida","tahoma","times","verdana"]),g),k("bandwidth-logo","bandwidth.logo_icon.base64_img",p("src"),y),b("bandwidth-text","color","bandwidth.css.text_color"),b("bandwidth-border","border-color","bandwidth.css.border_color"),k("bandwidth-banner","bandwidth.css.button_type",u("bandwidth-",["outline"]),g),b("bandwidth-button","color","bandwidth.css.button_text_color"),b("bandwidth-button","background-color","bandwidth.css.button_background_color"),b("bandwidth-button","border-color","bandwidth.css.button_border_color"))},n.customizeBandwidthBannerText=function(e,t){r=e;var n=t?"bandwidth.bandwidth_limit_alert":"bandwidth.bandwidth_usage_alert";k("bandwidth-main-text",n+".text",f),k("bandwidth-disable-btn",n+".label_acknowledgement_text",f)}}function SheetLoader(e){var t,r,n,i,o={},a=null,s=!1,l=!1;function c(){return 0===Object.keys(o).length}function d(){var e;for(e in o)if(o.hasOwnProperty(e)&&"done"!==o[e].state)return!1;return!(l&&!i)}function u(r){Date.now(),t&&(t.parentNode&&t.parentNode.removeChild(t),t=null,e.text_monitor.resume_all()),o={},a&&(clearTimeout(a),a=null),s=!0}function f(e,t){var r,n=getUidByNode(e);s||((r=o[n]).state="done",r.success=t,r.elapsed_ms=Date.now()-r.start_time,d()&&e.ownerDocument.body&&u("all-sheets-complete"))}function p(e,t){return"link"===t&&e.rel&&"stylesheet"===e.rel.toLowerCase()&&function(e){var t=e,r=e.ownerDocument;for(assert(r.documentElement);t&&t!==r.documentElement;){if(t===r.head)return!0;t=t.parentNode}return!1}(e)}function g(n,i,l,g){var m=i.ownerDocument;if(n===window.top)if("body"===l){if(assert(m.body),i.getRootNode&&i.getRootNode()!==window.document)return;!d()||c()?function(r){e.text_monitor.pause_all(),Date.now(),r.head||e.feedback_bar.addHeadNode(r),(t=r.createElement("style")).appendChild(r.createTextNode("body { visibility: hidden !important; }")),r.head.appendChild(t),a=setTimeout((function(){a=null,u("timeout")}),3e3)}(m):s=!0,c()||(assert(r),assert(e.callback.deregister(r)),r=null)}else p(i,l)&&function(e){var t=getUidByNode(e);o[t]={state:"pending",start_time:Date.now()},EventListener.addListener(e,"load",(function(){f(e,!0)})),EventListener.addListener(e,"error",(function(){f(e,!1)}))}(i)}function m(){r&&(assert(e.callback.deregister(r)),r=null),assert(n),assert(e.callback.deregister(n)),n=null,s||c()&&u("dom-loaded")}this.set_dom_resync_completed=function(){i=!0,s||d()&&u("resync-complete")},this.reset=function(){l=!0,i=!1,s=!1,o={},t=null,a&&(clearTimeout(a),a=null),r&&assert(e.callback.deregister(r)),n&&assert(e.callback.deregister(n)),r=e.callback.register("add-element",g),n=e.callback.register("dom-loaded",m)},r=e.callback.register("add-element",g),n=e.callback.register("dom-loaded",m),s=!1}function SurrogateView(e){var t,r=this,n=new Logger("surrogate-view",{level:"info"}),i=new KeyMap,o=!1;function a(){var t=!1;o||(o=!0,e.compositor&&e.compositor.getConfig()&&(t=e.compositor.getConfig().retainTextMetrics()),e.surrogate_channel.send("get-screenshot",!DEBUG,1,t))}function s(e){try{return!e.document||e.closed}catch(e){return!0}}function l(t){e.surrogate_channel&&e.surrogate_channel.send.apply(e.surrogate_channel,t)}function c(t){t.type,t.clientX,t.clientY,Util.getMouseAndKeyboardModifiers(t,n),t.button,Util.get_node_tag(t.target),e.fid&&(l(["CM-mouse",e.fid,t.type,t.clientX,t.clientY,t.clientX,t.clientY,t.button,Util.getMouseAndKeyboardModifiers(t,n),t.detail]),"mousedown"!==t.type&&"mouseup"!==t.type||t.preventDefault())}function d(t){var r=i.getKeyCode(t);t.type,t.keyCode,e.fid&&l(["kbd",e.fid,0,t.type,t.keyCode,t.charCode,r,i.getCode(t),t.shiftKey,t.ctrlKey,t.altKey,t.metaKey,0,!1])}function u(t){var r=Math.round(t.deltaX),i=Math.round(t.deltaY),o=void 0===t.wheelDeltaX?-3*r:t.wheelDeltaX,a=void 0===t.wheelDeltaY?-3*i:t.wheelDeltaY;e.fid&&(l(["CM-wheel",e.fid,t.clientX,t.clientY,t.clientX,t.clientY,r,i,o,a,!0,Util.getMouseAndKeyboardModifiers(t,n)]),t.preventDefault())}function f(){r.stop("child unloaded")}function p(e){var r=e?EventListener.addListener:EventListener.removeListener;t&&(r(t.document,"mousemove",c,!1),r(t.document,"mousedown",c,!1),r(t.document,"mouseup",c,!1),r(t.document,"keydown",d,!1),r(t.document,"keypress",d,!1),r(t.document,"keyup",d,!1),r(t.document,"wheel",u,!1),r(t,"beforeunload",f,!1))}r.surrogate_screenshot=null,r.stop=function(r){e.pairing_dict.surrogate_view_active=!1,e.pairing.savePairingState(e.pairing_dict),o=!1,t&&(p(!1),s(t)||t.close(),t=null)},r.start=function(r){if(e.pairing_dict.surrogate_view_active=!0,e.pairing.savePairingState(e.pairing_dict),!(t=t&&!s(t)?t:Util.windowOpen("","sv_view_"+e.pairing_dict.tab_id)))return n.error({event:"surrogate-view-start-failed",reason:"cannot get window handle, popup denied?"}),t;try{i=t.document,o=i.createElement("meta"),i.title="Surrogate: "+document.title,o.setAttribute("name","viewport"),o.setAttribute("content","width=device-width"),i.head.appendChild(o),i.body.style.margin="0px",i.body.style.padding="0px"}catch(e){return void n.error({event:"surrogate-view-start-failed",reason:"init child failed, security violation?"})}var i,o;p(!0),e.surrogate_channel.send("disable-hiding"),a()},e.interp.registerOpcodeHandler("screenshot",(function(e,i){var l;r.surrogate_screenshot=e,t&&!s(t)?o?(o=!1,l=function(){var r,n,o,s,l;r=(i?"data:image/jpeg;base64,":"data:image/png;base64,")+e,(o=t?t.document:null)&&o.body&&((n=o.getElementById("view"))||((n=o.createElement("img")).id="view",o.body.appendChild(n)),n.src=r,n.style.width=MetricsUtils.getVisualViewportMetrics().width+"px",n.style.height=MetricsUtils.getVisualViewportMetrics().height+"px"),s=function(){a()},l=40,BrowserDetect.isIE()?setTimeout(s,l):t&&t.setTimeout(s,l)},BrowserDetect.isIE()?l():t.requestAnimationFrame(l)):n.warn({event:"unexpected-frame",action:"drop"}):r.stop("tab connection lost?")})),e.callback.register("surrogate-channel-connected",(function(t){e.pairing_dict.surrogate_view_active&&t&&(o=!1,r.start("resume after navigation"))}))}function PrintHandler(e){var t,r=this,n=0,i=!!document.attachEvent,o=!1,a=BrowserDetect.isMobileSafari(),s=null,l=!1,c=!1,d={},u=!1,f=null,p=!1,g=!1,m=null;function _(){return a?"print_pdf":r.shouldDownloadPdf()?null:"print-preview-iframe"}function h(e){var t=e||window.event;if(r.isPrintEnabled()&&80===t.keyCode&&t.ctrlKey)return t.keyCode=0,!1}function y(){var t;r.isPrintEnabled()&&(t=BrowserDetect.isMobile()?e.localization.get("ID_PRINT_ALERT_MOBILE_TEXT"):BrowserDetect.isMac()?e.localization.get("ID_PRINT_ALERT_MAC_TEXT"):e.localization.get("ID_PRINT_ALERT_TEXT"),r.isPrintPending()||e.ui_frame.call("showPrintAlert",t,e.localization.get("ID_PRINT_ALERT_TITLE")))}function v(){r.isPrintEnabled()&&(r.isPrintPending()||BrowserDetect.isIE()||BrowserDetect.isEdge()||BrowserDetect.isMobile()||(e.ui_frame.call("dismissPrintAlert"),window.focus(),document.body.focus()))}function k(){m&&(m(),m=null)}function S(t,n,i,o,a){var s;o||g?(s=w.curry(t,o),m=s,r.setPrintEnabled(i),Util.getDocIdIfSafedocs()?r.handlePrint():n?e.download.emulateIframePrint(t,k,!0):i?(r.setPrintFid(t),e.ui_frame.call("showPrintOptions")):a>0?setTimeout(b.curry(t),1e3*a):b(t)):setTimeout(S.curry(t,n,i,o,a),50)}function b(e){var t=getWindowByFid(e);t&&t.print(),k()}function w(t,r){r&&e.surrogate_channel.send("unblock-print",t)}function C(){g=!0}function T(){k()}r.shouldDownloadPdf=function(){return Util.isPdfViewerDisabled()||BrowserDetect.isIE()||BrowserDetect.isEdge()||BrowserDetect.isAndroidChrome()},r.setPrintFid=function(e){n=e},r.setPrintPending=function(e){l=e},r.isPrintPending=function(){return l},r.isPrintEnabled=function(){return c},r.setPrintEnabled=function(e){c=e},r.fetchPdfForPreview=function(t,n,i){var o=new Util.xmlHttpRequest;o.onreadystatechange=function(){if(o.readyState===window.XMLHttpRequest.DONE){if(200!==o.status)return e.ui_frame.call("onPreviewError"),void(s&&s.close());var t,r;t=o.response,!!t&&"%PDF-"===(r=window.String.fromCharCode.apply(null,new window.Uint8Array(t.slice(0,128))).split("\n"))[0].slice(0,5)&&"<</Creator (Chromium)"===r[3]&&"/Producer (Skia/PDF "===r[4].slice(0,20)?(p=!0,function(t,r){var n=document.createElement("a"),i=new window.Blob([t],{type:"application/pdf"}),o="["+e.pairing_dict.origin+"]_print_preview.pdf";f&&window.URL.revokeObjectURL(f),f=window.URL.createObjectURL(i),n.setAttribute("href",f),r?n.setAttribute("target",r):n.setAttribute("download",o),(BrowserDetect.isIE()||BrowserDetect.isEdge())&&window.navigator&&window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(i,o):n.click(),!a&&r||e.ui_frame.call("hidePrintPreview")}(o.response,_())):e.ui_frame.call("onPreviewError")}},o.open(t,n),o.responseType="arraybuffer",o.setRequestHeader("Accept","application/pdf"),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.withCredentials=!0,o.send(i),a&&(s&&!s.closed&&(s.close(),f&&(window.URL.revokeObjectURL(f),f=null)),setTimeout((function(){var t,n,i;(s=Util.windowOpen("",_()))&&(s.document.body||s.document.appendChild(s.document.createElement("body")),assert(s.document.body),t=s.document.createElement("p"),n=s.document.createTextNode(e.localization.get("ID_PRINT_PREVIEW_STATUS")),t.appendChild(n),s.document.body.appendChild(t),i=window.setInterval((function(){s.closed&&(window.clearInterval(i),r.cleanUpPrint())}),500))}),0))},r.handlePrint=function(){var t,i=Util.getDocIdIfSafedocs(),o=Util.removePrefix(Util.getRawPageUrl()),a={cid:e.pairing_dict.cid,rid:e.pairing_dict.rid,tab_id:e.pairing_dict.tab_id,mpa_id:e.pairing_dict.mpa_id,page_url:encodeURIComponent(Util.isAboutBlankUrl()?o:new ParsedURL(o).defrag())};e.pairing_dict.cluster_id&&(a.cl=e.pairing_dict.cluster_id),i?setTimeout((function(){!function(t){var r,n,i;e.pairing_dict.client_caps.safedocs_block_print?e.ui_frame.call("showModal","SafedocsPrintBlocked"):(r={cid:e.pairing_dict.cid},i=e.url_builder.buildFileServerUrl("/safeview-fileserv/safepdfprint/"+t,!0),BrowserDetect.isEdge()||BrowserDetect.isSafari()?(n=i+"?cid="+e.pairing_dict.cid,e.pairing_dict.cluster_id&&(n+="&cl="+e.pairing_dict.cluster_id),Util.windowOpen(n,_()),k()):(r.cluster_id=e.pairing_dict.cluster_id||"",e.ui_frame.call("showSafedocsPrintPreview",i,r)))}(i)}),0):(t="/r/print?"+Util.buildQueryStr(a),t=e.url_builder.buildProtocolUrl(t),d.fid=n,d.safe_rid=e.pairing_dict.safe_rid,d.tab_id=e.pairing_dict.tab_id,setTimeout((function(){e.ui_frame.call("showPrintPreview",t,d)}),0),r.setPrintFid(0))},r.cleanUpPrint=function(){a||f&&(window.URL.revokeObjectURL(f),f=null,p=!1)},r.getPrintOptions=function(){return d},r.setPrintOptions=function(e,t,r,n,i){d.layout=e,d.paper_size=t,d.scale=r,d.header_footer=n,d.background=i},r.printWithDefaultOptions=function(){r.setPrintEnabled(!0),r.setPrintFid(getTopFrameFid()),r.handlePrint()},r.isPrintDataReady=function(){return p},r.handlePrintKeyEventIfNeeded=function(t,n){var i=Util.getDocIdIfSafedocs();return!!r.isPrintEnabled()&&("keydown"===t.type&&"print"===n?!e.key_ctrl.should_prevent_default(getFidByNode(t.target),getUidByNode(t.target),t.type,t.keyCode,t.ctrlKey,t.shiftKey,t.altKey,t.metaKey)&&(r.isPrintPending()?(t.preventDefault(),!0):(r.setPrintPending(!0),BrowserDetect.isIE11()&&(window.alert(e.localization.get("ID_PRINT_SHORTCUT_KEY_ALERT")),u=!0),i?e.pairing_dict.client_caps.safedocs_block_print?e.ui_frame.call("showModal","SafedocsPrintBlocked"):e.ui_frame.call("showModal","SafedocsUsePrintButton"):e.ui_frame.call("showPrintOptions"),o||(t.preventDefault(),t.stopImmediatePropagation?t.stopImmediatePropagation():t.stopPropagation()),!0)):!(!u||"keypress"!==t.type||112!==t.keyCode&&80!==t.keyCode)&&(t.type,t.keyCode,t.preventDefault(),u=!1,!0))},r.attachKeyEventHandler=function(e){i&&(e?o=document.attachEvent("onkeydown",h):o&&document.detachEvent("onkeydown",h))},r.runDonePrintCb=k,r.setPrintOptions("portrait",(t=Util.getLanguage().toLowerCase(),-1!==["en-us","en-ca","en-ph"].indexOf(t)?"letter":"a4"),"100",!0,!1),e.interp.registerOpcodeHandler("window_print",S),e.callback.register("dom-loaded",C),e.callback.register("safeview-exit",T),BrowserDetect.isMobile()?window.matchMedia("print").addListener((function(e){e.matches?y():v()})):(window.onbeforeprint=y,window.onafterprint=v)}function FullscreenVideo(e){var t,r,n=this,i=null,o=!1;function a(t,n){var a=getFidByNode(t.target),s=getUidByNode(t.target);o?o=!1:(n?r=getNodeKey(a,s):(e.surrogate_channel.send("client-media",a,s,{type:"pause"}),s=-1,i=setTimeout((function(){r=void 0,i=null}),2e3)),e.surrogate_channel.send("fullscreen",a,n,s))}function s(e){a(e,!0)}function l(e){a(e,!1)}function c(n){var i=t.fid,a=t.uid,s=getNodeByUid(i,a);s?(n?(o=!0,s.webkitEnterFullscreen(),r=getNodeKey(i,a)):(e.surrogate_channel.send("fullscreen",i,!1,a),r=void 0),t=null):reportClientEvent("tc-fullscreen-no-node-error",{frame_id:i,node_id:a},!0)}n.onSurrogateFullScreenChange=function(n,a,s){var l,c;if(a){if((l=getNodeByUid(n,s))&&"VIDEO"===l.nodeName||(l=null,e.useRemotingV2()&&(l=e.compositor.getMainFrame().getActiveVideoNode())&&(n=getFidByNode(l),s=getUidByNode(l))),!l||!l.webkitSupportsFullscreen)return void e.surrogate_channel.send("fullscreen",n,!1,-1);if(r===getNodeKey(n,s))return;t||e.ui_frame.call("showModal","Fullscreen",n,s),t={fid:n,uid:s}}else if(r){if(c=splitNodeKey(r),r=void 0,!(l=getNodeByUid(c.fid,c.uid)))return;c.fid,c.uid,i?(clearTimeout(i),i=null):(o=!0,l.webkitExitFullscreen())}},n.allowFullscreen=function(){c(!0)},n.blockFullscreen=function(){c(!1)},n.isFullscreen=function(){return void 0!==r},n.exitFSIfNeeded=function(t){var n;r&&t!==r&&(n=splitNodeKey(r),e.surrogate_channel.send("fullscreen",n.fid,!1,n.uid))},n.installListeners=function(e){EventListener.addListener(e,"webkitbeginfullscreen",s,!1),EventListener.addListener(e,"webkitendfullscreen",l,!1)},n.removeListeners=function(e){EventListener.removeListener(e,"webkitbeginfullscreen",s,!1),EventListener.removeListener(e,"webkitendfullscreen",l,!1)}}function FullscreenCustom(e){var t,r,n=new Logger("fullscreen_custom",{level:"info"}),i=this,o=[];function a(t){return e.useRemotingV2()?document:getWindowByFid(t).document}function s(t){var i=e.useRemotingV2()?getTopFrameFid():getFidByNode(t.target),o=a(i)[e.xbrowser.fullscreenElement];if(e.key_ctrl.get_prevent_local_all_keys()&&(o?navigator.keyboard&&"function"==typeof navigator.keyboard.lock?navigator.keyboard.lock().then((function(){})).catch((function(e){n.error("Failed to lock keyboard: "+e)})):n.warn("Keyboard Lock API not supported"):navigator.keyboard&&"function"==typeof navigator.keyboard.unlock&&navigator.keyboard.unlock()),e.useRemotingV2()){if(o)return;r&&(window.scrollTo(r.x,r.y),r=null)}e.surrogate_channel.send("fullscreen",i,null!==o,o?getUidByNode(o):-1)}i.onSurrogateFullScreenChange=function(r,n,i){var s=getNodeByUid(r,i),l=a(r);if(n)if(e.xbrowser.fullscreenchange.length){if(s&&l[e.xbrowser.fullscreenElement]===s)return;o.length>1&&o[1].fid===r&&o[1].uid===i?(o.shift(),e.xbrowser.exitFullscreen.call(l)):(t||e.ui_frame.call("showModal","Fullscreen",r,i),t={fid:r,uid:i})}else e.surrogate_channel.send("fullscreen",r,!1,-1);else e.xbrowser.exitFullscreen&&l[e.xbrowser.fullscreenElement]&&e.xbrowser.exitFullscreen.call(l),o=[]},i.allowFullscreen=function(){var n;(n=e.useRemotingV2()?document.body:getNodeByUid(t.fid,t.uid))?(e.useRemotingV2()&&(window.scrollX>0||window.scrollY>0)&&(r={x:window.scrollX,y:window.scrollY}),e.callback.fire("will-request-fullscreen"),e.xbrowser.requestFullscreen(n),o.unshift({fid:t.fid,uid:t.uid}),t=null):reportClientEvent("tc-fullscreen-no-node-error",{frame_id:t.fid,node_id:t.uid},!0)},i.blockFullscreen=function(){var r,n,i;getNodeByUid(t.fid,t.uid)||e.useRemotingV2()?(i=(n=(r=getWindowByFid(t.fid))?r.document:null)?n[e.xbrowser.fullscreenElement]:null,e.surrogate_channel.send("fullscreen",t.fid,!1,i?getUidByNode(i):-1),t=null):reportClientEvent("tc-fullscreen-no-node-error",{frame_id:t.fid,node_id:t.uid},!0)},e.xbrowser.fullscreenchange.forEach((function(e){EventListener.addListener(document,e,s,!1)})),i.isFullscreen=function(){return 0!==o.length&&!!a(o[0].fid)[e.xbrowser.fullscreenElement]}}function Fullscreen(e){var t,r,n=this,i=!1;function o(t,r){var n,i;t.__sv_frame_owner||BrowserDetect.isFirefox()&&(i=getWindowByFid(getFidByNode(t)),t.allow?-1===t.allow.indexOf("fullscreen *")&&(n=-1===t.allow.indexOf("fullscreen")?t.allow+"; fullscreen *":t.allow.replace("fullscreen","fullscreen *")):n="fullscreen *",e.xbrowser.setAttribute(i,t,"","allow",n))}n.allowFullscreen=function(){t.allowFullscreen()},n.blockFullscreen=function(){t.blockFullscreen()},n.isFullscreen=function(){return t.isFullscreen()},n.exitFSIfNeeded=function(e){if(i)return t.exitFSIfNeeded(e)},n.installListeners=function(e){i&&t.installListeners(e)},n.removeListeners=function(e){i&&t.removeListeners(e)},t=!e.xbrowser.fullscreenchange.length&&(r=document.createElement("video"),i=void 0!==r.webkitEnterFullscreen,r=null,i)?new FullscreenVideo(e):new FullscreenCustom(e),e.interp.registerOpcodeHandler(e.interp.OPCODES.FULLSCREEN_CHANGE,t.onSurrogateFullScreenChange),e.callback.register("frame-node-inserted",o)}var MetricsUtilsClass=function(){var e,t,r,n=this;function i(){return"portrait"===Util.getScreenOrientationType()}function o(){return BrowserDetect.isMobileSafari()?i()?Util.getPortraitScreenSize().width:Util.getPortraitScreenSize().height:Util.getPortraitScreenSize().width}function a(){var e=0,t=0;return assert(!BrowserDetect.isMobile()),Util.getInnerWidth()?(e=Util.getInnerWidth(),t=Util.getInnerHeight()):document.documentElement&&document.documentElement.clientWidth?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.body&&(e=document.body.clientWidth,t=document.body.clientHeight),assert("number"==typeof e&&"number"==typeof t),{x:0,y:0,width:e,height:t,scale:n.getVisualViewportScale()}}function s(e,t){var r,n=document.createElement("div");return assert("fixed"===e||"absolute"===e),n.style.position=e,n.style.left=t.x+"px",n.style.top=t.y+"px",n.style.width="1px",n.style.height="1px",function(){if(!document.body){var e=document.createElement("body");document.documentElement.appendChild(e),assert(document.body)}}(),document.body.appendChild(n),r=n.getBoundingClientRect(),n.parentNode.removeChild(n),{x:r.x,y:r.y}}function l(e){return Math.floor(Math.max(0,e))}n.maybeSplitView=function(){var e,t,n=Util.getVisualViewport();return!(!BrowserDetect.isMobileSafari()||!n||BrowserDetect.isMobileSafariOnIPhone())&&(!(r&&Date.now()-r<3e3)&&((e=n.width*n.scale)>=(t=o())*(1-.8)&&e<=.8*t))},n.getVisualViewportScale=function(){var e,t,r=Util.getVisualViewport();return function(){if(!BrowserDetect.isMobileSafari())return!1;if(!Util.getVisualViewport())return!0;if(BrowserDetect.isMobileSafariOnIPhone()){if(!i())return!1}else if(n.maybeSplitView())return!1;return!0}()?t=(e=Util.getInnerWidth())?o()/e:1:r?(assert(r.scale),BrowserDetect.isMobileSafari()&&(t=Math.round(100*r.scale)/100),t||r.scale):1},n.getScreenHeight=function(){return i()?Util.getPortraitScreenSize().height:Util.getPortraitScreenSize().width},n.getVisualViewportMetrics=function(){var e,t,r,i=Util.getVisualViewport(),o=n.getVisualViewportScale();return i?{x:l(i.offsetLeft),y:l(i.offsetTop),width:Math.ceil(i.width*o),height:Math.ceil(i.height*o),scale:o}:BrowserDetect.isMobileSafari()?(assert(void 0!==window.innerWidth&&void 0!==window.innerHeight),t=s("fixed",{x:0,y:0}),r=s("absolute",{x:window.scrollX,y:window.scrollY}),assert(BrowserDetect.isMobileSafari()),{x:l((e=1===n.getVisualViewportScale()?{x:0,y:0}:{x:r.x-t.x,y:r.y-t.y,scroll_bounds:r,fixed_bounds:t}).x),y:l(e.y),width:Math.ceil(Util.getInnerWidth()*o),height:Math.ceil(Util.getInnerHeight()*o),scale:n.getVisualViewportScale()}):(assert(!BrowserDetect.isMobile()),a())},n.getWebViewSize=function(){var e,t={},r=n.getVisualViewportScale();return BrowserDetect.isMobile()?(t.width=(e=Util.getVisualViewport())?Math.ceil(e.width*n.getVisualViewportScale()):i()?Util.getPortraitScreenSize().width:Util.getPortraitScreenSize().height,assert(r>0&&Number.isFinite(r),{scale:r}),BrowserDetect.isMobileSafari()?(assert(Number.isFinite(window.innerHeight)),t.height=Math.ceil(window.innerHeight*r)):BrowserDetect.isAndroidChrome()?t.height=n.getVisualViewportMetrics().height:assert(0),t):a()},n.getAllMetrics=function(){var t=Util.getDeviceMetrics();return t.view_size=n.getWebViewSize(),t.visual_viewport=n.getVisualViewportMetrics(),t.initial_view_height=e,t},n.clientToScreenPos=function(e,t){var r,i=n.getVisualViewportScale(),o=Util.getVisualViewport();return assert(Number.isFinite(i)),BrowserDetect.isChrome()?(assert(o),assert(Number.isFinite(o.offsetLeft)&&Number.isFinite(o.offsetTop)),r={x:(e-o.offsetLeft)*i,y:(t-o.offsetTop)*i}):r={x:e*i,y:t*i},assert(Number.isFinite(r.x)&&Number.isFinite(r.y)),r},n.onWebViewResize=function(){var i=Util.getScreenOrientationType();i!==t&&(r=Date.now(),t=i,e=n.getWebViewSize().height)},e=n.getWebViewSize().height,t=Util.getScreenOrientationType(),assert(Number.isFinite(e))},MetricsUtils=new MetricsUtilsClass;function MetricsObserver(e){var t,r,n,i,o=this,a={},s=!1;function l(){var e,r=window.devicePixelRatio||1,n=Util.getPortraitScreenSize();t&&t.removeListener(o.onMediaQueryStateChanged),e="screen and (resolution: "+r+"dppx) and (min-device-width: "+n.width+"px) and (max-device-width: "+n.width+"px) and (min-device-height: "+n.height+"px) and (max-device-height: "+n.height+"px)",(t=window.matchMedia(e)).addListener(o.onMediaQueryStateChanged)}function c(t){var r,n=a,i=MetricsUtils.getAllMetrics();if((t=t||"query-change",!a||JSON.stringify(i)!==JSON.stringify(a))&&(function(t,r){return!!Util.isDictEmpty(t)||!(e.fullscreen.isFullscreen()&&BrowserDetect.isMobileSafariOnIPhone()&&function(e,t){return e.view_size.height>t.view_size.height}(t,r)&&!function(e,t){return e.screen_orientation_type!==t.screen_orientation_type||e.screen_orientation_angle!==t.screen_orientation_angle}(t,r))}(a,i)&&(r=["set-render-params",i],e.surrogate_channel&&(e.surrogate_channel.send.apply(e.surrogate_channel,r),1)&&(a=i,l(),e.callback.fire("metrics-changed",a,n),"window-resize"===t)))){if(s)return void(s=!1);e.callback.fire("window-resized",a)}}function d(){c("layout-viewport-change")}function u(){s=!0}function f(){BrowserDetect.isMobileSafari()&&MetricsUtils.onWebViewResize(),c("window-resize")}function p(){BrowserDetect.isAndroidChrome()&&MetricsUtils.onWebViewResize(),MetricsUtils.maybeSplitView()?(r&&clearTimeout(r),r=setTimeout((function(){c("visual-viewport-change"),r=null}),300)):c("visual-viewport-change")}o.onMediaQueryStateChanged=function(){c("media-query")},o.checkForMetricsChange=c,o.release=function(){var t=Util.getVisualViewport();EventListener.removeListener(window,"resize",f,!1),t?(EventListener.removeListener(t,"resize",p),EventListener.removeListener(t,"scroll",p)):BrowserDetect.isMobileSafari()&&EventListener.removeListener(window,"scroll",p,!1),e.callback.deregister("layout-viewport-props-changed",d)},o.stop_poll=function(){clearInterval(n)},i=Util.getVisualViewport(),EventListener.addListener(window,"resize",f,!1),i?(EventListener.addListener(i,"resize",p),EventListener.addListener(i,"scroll",p)):BrowserDetect.isMobileSafari()&&EventListener.addListener(window,"scroll",p,!1),e.callback.register("layout-viewport-props-changed",d),e.callback.register("surrogate-will-resize-window",u),c("init"),n=setInterval((function(){c("poll")}),3e3),window.matchMedia&&l()}var Resource=Object.freeze({videoDataUri:"data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAwJtZGF0AAACrQYF//+p3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjYzOCA3NTk5MjEwIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNSAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTEgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTIgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD00MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIzLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAfZYiEABX//vfJ78Cm69vetb+Tz0j4e8ZQD6wZq+vdsQAAAApBmiNsQS/+tTlYAAAACEGeQniCXwN/AAAACAGeYXRBLwN+AAADQ21vb3YAAABsbXZoZAAAAAAAAAAAAAAAAAAAA+gAAAfQAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAJtdHJhawAAAFx0a2hkAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAfQAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAA4AAAAKgAAAAAAJGVkdHMAAAAcZWxzdAAAAAAAAAABAAAH0AAAQAAAAQAAAAAB5W1kaWEAAAAgbWRoZAAAAAAAAAAAAAAAAAAAQAAAAIAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAZBtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAFQc3RibAAAAJhzdHNkAAAAAAAAAAEAAACIYXZjMQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAA4ACoASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAADJhdmNDAWQACv/hABlnZAAKrNlEflkwEQAAAwABAAADAAQPEiWWAQAGaOvjyyLAAAAAGHN0dHMAAAAAAAAAAQAAAAQAACAAAAAAFHN0c3MAAAAAAAAAAQAAAAEAAAAwY3R0cwAAAAAAAAAEAAAAAQAAQAAAAAABAACAAAAAAAEAAEAAAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAQAAAABAAAAJHN0c3oAAAAAAAAAAAAAAAQAAALUAAAADgAAAAwAAAAMAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjIzLjEwMQ==",dummyAudioUri:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU3LjgzLjEwMAAAAAAAAAAAAAAA//tUwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAACAAABgADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA//////////////////////////////////////////////////////////////////8AAAAATGF2YzU3LjEwAAAAAAAAAAAAAAAAJAMAAAAAAAAAAYBWbp0FAAAAAAAAAAAAAAAAAAAA//sUxAADwAABpAAAACAAADSAAAAETEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//sUxCWDwAABpAAAACAAADSAAAAEVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"});function Clipboard(e){var t,r,n,i,o,a=this,s=!1,l=!1,c=!1,d=null,u=null,f=!1,p=null,g=new ShortcutKeyHandler(e);function m(){o={keydown:!0,mousedown:!0}}function _(){var r,n,i,o=!1;i=!1,BrowserDetect.isIE()&&(document.activeElement&&(Util.is_element_input_text(document.activeElement)||document.activeElement.isContentEditable)||(i=!0)),BrowserDetect.isFirefox()&&e.useRemotingV2()&&(i=!0),BrowserDetect.isSafari()&&(i=!0),i&&(document.activeElement,u=document.activeElement,(d=document.createElement("input")).style.position="fixed",d.style.top="1px",d.style.left="1px",d.style.height="1px !important",d.style.border="none",d.style.background="transparent !important",d.style.textIndent="-300px",document.body.insertBefore(d,document.body.firstChild),d.value=t,BrowserDetect.isSafari()?((r=document.createRange()).selectNodeContents(d),(n=window.getSelection()).removeAllRanges(),n.addRange(r),d.setSelectionRange(0,t?t.length:1)):(Util.safeFocus(d),d.select()));try{l=!0,c=!1,o=document.execCommand("copy"),BrowserDetect.isIE()&&!c&&(o=!1),l=!1}catch(e){}return d&&(d.parentNode.removeChild(d),d=null,u&&u.focus&&Util.safeFocus(u),u=null),o&&(s=!1),o}function h(t,r,o){e.useRemotingV2()?r&&"\n"!==r&&(Util.copyToClipboardInEventHandler(t,r,o),i=r):t.defaultPrevented?t.type:i=function(){var e,t,r;if(!n)return null;if(!(e=getWindowByFid(n)))return null;if((t=e.document.activeElement)&&Util.is_element_input_text(t)){if(t.selectionStart!==t.selectionEnd)return t.value.substring(t.selectionStart,t.selectionEnd)}else if(r=e.getSelection())return r.toString();return null}(),i&&(i=i.replace(/\r/g,""))}function y(e,n,i){e.type,l?function(e){c=!0,s&&Util.copyToClipboardInEventHandler(e,t,r)}(e):h(e,n,i)}function v(n,o,a,l,c){var d;t=o,r=a,e.copy_paste_ctrl.enforce_on_clipb_data()||(c||t!==i||function(e){return e&&(-1!==e.indexOf(" src=")||-1!==e.indexOf(" href="))}(a))&&(s=!0,m(),f?f=!1:(d=_(),l&&!d&&reportErrorClientEvent("tc-clipboard-copy-failure",{detail:"Backend clipboard is changed without recent user interaction"})))}a.copy_event_handler=y,a.cut_event_handler=y,a.piggyback=function(e){s&&o.hasOwnProperty(e.type)&&o[e.type]&&("keydown"===e.type&&BrowserDetect.isFirefox()&&(e.keyCode<48||e.keyCode>90)||("copy"===g.get_operation(e)&&(f=!0,p&&clearTimeout(p),p=setTimeout((function(){f=!1,p=null}),2e3)),e.type,o[e.type]=!1,_()))},a.set_last_selection_fid=function(e){n=e},m(),e.interp.registerOpcodeHandler("clpbd-data",v)}function CopyPasteControl(e){var t=this,r=!1,n=!1,i=!0,o=!1,a=0,s=!0,l=!1,c=["copy","cut","paste","drop","file_upload"],d={COPY_DISABLED:1,PASTE_DISABLED:2,PASTE_RESTRICTED:3,COPY_PASTE_DISABLED:4},u=null,f=null,p=!1;function g(e){var t,r,n,i,o,l=!1;if("paste"===e.type?t=e.clipboardData:"drop"===e.type&&(t=e.dataTransfer),t&&t.getData)for(r=0;r<t.types.length;r+=1)"text/plain"===(n=t.types[r])?i=t.getData(n):"text/html"===n?o=t.getData(n):l=!0;else"paste"===e.type&&window.clipboardData&&window.clipboardData.getData&&(i=window.clipboardData.getData("Text"));return i?i.length>a:o?o.length>a:!!l&&(!t.types.includes("Files")||"drop"!==e.type||s)}function m(t,r){l||t===u&&r===f||(u=t,f=r,setTimeout((function(){u=null,f=null}),1e3),e.surrogate_channel.send("report-user-action",t,r),assert(-1!==c.indexOf(t)))}function _(t){var i,o;if(!l){switch(assert(-1!==c.indexOf(t)),t){case"paste":case"drop":case"file_upload":n&&(a>0?(i=d.PASTE_RESTRICTED,o=a):i=r?d.COPY_PASTE_DISABLED:d.PASTE_DISABLED);break;case"copy":case"cut":r&&(i=n&&0===a?d.COPY_PASTE_DISABLED:d.COPY_DISABLED);break;default:assert(!1)}i&&e.ui_frame.call("showCopyPasteRestricted",i,o)}}function h(e,t){m(e,t),_(e)}t.enforce_on_user_action=function(t,a){switch(a.type){case"paste":if(n&&g(a))return a.preventDefault(),h(a.type,!0),!0;m(a.type,!1);break;case"copy":case"cut":if(r)return a.preventDefault(),h(a.type,!0),!0;m(a.type,!1);break;case"contextmenu":if(o||i&&"img"===t.nodeName.toLowerCase()||p)return a.preventDefault(),e.snackbar.showContextMenuBlock(),!0;break;case"drop":if(n&&g(a))return a.preventDefault(),h(a.type,!0),!0;break;case"dragstart":if(r)return a.preventDefault(),!0}return!1},t.enforce_on_file_upload=function(){return!(!n||!s)&&(h("file_upload",!0),!0)},t.enforce_on_clipb_data=function(){return!!r&&(reportErrorClientEvent("tc-copy-paste-policy-error",{detail:"The surrogate should have stopped the clipboard update."}),_("copy"),!0)},t.enforce_on_cb_api_data=function(e,t,i){switch(e){case"paste":if(!n)return m(e,!1),!1;if("text/plain"!==i&&"text/html"!==i)return!0;if(t.length>a)return h(e,!0),!0;break;case"copy":case"cut":if(r)return h(e,!0),!0}return!1},t.has_paste_restriction=function(){return n},t.has_disabled_all_ctx_menu=function(){return o||p},t.enable_test_disable_all_ctx_menu=function(){p=!0},t.msgbox_types=d,e.interp.registerOpcodeHandler("copy-paste-policy-update",(function(e){JSON.stringify(e),r=!!e.disable_copy,n=!!e.restrict_paste,i=!!e.disable_img_ctx_menu_for_copy,o=!!e.disable_all_ctx_menu_for_copy,a=parseInt(e.char_len_limit_if_paste_restricted),s=!!e.block_file_upload_if_paste_restricted,(isNaN(a)||a<0)&&(a=0),l=!!e.is_fail_closed_policy}))}function PermissionStub(e){function t(t){var r={};t.permissions.forEach((function(e){switch(e){case"Geolocation":r[e]={granted:!1,la:0,lo:0,acc:0,geo_error:0,geo_detail:"no-geolocation"};break;case"Clipboard":r[e]={granted:!1,text:"",html:""}}})),e.surrogate_channel.send("perm",t.id,r)}e.interp.registerOpcodeHandler("permissions-request",t)}function ImageRequestMgr(e){var t=this,r=!1,n={};function i(e){var t,r,n,i=e.split("_");return r=parseInt(i[0],10),n=parseInt(i[1],10),isNaN(r)||isNaN(n)?(reportErrorClientEvent("tc-imgreq-invalid-req-id-error",{req_id:e}),null):"img"!==(t=getNodeByUid(r,n)).nodeName.toLowerCase()?(reportErrorClientEvent("tc-imgreq-wrong-elem-type-error",{type:t.nodeName}),null):t}function o(e,t){var r;t&&t.substring(0,24),Date.now(),n[e]?(r=i(e))?(t&&(r.src=t),function(e){var t;(t=i(e))&&t.style&&t.style.cursor&&n[e]&&n[e].cursor_set&&(n[e].cursor?t.style.cursor=n[e].cursor:t.style.removeProperty("cursor"),delete n[e].cursor_set,delete n[e].cursor)}(e),r.__sv_is_dataurl=!0,function(e){var t=n[e].image;t&&t.parentNode&&t.parentNode.removeChild(t),delete n[e]}(e)):reportWarnClientEvent("tc-imgreq-image-missing-error",{req_id:e,location:"image response"}):reportErrorClientEvent("tc-imgreq-request-data-missing-error",{req_id:e})}t.request_image=function(t,o){var a,s,l,c,d,u=null,f=o.type;if(assert("img"===t.nodeName.toLowerCase()),r&&"contextmenu"===f&&o.preventDefault(),c=getFidByNode(l=t),d=getUidByNode(l),(a=void 0===c||void 0===d?null:c+"_"+d)&&!t.__sv_is_dataurl&&t.src)if(n[a])"contextmenu"!==f||n[a].cursor_set||setTimeout((function(){!function(e){var t;n[e]&&!n[e].cursor_set&&((t=i(e))?(t.style&&t.style.cursor&&(n[e].cursor=t.style.cursor),t.style&&(t.style.cursor="wait",n[e].cursor_set=!0)):reportErrorClientEvent("tc-imgreq-image-missing-error",{req_id:e,location:"visual indicator"}))}(a)}),750);else{if(0!==t.src.indexOf("data:"))s=0===t.src.indexOf("blob:")&&t.__sv_auth_fetch_src?t.__sv_auth_fetch_src:t.src,(u=new Image(64,64)).src=s+(-1===s.indexOf("?")?"?":"&"),u.src=u.src+"req_tab="+e.pairing_dict.tab_id+"&req_id="+a+"&rand="+__randstr(8),function(e){assert(e),e.decode?e.decode():(e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.visibility="hidden",document.body.appendChild(e))}(u);else{if(0!==t.src.indexOf("data:image/webp")&&0!==t.src.indexOf("data:image/avif"))return;e.surrogate_channel.send("compat-img-req",getFidByNode(t),getUidByNode(t))}n[a]={image:u,ts:Date.now()},n[a].ts}},t.reset=function(e){delete e.__sv_is_dataurl},t.enable_test=function(){r=!0},e.interp.registerOpcodeHandler("img_data_http_url",o),e.interp.registerOpcodeHandler("img_data_non_http_url",(function(e,t,r){o(e+"_"+t,r)}))}function WatermarkHandler(e){var t,r,n,i,o,a,s=["__safly_mwtc_header","__safly_mwtc_uid","__safly_mwtc_ts"],l=0,c=0,d={};function u(){var e,t,i,a,s,d,u;if(r.style.display="none",i=Math.max(document.documentElement.scrollHeight||0,window.innerHeight||0),s=((u=Math.max(document.documentElement.scrollWidth||0,window.innerWidth||0))+400)*(i+400)/43200,i===l&&u===c&&n.childNodes.length>=s)r.style.display="block";else{for(t=(i-30).toString()+"px",d=(u-30).toString()+"px",e=(i+360).toString()+"px",a=(u+360).toString()+"px",r.style.setProperty("height",t,"important"),r.style.setProperty("width",d,"important"),n.style.setProperty("height",e,"important"),n.style.setProperty("width",a,"important"),l=i,c=u;n.childNodes.length<s;)n.append?n.append(o.cloneNode(!0)):n.appendChild(o.cloneNode(!0));r.style.display="block"}}function f(t){e.surrogate_channel.send("report-user-action","wt",!0)}function p(e){var t=i.shadowRoot.adoptedStyleSheets.length;i.parentElement||(f(),document.body.appendChild(i)),n.parentElement||(f(),i.shadowRoot.appendChild(n)),t&&i.shadowRoot.adoptedStyleSheets[t-1].cssRules[0].cssText.startsWith("#__safly_mwtc")||i.shadowRoot.adoptedStyleSheets.push(a),u()}function g(){i||((i=document.createElement("div")).id="__safly_mwtc_root",document.body.appendChild(i),function(){var e,t;for(i.shadowRoot||i.attachShadow({mode:"open"}),(r=document.createElement("div")).id="__safly_mwtc",(n=document.createElement("div")).className="__safly_mwtc_container",(o=document.createElement("div")).className="__safly_mwtc_item",e=0;e<s.length;e++)(t=document.createElement("div")).className=s[e],o.appendChild(t);n.appendChild(o.cloneNode(!0)),r.appendChild(n),i.shadowRoot.appendChild(r)}()),u(),a||((a=new window.CSSStyleSheet).replaceSync(d.css.replace("timestamp",(new Date).toLocaleString())),i.shadowRoot.adoptedStyleSheets.push(a)),t||(window.ResizeObserver&&new window.ResizeObserver(p).observe(document.documentElement),t=setInterval(p,5e3)),p()}e.interp.registerOpcodeHandler("wpu",(function(t){d=t;var r={on_success:g,on_timeout:g};e.callback.registerOneShot("dom-loaded",2e3,r)}))}function Webauthn(e){var t,r=new Logger("webauthn",{level:"info"}),n={};function i(e){var t,r,n=getNodeByFrameFid(e);return getTopFrameFid()===e?Util.getPageUrl():(n&&(t=getNodeByUid(n.fid,n.uid)),t&&(r=t.getAttribute("data-sv-src")),r)}function o(e,t){var n,i={success:!0,id:t.id,type:t.type};return"password"===t.type?(i.password=t.password,i.name=t.name):"public-key"===t.type?(i.raw_id=Util.array_buffer_to_base64(t.rawId),i.authenticator_attachment=t.authenticatorAttachment,i.client_data_json=Util.array_buffer_to_base64(t.response.clientDataJSON),"create"===e?(i.attestation_object=Util.array_buffer_to_base64(t.response.attestationObject),t.response.getAuthenticatorData&&(i.authenticator_data=Util.array_buffer_to_base64(t.response.getAuthenticatorData())),t.response.getPublicKey&&(i.public_key=Util.array_buffer_to_base64(t.response.getPublicKey())),t.response.getPublicKeyAlgorithm&&(i.public_key_algorithm=t.response.getPublicKeyAlgorithm()),t.response.getTransports&&(i.transports=t.response.getTransports())):(i.authenticator_data=Util.array_buffer_to_base64(t.response.authenticatorData),i.signature=Util.array_buffer_to_base64(t.response.signature),i.user_handle=Util.array_buffer_to_base64(t.response.userHandle)),t.response.getClientExtensionResults&&(i.extensions={},t.response.getClientExtensionResults().forEach((function(t,r){if("credProps"===r)i.extensions[r]=t.rk;else if("largeBlob"===r)i.extensions[r]="create"===e?t.supported:{blob:Util.array_buffer_to_base64(t.blob),written:t.written};else if("prf"===r)i.extensions[r]={enabled:t.enabled},t.results.first&&(i.extensions[r].first=Util.array_buffer_to_base64(t.results.first)),t.results.second&&(i.extensions[r].second=Util.array_buffer_to_base64(t.results.second));else if("supplementalPubKeys"===r)for(i.extensions[r]=[],n=0;n<t.signatures.length;++n)i.extensions[r].push(Util.array_buffer_to_base64(t.signatures[n]));else i.extensions[r]="payment"===r?Util.array_buffer_to_base64(t.browser_bound_signature.signature_output):"getCredBlob"===r?Util.array_buffer_to_base64(t):t})))):"federated"===t.type?(i.provider=t.provider,i.name=t.name):"otp"===t.type?i.code=t.code:(r.error("Unsupported credential type: "+t.type),i.success=!1),i}function a(e){var t,r=i(e);if(r)return new ParsedURL(r).origin();throw(t=new Error("Unknown frame origin")).name="NotSupportedError",t}function s(e,t){var r;if(e.challenge&&(e.challenge=Util.base64_to_array_buffer(e.challenge)),e.excludeCredentials)for(r=0;r<e.excludeCredentials.length;++r)e.excludeCredentials[r].id&&(e.excludeCredentials[r].id=Util.base64_to_array_buffer(e.excludeCredentials[r].id));if(e.allowCredentials)for(r=0;r<e.allowCredentials.length;++r)e.allowCredentials[r].id&&(e.allowCredentials[r].id=Util.base64_to_array_buffer(e.allowCredentials[r].id));if(e.user&&e.user.id&&(e.user.id=Util.base64_to_array_buffer(e.user.id)),e.extensions){if(e.extensions.credBlob&&(e.extensions.credBlob=Util.base64_to_array_buffer(e.extensions.credBlob)),e.extensions.prf&&(e.extensions.prf.first&&(e.extensions.prf.first=Util.base64_to_array_buffer(e.extensions.prf.first)),e.extensions.prf.second&&(e.extensions.prf.second=Util.base64_to_array_buffer(e.extensions.prf.second)),e.extensions.prf.evalByCredential))for(r in e.extensions.prf.evalByCredential)e.extensions.prf.evalByCredential.hasOwnProperty(r)&&(e.extensions.prf.evalByCredential[r].first&&(e.extensions.prf.evalByCredential[r].first=Util.base64_to_array_buffer(e.extensions.prf.evalByCredential[r].first)),e.extensions.prf.evalByCredential[r].second&&(e.extensions.prf.evalByCredential[r].second=Util.base64_to_array_buffer(e.extensions.prf.evalByCredential[r].second)));if(e.extensions.cableAuthentication)for(r=0;r<e.extensions.cableAuthentication.length;++r)e.extensions.cableAuthentication[r].clientEid&&(e.extensions.cableAuthentication[r].clientEid=Util.base64_to_array_buffer(e.extensions.cableAuthentication[r].clientEid)),e.extensions.cableAuthentication[r].authenticatorEid&&(e.extensions.cableAuthentication[r].authenticatorEid=Util.base64_to_array_buffer(e.extensions.cableAuthentication[r].authenticatorEid)),e.extensions.cableAuthentication[r].sessionPreKey&&(e.extensions.cableAuthentication[r].sessionPreKey=Util.base64_to_array_buffer(e.extensions.cableAuthentication[r].sessionPreKey));e.extensions.largeBlob&&e.extensions.largeBlob.write&&(e.extensions.largeBlob.write=Util.base64_to_array_buffer(e.extensions.largeBlob.write))}TPROXY_ENABLED||(e.extensions=e.extensions||{},e.extensions.remoteDesktopClientOverride={origin:a(t),sameOriginWithAncestors:!1})}t={create:function(e,t,r){return e.signal=t,e.publicKey&&s(e.publicKey,r),navigator.credentials.create(e).then((function(e){return o("create",e)}))},get:function(e,t,r){return e.signal=t,e.publicKey&&s(e.publicKey,r),BrowserDetect.isFirefox()&&e&&e.publicKey&&e.publicKey.extensions&&!1===e.publicKey.extensions.credProps&&delete e.publicKey.extensions.credProps,navigator.credentials.get(e).then((function(e){return o("get",e)}))},store:function(e){var t=null;if("password"===e.type&&window.PasswordCredential)t=new window.PasswordCredential({id:e.id,name:e.name,password:e.password});else{if("federated"!==e.type||!window.FederatedCredential){const t=new Error("Unsupported credential type: "+e.type);throw t.name="NotSupportedError",t}t=new window.FederatedCredential({id:e.id,name:e.name,provider:e.provider})}return navigator.credentials.store(t).then((function(){return{success:!0}}))},report:function(e){var t=null;return e.credentialId?t=window.PublicKeyCredential.signalUnknownCredential(e):e.allAcceptedCredentialIds?t=window.PublicKeyCredential.signalAllAcceptedCredentials(e):e.name&&(t=window.PublicKeyCredential.signalCurrentUserDetails(e)),null===t?{success:!1}:t.then((function(){return{success:!0}}))},preventSilentAccess:function(){return navigator.credentials.preventSilentAccess().then((function(){return{success:!0}}))},getClientCapabilities:function(){return window.PublicKeyCredential.getClientCapabilities()},isUserVerifyingAuthAvail:function(){return window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().then((function(e){return{success:e}}))},isConditionalMedAvail:function(){return window.PublicKeyCredential.isConditionalMediationAvailable().then((function(e){return{success:e}}))},cancel:function(e){for(var t=0;t<e.length;)void 0!==n[e[t]]&&n[e[t]].abort(),++t}},e.interp.registerOpcodeHandler("webauthn",(function(o,a,s,l){var c=function(t){delete n[a],e.surrogate_channel.send("promise-response",o,a,t)},d=null;if((TPROXY_ENABLED||function(e,t){var r;if("create"===e||"get"===e){for(r in t)t.hasOwnProperty(r)&&"publicKey"!==r&&delete t[r];return!!t.publicKey}return"store"!==e}(s,l))&&navigator.credentials&&t.hasOwnProperty(s))try{!function(t){var r,n,o;if(getTopFrameFid()===t)return;n=new URL(Util.getPageUrl());try{r=new URL(i(t))}catch(e){}if(n&&r&&r.protocol===n.protocol&&r.hostname===n.hostname&&r.port===n.port)return;n&&(n=n.toString());r&&(r=r.toString());throw e.fatalError("tc-webauthn-cross-origin",{top_src:n,frame_src:r}),(o=new Error("Cross-origin iframe not supported")).name="NotSupportedError",o}(o),void 0!==window.AbortController&&(d=new window.AbortController,n[a]=d,d=d.signal),t[s](l,d,o).then(c).catch((function(e){r.error("Error handling "+s+": "+e.name+" "+e.message),c({success:!1,message:e.message,name:e.name})}))}catch(e){c({success:!1,message:e.message,name:e.name})}else r.error("Unsupported command: "+s),c({success:!1})}))}function SnackBar(e){var t=this,r=mf.document,n={snackbar:{id:"safeview-snackbar-host",css:e.url_builder.buildAssetURL("/safeview-static/css/snackbar.css"),link_id:"__safly_snackbar_css_link"}},i={context_menu_block:new o({snackbar_id:"ctxmenu-block-snackbar",auto_hide_timeout:5e3,shadow_host_id:n.snackbar.id}),cloud_debug_snackbar:new o({snackbar_id:"cloud-debug-snackbar",auto_hide_timeout:0,shadow_host_id:n.snackbar.id,children:{indicator:null,message:null,toggle_button:null,stop_button:null}})};function o(e){var t=this;t.show=function(e){var r,n;t.visible||("0"===e.style.opacity&&(e.style.opacity=""),t.visible=!0,assert(e),r=e,(n=mf.document.getElementById(t.shadow_host_id))?n.shadowRoot.appendChild(r):mf.document.body.appendChild(r),t.auto_hide_timeout&&setTimeout(t.hide,t.auto_hide_timeout))},t.hide=function(){var e,r=mf.document.getElementById(t.shadow_host_id);t.visible&&(e=r?r.shadowRoot.getElementById(t.snackbar_id):mf.document.getElementById(t.snackbar_id))&&(EventListener.addListener(e,"transitionend",(function(t){e.style.visibility="hidden",r?r.shadowRoot.removeChild(e):mf.document.body.removeChild(e)})),e.style.opacity="0",t.visible=!1)},function(){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);assert(t.shadow_host_id)}()}t.showContextMenuBlock=function(){var t=e.localization.get("ID_SNACKBAR_CONTEXT_MENU_BLOCK"),n=r.createElement("div"),o=r.createElement("div"),a=r.createElement("p"),s="http://www.w3.org/2000/svg",l=r.createElementNS(s,"svg"),c=r.createElementNS(s,"path");l.setAttribute("class","__safly_snackbar_icon"),l.setAttribute("width","18"),l.setAttribute("height","15"),l.setAttribute("viewBox","0 0 18 15"),l.setAttribute("fill","none"),c.setAttribute("d","M9 0.761719L17.2617 15H0.738281L9 0.761719ZM9 3.75L3.33984 13.4883 H14.6602L9 3.75ZM8.26172 6.73828H9.73828V9.76172H8.26172V6.73828 ZM8.26172 11.2383H9.73828V12.75H8.26172V11.2383Z"),l.appendChild(c),o.classList.add("__safly_message_bar"),a.innerText=t,o.appendChild(l),o.appendChild(a),n.id=i.context_menu_block.snackbar_id,n.classList.add("__safly_message_bar_container","fade"),n.appendChild(o),i.context_menu_block.show(n)},t.setCloudDebugSnackbarState=function(t){var n,o,a,s,l,c=i.cloud_debug_snackbar,d=(s=c,(l=mf.document.getElementById(s.shadow_host_id))?l.shadowRoot.getElementById(s.snackbar_id):mf.document.getElementById(s.snackbar_id));switch(t!==e.cloud_debug.RECORDING_STATES.STOPPED&&(d?c.visible||c.show(d):c.show(function(){var t,n=i.cloud_debug_snackbar,o=i.cloud_debug_snackbar.children;return(t=r.createElement("div")).setAttribute("id",n.snackbar_id),t.classList.add("at-bottom","fade"),t.insertAdjacentHTML("beforeend",e.template.get("cloud-debug-snackbar")),o.indicator=t.querySelector(".indicator"),o.message=t.querySelector(".message"),o.stop_button=t.querySelector(".stop-button"),o.toggle_button=t.querySelector(".toggle-button"),EventListener.addListener(o.stop_button,"click",(function(){e.cloud_debug.stopRecord()})),EventListener.addListener(o.toggle_button,"click",(function(){t.classList.contains("at-bottom")?(t.classList.remove("at-bottom"),t.classList.add("at-top")):(t.classList.remove("at-top"),t.classList.add("at-bottom"))})),t}())),n=c.children.indicator,o=c.children.message,a=c.children.stop_button,t){case e.cloud_debug.RECORDING_STATES.PENDING:n.classList.remove("recording"),o.textContent=e.localization.get("ID_CLOUD_DEBUG_SNACKBAR_PREPARING_TEXT"),a.classList.add("hidden");break;case e.cloud_debug.RECORDING_STATES.RECORDING:n.classList.add("recording"),o.textContent=e.localization.get("ID_CLOUD_DEBUG_SNACKBAR_LOGGING_TEXT"),a.classList.remove("hidden");break;case e.cloud_debug.RECORDING_STATES.STOPPING:n.classList.remove("recording"),o.textContent=e.localization.get("ID_CLOUD_DEBUG_SNACKBAR_DOWNLOADING_TEXT"),a.classList.add("hidden");break;case e.cloud_debug.RECORDING_STATES.STOPPED:c.hide()}},t.load=function(){r.body?mf.window.customElements&&Util.forEachItem(n,(function(e,t){var n;mf.window.customElements.get(t.id)||(new SvCustomElemReg).handle_define_elem_in_frame(mf.window,t.id),t.hasOwnProperty("init_host_override")?n=t.init_host_override(t):(n=r.getElementById(t.id))||((n=r.createElement(t.id)).id=t.id,r.body.appendChild(n)),n.shadowRoot||n.attachShadow({mode:"open"}),function(e,t){var n,i;if(!(i=t?t.shadowRoot.getElementById(t.link_id):r.getElementById(t.link_id)))if((i=r.createElement("link")).id=e.link_id,i.type="text/css",i.rel="stylesheet",i.href=e.css,t)t.shadowRoot.appendChild(i);else{if(!(n=r.head))return void reportErrorClientEvent("tc-snackbar-load-failed",{detail:"Cannot load the snackbar because the page does not have a head."});n.appendChild(i)}}(t,n)})):reportErrorClientEvent("tc-snackbar-load-failed",{detail:"Cannot load the snackbar because the page does not have a body."})},e.callback.registerOnFirst("dom-loaded",t.load)}function Fonts(e){var t=[],r=0,n=!!window.FontFace,i={},o="1";function a(){var e,n=[];for(r=0,e=0;e<t.length;e+=1)s(t[e],n);t=n}function s(e,t){getWindowByFid(e[1])?e[0]===o&&function(e,t,r,o,a){var s=getWindowByFid(e),l=function(e,t,r){var n=__object_assign({},r);return n.family=e,n.source=t,JSON.stringify(n,Object.keys(n).sort())}(t,o,a),c=function(e,t){var r=t.replaceAll('"','\\"');switch(e){case"local":return'local("'+r+'")';case"remote":return'url("'+r+'")'}return reportClientEvent("tc-sanitise-source-failed",{type:e,src:t}),""}(r,o);if(!s||!c||!n)return;i.hasOwnProperty(e)||(i[e]={});i[e].hasOwnProperty(l)&&s.document.fonts.delete(i[e][l]);try{i[e][l]=new FontFace(t,c,a),i[e][l].load().then((function(){s.document.fonts.add(i[e][l])}))}catch(e){reportClientEvent("tc-add-font-exception",{family:t,type:r,source:o,descriptors:a,error:e.toString()},!0)}}(e[1],e[2],e[3],e[4],e[5]):(e[1],t.push(e),r||(r=setTimeout(a,100)))}function l(e,r,n,i,a){s([o,e,r,n,i,a],t)}e.interp.registerOpcodeHandler("load_font",l)}function TranslateDetector(e){var t=this,r="Detect page translation",n=null,i=null,o=null;t.start=function(){var t,a,s,l;n||function(){if(!window.customElements||"function"!=typeof window.customElements.get)return!1;if("undefined"==typeof MutationObserver)return!1;window.customElements.get("translate-detector")||(new SvCustomElemReg).handle_define_elem(getFidByNode(window),"translate-detector");if(!document.body)return reportErrorClientEvent("tc-translate-detector-load-failed",{detail:"Cannot load the translate detector because the page does not have a body."}),!1;return!0}()&&((o=document.createElement("div")).id="safeview-td-container",o.textContent=r,o.setAttribute("style","position: absolute !important; left: -100px !important; width: 100px !important; top: -100px !important; height: 100px !important; opacity: 0 !important;"),(i=document.createElement("translate-detector")).id="safeview-td-host",i.attachShadow({mode:"open"}),i.shadowRoot.appendChild(o),document.body.appendChild(i),t={characterData:!0,childList:!0,subtree:!0},(n=new MutationObserver((function(t,n){for(a=0;a<t.length;a++)if(("characterData"===(s=t[a]).type||"childList"===s.type)&&(l=o.textContent?o.textContent.trim():"")!==r&&""!==l){e.surrogate_channel.send("page-translation-detected"),r=l;break}}))).observe(o,t))},t.stop=function(){n&&n.disconnect(),i&&i.parentNode&&i.parentNode.removeChild(i),o&&o.parentNode&&o.parentNode.removeChild(o),n=null,i=null,o=null},EventListener.addListener(window,"beforeunload",t.stop,!1),e.callback.registerOnFirst("dom-loaded",t.start)}var safeview,cof_server_frame,MSG_KIND_DATA=1,MSG_KIND_CONTROL=2,MSG_KIND_COMPOSITOR_COMMIT=3,MSG_KIND_CANVAS=4,MSG_KIND_CANVAS_PICTURE=5,MSG_KIND_PARTIAL=6,mf=null,DOM_LOADED_ELEM_ID="__safely_dom_loaded",local_echo_enabled=!1,local_echo_config={};function Safeview(e){var t,r,n=this,i=new Logger("main",{level:"info"}),o={},a=!1,s={},l=Object.freeze({kValueDeviceWidth:-1}),c=null;function d(){var e=this,t={};e.queue=function(e,r){t[e]||(t[e]=[]),t[e].push(r)},e.deliver=function(e,r){var n;t[e]&&(n=t[e],delete t[e],r(n))},e.discard=function(e){var r=t[e];return r&&delete t[e],r},e.count=function(e){return t[e]?t[e].length:0},e.change_top_frame_fid=function(e){t[e]=t[-1],delete t[-1]}}function u(e){var t,r,n="sv-pointer-progress",i="sv-pointer-wait",o=document.getElementById(n),a=document.getElementById(i),s=document.head||document.getElementsByTagName("head")[0];if(assert(e>=0&&e<=2),0===e)return o&&o.parentNode&&o.parentNode.removeChild(o),void(a&&a.parentNode&&a.parentNode.removeChild(a));if(1===e){if(a&&a.parentNode&&a.parentNode.removeChild(a),o)return}else if(o&&o.parentNode&&o.parentNode.removeChild(o),a)return;r="* {cursor:"+(1===e?"progress":"wait")+"} ",r+="input {cursor: progress}",(t=document.createElement("style")).id=1===e?n:i,t.type="text/css",t.styleSheet?t.styleSheet.cssText=r:t.appendChild(document.createTextNode(r)),s.appendChild(t)}function f(e,t){var r;return Util.isDataOrCtrlMessage(e)?assert((r=JSON.parse(Util.utf8ByteDecode(t)))instanceof Array&&r.length>=1,"Malformed command "+r):r=t,safeview.interpret(e,r)}function p(e){var t,r,n,i,o,a,s,l=e.byteOffset,d=e.byteLength;return r=(t=new DataView(e.buffer,l,16)).getUint32(0,!1),n=t.getUint32(4,!1),i=t.getUint32(8,!1),o=t.getUint32(12,!1),a=e.buffer.slice(l+16,l+d),c||(assert(i>1),c={id:r,kind:n,total:i,received:0,data:[]}),assert(c.id===r),assert(c.kind===n),assert(c.total===i),assert(!c.data[o]),c.data[o]=a,c.received+=1,c.received!==c.total||(assert(c),s=c,c=null,f(s.kind,new Uint8Array(Util.join_array_buffers(s.data))))}function g(){n.callback=new CallbackSupport(n),n.callback.register("dom-loaded",(function(e){var t,r,n,i;t=e,n=mf.document.body,i=DOM_LOADED_ELEM_ID,"r2"!==t.mode||t.has_first_commit||(i="__safely_dom_loaded_wait_first_commit"),n&&((r=mf.document.createElement("input")).type="hidden",r.value=JSON.stringify(t),r.id=i,n.appendChild(r))})),n.callback.register("surrogate-channel-connected",(function(e){e&&n.local_events.resize_event(),n.surrogate_channel.send("rttpong",0,0,0)})),n.callback.register("dom-init",(function(e,t){t||safeview.local_events.install_event_listeners(mf.window,mf.document)}))}function m(e){n.fid=e,__init_id_state(e),n.update_queue.deliver(e,n.interpretQueued)}function _(e,t,r){n.ctx_menu_mode||(n.ctx_menu_mode={}),n.ctx_menu_mode.backend_driven=t,n.ctx_menu_mode.native_menu_for_input=r}function h(){safeview.context_menu.display.apply(safeview.context_menu,arguments)}function y(e){n.allow_backend_dragdrop=!0}function v(){window.clearInterval(t),t=null}function k(e,t){}function S(e,t){n.callback.fire("surrogate-will-resize-window"),window.resizeTo(e,t)}function b(e){var t,r={};if(function(e){return e.error?("tab_limit"===e.error?n.ui_frame.call("showTabLimit"):"show_error_page"===e.error?n.ui_frame.call("showErrorPage",e.title,e.message,e.details):"access_denied_redirect"===e.error?Util.locationSet(window,e.redirect_url):n.showError(e.error,e.description),!1):!e.block&&(n.http_alert.configHttpAlert(e),n.preload_indicator.configPreloadIndicator(e),e&&e.client_caps&&(n.perf=e.client_caps.perf,e.client_caps.local_echo&&(local_echo_enabled=e.client_caps.local_echo.enabled,local_echo_config=e.client_caps.local_echo,"Explorer"===browser.name&&(local_echo_config.extended=!1),n.lecho_regulator_ext.apply_config(),n.lecho_error_alert.config_alert(local_echo_enabled))),!0)}(e)){if(n.pairing_dict=e,window.TPROXY_ENABLED&&Util.isFrameBuster()){if(!window.FRAMEBUST.new_window)return void Util.locationSet(window.top,window.location.href);Util.windowOpen(window.location.href)}n.pairing.onPairingComplete(),n.surrogate_channel=function(){var e=n.pairing_dict,t={cid:e.cid,rid:e.rid,tab_id:e.tab_id||1};return e.cluster_id&&(t.cl=e.cluster_id),n.openChannel("surrogate",{use_websockets:n.perf.use_websockets&&("Explorer"!==browser.name||11===browser.version&&n.perf.use_websockets_on_ie11),service_prefix:"/r",query_params:t,on_connect:function(e,t){n.callback.fire("surrogate-channel-connected",t)},on_disconnect:function(e){"client-close"!==e&&"client-detach"!==e&&(Util.isTabVisible()?n.reload("ping-404"===e?0:3e3):(reportClientEvent("tc-detach-from-channel-failure",{}),n.tab.detachAfterChannelClose()))},on_recv:function(e){var t,r,n,i,o,a,s;if(n=new DataView(e,0,4).getUint32(0,!0))for(r=new DataView(e,4,n),s=4+n,i=0;i<n/5&&(a=r.getUint32(5*i,!0),o=r.getUint8(5*i+4),t=new Uint8Array(e,s,a),s+=a,o===MSG_KIND_PARTIAL?p(t):f(o,t));i+=1);},on_report:function(e,t){reportClientEvent(e,t)},url_builder:n.url_builder.buildProtocolUrl,ajax:n.serverCall,on_latency_change:u})}(),Util.isAboutBlankUrl()&&safeview.surrogate_channel.send("get-persistent-policy"),r.through=!0,r.redirect_list=n.pairing_dict.rc_rlist,(t=safeview.url_builder.getDomain("inspect"))&&r.redirect_list&&-1===r.redirect_list.indexOf(t)&&(r.redirect_list+=","+t),r.login_url=n.pairing_dict.rc_url,r.transparent_mode=window.TPROXY_ENABLED,r.url=window.location.href,n.pairing.doCheckRequest(r)}}function w(){var e;for(e in o)o.hasOwnProperty(e)&&n.closeChannel(e)}function C(e){safeview.surrogate_channel&&safeview.surrogate_channel.send.apply(safeview.surrogate_channel,e)}function T(e){var t,r;C(["srm",e==="2".charCodeAt(0)]),t=function(){Util.xframe_reload()},C(["req-ack",r=__randstr(16)]),n.interp.registerOpcodeHandler("ack",(function(e){e===r&&(n.interp.deregisterOpcodeHandler("ack"),t(r))}))}function E(e){if(e.ctrlKey&&e.altKey&&e.shiftKey&&"keydown"===e.type)switch(e.keyCode){case"1".charCodeAt(0):case"2".charCodeAt(0):T(e.keyCode);break;case"S".charCodeAt(0):n.surrogate_view.start("keyboard shortcut");break;case"P".charCodeAt(0):C(["stop-dom"]);break;case"C".charCodeAt(0):C(["throttle-canvas"])}}function A(e){var t={renderer:"",vendor:""},r=e.getExtension("WEBGL_debug_renderer_info");return r&&(t.renderer=e.getParameter(r.UNMASKED_RENDERER_WEBGL),t.vendor=e.getParameter(r.UNMASKED_VENDOR_WEBGL)),t}function R(e){var t,r;try{if((t=document.createElement("canvas")).width=1,t.height=1,document.body.appendChild(t),r=t.getContext(e,{stencil:!0}))return function(e){return{glVersion:e.getParameter(e.VERSION),shadingLanguageVersion:e.getParameter(e.SHADING_LANGUAGE_VERSION),vendor:e.getParameter(e.VENDOR),renderer:e.getParameter(e.RENDERER),card:A(e),antialias:e.getContextAttributes().antialias?"Available":"Not available",redBits:e.getParameter(e.RED_BITS),greenBits:e.getParameter(e.GREEN_BITS),blueBits:e.getParameter(e.BLUE_BITS),alphaBits:e.getParameter(e.ALPHA_BITS),depthBits:e.getParameter(e.DEPTH_BITS),stencilBits:e.getParameter(e.STENCIL_BITS),maxRenderBufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxCombinedTextureImageUnits:e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxCubeMapTextureSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxFragmentUniformVectors:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxVaryingVectors:e.getParameter(e.MAX_VARYING_VECTORS),maxVertexAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexUniformVectors:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),extensions:e.getSupportedExtensions()}}(r)}catch(e){return null}finally{t&&t.parentNode&&t.parentNode.removeChild(t)}return null}function x(){var e,t,r=["webgl","experimental-webgl","webgl2","experimental-webgl2"],n={};for(e=0;e<r.length;e+=1)n[r[e]]=Util.splunkify(R(r[e]));n.wasm="object"==typeof window.WebAssembly,navigator&&(n.nr_cores=navigator.hardwareConcurrency,n.device_memory_gb=navigator.deviceMemory,navigator.javaEnabled&&(n.java_enabled=navigator.javaEnabled()),n.do_not_track=navigator.doNotTrack,n.max_touch_points=navigator.maxTouchPoints,(t=navigator.connection||navigator.mozConnection||navigator.webkitConnection)&&(n.connection=Util.splunkify({downlink:t.downlink,effective_type:t.effectiveType,rtt:t.rtt,save_data:t.saveData})));try{n.avail_canvas_memory=function(){for(var e,t,r=0,n=400*Math.pow(2,20),i=[];r<n&&(e=document.createElement("canvas"))&&(e.width=e.height=1024,t=e.getContext("2d"));)t.clearRect(0,0,1024,1024),i.push(e),r+=e.width*e.height*4;return i.forEach((function(e){e.width=e.height=0})),r}()}catch(e){}return n}e=__object_assign({parseConfig:Util.parseConfig,getContentWindow:function(){return window},enable_active_tab:!0},e||{}),n.setLayoutViewport=function(e){var r,i=[];assert("object"==typeof e),s&&JSON.stringify(s)===JSON.stringify(e)||((r=document.getElementById("svm"))||(r=document.createElement("meta"),document.head.appendChild(r),r.id="svm"),r.setAttribute("name","viewport"),void 0!==e.width&&i.push("width="+function(e){switch(assert(void 0!==e),e){case l.kValueDeviceWidth:return"device-width";default:return e}}(e.width)),void 0!==e.initial_scale&&i.push("initial-scale="+e.initial_scale),void 0!==e.user_zoom&&i.push("user-scalable="+(e.user_zoom?1:0)),void 0!==e.minimum_scale&&i.push("minimum-scale="+e.minimum_scale),void 0!==e.maximum_scale&&i.push("maximum-scale="+e.maximum_scale),r.setAttribute("content",i.join(",")),s=e,t&&v(),function(e){var r=Date.now();t=window.setInterval((function(){n.callback.fire("layout-viewport-props-changed",e),Date.now()-r>1e3&&v()}),100)}(e))},n.getLayoutViewport=function(){return Util.copyDict(s)},n.deregister=function(){n.cof.deregister(),EventListener.removeListener(window,"keydown",E,!1),n.metrics_observer.release(),n.metrics_observer.stop_poll(),n.event_reporter.flush()},n.start=function(e){i.info({event:"tc-started",build_id:BUILD_ID,url:window.location.href}),!0===window.EXPIRED_RELOAD&&reportClientEvent("tc-expired",{time:window.LOAD_TIME,ua:navigator.userAgent}),"true"===Util.getQueryValue(window.location.search,"from_isolation")&&Util.setUrlHint("from_isolation","true"),""===Util.getQueryValue(window.location.search,"__sv_remain_isolate")&&Util.setUrlHint("__sv_remain_isolate",""),e?b(e):Util.getClientHints((function(e){n.pairing.withSurrogateDo({on_complete:b},Util.getDoctypeDecl(window),Util.getFramingStatus(),e)}))},n.setPairing=function(e){n.pairing=e},window.onerror=function(e,t,r,i,o){function a(e){return e?e.toString():null}if("ResizeObserver loop limit exceeded"!==e){try{if("Script error."===e&&BrowserDetect.isChromiumEdge()&&(window.location.hostname.endsWith("bing.com")||/^www\.google(\.com|\.co)?(\.[a-z]+)?$/.test(window.location.hostname)))return}catch(e){}try{!function(e,t,r,i,o){var a,s="Script error."===e?"":printStackTrace(o);a={error_msg:e,url:t||window.location.href,line:r,column:i,stacktrace:s,exception:o?o.toString():null},n.fatalError("tc-uncaught-exception",a)}(e,t,r,i,o)}catch(t){try{reportErrorClientEvent("double-fault",{error_msg:e,"first-exception":a(o),"second-exception":a(t)})}catch(r){window.triple_fault={error_msg:e,"first-exception":a(o),"second-exception":a(t),"third-exception":a(r)}}}}},n.openChannel=function(e,t){var r=new Channel(e,t);return o[e]=r,r},n.closeChannel=function(e){o[e].close(),delete o[e]},n.fatalError=function(e,t){DEBUG&&(w(),n.ui_frame.call("showModal","Crash")),reportErrorClientEvent(e,t)},n.finish=function(){n.compositor&&(n.compositor.release(),n.compositor=null),n.metrics_observer&&n.metrics_observer.release(),n.canvas&&n.canvas.release(),w(),window.reportClientEvent=function(){},safeview.frameset_wrapper&&safeview.frameset_wrapper.uninstall_event_listeners(),n.local_events.uninstall_event_listeners(mf.window,mf.document),n.lecho_regulator_ext.cleanup(),window.onerror=null},n.interpret=function(e,t){var r;return n.stats.start("t_tip"),r=n.interp.processOneCommand(e,t),n.stats.stop("t_tip"),r},n.interpretQueued=function(e){var t;for(t=0;t<e.length&&n.interpret(e[t][0],e[t][1]);t+=1);},n.reset=function(e){try{reportWarnClientEvent("tc-reset",{reason:e}),n.event_reporter&&n.event_reporter.flush(),n.tab_store&&n.tab_store.clear()}catch(e){}Util.xframe_reload(!0)},n.reload=function(e){reportClientEvent("tc-reload-started",{countdown_ms:e}),safeview.finish(),e?new Countdown(e,Util.show_message_bar,(function(){Util.xframe_reload(!0)}),i).restart():Util.xframe_reload(!0)},n.setRenderingModeForTest=T,n.useRemotingV2=function(){return a},n.getLastMousePos=function(){return a?n.compositor.getLastMousePos():n.local_events.get_last_mouse_pos()},n.sendCommand=function(e){safeview.surrogate_channel&&safeview.surrogate_channel.send.apply(safeview.surrogate_channel,e)},n.isMobile=function(){return BrowserDetect.isMobile()},n.isAndroidChrome=function(){return BrowserDetect.isAndroidChrome()},n.isChrome=function(){return BrowserDetect.isChrome()},n.siteflag=function(e){var t={};t[window.location.host]=[e],safeview.sendCommand(["siteflag-override",t])},n.enableComparatorMode=function(){var e;return n.useRemotingV2()?(assert(n.compositor),e=n.compositor.enableComparatorMode()):(assert(n.permission),n.permission.enableComparatorMode()),e},e.parseConfig(),r=e.getContentWindow(),mf={window:r,document:r.document},window.mf=mf,g(),n.server_call=new ServerCall(n),n.serverCall=n.server_call.call,n.template=new Template(n),n.stats=new Stats(n),window.performance&&(window.performance.getEntries?window.performance.getEntries().forEach((function(e){"navigation"===e.entryType&&n.stats.setNavStartTime(e.startTime)})):window.performance.timing&&n.stats.setNavStartTime(window.performance.timing.navigationStart-(Date.now()-Util.now()))),n.event_reporter=new ClientEventReporter(n),n.interp=new Interpreter(n),n.xbrowser=new XBrowserHelpers(n),n.alert=new AlertSupport(n),n.url_builder=new URLBuilder(n),n.tab_store=new TabStorage,n.pairing=new Pairing(n),n.pairing_dict=n.pairing.loadPairingState(),n.cof=new CrossOriginFrame(n,n.url_builder.buildInspectURL(Util.COFPath()),cof_server_frame),n.cof.call(["setDebugFlag",window.DEBUG]),e.enable_active_tab&&(n.active_tab=new ActiveTab(n)),n.history=new HistorySupport(n),n.upload=new UploadSupport(n),window.Permission?n.permission=new Permission(n):n.permission=new PermissionStub(n),n.ui_frame=new UIFrame(n),n.context_menu=new ContextMenu(n),n.feedback_bar=new FeedbackBar(n,window,!0),n.media_objects=new MediaObjects(n),n.media_source_extensions=new MediaSourceExtensions(n),window.EncryptedMediaExtensions&&(n.encrypted_media_extensions=new EncryptedMediaExtensions(n)),window.MediaSession&&(n.media_session=new MediaSession(n)),n.wa_manager=new WebAudioManager(n),n.restore_on_reattach=new RestoreOnReattach(n),n.canvas=new CanvasSupport(n),n.selection=new Selection(n),n.tab=new TabSupport(n),n.voodoo=new BrowserVoodoo(n),n.policy=new PolicySupport(n),n.readonly=new ReadonlySupport(n),n.http_alert=new HttpAlertSupport(n),n.preload_indicator=new PreloadIndicator(n),n.print_handler=new PrintHandler(n),n.imgreq_mgr=new ImageRequestMgr(n),n.local_events=new LocalEvents(n),n.local_input=new LocalInput(n),n.lecho_regulator=new LEchoRegulator(n),n.lecho_regulator_ext=new LEchoRegulatorExt(n),n.lecho_error_alert=new LEchoErrorAlert(n),n.clipboard=new Clipboard(n),n.copy_paste_ctrl=new CopyPasteControl(n),n.watermark_handler=new WatermarkHandler(n),n.text_monitor=new TextMonitor(n),n.frame_loader=new FrameLoader(n),n.dom_updater=new DOMUpdater(n),n.ux=new UX(n,document),n.update_queue=new d,n.sheet_loader=new SheetLoader(n),n.localization=new Localization(n),n.download=new DownloadSupport(n),n.surrogate_view=new SurrogateView(n),n.exit_handler=new ExitHandler(n),n.fullscreen=new Fullscreen(n),n.wheel_ctrl=new WheelCtrl(n),n.key_ctrl=new KeyCtrl(n),n.webauthn=new Webauthn(n),n.fonts=new Fonts(n),n.perf=CLIENT_PERF,n.metrics_observer=new MetricsObserver(n),n.snackbar=new SnackBar(n),n.cloud_debug=new CloudDebug(n),n.translate_detector=new TranslateDetector(n),n.browser_state=new BrowserPrefs(n),n.interp.registerOpcodeHandler("set_top_fid",m),n.interp.registerOpcodeHandler("set_ctxmenu_mode",_),n.interp.registerOpcodeHandler("display_contextmenu",h),n.interp.registerOpcodeHandler("backend_dragdrop",y),n.interp.registerOpcodeHandler("rttping",(function(e,t,r){safeview.rtt_timestamp=e,safeview.surrogate_channel.send("rttpong",e,t,r)})),n.interp.registerOpcodeHandler("anim_ping",(function(e,t){safeview.surrogate_channel.send("anim_pong",e,t)})),n.interp.registerOpcodeHandler("lvpc",k),n.interp.registerOpcodeHandler("resize_window",S),n.interp.registerOpcodeHandler("MPA_session",(function(){})),n.interp.registerOpcodeHandler("reload",(function(){Util.xframe_reload()})),n.interp.registerOpcodeHandler("recording",(function(e){n.feedback_bar.indicateRecord(e)})),n.cof.register(),EventListener.addListener(window,"keydown",E,!1),n.callback.register("dom-init",(function(e){try{n.cof.call(["getFeatureReport"],(function(e){var t;e||(reportClientEvent("tc-feature-report",t=x(),!1),n.cof.call(["setFeatureReport",JSON.stringify(t)]))}))}catch(e){i.error({event:"tc-report-features-error",e:e})}(a=e)&&(n.compositor||(n.compositor=new Compositor.Display(n)))}))}function start(){var e=document.documentElement.getAttribute("sv_role"),t=Util.getParam("sv_itok",!0),r=Util.getParam("sv_reload",!0),n=Util.getParam("_sc_check",!0);t&&(Util.removeParam("sv_itok",t),t=decodeURIComponent(t)),r&&Util.removeParam("sv_reload",r),n&&Util.removeParam("_sc_check",n);try{window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))}catch(e){}switch(e){case"main":(safeview=new Safeview).itok=t;break;case"cof-server":Util.parseConfig(),(safeview=new CrossOriginFrameServer).init();break;default:assert(0)}}start(),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).glMatrix={})}(this,(function(e){var t=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array,n=Math.random,i=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var o=Object.freeze({EPSILON:t,get ARRAY_TYPE(){return r},RANDOM:n,setMatrixArrayType:function(e){r=e},toRadian:function(e){return e*i},equals:function(e,r){return Math.abs(e-r)<=t*Math.max(1,Math.abs(e),Math.abs(r))}});function a(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=r[0],l=r[1],c=r[2],d=r[3];return e[0]=n*s+o*l,e[1]=i*s+a*l,e[2]=n*c+o*d,e[3]=i*c+a*d,e}function s(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}var l=a,c=s,d=Object.freeze({create:function(){var e=new r(4);return r!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new r(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},fromValues:function(e,t,n,i){var o=new r(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o},set:function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},transpose:function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r*o-i*n;return a?(a=1/a,e[0]=o*a,e[1]=-n*a,e[2]=-i*a,e[3]=r*a,e):null},adjoint:function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:a,rotate:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+o*s,e[1]=i*l+a*s,e[2]=n*-s+o*l,e[3]=i*-s+a*l,e},scale:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=r[0],l=r[1];return e[0]=n*s,e[1]=i*s,e[2]=o*l,e[3]=a*l,e},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3])},LDU:function(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},subtract:s,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],l=r[1],c=r[2],d=r[3];return Math.abs(n-s)<=t*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=t*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=t*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-d)<=t*Math.max(1,Math.abs(a),Math.abs(d))},multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},mul:l,sub:c});function u(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=r[0],d=r[1],u=r[2],f=r[3],p=r[4],g=r[5];return e[0]=n*c+o*d,e[1]=i*c+a*d,e[2]=n*u+o*f,e[3]=i*u+a*f,e[4]=n*p+o*g+s,e[5]=i*p+a*g+l,e}function f(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}var p=u,g=f,m=Object.freeze({create:function(){var e=new r(6);return r!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new r(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fromValues:function(e,t,n,i,o,a){var s=new r(6);return s[0]=e,s[1]=t,s[2]=n,s[3]=i,s[4]=o,s[5]=a,s},set:function(e,t,r,n,i,o,a){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=r*o-n*i;return l?(l=1/l,e[0]=o*l,e[1]=-n*l,e[2]=-i*l,e[3]=r*l,e[4]=(i*s-o*a)*l,e[5]=(n*a-r*s)*l,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:u,rotate:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=Math.sin(r),d=Math.cos(r);return e[0]=n*d+o*c,e[1]=i*d+a*c,e[2]=n*-c+o*d,e[3]=i*-c+a*d,e[4]=s,e[5]=l,e},scale:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=r[0],d=r[1];return e[0]=n*c,e[1]=i*c,e[2]=o*d,e[3]=a*d,e[4]=s,e[5]=l,e},translate:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=r[0],d=r[1];return e[0]=n,e[1]=i,e[2]=o,e[3]=a,e[4]=n*c+o*d+s,e[5]=i*c+a*d+l,e},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=0,e[5]=0,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},subtract:f,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=r[0],d=r[1],u=r[2],f=r[3],p=r[4],g=r[5];return Math.abs(n-c)<=t*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-d)<=t*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-u)<=t*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(a-f)<=t*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-p)<=t*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(l-g)<=t*Math.max(1,Math.abs(l),Math.abs(g))},mul:p,sub:g});function _(){var e=new r(9);return r!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function h(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],d=t[7],u=t[8],f=r[0],p=r[1],g=r[2],m=r[3],_=r[4],h=r[5],y=r[6],v=r[7],k=r[8];return e[0]=f*n+p*a+g*c,e[1]=f*i+p*s+g*d,e[2]=f*o+p*l+g*u,e[3]=m*n+_*a+h*c,e[4]=m*i+_*s+h*d,e[5]=m*o+_*l+h*u,e[6]=y*n+v*a+k*c,e[7]=y*i+v*s+k*d,e[8]=y*o+v*l+k*u,e}function y(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}var v=h,k=y,S=Object.freeze({create:_,fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new r(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues:function(e,t,n,i,o,a,s,l,c){var d=new r(9);return d[0]=e,d[1]=t,d[2]=n,d[3]=i,d[4]=o,d[5]=a,d[6]=s,d[7]=l,d[8]=c,d},set:function(e,t,r,n,i,o,a,s,l,c){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],d=t[8],u=d*a-s*c,f=-d*o+s*l,p=c*o-a*l,g=r*u+n*f+i*p;return g?(g=1/g,e[0]=u*g,e[1]=(-d*n+i*c)*g,e[2]=(s*n-i*a)*g,e[3]=f*g,e[4]=(d*r-i*l)*g,e[5]=(-s*r+i*o)*g,e[6]=p*g,e[7]=(-c*r+n*l)*g,e[8]=(a*r-n*o)*g,e):null},adjoint:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],d=t[8];return e[0]=a*d-s*c,e[1]=i*c-n*d,e[2]=n*s-i*a,e[3]=s*l-o*d,e[4]=r*d-i*l,e[5]=i*o-r*s,e[6]=o*c-a*l,e[7]=n*l-r*c,e[8]=r*a-n*o,e},determinant:function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8];return t*(c*o-a*l)+r*(-c*i+a*s)+n*(l*i-o*s)},multiply:h,translate:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],d=t[7],u=t[8],f=r[0],p=r[1];return e[0]=n,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=f*n+p*a+c,e[7]=f*i+p*s+d,e[8]=f*o+p*l+u,e},rotate:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],d=t[7],u=t[8],f=Math.sin(r),p=Math.cos(r);return e[0]=p*n+f*a,e[1]=p*i+f*s,e[2]=p*o+f*l,e[3]=p*a-f*n,e[4]=p*s-f*i,e[5]=p*l-f*o,e[6]=c,e[7]=d,e[8]=u,e},scale:function(e,t,r){var n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r+r,s=n+n,l=i+i,c=r*a,d=n*a,u=n*s,f=i*a,p=i*s,g=i*l,m=o*a,_=o*s,h=o*l;return e[0]=1-u-g,e[3]=d-h,e[6]=f+_,e[1]=d+h,e[4]=1-c-g,e[7]=p-m,e[2]=f-_,e[5]=p+m,e[8]=1-c-u,e},normalFromMat4:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],d=t[8],u=t[9],f=t[10],p=t[11],g=t[12],m=t[13],_=t[14],h=t[15],y=r*s-n*a,v=r*l-i*a,k=r*c-o*a,S=n*l-i*s,b=n*c-o*s,w=i*c-o*l,C=d*m-u*g,T=d*_-f*g,E=d*h-p*g,A=u*_-f*m,R=u*h-p*m,x=f*h-p*_,D=y*x-v*R+k*A+S*E-b*T+w*C;return D?(D=1/D,e[0]=(s*x-l*R+c*A)*D,e[1]=(l*E-a*x-c*T)*D,e[2]=(a*R-s*E+c*C)*D,e[3]=(i*R-n*x-o*A)*D,e[4]=(r*x-i*E+o*T)*D,e[5]=(n*E-r*R-o*C)*D,e[6]=(m*w-_*b+h*S)*D,e[7]=(_*k-g*w-h*v)*D,e[8]=(g*b-m*k+h*y)*D,e):null},projection:function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},subtract:y,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],d=e[7],u=e[8],f=r[0],p=r[1],g=r[2],m=r[3],_=r[4],h=r[5],y=r[6],v=r[7],k=r[8];return Math.abs(n-f)<=t*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-p)<=t*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-g)<=t*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(a-m)<=t*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-_)<=t*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(l-h)<=t*Math.max(1,Math.abs(l),Math.abs(h))&&Math.abs(c-y)<=t*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(d-v)<=t*Math.max(1,Math.abs(d),Math.abs(v))&&Math.abs(u-k)<=t*Math.max(1,Math.abs(u),Math.abs(k))},mul:v,sub:k});function b(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function w(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],d=t[7],u=t[8],f=t[9],p=t[10],g=t[11],m=t[12],_=t[13],h=t[14],y=t[15],v=r[0],k=r[1],S=r[2],b=r[3];return e[0]=v*n+k*s+S*u+b*m,e[1]=v*i+k*l+S*f+b*_,e[2]=v*o+k*c+S*p+b*h,e[3]=v*a+k*d+S*g+b*y,v=r[4],k=r[5],S=r[6],b=r[7],e[4]=v*n+k*s+S*u+b*m,e[5]=v*i+k*l+S*f+b*_,e[6]=v*o+k*c+S*p+b*h,e[7]=v*a+k*d+S*g+b*y,v=r[8],k=r[9],S=r[10],b=r[11],e[8]=v*n+k*s+S*u+b*m,e[9]=v*i+k*l+S*f+b*_,e[10]=v*o+k*c+S*p+b*h,e[11]=v*a+k*d+S*g+b*y,v=r[12],k=r[13],S=r[14],b=r[15],e[12]=v*n+k*s+S*u+b*m,e[13]=v*i+k*l+S*f+b*_,e[14]=v*o+k*c+S*p+b*h,e[15]=v*a+k*d+S*g+b*y,e}function C(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=n+n,l=i+i,c=o+o,d=n*s,u=n*l,f=n*c,p=i*l,g=i*c,m=o*c,_=a*s,h=a*l,y=a*c;return e[0]=1-(p+m),e[1]=u+y,e[2]=f-h,e[3]=0,e[4]=u-y,e[5]=1-(d+m),e[6]=g+_,e[7]=0,e[8]=f+h,e[9]=g-_,e[10]=1-(d+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function T(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function E(e,t){var r=t[0],n=t[1],i=t[2],o=t[4],a=t[5],s=t[6],l=t[8],c=t[9],d=t[10];return e[0]=Math.hypot(r,n,i),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(l,c,d),e}function A(e,t){var n=new r(3);E(n,t);var i=1/n[0],o=1/n[1],a=1/n[2],s=t[0]*i,l=t[1]*o,c=t[2]*a,d=t[4]*i,u=t[5]*o,f=t[6]*a,p=t[8]*i,g=t[9]*o,m=t[10]*a,_=s+u+m,h=0;return _>0?(h=2*Math.sqrt(_+1),e[3]=.25*h,e[0]=(f-g)/h,e[1]=(p-c)/h,e[2]=(l-d)/h):s>u&&s>m?(h=2*Math.sqrt(1+s-u-m),e[3]=(f-g)/h,e[0]=.25*h,e[1]=(l+d)/h,e[2]=(p+c)/h):u>m?(h=2*Math.sqrt(1+u-s-m),e[3]=(p-c)/h,e[0]=(l+d)/h,e[1]=.25*h,e[2]=(f+g)/h):(h=2*Math.sqrt(1+m-s-u),e[3]=(l-d)/h,e[0]=(p+c)/h,e[1]=(f+g)/h,e[2]=.25*h),e}function R(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}var x=w,D=R,I=Object.freeze({create:function(){var e=new r(16);return r!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},clone:function(e){var t=new r(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:function(e,t,n,i,o,a,s,l,c,d,u,f,p,g,m,_){var h=new r(16);return h[0]=e,h[1]=t,h[2]=n,h[3]=i,h[4]=o,h[5]=a,h[6]=s,h[7]=l,h[8]=c,h[9]=d,h[10]=u,h[11]=f,h[12]=p,h[13]=g,h[14]=m,h[15]=_,h},set:function(e,t,r,n,i,o,a,s,l,c,d,u,f,p,g,m,_){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e[9]=d,e[10]=u,e[11]=f,e[12]=p,e[13]=g,e[14]=m,e[15]=_,e},identity:b,transpose:function(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],d=t[8],u=t[9],f=t[10],p=t[11],g=t[12],m=t[13],_=t[14],h=t[15],y=r*s-n*a,v=r*l-i*a,k=r*c-o*a,S=n*l-i*s,b=n*c-o*s,w=i*c-o*l,C=d*m-u*g,T=d*_-f*g,E=d*h-p*g,A=u*_-f*m,R=u*h-p*m,x=f*h-p*_,D=y*x-v*R+k*A+S*E-b*T+w*C;return D?(D=1/D,e[0]=(s*x-l*R+c*A)*D,e[1]=(i*R-n*x-o*A)*D,e[2]=(m*w-_*b+h*S)*D,e[3]=(f*b-u*w-p*S)*D,e[4]=(l*E-a*x-c*T)*D,e[5]=(r*x-i*E+o*T)*D,e[6]=(_*k-g*w-h*v)*D,e[7]=(d*w-f*k+p*v)*D,e[8]=(a*R-s*E+c*C)*D,e[9]=(n*E-r*R-o*C)*D,e[10]=(g*b-m*k+h*y)*D,e[11]=(u*k-d*b-p*y)*D,e[12]=(s*T-a*A-l*C)*D,e[13]=(r*A-n*T+i*C)*D,e[14]=(m*v-g*S-_*y)*D,e[15]=(d*S-u*v+f*y)*D,e):null},adjoint:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],d=t[8],u=t[9],f=t[10],p=t[11],g=t[12],m=t[13],_=t[14],h=t[15];return e[0]=s*(f*h-p*_)-u*(l*h-c*_)+m*(l*p-c*f),e[1]=-(n*(f*h-p*_)-u*(i*h-o*_)+m*(i*p-o*f)),e[2]=n*(l*h-c*_)-s*(i*h-o*_)+m*(i*c-o*l),e[3]=-(n*(l*p-c*f)-s*(i*p-o*f)+u*(i*c-o*l)),e[4]=-(a*(f*h-p*_)-d*(l*h-c*_)+g*(l*p-c*f)),e[5]=r*(f*h-p*_)-d*(i*h-o*_)+g*(i*p-o*f),e[6]=-(r*(l*h-c*_)-a*(i*h-o*_)+g*(i*c-o*l)),e[7]=r*(l*p-c*f)-a*(i*p-o*f)+d*(i*c-o*l),e[8]=a*(u*h-p*m)-d*(s*h-c*m)+g*(s*p-c*u),e[9]=-(r*(u*h-p*m)-d*(n*h-o*m)+g*(n*p-o*u)),e[10]=r*(s*h-c*m)-a*(n*h-o*m)+g*(n*c-o*s),e[11]=-(r*(s*p-c*u)-a*(n*p-o*u)+d*(n*c-o*s)),e[12]=-(a*(u*_-f*m)-d*(s*_-l*m)+g*(s*f-l*u)),e[13]=r*(u*_-f*m)-d*(n*_-i*m)+g*(n*f-i*u),e[14]=-(r*(s*_-l*m)-a*(n*_-i*m)+g*(n*l-i*s)),e[15]=r*(s*f-l*u)-a*(n*f-i*u)+d*(n*l-i*s),e},determinant:function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],d=e[9],u=e[10],f=e[11],p=e[12],g=e[13],m=e[14],_=e[15];return(t*a-r*o)*(u*_-f*m)-(t*s-n*o)*(d*_-f*g)+(t*l-i*o)*(d*m-u*g)+(r*s-n*a)*(c*_-f*p)-(r*l-i*a)*(c*m-u*p)+(n*l-i*s)*(c*g-d*p)},multiply:w,translate:function(e,t,r){var n,i,o,a,s,l,c,d,u,f,p,g,m=r[0],_=r[1],h=r[2];return t===e?(e[12]=t[0]*m+t[4]*_+t[8]*h+t[12],e[13]=t[1]*m+t[5]*_+t[9]*h+t[13],e[14]=t[2]*m+t[6]*_+t[10]*h+t[14],e[15]=t[3]*m+t[7]*_+t[11]*h+t[15]):(n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],d=t[7],u=t[8],f=t[9],p=t[10],g=t[11],e[0]=n,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=d,e[8]=u,e[9]=f,e[10]=p,e[11]=g,e[12]=n*m+s*_+u*h+t[12],e[13]=i*m+l*_+f*h+t[13],e[14]=o*m+c*_+p*h+t[14],e[15]=a*m+d*_+g*h+t[15]),e},scale:function(e,t,r){var n=r[0],i=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},rotate:function(e,r,n,i){var o,a,s,l,c,d,u,f,p,g,m,_,h,y,v,k,S,b,w,C,T,E,A,R,x=i[0],D=i[1],I=i[2],O=Math.hypot(x,D,I);return O<t?null:(x*=O=1/O,D*=O,I*=O,o=Math.sin(n),s=1-(a=Math.cos(n)),l=r[0],c=r[1],d=r[2],u=r[3],f=r[4],p=r[5],g=r[6],m=r[7],_=r[8],h=r[9],y=r[10],v=r[11],k=x*x*s+a,S=D*x*s+I*o,b=I*x*s-D*o,w=x*D*s-I*o,C=D*D*s+a,T=I*D*s+x*o,E=x*I*s+D*o,A=D*I*s-x*o,R=I*I*s+a,e[0]=l*k+f*S+_*b,e[1]=c*k+p*S+h*b,e[2]=d*k+g*S+y*b,e[3]=u*k+m*S+v*b,e[4]=l*w+f*C+_*T,e[5]=c*w+p*C+h*T,e[6]=d*w+g*C+y*T,e[7]=u*w+m*C+v*T,e[8]=l*E+f*A+_*R,e[9]=c*E+p*A+h*R,e[10]=d*E+g*A+y*R,e[11]=u*E+m*A+v*R,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)},rotateX:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[4],a=t[5],s=t[6],l=t[7],c=t[8],d=t[9],u=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*n,e[5]=a*i+d*n,e[6]=s*i+u*n,e[7]=l*i+f*n,e[8]=c*i-o*n,e[9]=d*i-a*n,e[10]=u*i-s*n,e[11]=f*i-l*n,e},rotateY:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],s=t[2],l=t[3],c=t[8],d=t[9],u=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*n,e[1]=a*i-d*n,e[2]=s*i-u*n,e[3]=l*i-f*n,e[8]=o*n+c*i,e[9]=a*n+d*i,e[10]=s*n+u*i,e[11]=l*n+f*i,e},rotateZ:function(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],s=t[2],l=t[3],c=t[4],d=t[5],u=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*n,e[1]=a*i+d*n,e[2]=s*i+u*n,e[3]=l*i+f*n,e[4]=c*i-o*n,e[5]=d*i-a*n,e[6]=u*i-s*n,e[7]=f*i-l*n,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,r,n){var i,o,a,s=n[0],l=n[1],c=n[2],d=Math.hypot(s,l,c);return d<t?null:(s*=d=1/d,l*=d,c*=d,i=Math.sin(r),a=1-(o=Math.cos(r)),e[0]=s*s*a+o,e[1]=l*s*a+c*i,e[2]=c*s*a-l*i,e[3]=0,e[4]=s*l*a-c*i,e[5]=l*l*a+o,e[6]=c*l*a+s*i,e[7]=0,e[8]=s*c*a+l*i,e[9]=l*c*a-s*i,e[10]=c*c*a+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:C,fromQuat2:function(e,t){var n=new r(3),i=-t[0],o=-t[1],a=-t[2],s=t[3],l=t[4],c=t[5],d=t[6],u=t[7],f=i*i+o*o+a*a+s*s;return f>0?(n[0]=2*(l*s+u*i+c*a-d*o)/f,n[1]=2*(c*s+u*o+d*i-l*a)/f,n[2]=2*(d*s+u*a+l*o-c*i)/f):(n[0]=2*(l*s+u*i+c*a-d*o),n[1]=2*(c*s+u*o+d*i-l*a),n[2]=2*(d*s+u*a+l*o-c*i)),C(e,t,n),e},getTranslation:T,getScaling:E,getRotation:A,fromRotationTranslationScale:function(e,t,r,n){var i=t[0],o=t[1],a=t[2],s=t[3],l=i+i,c=o+o,d=a+a,u=i*l,f=i*c,p=i*d,g=o*c,m=o*d,_=a*d,h=s*l,y=s*c,v=s*d,k=n[0],S=n[1],b=n[2];return e[0]=(1-(g+_))*k,e[1]=(f+v)*k,e[2]=(p-y)*k,e[3]=0,e[4]=(f-v)*S,e[5]=(1-(u+_))*S,e[6]=(m+h)*S,e[7]=0,e[8]=(p+y)*b,e[9]=(m-h)*b,e[10]=(1-(u+g))*b,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,r,n,i){var o=t[0],a=t[1],s=t[2],l=t[3],c=o+o,d=a+a,u=s+s,f=o*c,p=o*d,g=o*u,m=a*d,_=a*u,h=s*u,y=l*c,v=l*d,k=l*u,S=n[0],b=n[1],w=n[2],C=i[0],T=i[1],E=i[2],A=(1-(m+h))*S,R=(p+k)*S,x=(g-v)*S,D=(p-k)*b,I=(1-(f+h))*b,O=(_+y)*b,U=(g+v)*w,M=(_-y)*w,F=(1-(f+m))*w;return e[0]=A,e[1]=R,e[2]=x,e[3]=0,e[4]=D,e[5]=I,e[6]=O,e[7]=0,e[8]=U,e[9]=M,e[10]=F,e[11]=0,e[12]=r[0]+C-(A*C+D*T+U*E),e[13]=r[1]+T-(R*C+I*T+M*E),e[14]=r[2]+E-(x*C+O*T+F*E),e[15]=1,e},fromQuat:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r+r,s=n+n,l=i+i,c=r*a,d=n*a,u=n*s,f=i*a,p=i*s,g=i*l,m=o*a,_=o*s,h=o*l;return e[0]=1-u-g,e[1]=d+h,e[2]=f-_,e[3]=0,e[4]=d-h,e[5]=1-c-g,e[6]=p+m,e[7]=0,e[8]=f+_,e[9]=p-m,e[10]=1-c-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,r,n,i,o,a){var s=1/(r-t),l=1/(i-n),c=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(i+n)*l,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0,e},perspective:function(e,t,r,n,i){var o,a=1/Math.tan(t/2);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(n-i),e[10]=(i+n)*o,e[14]=2*i*n*o):(e[10]=-1,e[14]=-2*n),e},perspectiveFromFieldOfView:function(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+s),c=2/(i+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*l*.5,e[9]=(i-o)*c*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e},ortho:function(e,t,r,n,i,o,a){var s=1/(t-r),l=1/(n-i),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*l,e[14]=(a+o)*c,e[15]=1,e},lookAt:function(e,r,n,i){var o,a,s,l,c,d,u,f,p,g,m=r[0],_=r[1],h=r[2],y=i[0],v=i[1],k=i[2],S=n[0],w=n[1],C=n[2];return Math.abs(m-S)<t&&Math.abs(_-w)<t&&Math.abs(h-C)<t?b(e):(u=m-S,f=_-w,p=h-C,o=v*(p*=g=1/Math.hypot(u,f,p))-k*(f*=g),a=k*(u*=g)-y*p,s=y*f-v*u,(g=Math.hypot(o,a,s))?(o*=g=1/g,a*=g,s*=g):(o=0,a=0,s=0),l=f*s-p*a,c=p*o-u*s,d=u*a-f*o,(g=Math.hypot(l,c,d))?(l*=g=1/g,c*=g,d*=g):(l=0,c=0,d=0),e[0]=o,e[1]=l,e[2]=u,e[3]=0,e[4]=a,e[5]=c,e[6]=f,e[7]=0,e[8]=s,e[9]=d,e[10]=p,e[11]=0,e[12]=-(o*m+a*_+s*h),e[13]=-(l*m+c*_+d*h),e[14]=-(u*m+f*_+p*h),e[15]=1,e)},targetTo:function(e,t,r,n){var i=t[0],o=t[1],a=t[2],s=n[0],l=n[1],c=n[2],d=i-r[0],u=o-r[1],f=a-r[2],p=d*d+u*u+f*f;p>0&&(d*=p=1/Math.sqrt(p),u*=p,f*=p);var g=l*f-c*u,m=c*d-s*f,_=s*u-l*d;return(p=g*g+m*m+_*_)>0&&(g*=p=1/Math.sqrt(p),m*=p,_*=p),e[0]=g,e[1]=m,e[2]=_,e[3]=0,e[4]=u*_-f*m,e[5]=f*g-d*_,e[6]=d*m-u*g,e[7]=0,e[8]=d,e[9]=u,e[10]=f,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},subtract:R,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:function(e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],d=e[7],u=e[8],f=e[9],p=e[10],g=e[11],m=e[12],_=e[13],h=e[14],y=e[15],v=r[0],k=r[1],S=r[2],b=r[3],w=r[4],C=r[5],T=r[6],E=r[7],A=r[8],R=r[9],x=r[10],D=r[11],I=r[12],O=r[13],U=r[14],M=r[15];return Math.abs(n-v)<=t*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(i-k)<=t*Math.max(1,Math.abs(i),Math.abs(k))&&Math.abs(o-S)<=t*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(a-b)<=t*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(s-w)<=t*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(l-C)<=t*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(c-T)<=t*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(d-E)<=t*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(u-A)<=t*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(f-R)<=t*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(p-x)<=t*Math.max(1,Math.abs(p),Math.abs(x))&&Math.abs(g-D)<=t*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(m-I)<=t*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(_-O)<=t*Math.max(1,Math.abs(_),Math.abs(O))&&Math.abs(h-U)<=t*Math.max(1,Math.abs(h),Math.abs(U))&&Math.abs(y-M)<=t*Math.max(1,Math.abs(y),Math.abs(M))},mul:x,sub:D});function O(){var e=new r(3);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function U(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function M(e,t,n){var i=new r(3);return i[0]=e,i[1]=t,i[2]=n,i}function F(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function P(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function L(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function N(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.hypot(r,n,i)}function B(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function H(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function V(e,t){var r=t[0],n=t[1],i=t[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function W(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function z(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[0],s=r[1],l=r[2];return e[0]=i*l-o*s,e[1]=o*a-n*l,e[2]=n*s-i*a,e}var G,j=F,Y=P,X=L,q=N,K=B,Q=U,J=H,Z=(G=O(),function(e,t,r,n,i,o){var a,s;for(t||(t=3),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,a=r;a<s;a+=t)G[0]=e[a],G[1]=e[a+1],G[2]=e[a+2],i(G,G,o),e[a]=G[0],e[a+1]=G[1],e[a+2]=G[2];return e}),$=Object.freeze({create:O,clone:function(e){var t=new r(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:U,fromValues:M,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},subtract:F,multiply:P,divide:L,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e},distance:N,squaredDistance:B,squaredLength:H,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:V,dot:W,cross:z,lerp:function(e,t,r,n){var i=t[0],o=t[1],a=t[2];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=a+n*(r[2]-a),e},hermite:function(e,t,r,n,i,o){var a=o*o,s=a*(2*o-3)+1,l=a*(o-2)+o,c=a*(o-1),d=a*(3-2*o);return e[0]=t[0]*s+r[0]*l+n[0]*c+i[0]*d,e[1]=t[1]*s+r[1]*l+n[1]*c+i[1]*d,e[2]=t[2]*s+r[2]*l+n[2]*c+i[2]*d,e},bezier:function(e,t,r,n,i,o){var a=1-o,s=a*a,l=o*o,c=s*a,d=3*o*s,u=3*l*a,f=l*o;return e[0]=t[0]*c+r[0]*d+n[0]*u+i[0]*f,e[1]=t[1]*c+r[1]*d+n[1]*u+i[1]*f,e[2]=t[2]*c+r[2]*d+n[2]*u+i[2]*f,e},random:function(e,t){t=t||1;var r=2*n()*Math.PI,i=2*n()-1,o=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*o,e[1]=Math.sin(r)*o,e[2]=i*t,e},transformMat4:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/a,e[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,e[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,e},transformMat3:function(e,t,r){var n=t[0],i=t[1],o=t[2];return e[0]=n*r[0]+i*r[3]+o*r[6],e[1]=n*r[1]+i*r[4]+o*r[7],e[2]=n*r[2]+i*r[5]+o*r[8],e},transformQuat:function(e,t,r){var n=r[0],i=r[1],o=r[2],a=r[3],s=t[0],l=t[1],c=t[2],d=i*c-o*l,u=o*s-n*c,f=n*l-i*s,p=i*f-o*u,g=o*d-n*f,m=n*u-i*d,_=2*a;return d*=_,u*=_,f*=_,p*=2,g*=2,m*=2,e[0]=s+d+p,e[1]=l+u+g,e[2]=c+f+m,e},rotateX:function(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},rotateY:function(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},rotateZ:function(e,t,r,n){var i=[],o=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e},angle:function(e,t){var r=M(e[0],e[1],e[2]),n=M(t[0],t[1],t[2]);V(r,r),V(n,n);var i=W(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],l=r[2];return Math.abs(n-a)<=t*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=t*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-l)<=t*Math.max(1,Math.abs(o),Math.abs(l))},sub:j,mul:Y,div:X,dist:q,sqrDist:K,len:Q,sqrLen:J,forEach:Z});function ee(){var e=new r(4);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function te(e){var t=new r(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function re(e,t,n,i){var o=new r(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o}function ne(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ie(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function oe(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function ae(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function se(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function le(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function ce(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function de(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.hypot(r,n,i,o)}function ue(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return r*r+n*n+i*i+o*o}function fe(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.hypot(t,r,n,i)}function pe(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function ge(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=n*a,e[2]=i*a,e[3]=o*a,e}function me(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function _e(e,t,r,n){var i=t[0],o=t[1],a=t[2],s=t[3];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=a+n*(r[2]-a),e[3]=s+n*(r[3]-s),e}function he(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function ye(e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],l=r[1],c=r[2],d=r[3];return Math.abs(n-s)<=t*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=t*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=t*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-d)<=t*Math.max(1,Math.abs(a),Math.abs(d))}var ve=ae,ke=se,Se=le,be=de,we=ue,Ce=fe,Te=pe,Ee=function(){var e=ee();return function(t,r,n,i,o,a){var s,l;for(r||(r=4),n||(n=0),l=i?Math.min(i*r+n,t.length):t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}(),Ae=Object.freeze({create:ee,clone:te,fromValues:re,copy:ne,set:ie,add:oe,subtract:ae,multiply:se,divide:le,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:ce,scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},distance:de,squaredDistance:ue,length:fe,squaredLength:pe,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:ge,dot:me,cross:function(e,t,r,n){var i=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],a=r[0]*n[3]-r[3]*n[0],s=r[1]*n[2]-r[2]*n[1],l=r[1]*n[3]-r[3]*n[1],c=r[2]*n[3]-r[3]*n[2],d=t[0],u=t[1],f=t[2],p=t[3];return e[0]=u*c-f*l+p*s,e[1]=-d*c+f*a-p*o,e[2]=d*l-u*a+p*i,e[3]=-d*s+u*o-f*i,e},lerp:_e,random:function(e,t){var r,i,o,a,s,l;t=t||1;do{s=(r=2*n()-1)*r+(i=2*n()-1)*i}while(s>=1);do{l=(o=2*n()-1)*o+(a=2*n()-1)*a}while(l>=1);var c=Math.sqrt((1-s)/l);return e[0]=t*r,e[1]=t*i,e[2]=t*o*c,e[3]=t*a*c,e},transformMat4:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,e[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,e[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,e[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,e},transformQuat:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[0],s=r[1],l=r[2],c=r[3],d=c*n+s*o-l*i,u=c*i+l*n-a*o,f=c*o+a*i-s*n,p=-a*n-s*i-l*o;return e[0]=d*c+p*-a+u*-l-f*-s,e[1]=u*c+p*-s+f*-a-d*-l,e[2]=f*c+p*-l+d*-s-u*-a,e[3]=t[3],e},zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:he,equals:ye,sub:ve,mul:ke,div:Se,dist:be,sqrDist:we,len:Ce,sqrLen:Te,forEach:Ee});function Re(){var e=new r(4);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function xe(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function De(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=r[0],l=r[1],c=r[2],d=r[3];return e[0]=n*d+a*s+i*c-o*l,e[1]=i*d+a*l+o*s-n*c,e[2]=o*d+a*c+n*l-i*s,e[3]=a*d-n*s-i*l-o*c,e}function Ie(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*s,e[1]=i*l+o*s,e[2]=o*l-i*s,e[3]=a*l-n*s,e}function Oe(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l-o*s,e[1]=i*l+a*s,e[2]=o*l+n*s,e[3]=a*l-i*s,e}function Ue(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*s,e[1]=i*l-n*s,e[2]=o*l+a*s,e[3]=a*l-o*s,e}function Me(e,r,n,i){var o,a,s,l,c,d=r[0],u=r[1],f=r[2],p=r[3],g=n[0],m=n[1],_=n[2],h=n[3];return(a=d*g+u*m+f*_+p*h)<0&&(a=-a,g=-g,m=-m,_=-_,h=-h),1-a>t?(o=Math.acos(a),s=Math.sin(o),l=Math.sin((1-i)*o)/s,c=Math.sin(i*o)/s):(l=1-i,c=i),e[0]=l*d+c*g,e[1]=l*u+c*m,e[2]=l*f+c*_,e[3]=l*p+c*h,e}function Fe(e,t){var r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*o+o]-t[3*a+a]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*o+a]-t[3*a+o])*r,e[o]=(t[3*o+i]+t[3*i+o])*r,e[a]=(t[3*a+i]+t[3*i+a])*r}return e}var Pe,Le,Ne,Be,He,Ve,We=te,ze=re,Ge=ne,je=ie,Ye=oe,Xe=De,qe=ce,Ke=me,Qe=_e,Je=fe,Ze=Je,$e=pe,et=$e,tt=ge,rt=he,nt=ye,it=(Pe=O(),Le=M(1,0,0),Ne=M(0,1,0),function(e,t,r){var n=W(t,r);return n<-.999999?(z(Pe,Le,t),Q(Pe)<1e-6&&z(Pe,Ne,t),V(Pe,Pe),xe(e,Pe,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(z(Pe,t,r),e[0]=Pe[0],e[1]=Pe[1],e[2]=Pe[2],e[3]=1+n,tt(e,e))}),ot=(Be=Re(),He=Re(),function(e,t,r,n,i,o){return Me(Be,t,i,o),Me(He,r,n,o),Me(e,Be,He,2*o*(1-o)),e}),at=(Ve=_(),function(e,t,r,n){return Ve[0]=r[0],Ve[3]=r[1],Ve[6]=r[2],Ve[1]=n[0],Ve[4]=n[1],Ve[7]=n[2],Ve[2]=-t[0],Ve[5]=-t[1],Ve[8]=-t[2],tt(e,Fe(e,Ve))}),st=Object.freeze({create:Re,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:xe,getAxisAngle:function(e,r){var n=2*Math.acos(r[3]),i=Math.sin(n/2);return i>t?(e[0]=r[0]/i,e[1]=r[1]/i,e[2]=r[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},multiply:De,rotateX:Ie,rotateY:Oe,rotateZ:Ue,calculateW:function(e,t){var r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e},slerp:Me,random:function(e){var t=n(),r=n(),i=n(),o=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=o*Math.sin(2*Math.PI*r),e[1]=o*Math.cos(2*Math.PI*r),e[2]=a*Math.sin(2*Math.PI*i),e[3]=a*Math.cos(2*Math.PI*i),e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r*r+n*n+i*i+o*o,s=a?1/a:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-i*s,e[3]=o*s,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},fromMat3:Fe,fromEuler:function(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var o=Math.sin(t),a=Math.cos(t),s=Math.sin(r),l=Math.cos(r),c=Math.sin(n),d=Math.cos(n);return e[0]=o*l*d-a*s*c,e[1]=a*s*d+o*l*c,e[2]=a*l*c-o*s*d,e[3]=a*l*d+o*s*c,e},str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},clone:We,fromValues:ze,copy:Ge,set:je,add:Ye,mul:Xe,scale:qe,dot:Ke,lerp:Qe,length:Je,len:Ze,squaredLength:$e,sqrLen:et,normalize:tt,exactEquals:rt,equals:nt,rotationTo:it,sqlerp:ot,setAxes:at});function lt(e,t,r){var n=.5*r[0],i=.5*r[1],o=.5*r[2],a=t[0],s=t[1],l=t[2],c=t[3];return e[0]=a,e[1]=s,e[2]=l,e[3]=c,e[4]=n*c+i*l-o*s,e[5]=i*c+o*a-n*l,e[6]=o*c+n*s-i*a,e[7]=-n*a-i*s-o*l,e}function ct(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}var dt=Ge,ut=Ge;function ft(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=r[4],l=r[5],c=r[6],d=r[7],u=t[4],f=t[5],p=t[6],g=t[7],m=r[0],_=r[1],h=r[2],y=r[3];return e[0]=n*y+a*m+i*h-o*_,e[1]=i*y+a*_+o*m-n*h,e[2]=o*y+a*h+n*_-i*m,e[3]=a*y-n*m-i*_-o*h,e[4]=n*d+a*s+i*c-o*l+u*y+g*m+f*h-p*_,e[5]=i*d+a*l+o*s-n*c+f*y+g*_+p*m-u*h,e[6]=o*d+a*c+n*l-i*s+p*y+g*h+u*_-f*m,e[7]=a*d-n*s-i*l-o*c+g*y-u*m-f*_-p*h,e}var pt=ft,gt=Ke,mt=Je,_t=mt,ht=$e,yt=ht,vt=Object.freeze({create:function(){var e=new r(8);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},clone:function(e){var t=new r(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},fromValues:function(e,t,n,i,o,a,s,l){var c=new r(8);return c[0]=e,c[1]=t,c[2]=n,c[3]=i,c[4]=o,c[5]=a,c[6]=s,c[7]=l,c},fromRotationTranslationValues:function(e,t,n,i,o,a,s){var l=new r(8);l[0]=e,l[1]=t,l[2]=n,l[3]=i;var c=.5*o,d=.5*a,u=.5*s;return l[4]=c*i+d*n-u*t,l[5]=d*i+u*e-c*n,l[6]=u*i+c*t-d*e,l[7]=-c*e-d*t-u*n,l},fromRotationTranslation:lt,fromTranslation:function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},fromRotation:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},fromMat4:function(e,t){var n=Re();A(n,t);var i=new r(3);return T(i,t),lt(e,n,i),e},copy:ct,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},set:function(e,t,r,n,i,o,a,s,l){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=l,e},getReal:dt,getDual:function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},setReal:ut,setDual:function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},getTranslation:function(e,t){var r=t[4],n=t[5],i=t[6],o=t[7],a=-t[0],s=-t[1],l=-t[2],c=t[3];return e[0]=2*(r*c+o*a+n*l-i*s),e[1]=2*(n*c+o*s+i*a-r*l),e[2]=2*(i*c+o*l+r*s-n*a),e},translate:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=.5*r[0],l=.5*r[1],c=.5*r[2],d=t[4],u=t[5],f=t[6],p=t[7];return e[0]=n,e[1]=i,e[2]=o,e[3]=a,e[4]=a*s+i*c-o*l+d,e[5]=a*l+o*s-n*c+u,e[6]=a*c+n*l-i*s+f,e[7]=-n*s-i*l-o*c+p,e},rotateX:function(e,t,r){var n=-t[0],i=-t[1],o=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],d=t[7],u=s*a+d*n+l*o-c*i,f=l*a+d*i+c*n-s*o,p=c*a+d*o+s*i-l*n,g=d*a-s*n-l*i-c*o;return Ie(e,t,r),n=e[0],i=e[1],o=e[2],a=e[3],e[4]=u*a+g*n+f*o-p*i,e[5]=f*a+g*i+p*n-u*o,e[6]=p*a+g*o+u*i-f*n,e[7]=g*a-u*n-f*i-p*o,e},rotateY:function(e,t,r){var n=-t[0],i=-t[1],o=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],d=t[7],u=s*a+d*n+l*o-c*i,f=l*a+d*i+c*n-s*o,p=c*a+d*o+s*i-l*n,g=d*a-s*n-l*i-c*o;return Oe(e,t,r),n=e[0],i=e[1],o=e[2],a=e[3],e[4]=u*a+g*n+f*o-p*i,e[5]=f*a+g*i+p*n-u*o,e[6]=p*a+g*o+u*i-f*n,e[7]=g*a-u*n-f*i-p*o,e},rotateZ:function(e,t,r){var n=-t[0],i=-t[1],o=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],d=t[7],u=s*a+d*n+l*o-c*i,f=l*a+d*i+c*n-s*o,p=c*a+d*o+s*i-l*n,g=d*a-s*n-l*i-c*o;return Ue(e,t,r),n=e[0],i=e[1],o=e[2],a=e[3],e[4]=u*a+g*n+f*o-p*i,e[5]=f*a+g*i+p*n-u*o,e[6]=p*a+g*o+u*i-f*n,e[7]=g*a-u*n-f*i-p*o,e},rotateByQuatAppend:function(e,t,r){var n=r[0],i=r[1],o=r[2],a=r[3],s=t[0],l=t[1],c=t[2],d=t[3];return e[0]=s*a+d*n+l*o-c*i,e[1]=l*a+d*i+c*n-s*o,e[2]=c*a+d*o+s*i-l*n,e[3]=d*a-s*n-l*i-c*o,s=t[4],l=t[5],c=t[6],d=t[7],e[4]=s*a+d*n+l*o-c*i,e[5]=l*a+d*i+c*n-s*o,e[6]=c*a+d*o+s*i-l*n,e[7]=d*a-s*n-l*i-c*o,e},rotateByQuatPrepend:function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=r[0],l=r[1],c=r[2],d=r[3];return e[0]=n*d+a*s+i*c-o*l,e[1]=i*d+a*l+o*s-n*c,e[2]=o*d+a*c+n*l-i*s,e[3]=a*d-n*s-i*l-o*c,s=r[4],l=r[5],c=r[6],d=r[7],e[4]=n*d+a*s+i*c-o*l,e[5]=i*d+a*l+o*s-n*c,e[6]=o*d+a*c+n*l-i*s,e[7]=a*d-n*s-i*l-o*c,e},rotateAroundAxis:function(e,r,n,i){if(Math.abs(i)<t)return ct(e,r);var o=Math.hypot(n[0],n[1],n[2]);i*=.5;var a=Math.sin(i),s=a*n[0]/o,l=a*n[1]/o,c=a*n[2]/o,d=Math.cos(i),u=r[0],f=r[1],p=r[2],g=r[3];e[0]=u*d+g*s+f*c-p*l,e[1]=f*d+g*l+p*s-u*c,e[2]=p*d+g*c+u*l-f*s,e[3]=g*d-u*s-f*l-p*c;var m=r[4],_=r[5],h=r[6],y=r[7];return e[4]=m*d+y*s+_*c-h*l,e[5]=_*d+y*l+h*s-m*c,e[6]=h*d+y*c+m*l-_*s,e[7]=y*d-m*s-_*l-h*c,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e},multiply:ft,mul:pt,scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e},dot:gt,lerp:function(e,t,r,n){var i=1-n;return gt(t,r)<0&&(n=-n),e[0]=t[0]*i+r[0]*n,e[1]=t[1]*i+r[1]*n,e[2]=t[2]*i+r[2]*n,e[3]=t[3]*i+r[3]*n,e[4]=t[4]*i+r[4]*n,e[5]=t[5]*i+r[5]*n,e[6]=t[6]*i+r[6]*n,e[7]=t[7]*i+r[7]*n,e},invert:function(e,t){var r=ht(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},length:mt,len:_t,squaredLength:ht,sqrLen:yt,normalize:function(e,t){var r=ht(t);if(r>0){r=Math.sqrt(r);var n=t[0]/r,i=t[1]/r,o=t[2]/r,a=t[3]/r,s=t[4],l=t[5],c=t[6],d=t[7],u=n*s+i*l+o*c+a*d;e[0]=n,e[1]=i,e[2]=o,e[3]=a,e[4]=(s-n*u)/r,e[5]=(l-i*u)/r,e[6]=(c-o*u)/r,e[7]=(d-a*u)/r}return e},str:function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},equals:function(e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],d=e[7],u=r[0],f=r[1],p=r[2],g=r[3],m=r[4],_=r[5],h=r[6],y=r[7];return Math.abs(n-u)<=t*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-f)<=t*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-p)<=t*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-g)<=t*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-m)<=t*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(l-_)<=t*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-h)<=t*Math.max(1,Math.abs(c),Math.abs(h))&&Math.abs(d-y)<=t*Math.max(1,Math.abs(d),Math.abs(y))}});function kt(){var e=new r(2);return r!=Float32Array&&(e[0]=0,e[1]=0),e}function St(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function bt(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function wt(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function Ct(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.hypot(r,n)}function Tt(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function Et(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function At(e){var t=e[0],r=e[1];return t*t+r*r}var Rt=Et,xt=St,Dt=bt,It=wt,Ot=Ct,Ut=Tt,Mt=At,Ft=function(){var e=kt();return function(t,r,n,i,o,a){var s,l;for(r||(r=2),n||(n=0),l=i?Math.min(i*r+n,t.length):t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],o(e,e,a),t[s]=e[0],t[s+1]=e[1];return t}}(),Pt=Object.freeze({create:kt,clone:function(e){var t=new r(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var n=new r(2);return n[0]=e,n[1]=t,n},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,r){return e[0]=t,e[1]=r,e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},subtract:St,multiply:bt,divide:wt,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},distance:Ct,squaredDistance:Tt,length:Et,squaredLength:At,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:function(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},cross:function(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e},lerp:function(e,t,r,n){var i=t[0],o=t[1];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e},random:function(e,t){t=t||1;var r=2*n()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},transformMat2:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e},transformMat2d:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e},transformMat3:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e},transformMat4:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e},rotate:function(e,t,r,n){var i=t[0]-r[0],o=t[1]-r[1],a=Math.sin(n),s=Math.cos(n);return e[0]=i*s-o*a+r[0],e[1]=i*a+o*s+r[1],e},angle:function(e,t){var r=e[0],n=e[1],i=t[0],o=t[1],a=r*r+n*n;a>0&&(a=1/Math.sqrt(a));var s=i*i+o*o;s>0&&(s=1/Math.sqrt(s));var l=(r*i+n*o)*a*s;return l>1?0:l<-1?Math.PI:Math.acos(l)},zero:function(e){return e[0]=0,e[1]=0,e},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equals:function(e,r){var n=e[0],i=e[1],o=r[0],a=r[1];return Math.abs(n-o)<=t*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=t*Math.max(1,Math.abs(i),Math.abs(a))},len:Rt,sub:xt,mul:Dt,div:It,dist:Ot,sqrDist:Ut,sqrLen:Mt,forEach:Ft});e.glMatrix=o,e.mat2=d,e.mat2d=m,e.mat3=S,e.mat4=I,e.quat=st,e.quat2=vt,e.vec2=Pt,e.vec3=$,e.vec4=Ae,Object.defineProperty(e,"__esModule",{value:!0})})),/*! https://mths.be/utf8js v3.0.0 by @mathias */
function(e){var t,r,n,i=String.fromCharCode;function o(){if(n>=r)throw Error("Invalid byte index");var e=255&t[n];if(n++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function a(){var e,i;if(n>r)throw Error("Invalid byte index");if(n==r)return!1;if(e=255&t[n],n++,0==(128&e))return e;if(192==(224&e)){if((i=(31&e)<<6|o())>=128)return i;throw Error("Invalid continuation byte")}if(224==(240&e)){if((i=(15&e)<<12|o()<<6|o())>=2048)return function(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}(i),i;throw Error("Invalid continuation byte")}if(240==(248&e)&&(i=(7&e)<<18|o()<<12|o()<<6|o())>=65536&&i<=1114111)return i;throw Error("Invalid UTF-8 detected")}e.decodeByteArray=function(e){r=(t=e).length,n=0;for(var o,s=[];!1!==(o=a());)s.push(o);return function(e){for(var t,r=e.length,n=-1,o="";++n<r;)(t=e[n])>65535&&(o+=i((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=i(t);return o}(s)}}(this.utf8={});var Sk={Verb:Object.freeze({Save:0,SaveLayer:1,Restore:2,Concat:3,ClipRect:4,ClipRRect:5,ClipPath:6,ClipRegion:7,DrawArc:8,DrawAtlas:9,DrawDRRect:10,DrawText:11,DrawPosText:12,DrawPosTextH:13,DrawRegion:14,DrawTextOnPath:15,DrawTextBlob:16,DrawTextRSXform:17,DrawPatch:18,DrawPaint:19,DrawPoints:20,DrawRect:21,DrawPath:22,DrawOval:23,DrawRRect:24,DrawImage:25,DrawImageRect:26,DrawImageNine:27,DrawImageLattice:28,DrawVertices:29,DrawPicture:30,DrawAnnotation:31,DefineImage:32,DefineImageURL:33,DefinePath:34,DefineGlyph:35,DefineTextBlob:36,DefinePaint:37,DefinePicture:38,DefineRasterPicture:39,DefineTypeface:40,DefineFontData:41,DefineDrawOps:42,DefineHitTestData:43,DefineImageRewrittenURL:44,DefineFlattenable:45,EndDefinitions:46}),HT:{DisplayItemType:Object.freeze({kOther:0,kDrawingPaintPhase:1,kBoxDecorationBackground:2,kCaret:3,kDebugDrawing:4,kScrollCorner:5,kScrollbar:6}),ElementType:Object.freeze({kUnknown:0,kFormControl:1,kTextNode:2,kElementNode:3,kInnerEditorElement:4,kImageElement:5,kPlugInElement:6,kCustomScrollbar:7,kDataListIndicator:8,kPickerIndicator:9}),ElementFlags:Object.freeze({kHitTestable:1,kHasLink:2,kInShadowTree:4,kHasInputElementOwner:8,kHasTextAreaOwner:16,kHasContentEditableOwner:32,kHasDebugData:64,kHasCursor:128,kSelectable:256,kIsPlaceholderText:512,kHasTemporalElementOwner:1024,kHasColorInputOwner:2048,kInsideBlockingTouchEventHandler:4096,kHasScrollableContainerId:8192,kBackgroundPaintInContentsSpace:16384}),GenericFontFamily:Object.freeze({kNoFamily:0,kStandardFamily:1,kSerifFamily:2,kSansSerifFamily:3,kMonospaceFamily:4,kCursiveFamily:5,kFantasyFamily:6}),FontStyle:Object.freeze({kNormal:0,kItalic:1,kOblique:2}),FontFlags:Object.freeze({kWebFont:1,kRightToLeft:2,kAntialiased:4,kUseKerning:8,kSmallCaps:16,kHasStretchOrSpacing:32}),TextAlign:Object.freeze({kLeft:0,kRight:1,kCenter:2,kJustify:3,kStart:4,kEnd:5}),CursorType:Object.freeze({kUnknown:0,kNone:1,kCopy:2,kAuto:3,kCrosshair:4,kDefault:5,kPointer:6,kMove:7,kVerticalText:8,kCell:9,kContextMenu:10,kAlias:11,kProgress:12,kNoDrop:13,kNotAllowed:14,kZoomIn:15,kZoomOut:16,kEResize:17,kNeResize:18,kNwResize:19,kNResize:20,kSeResize:21,kSwResize:22,kSResize:23,kWResize:24,kEwResize:25,kNsResize:26,kNeswResize:27,kNwseResize:28,kColResize:29,kRowResize:30,kText:31,kWait:32,kHelp:33,kAllScroll:34,kGrab:35,kGrabbing:36}),FormControlElement:Object.freeze({Type:{kUnknown:0,kInput:1,kTextArea:2,kSelect:3,kContentEditable:4},Flags:{kDisabled:1,kReadOnly:2,kAutoComplete:4,kSupportsFocus:8,kAutoCapitalize:16,kRequired:32,kRightToLeft:64,kHasEnterKeyHint:128,kHasTextAreaInfo:256}}),DataListOptionItem:Object.freeze({Flags:{kDisabled:1,kHasValue:2}}),DataListElement:Object.freeze({Flags:{kDisabled:1}}),InputElement:Object.freeze({Type:{kUnknown:0,kEmail:1,kFile:2,kMonth:3,kNumber:4,kPassword:5,kSearch:6,kTel:7,kText:8,kTime:9,kUrl:10,kWeek:11,kRange:12,kDate:13,kDatetimeLocal:14,kColor:15},Flags:{kAutoComplete:1,kIsBaseTemporal:2,kHasDataList:4}}),SelectElement:Object.freeze({Flags:{kUsesMenuList:1,kLast:255}}),SelectItem:Object.freeze({Type:{kUnknown:0,kSeparator:1,kGroup:2,kOption:3},Flags:{kChecked:1,kEnabled:2,kInGroup:4,kHidden:8}}),TextAreaElement:Object.freeze({Flags:{kHasFormOwner:1,kLast:255}}),CustomScrollbar:Object.freeze({Flags:{kIsHorizontal:1,kIsLeftSideVertical:2,kJumpOnTrackClick:4,kSupportsDragSnapBack:8,kLastScrollbarProp:65535}})},SE:Object.freeze({Type:Object.freeze({kShadowAnchorNode:0,kShadowSelect:1,kShadowTextControl:2,kShadowTextNode:3,kShadowImageNode:4})}),FontSlant:Object.freeze({kNormal:0,kItalic:1,kOblique:2}),FontStretch:Object.freeze({kUltraCondensed_Width:1,kExtraCondensed_Width:2,kCondensed_Width:3,kSemiCondensed_Width:4,kNormal_Width:5,kSemiExpanded_Width:6,kExpanded_Width:7,kExtraExpanded_Width:8,kUltraExpanded_Width:9}),SaveLayerMask:Object.freeze({Flags:255,HasBounds:256,HasPaint:512,HasBackdrop:1024,DontClipToLayer:2048,HasClipMask:4096,HasClipMatrix:8192,MustCoverDst:16384}),TypeMask:Object.freeze({SetMatrix:16,Float16:32}),MatrixMask:Object.freeze({Translate:1,Scale:2,Affine:4,Perspective:8}),DrawImageMask:Object.freeze({HasPaint:1}),DrawImageRectMask:Object.freeze({Constraint:1,HasPaint:2,HasSrcRect:4}),DrawPictureMask:Object.freeze({HasMatrix:1<<21,HasPaint:1<<22}),ClipOp:Object.freeze({kDifference:0,kIntersect:1}),PathDirection:Object.freeze({kCW_Direction:0,kCCW_Direction:1}),FillRule:Object.freeze({kWinding:0,kEvenOdd:1,kInverseWinding:2,kInverseEvenOdd:3}),GlyphPositioning:Object.freeze({kDefault:0,kHorizontal:1,kFull:2}),NonDef:Object.freeze({kTextSize:1,kTextScaleX:2,kTextSkewX:4,kStrokeWidth:8,kStrokeMiter:16,kColor:32,kTypeface:64,kPathEffect:128,kShader:256,kMaskFilter:512,kColorFilter:1024,kRasterizer:2048,kImageFilter:4096}),Color:Object.freeze({BLACK:4278190080,RED:4294901760,getAlpha:function(e){return e>>24&255},isTransparent:function(e){return 0===this.getAlpha(e)},isOpaque:function(e){return 255===this.getAlpha(e)}}),NamedColorSpace:Object.freeze({kSRGB:0,kAdobeRGB:1,kSRGBLinear:2}),GradientSerializationFlags:Object.freeze({kHasPosition:2147483648,kHasLegacyLocalMatrix:1073741824,kHasColorSpace:536870912,kHasLocalMatrix:1048576,kTileModeShift:8,kTileModeMask:15,kInterpolationColorSpaceShift:4,kInterpolationColorSpaceMask:15,kInterpolationHueMethodShift:1,kInterpolationHueMethodMask:7,kInterpolationInPremul:1}),PackedGlyphID:Object.freeze({Type:{kNone:0,kPath:1,kImage:2},Flags:{kGlyphIDLen:16,kGlyphTypeLen:3,kGlyphType:20,kGlyphID:2,kGlyphIDMask:65535,kGlyphTypeMask:7}}),BlendMode:Object.freeze({kClear:0,kSrc:1,kDst:2,kSrcOver:3,kDstOver:4,kSrcIn:5,kDstIn:6,kSrcOut:7,kDstOut:8,kSrcATop:9,kDstATop:10,kXor:11,kPlus:12,kModulate:13,kScreen:14,kOverlay:15,kDarken:16,kLighten:17,kColorDodge:18,kColorBurn:19,kHardLight:20,kSoftLight:21,kDifference:22,kExclusion:23,kMultiply:24,kHue:25,kSaturation:26,kColor:27,kLuminosity:28,kCustom_SkBlendMode:255,kArithmetic_SkBlendMode:256}),PaintUsage:Object.freeze({kText:1,kGeometry:2,kImage:4,kPaint:8,kAll:4294967295}),TileMode:Object.freeze({kClamp:0,kRepeat:1,kMirror:2,kDecal:3}),PointMode:Object.freeze({kPoints:0,kLines:1,kPolygon:2}),PathVerb:Object.freeze({kMove:0,kLine:1,kQuad:2,kConic:3,kCubic:4,kClose:5,kArc:6}),RRectType:Object.freeze({kEmpty:0,kRect:1,kOval:2,kSimple:3,kNinePatch:4,kComplex:5,kLast:6}),FilterQuality:Object.freeze({kNone:0,kLow:1,kMedium:2,kHigh:3}),DefineImageExtra:Object.freeze({kHintLoadSync:1,kShouldAnimate:2,kCanvasSnapshot:4,kSrcCanvasAttached:8,kFromVideoNode:16,kIncompleteDataUrl:32,kDecodeAnimatedImage:64}),PictureFlags:Object.freeze({kHasText:1,kHasPaths:2,kHasPictures:4,kHasImages:8,kHasFillGeometry:16,kHintDoNotCache:32,kHintDoNotRasterCache:64,kHasRasterSubPicture:128,kHasHardCompositingOp:256,kHasBlendOp:512,kHasComplexClip:1024,kHasColorFilter:2048,kHintNeedsTextureSync:4096,kHasImageFilter:8192,kIsPictureShader:16384,kHasCSSGradientShader:32768,kIsCanvasSnapshot:65536,kHasSweepGradientPictureShader:1<<17}),CropEdge:Object.freeze({kHasLeft_CropEdge:1,kHasTop_CropEdge:2,kHasWidth_CropEdge:4,kHasHeight_CropEdge:8,kHasAll_CropEdge:15}),ScrollbarPart:Object.freeze({kNoPart:0,kBackButtonStartPart:1,kForwardButtonStartPart:2,kBackTrackPart:4,kThumbPart:8,kForwardTrackPart:16,kBackButtonEndPart:32,kForwardButtonEndPart:64,kScrollbarBGPart:128,kTrackBGPart:256,kAllParts:4294967295}),DebugFlags:Object.freeze({kDebugEnabled:1,kHighlightRasterCacheItems:2}),setDebugEnabled:function(e){e?this.debugFlags|=Sk.DebugFlags.kDebugEnabled:this.debugFlags&=~Sk.DebugFlags.kDebugEnabled},isDebugEnabled:function(){return!!(this.debugFlags&Sk.DebugFlags.kDebugEnabled)},setDebugFlags:function(e){this.debugFlags=e},getDebugFlags:function(){return this.debugFlags},setImageQuality:function(e,t){this.imageQuality=[t||e,e]},getImageQuality:function(){return this.imageQuality},init:function(e,t){var r,n;for(n in Function.prototype.curry||(Function.prototype.curry=function(){var e=this,t=Array.prototype.slice.call(arguments);return function(){return e.apply(this,t.concat(Array.prototype.slice.call(arguments)))}}),t)t.hasOwnProperty(n)&&(Sk[n]=t[n]);for(n in Sk.maxRasterArea,Sk.maxPlatformCanvasArea,e)e.hasOwnProperty(n)&&(r=e[n],this.canvasMemoryLimit[n]=r,this.canvasMemoryUsage[n]=0)},fini:function(){var e;for(e in Sk.waitCanvasCbById={},Sk.canvasKeyToDeviceId={},Sk.hiddenCanvasCache&&Sk.hiddenCanvasCache.clear(),Sk.htmlCanvasDeviceById)Sk.htmlCanvasDeviceById.hasOwnProperty(e)&&Sk.htmlCanvasDeviceById[e].release()},flushCaches:function(){},decodeUTF8ByteArray:function(e){return window.TextDecoder?new window.TextDecoder("utf-8").decode(e):window.utf8.decodeByteArray(e)},getOrCreateHiddenCanvasCache:function(){var e;return Sk.hiddenCanvasCache||(e=Sk.canvasMemoryLimit.invisible,Sk.hiddenCanvasCache=new Sk.LRU(e,(function(e){e.value.release()}))),Sk.hiddenCanvasCache},getCanvasDeviceByCanvasKey:function(e){var t;return Sk.canvasKeyToDeviceId.hasOwnProperty(e)?(t=Sk.canvasKeyToDeviceId[e],Sk.htmlCanvasDeviceById[t]):null},waitForCanvas:function(e,t){var r=Sk.getCanvasDeviceByCanvasKey(e);r?t(r):(Sk.waitCanvasCbById.hasOwnProperty(e)||(Sk.waitCanvasCbById[e]=[]),Sk.waitCanvasCbById[e].push(t))},onCanvasKeyChange:function(e,t,r){delete Sk.canvasKeyToDeviceId[e],Sk.canvasKeyToDeviceId[t]=r,Sk.waitCanvasCbById.hasOwnProperty(t)&&(Sk.waitCanvasCbById[t].forEach((function(e){e(Sk.getCanvasDeviceByCanvasKey(t))})),delete Sk.waitCanvasCbById[t])},setRemoteCanvasSrcCallback:function(e){Sk.remote_canvas_src_cb=e},fallbackToRemoteCanvasSrc:function(e){Sk.remote_canvas_src_cb,Sk.waitCanvasCbById={},Sk.canvasKeyToDeviceId={},Sk.remote_canvas_src_cb&&(Sk.remote_canvas_src_cb(e),delete Sk.remote_canvas_src_cb),Sk.hiddenCanvasCache&&(Sk.hiddenCanvasCache.clear(),Sk.hiddenCanvasCache=null)},nextCanvasId:0,nextHTMLCanvasDeviceId:0,nextDOMDeviceId:0,nextImageId:0,nextTextFitterId:0,debugFlags:0,subPixelPrecision:.5,maxSubPixelPrecision:1/64,maxPlatformCanvasArea:16777216,maxRasterArea:262144,imageQuality:[.8,.6],defaultMaxImageLoadRetries:3,defaultMaxConcurrentImageLoads:3,canvasMemoryUsage:{},canvasMemoryLimit:{},rasterCacheUseThreshold:2,htmlCanvasDeviceById:{},disabledRemoteCaret:!1,focusedElementInfoByNodeId:{},hiddenCanvasCache:null,canvasKeyToDeviceId:{},waitCanvasCbById:{}};Sk.Paint=new function(){var e=this;e.Flags=Object.freeze({kAntiAlias:1,kDither:4,kFakeBoldText:32,kLinearText:64,kSubpixelText:128,kDevKernText:256,kLCDRenderText:512,kEmbeddedBitmapText:1024,kAutoHinting:2048,kVerticalText:4096,kAllFlags:65535}),e.Align=Object.freeze({kLeft:0,kCenter:1,kRight:2}),e.Hinting=Object.freeze({kNo:0,kSlight:1,kNormal:2,kFull:3}),e.Style=Object.freeze({kFill_Style:0,kStroke_Style:1,kStrokeAndFill_Style:2}),e.Cap=Object.freeze({kButt:0,kRound:1,kSquare:2}),e.Join=Object.freeze({kMiter:0,kRound:1,kBevel:2}),e.TextEncoding=Object.freeze({kUTF8:0,kUTF16:1,kUTF32:2,kGlyphID:3}),e.skColorToCSSColor=function(e){return"rgba("+(e>>16&255)+","+(e>>8&255)+","+(255&e)+","+(e>>24&255)/255+")"},e.skColorToCanvasAlpha=function(e){return(e>>24&255)/255},e.rgbToHexadecimalColor=function(e,t,r){return[e,t,r].reduce((function(e,t){return e+t.toString(16).padStart(2,"0")}),"#")},e.skColorToHexadecimalColor=function(t){var r=t>>16&255,n=t>>8&255,i=255&t;return e.rgbToHexadecimalColor(r,n,i)},e.skNamedColorSpaceToColorInterpolation=function(e){switch(e){case Sk.NamedColorSpace.kSRGB:return"sRGB";case Sk.NamedColorSpace.kSRGBLinear:return"linearRGB";default:return"auto"}},e.skFillRuleToCanvasFillRule=function(e){switch(e){case Sk.FillRule.kWinding:return"nonzero";case Sk.FillRule.kEvenOdd:return"evenodd";default:return"nonzero"}},e.skFilterQualityToCanvasFilterQuality=function(e){switch(e){case Sk.FilterQuality.kNone:return"none";case Sk.FilterQuality.kLow:return"low";case Sk.FilterQuality.kMedium:return"medium";case Sk.FilterQuality.kHigh:return"high"}return null},e.isCompositingOp=function(e){switch(e){case Sk.BlendMode.kClear:case Sk.BlendMode.kSrc:case Sk.BlendMode.kSrcOver:case Sk.BlendMode.kDstOver:case Sk.BlendMode.kSrcIn:case Sk.BlendMode.kDstIn:case Sk.BlendMode.kSrcOut:case Sk.BlendMode.kDstOut:case Sk.BlendMode.kSrcATop:case Sk.BlendMode.kDstATop:case Sk.BlendMode.kXor:case Sk.BlendMode.kArithmetic_SkBlendMode:return!0;default:return!1}},e.isBlendOp=function(t){return!e.isCompositingOp(t)},e.skBlendModeToCompositeOp=function(e){switch(e){case Sk.BlendMode.kClear:return"clear";case Sk.BlendMode.kSrc:return"copy";case Sk.BlendMode.kSrcOver:return"source-over";case Sk.BlendMode.kDstOver:return"destination-over";case Sk.BlendMode.kSrcIn:return"source-in";case Sk.BlendMode.kDstIn:return"destination-in";case Sk.BlendMode.kSrcOut:return"source-out";case Sk.BlendMode.kDstOut:return"destination-out";case Sk.BlendMode.kSrcATop:return"source-atop";case Sk.BlendMode.kDstATop:return"destination-atop";case Sk.BlendMode.kXor:return"xor";case Sk.BlendMode.kPlus:case Sk.BlendMode.kScreen:return"screen";case Sk.BlendMode.kOverlay:return"overlay";case Sk.BlendMode.kDarken:return"darken";case Sk.BlendMode.kLighten:return"lighten";case Sk.BlendMode.kColorDodge:return"color-dodge";case Sk.BlendMode.kColorBurn:return"color-burn";case Sk.BlendMode.kHardLight:return"hard-light";case Sk.BlendMode.kSoftLight:return"soft-light";case Sk.BlendMode.kDifference:return"difference";case Sk.BlendMode.kExclusion:return"exclusion";case Sk.BlendMode.kMultiply:return"multiply";case Sk.BlendMode.kHue:return"hue";case Sk.BlendMode.kSaturation:return"saturation";case Sk.BlendMode.kColor:return"color";case Sk.BlendMode.kLuminosity:return"luminosity";default:return"source-over"}},e.skBlendModeToFeBlendMode=function(e){switch(e){case Sk.BlendMode.kSrcOver:return"normal";case Sk.BlendMode.kScreen:case Sk.BlendMode.kPlus:return"screen";case Sk.BlendMode.kOverlay:return"overlay";case Sk.BlendMode.kDarken:return"darken";case Sk.BlendMode.kLighten:return"lighten";case Sk.BlendMode.kColorDodge:return"color-dodge";case Sk.BlendMode.kColorBurn:return"color-burn";case Sk.BlendMode.kHardLight:return"hard-light";case Sk.BlendMode.kSoftLight:return"soft-light";case Sk.BlendMode.kDifference:return"difference";case Sk.BlendMode.kExclusion:return"exclusion";case Sk.BlendMode.kMultiply:return"multiply";case Sk.BlendMode.kHue:return"hue";case Sk.BlendMode.kSaturation:return"saturation";case Sk.BlendMode.kColor:return"color";case Sk.BlendMode.kLuminosity:return"luminosity";default:return"normal"}},e.skBlendModeToFeCompositeOp=function(e){switch(e){case Sk.BlendMode.kSrcOver:return"over";case Sk.BlendMode.kSrcIn:return"in";case Sk.BlendMode.kSrcOut:return"out";case Sk.BlendMode.kSrcATop:return"atop";case Sk.BlendMode.kXor:return"xor";case Sk.BlendMode.kArithmetic_SkBlendMode:return"arithmetic";default:return"over"}},e.skStrokeCapToCanvasLineCap=function(t){switch(t){case e.Cap.kButt:return"butt";case e.Cap.kRound:return"round";case e.Cap.kSquare:return"square";default:return"butt"}},e.skStrokeJoinToCanvasLineJoin=function(t){switch(t){case e.Join.kMiter:return"miter";case e.Join.kRound:return"round";case e.Join.kBevel:return"bevel";default:return"miter"}},e.skPointModeToString=function(e){switch(e){case Sk.PointMode.kPoints:return"points";case Sk.PointMode.kLines:return"lines";case Sk.PointMode.kPolygon:return"polygon";default:return"null"}},e.populatePaintStrings=function(t){return t.filterQualityStr=e.skFilterQualityToCanvasFilterQuality(t.filterQuality),t.strokeCapStr=e.skStrokeCapToCanvasLineCap(t.strokeCap),t.strokeJoinStr=e.skStrokeJoinToCanvasLineJoin(t.strokeJoin),t.blendModeStr=e.skBlendModeToCompositeOp(t.blendMode),t.cssColor=e.skColorToCSSColor(t.color),t.alphaFloat=e.skColorToCanvasAlpha(t.color),t},e.Default=Object.freeze(e.populatePaintStrings({color:4278190080,blendMode:Sk.BlendMode.kSrcOver,filterQuality:Sk.FilterQuality.kNone,style:0,strokeWidth:0,strokeMiter:4,strokeCap:0,strokeJoin:0})),e.makePaint=function(t){var r=Sk.Util.copyDict(e.Default);return Sk.Util.updateDict(r,t),Object.freeze(e.populatePaintStrings(r))},e.kTextFields=Object.freeze(["flags","typeface","textSize","textScaleX","textSkewX","textAlign","hinting","textEncoding"]),e.isValidTextPaint=function(t){var r;for(r=0;r<e.kTextFields.length;r+=1)if(void 0===t[e.kTextFields[r]])return!1;return!0},e.flagsToString=function(t){var r,n=[];for(r in e.Flags)e.Flags.hasOwnProperty(r)&&t.flags&e.Flags[r]&&n.push(r);return n},e.applyTextRunPaint=function(t,r){var n,i=e.kTextFields;for(e.isValidTextPaint(r),n=0;n<i.length;n+=1)t[i[n]]=r[i[n]]},e.isValid=function(t){function r(e,t){var r;for(r in e)if(e.hasOwnProperty(r)&&e[r]===t)return!0;return!1}return r(e.Style,t.style)&&r(e.Align,t.textAlign)&&r(e.Hinting,t.hinting)&&r(e.TextEncoding,t.textEncoding)},e.kCanonicalTextSizeForPaths=64,e.getTextScale=function(t){return t.textSize,t.textSize/e.kCanonicalTextSizeForPaths},e.getShadowSigma=function(e,t){var r=e.mask_filter?e.mask_filter.sigma:0;return e.mask_filter&&!e.mask_filter.ignore_ctm&&(r=Sk.Matrix.mapRadius(t,r)),r},e.getShadowBlurRadius=function(t,r){return 2*e.getShadowSigma(t,r)},e.applyBlendMode=function(e,t){t.blendMode!==Sk.BlendMode.kSrcOver&&(t.blendMode!==Sk.BlendMode.kSrc||t.shader||1!==t.alphaFloat)&&(Sk.Paint.isCompositingOp(t.blendMode)?Sk.isDebugEnabled()&&e.setAttribute("unhandled_blend_mode",t.blendModeStr):void 0!==e.style.mixBlendMode&&(e.style.mixBlendMode=Sk.Paint.skBlendModeToCompositeOp(t.blendMode)))}},Sk.Logger=function(e){var t=this;function r(e,t){var r=t;"object"==typeof t&&(r=JSON.stringify(t)),console[e](r)}t.debug=function(e){},t.info=function(e){r("log",e)},t.warn=function(e){r("warn",e)},t.error=function(e){r("error",e)}},Sk.fatal=function(e,t){var r={event:"fatal-error",error:e,details:t};throw new Error(JSON.stringify(r))},Sk.assert=function(e,t){var r;if(!e)throw r={event:"assert-failed",details:t},new Error(JSON.stringify(r))},Sk.assertUnimplemented=function(){},Sk.Util=function(){var e={};function t(e,t){var r="";if(e.length>=t)return e;for(;e.length<t;)r+="0",t-=1;return r+e}return e.init=function(t,r){e.FEQ=t.FloatingPoint.isEqual,e.copyDict=r.copyDict,e.forEachItem=r.forEachItem,e.getImageFromU8Array=r.getImageFromU8Array,e.isDictEmpty=r.isDictEmpty,e.splunkify=r.splunkify,e.hashCode=r.hashCode},e.updateDict=function(e,t){var r;for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e.createSVGElement=function(e){return document.createElementNS("http://www.w3.org/2000/svg",e)},e.toSVGTransformAttribute=function(e){return Array.isArray(e)&&e.length,"matrix("+e.join(" ")+")"},e.createSVGRootElement=function(e,t){var r="http://www.w3.org/2000/svg",n=document.createElementNS(r,"svg");return n.setAttribute("xmlns",r),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("width",e),n.setAttribute("height",t),n.createElement=function(e){return document.createElementNS(r,e)},n},e.makeImageBlobFromU8Array=function(e){return new window.Blob([e],{type:"image/*"})},e.setImageSmoothingEnabled=function(e,t){Sk.imageSmoothingVar||(Sk.imageSmoothingVar=function(){var t,r=["imageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled","mozImageSmoothingEnabled"];for(t=0;t<r.length;t+=1)if(void 0!==e[r[t]])return r[t];return null}()),Sk.imageSmoothingVar&&(e[Sk.imageSmoothingVar]=t)},e.copyArray=function(e){return e.slice(0)},e.urlWrap=function(e){return"url("+e+")"},e.argumentsToArray=function(e){return Array.prototype.slice.call(e).slice(0)},e.marshalFrameToken=function(e,r){return t(e.toString(16),8)+t(r.toString(16),8)},e.getNodeKey=function(e,t){return e+":"+t},e.scalarArrayToPoints=function(e,t){var r;if(!t.length||t.length%2!=0)return!1;for(r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);return!0},e.radToDeg=function(e){return 180*e/Math.PI},e.degToRad=function(e){return e*Math.PI/180},e.floatAs2sCompliment=function(e){var t,r=new window.DataView(new window.ArrayBuffer(4));return r.setFloat32(0,e),(t=r.getInt32(0))<0&&(t=-(t&=2147483647)),t},e.angleBetween=function(t,r,n){var i,o;return 0===(i=Math.sign(vec2.cross([],t,r)[2]))&&(i=1),o=vec2.angle(t,r)*i,n?e.radToDeg(o):o},e.skTextAlignToCSSTextAlign=function(e){switch(e){case Sk.HT.TextAlign.kLeft:return"left";case Sk.HT.TextAlign.kRight:return"right";case Sk.HT.TextAlign.kCenter:return"center";case Sk.HT.TextAlign.kJustify:return"justify";case Sk.HT.TextAlign.kStart:return"start";case Sk.HT.TextAlign.kEnd:return"end";default:return"left"}},e}(),Sk.BinaryWriter=function(e){var t,r,n,i=this,o=0,a=!0;function s(e){var i,a;if(!(e<=n)){for(a=new Uint8Array(e),i=0;i<o;i+=1)a[i]=r[i];r=a,t=new window.DataView(r.buffer,r.byteOffset,r.byteLength),n=e}}function l(e){var t=o;return o>=n&&s(n+256),o+=e,t}i.isLE=function(){return a},i.getOffset=function(){return o},i.getView=function(){return t},i.getSize=function(){return n},i.writeUint8=function(e){var r=l(1);t.setUint8(r,e,a)},i.writeUint32=function(e){var r=l(4);t.setUint32(r,e,a)},i.writeInt32=function(e){var r=l(4);t.setInt32(r,e,a)},i.writeFloat32=function(e){var r=l(4);t.setFloat32(r,e,a)},i.writeRect=function(e){e.length,i.writeFloat32(e[0]),i.writeFloat32(e[1]),i.writeFloat32(e[2]),i.writeFloat32(e[3])},i.writeBytes=function(e){var t,n=o,i=e.length+3>>2<<2;for(s(n+i),t=0;t<e.length;t+=1)r[n]=e[t],n+=1;o+=i},i.writeByteArray=function(e){i.writeUint32(e.length),i.writeBytes(e)},i.writePoint=function(e){void 0!==e.x&&e.y,i.writeFloat32(e.x),i.writeFloat32(e.y)},i.getData=function(){return r.subarray(0,o)},n=e=e||0,r=new Uint8Array(e),t=new window.DataView(r.buffer,r.byteOffset,r.byteLength)},Sk.BinaryReader=function(e,t){var r=new window.DataView(e.buffer,e.byteOffset,e.byteLength),n=this,i=0,o=!0;function a(e){Sk.fatal("SkBinaryReaderError",e)}function s(e){return e+3>>2<<2}n.readUint8=function(){var e=r.getUint8(i,o);return i+=1,e},n.readInt32=function(){var e=r.getInt32(i,o);return i+=4,e},n.readBool=function(){return n.readInt32()},n.readUint16=function(e){var t=r.getUint16(i,o);return e||(i+=2),t},n.readInt16=function(e){var t=r.getInt16(i,o);return e||(i+=2),t},n.readUint32=function(e){var t=r.getUint32(i,o);return e||(i+=4),t},n.readFloat16=function(){var e,t,r,i;return t=(32768&(e=n.readUint16()))>>15,i=1023&e,0==(r=(31744&e)>>10)?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):31===r?i?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,r-15)*(1+i/Math.pow(2,10))},n.readFloat16Array=function(e){var t,r=[];for(t=0;t<e;t+=1)r.push(n.readFloat16());return e%2==1&&n.readFloat16(),r},n.readFloat32=function(){var e=r.getFloat32(i,o);return i+=4,e},n.readRect=function(){var e,t=[];for(e=0;e<4;e+=1)t.push(n.readFloat32());return t},n.readPoint=function(){return[n.readFloat32(),n.readFloat32()]},n.readBytes=function(t,r){var n=e.subarray(i,i+t);return n.length,n.length,r||(i+=t),n},n.readUint16Array=function(e){var t,r=[];for(t=0;t<e;t+=1)r.push(n.readUint16());return r},n.readFloat32Array=function(e){var t,r=[];for(t=0;t<e;t+=1)r.push(n.readFloat32());return r},n.readString=function(){var e,t=n.readUint32(),r=n.readBytes(t,!0);return r.length,e=Sk.decodeUTF8ByteArray(r),n.skip(s(t+1)),n.offset(),e},n.skip=function(e){i+=e},n.eof=function(){return i>=e.length},n.offset=function(){return i},n.reset=function(){i=0},n.length=function(){return e.length},n.canRead=function(e){return i+e<=n.length()},n.bytesRead=function(e){var t,r=n.offset();return t=n[e](),{bytes_read:n.offset()-r,object:t}},n.readByteArray=function(){var e=n.readUint32(),t=n.readBytes(e,!0);return n.skip(s(e)),t},n.readUint32Array=function(){var e,t=n.readUint32(),r=[];for(e=0;e<t;e+=1)r.push(n.readUint32());return r},n.readScalarArray=function(){var e=n.readUint32();return n.readFloat32Array(e)},n.readFlattenable=function(){var e=n.readUint32(),r=t.get(Sk.Deduper.Type.kFlattenable,e);return r||a({event:"invalid-flattenable-index",index:e}),r},n.readFlattenableDef=function(){var e=Sk.FlattenableReader.readFrom(n)||{};return e.deduper={},e},n.readTypefaceDef=function(){var e,t,r,i,o,a={deduper:{}};for(a.id=n.readUint32(),a.coordinates=[],e=n.readUint32(),t=0;t<e;t+=1)r=n.readUint32(),i=n.readFloat32(),a.coordinates.push([r,i]);return o=n.readUint32(),a.weight=65535&o,a.width=o>>16&255,a.slant=o>>24&15,a.has_font_data=!!(o>>28&1),a.is_platform_font=!!(o>>29&1),a.has_font_data&&(a.font_data=n.readFontData().data),Object.freeze(a)},n.readFontDataDef=function(){var e={deduper:{}};return e.data=n.readByteArray(),e.data.length,e},n.readPaintDef=function(){var e,t,r={};function i(e,r){return t&e?n.readFloat32():r}function o(e){return t&e?n.readFlattenable():null}return function(e){function t(e){return(1<<e)-1}r.flags=e>>16&t(16),r.filterQuality=e>>14&t(2),r.style=e>>12&t(2),r.strokeCap=e>>10&t(2),r.strokeJoin=e>>8&t(2),r.hinting=e>>6&t(2),r.textAlign=e>>4&t(2),r.textEncoding=e>>2&t(2)}(n.readUint32()),e=n.readUint32(),t=e>>16&65535,r.blendMode=e>>8&255,r.textSize=i(Sk.NonDef.kTextSize,12),r.textScaleX=i(Sk.NonDef.kTextScaleX,1),r.textSkewX=i(Sk.NonDef.kTextSkewX,0),r.strokeWidth=i(Sk.NonDef.kStrokeWidth,0),r.strokeMiter=i(Sk.NonDef.kStrokeMiter,4),r.color=t&Sk.NonDef.kColor?n.readUint32():Sk.Color.BLACK,t&Sk.NonDef.kTypeface&&(r.typeface=n.readTypeface()),r.path_effect=o(Sk.NonDef.kPathEffect),r.shader=o(Sk.NonDef.kShader),r.mask_filter=o(Sk.NonDef.kMaskFilter),r.color_filter=o(Sk.NonDef.kColorFilter),r.image_filter=o(Sk.NonDef.kImageFilter),r.deduper={},Sk.Paint.isValid(r),Object.freeze(Sk.Paint.populatePaintStrings(r))},n.readTypeface=function(){var e=n.readUint32(),r=t.get(Sk.Deduper.Type.kTypeface,e);return r||a({event:"invalid-typeface-index",index:e}),r},n.readFontData=function(){var e=n.readUint32(),r=t.get(Sk.Deduper.Type.kFontData,e);return r||a({event:"invalid-font-data-index",index:e}),r},n.readPaint=function(){var e=n.readUint32(),r=t.get(Sk.Deduper.Type.kPaint,e);return r||a({event:"invalid-paint-index",index:e}),r},n.readTextBlobDef=function(){for(var e,r,i,o={runs:[],deduper:{}};e={},4294967295!==(r=n.readUint32());)e.positioning=3&r,i=e.positioning===Sk.GlyphPositioning.kFull?2:1,e.offset=n.readPoint(),e.paint=n.readPaint(),e.glyph_count=n.readUint32(),e.glyph_reader=new Sk.BinaryReader(n.readBytes(e.glyph_count*(4+4*i)),t),o.runs.push(e);return Object.freeze(o)},n.readTextBlobByIndex=function(e){return t.get(Sk.Deduper.Type.kTextBlob,e)},n.readSparseMatrix=function(e){var t,r=[1,0,0,1,0,0];return e&(Sk.MatrixMask.Affine|Sk.MatrixMask.Perspective|Sk.MatrixMask.Scale)?r=e&Sk.TypeMask.Float16?n.readFloat16Array(6):n.readFloat32Array(6):e&Sk.MatrixMask.Translate&&(t=e&Sk.TypeMask.Float16?n.readFloat16Array(2):n.readFloat32Array(2),r[4]=t[0],r[5]=t[1]),r},n.readMatrix=function(){return n.readSparseMatrix(n.readUint32())},n.readSampling=function(){var e={};return e.max_aniso=n.readUint32(),0===e.max_aniso&&(e.use_cubic=n.readBool(),e.use_cubic?e.cubic={B:n.readFloat32(),C:n.readFloat32()}:(e.filter=n.readUint32(),e.mipmap=n.readUint32())),e},n.readRRect=function(e){var t,r,i,o;switch(e>=0&&Sk.RRectType.kLast,e){case Sk.RRectType.kRect:t=n.readRect();break;case Sk.RRectType.kSimple:for(t=n.readRect(),i=n.readFloat32Array(2),r=[],o=0;o<4;o+=1)r=r.concat(i);break;case Sk.RRectType.kEmpty:case Sk.RRectType.kOval:case Sk.RRectType.kNinePatch:case Sk.RRectType.kComplex:t=n.readRect(),r=n.readFloat32Array(8)}return{rect:t,radii:r}},n.readImage=function(){var e=n.readUint32(),r=t.get(Sk.Deduper.Type.kImage,e);return r||a({event:"invalid-image-index",index:e}),r},n.readPathDef=function(){var e=n.readUint32(),t=e>>16&1,r=n.readByteArray(),i=n.readUint32(),o=n.readFloat32Array(2*i),a=t?n.readUint32():0,s=a>0?n.readFloat32Array(a):null,l=function(e){var t,r,n,i,o;if(e.length<2)return Sk.Rect.makeEmpty();for(r=i=e[0],n=o=e[1],t=2;t<e.length;t++)e[t]<r?r=e[t]:e[t]>i&&(i=e[t]),e[++t]<n?n=e[t]:e[t]>o&&(o=e[t]);return Sk.Rect.fromLTRB(r,n,i,o)}(o);return Object.freeze({fill_rule:e>>8&255,first_direction:e>>26&3,point_count:i,verbs_u8a:r,points_f32a:o,weight_count:a,weights_f32a:s,bounds:l,deduper:{}})},n.readPathByIndex=function(e){return e=e||n.readUint32(),t.get(Sk.Deduper.Type.kPath,e)},n.readGlyphDef=function(){var e,t,r=n.readUint32(),i=n.readRect(),o=Sk.PackedGlyphID.Flags,a=r>>o.kGlyphType&o.kGlyphTypeMask;switch(a){case Sk.PackedGlyphID.Type.kPath:e=n.readPathDef();break;case Sk.PackedGlyphID.Type.kImage:t=n.readByteArray()}return{id:r,bounds:i,path:e,image:t,type:a,deduper:{}}},n.readGlyphByIndex=function(e,r){return e=e||n.readUint32(),t.get(Sk.Deduper.Type.kGlyph,e,r)}},Sk.Canvas=function(e,t,r,n){var i,o,a=this,s=new Sk.Logger("sk-canvas",{level:"info",debug:n}),l=null,c=null,d=!1,u=[{matrix_clip_ops:[],canvas_clip:Sk.Rect.makeLargest(),ctm:Sk.Matrix.identity(),dev_inverse_ctm:null,device:e}];function f(){return u[u.length-1]}function p(){return f().device}function g(){return f().matrix_clip_ops}function m(){return f().ctm}function _(){return f().canvas_clip}function h(e){f().ctm=e,f().dev_inverse_ctm=null}function y(e){return Sk.Rect.isValid(e),Sk.Rect.roundOut0(Sk.Matrix.mapRect(m(),e))}function v(){u.length,u.push({matrix_clip_ops:g().slice(0),canvas_clip:Sk.Rect.makeCopy(_()),ctm:m().slice(0),dev_inverse_ctm:f().dev_inverse_ctm,device:p()})}function k(e,t){var r;t===Sk.ClipOp.kIntersect&&(r=Sk.Rect.intersection(_(),y(e)),f().canvas_clip=r)}function S(e,r){r&&r.isComplete(),t&&!Sk.Rect.isEmpty(e)&&t(e,"image-load-complete")}a.setHostCanvas=function(e){l=e},a.getOptions=function(){return r},a.getRedrawFn=function(){return l?l.getRedrawFn():t},a.getActiveMatrixClipListRef=function(){return g()},a.getCTM=function(){return m()},a.toCanvasBounds=y,a.getNode=function(){return e.getNode()},a.getDeviceContainerNode=function(){var e=a.getOptions()||{};return e.is_hidden?e.svg_con:a.getNode().parentNode?a.getNode().parentNode:l.getDeviceContainerNode()},a.release=function(){e.release(),e=null,l=null,t=null,o&&delete Sk.canvasKeyToDeviceId[o]},a.save=function(){var e=u.length;return v(),p().save(),e},a.saveLayer=function(e,t){var r,n=_();e.local_bounds&&!function(e){return!!(e&Sk.SaveLayerMask.MustCoverDst)}(t)&&(n=Sk.Rect.intersection(n,a.toCanvasBounds(e.local_bounds))),r=a.rootToDeviceBounds(n),Sk.Rect.isEmpty(r)?a.save():function(e,t){var r;v(),g(),(r=p().createDevice("save-layer",e,g()))?(f().device=r,f().device.setCanvas(a),f().paint=t):p().save()}(r,e.paint||Sk.Paint.Default),e.local_bounds&&function(e){return!(e&Sk.SaveLayerMask.DontClipToLayer)}(t)&&a.clipRRect({rect:e.local_bounds}),Sk.SaveLayerMask.HasBackdrop,Sk.SaveLayerMask.HasClipMask,Sk.SaveLayerMask.HasClipMatrix},a.restore=function(){var e=f(),t=p();return u.length,u.pop(),p()===t?p().restore():(e.paint,p().drawDevice(t,t.getDeviceBounds(),e.paint),t.release(!0),t=null),u.length},a.concat=function(e){g().push({concat_mat:e}),p().concat(e),h(Sk.Matrix.multiply(m(),Sk.Matrix.fromMat2D(e)))},a.setMatrix=function(e,t){e.length,g().push({set_mat:e}),p().setMatrix(e,t),h(t?Sk.Matrix.multiply(t,Sk.Matrix.fromMat2D(e)):Sk.Matrix.fromMat2D(e))},a.scale=function(e,t){a.concat([e,0,0,t,0,0])},a.translate=function(e,t){a.concat([1,0,0,1,e,t])},a.clipRRect=function(e,t){Sk.Rect.isValid(e.rect),void 0===t&&(t=Sk.ClipOp.kIntersect),k(e.rect,t),g().push({clip_rrect:e,clip_op:t}),p().clipRRect(e,t)},a.clipRect=function(e){Sk.Rect.isValid(e),a.clipRRect({rect:e})},a.clearRect=function(e){Sk.Rect.isValid(e),p().clearRect(e)},a.drawRRect=function(e,t){p().drawRRect(e,t||Sk.Paint.Default)},a.fillText=function(e,t,r,n){p().fillText(e,t,r,n)},a.fillRect=function(e,t){p().fillRect(e,t)},a.needsRedraw=function(){return d},a.clearNeedsRedraw=function(){d=!1},a.setNeedsRedrawOnLoad=function(e,t){e.asDict(),d=!0,e.setCompletionCallback(i+":"+Sk.Rect.toString(t),S.curry(t))},a.drawVideoRect=function(e,t,r,n){HTMLVideoElement,p().drawVideoRect(e,t,r,n)},a.drawImageRect=function(e,t,r,n){var i,o,l,c=Sk.Rect.makeLargest();if(Sk.Image,Sk.Rect.isValid(r)||Sk.Point.isValid(r),e.asDict(),e.isSuccess()&&(e.isComplete()||(Sk.Rect.isValid(r)?c=y(r):Sk.Point.isValid(r)&&(c=Sk.Rect.roundOut(_())),a.setNeedsRedrawOnLoad(e,c)),i=e.getActiveFrame())){if(i instanceof HTMLImageElement){if(!i.naturalWidth||!i.naturalHeight)return void s.error({event:"undefined-or-empty-image",naturalWidth:i.naturalWidth,naturalHeight:i.naturalHeight});o=i.naturalWidth,l=i.naturalHeight}else if(i instanceof HTMLCanvasElement)o=i.width,l=i.height;else if(i instanceof HTMLVideoElement)o=i.videoWidth,l=i.videoHeight;else{if(!(i instanceof VideoFrame))return void s.error({event:"unsupported-dom-image",tag:i.tagName});o=i.codedWidth,l=i.codedHeight}t=t||Sk.Rect.fromXYWH(0,0,o,l),Sk.Rect.isEmpty(t),Sk.Rect.isValid(r)||(Sk.Point.isValid(r),r=Sk.Rect.fromXYWH(r[0],r[1],o,l)),Sk.Rect.isValid(r),Sk.Rect.isEmpty(t)||Sk.Rect.isEmpty(r)||p().drawImageRect(e,t,r,n||Sk.Paint.Default)}},a.toDeviceBounds=function(e){var t=p().getDeviceScaleFactor();return Sk.Rect.roundOut0(Sk.Matrix.mapRect(Sk.Matrix.postScale(a.getCTM(),t,t),e))},a.deviceToLocalBounds=function(e){var t,r=(f().dev_inverse_ctm||(t=p().getDeviceScaleFactor(),f().dev_inverse_ctm=Sk.Matrix.invert(Sk.Matrix.postScale(m(),t,t))),f().dev_inverse_ctm);return r?Sk.Rect.roundOut0(Sk.Matrix.mapRect(r,e)):null},a.rootToDeviceBounds=function(e){var t=p().getDeviceScaleFactor();return Sk.Rect.roundOut0(Sk.Matrix.mapRect(Sk.Matrix.makeScale(t,t),e))},a.getDeviceScaleFactor=function(){return p().getDeviceScaleFactor()},a.rasterShader=function(e,r,i){var o,d,u=_();return Sk.Rect.isEmpty(e.tile),c&&(o=c.get(Sk.Deduper.Type.kPicture,e.index)),o?r?((d=new Sk.Canvas(r,(function(e){t&&t(u,"shader-image-load-complete")}),i,n)).setHostCanvas(a),r.getShaderMatrixForDraw&&d.concat(Sk.Matrix.toMat2D(r.getShaderMatrixForDraw())),d.drawPicture(o,o.getCullRect()),r.setCanvas(null),d.setHostCanvas(null),d=null,r):null:l?l.rasterShader(e,r,i):(s.error({event:"picture-shader",details:"no picture found",index:e.index}),null)},a.drawPicture=function(e,t,n,i){var o,s=y(e.getCullRect());Sk.Rect.intersects(s,_())&&((o=e.getHitTestData())&&(r.hit_item_listener&&r.hit_item_listener(t,o),!function(e){var t,r;if(e.display_item_type===Sk.HT.DisplayItemType.kCaret)return!Sk.disabledRemoteCaret;if(function(e){return e.flags&Sk.HT.ElementFlags.kInShadowTree&&(e.flags&Sk.HT.ElementFlags.kHasInputElementOwner||e.flags&Sk.HT.ElementFlags.kHasTextAreaOwner||e.flags&Sk.HT.ElementFlags.kHasTemporalElementOwner||e.flags&Sk.HT.ElementFlags.kHasColorInputOwner)&&!(e.flags&Sk.HT.ElementFlags.kIsPlaceholderText)}(e)&&(t=e.type===Sk.HT.ElementType.kTextNode,r=Sk.focusedElementInfoByNodeId[e.owner_node_uid])){if(t)return!1;if(e.flags&(Sk.HT.ElementFlags.kHasTemporalElementOwner|Sk.HT.ElementFlags.kHasColorInputOwner))return!1;if(BrowserDetect.isMobileSafari())return!("search"===r.type&&e.type===Sk.HT.ElementType.kElementNode)}return!0}(o))||(c=e.getAssetCache(),p().onWillDrawPicture&&p().onWillDrawPicture(e,t),function(e,t){var n,i,o=e.getRasterImage();if(e.use_count||(e.use_count=0),r.use_raster_cache&&!o&&e.use_count>=Sk.rasterCacheUseThreshold&&(i=e.getRasterCache().getOrCreate(e.getContentId(),e,a)),e.use_count+=1,i&&r.use_raster_cache)return Sk.Paint.Default.filterQuality,Sk.FilterQuality.kNone,void p().drawDevice(i,t,Sk.Paint.Default,!0);o?(Sk.Rect.isIntRect(e.getCullRect()),o.isComplete(),n=o.getActiveFrame(),a.drawImageRect(o,Sk.Rect.fromXYWH(0,0,n.naturalWidth,n.naturalHeight),e.getCullRect(),Sk.Paint.Default),p().drawDebugRect(e.getCullRect(),"rgba(255,0,0,0.5)")):(a.save(),a.translate(e.getCullRect()[0],e.getCullRect()[1]),e.playback(a,{original_ctm:a.getCTM().slice(0)}),a.restore())}(e,s),p().onDidDrawPicture&&p().onDidDrawPicture(),c=null,o&&o.formctrl&&p().drawDebugRect(e.getCullRect(),"rgba(0,255,0,0.5)")))},a.drawAnnotation=function(e,t){},a.clipPath=function(e,t){k(e.bounds,t),g().push({clip_path:e,clip_op:t}),p().clipPath(e,t)},a.clipQuad=function(e,t){k(Sk.Rect.bboxRect(e),t),g().push({clip_quad:e,clip_op:t}),p().clipQuad(e,t)},a.drawPath=function(e,t){p().drawPath(e,t)},a.drawTextBlob=function(e,t,r,n){p().drawTextBlob(e,t,r,n)},a.drawPaint=function(e){p().drawPaint(e)},a.drawPoints=function(e,t,r,n){p().drawPoints(e,t,r,n)},a.drawArc=function(e,t,r,n,i){p().drawArc(e,t,r,n,i)},a.toDataURL=function(t){e.toDataURL(t)},a.usesRasterCache=function(){return r.use_raster_cache},a.getDevice=function(){return e},a.setCanvasKey=function(t){Sk.onCanvasKeyChange(o,t,e.getId()),o=t},a.onCanvasKeyChange=function(t){o!==t&&e&&a.setCanvasKey(t)},e.setCanvas(a),i=Sk.nextCanvasId,Sk.nextCanvasId+=1,r=r||{use_raster_cache:!1}},Sk.HiddenCanvas=function(e,t,r){var n,i,o,a,s,l,c,d,u=this,f=(new Sk.Logger("sk-hidden-canvas",{level:"info"}),!1);function p(){var e=a?a.getDevice():null;Sk.Util.forEachItem(n,(function(t,r){delete n[t],r(e)}))}function g(e){r.scheduleRasteringHiddenCanvas(u)}u.setCompletionCallback=function(e,t){var i=!u.hasPendingDelta();n[e]=t,i&&r.scheduleRasteringHiddenCanvas(u)},u.getMemoryUsage=function(){return a.getDevice().getMemoryUsage()},u.getCanvasKey=function(){return t},u.flushTextureUpdates=function(){a?(o.playback((function(e){var t,r=e.getCullRect();return a.save(),a.clipRect(r),a.translate(Sk.Rect.getX(r),Sk.Rect.getY(r)),e.playback(a),a.restore(),t=a.needsRedraw(),a.clearNeedsRedraw(),t})),o.hasPendingRecords()||p()):p()},u.queueTextureUpdate=function(t,r){!function(t){s&&!Sk.Rect.equals(t,e)&&(s=!1,e=t,i=Sk.Rect.roundOut(e),a.getDevice().reset("invisible",Sk.Rect.makeCopy(i),{x:0,y:0},1))}(r),o.recordTextureUpdate(t),g(t.getCullRect())},u.isValid=function(){return f},u.hasPendingDelta=function(){return!!o&&(!Sk.Util.isDictEmpty(n)||o.hasPendingRecords())},u.willResize=function(){s=!0},u.clearTextureUpdates=function(e){return o.clearTextureUpdates(e)},u.asDict=function(){return{canvas_key:t,texture_bounds:i,is_valid:f,has_pending_cb:!Sk.Util.isDictEmpty(n),has_pending_deltas:!!o&&o.hasPendingRecords()}},u.release=function(){p(),n={},a&&(a.release(),a=null),o.release(),o=null},d={},i=Sk.Rect.roundOut(e),o=r.allocNewTextureLayerClient(),(l=(c=new Sk.HTMLCanvasDevice("invisible",Sk.Rect.makeCopy(i),{x:Sk.Rect.getX(i),y:Sk.Rect.getY(i)},1)).tryAlloc()?c:(Sk.fallbackToRemoteCanvasSrc("OOM"),null))&&(f=!0,n={},d.use_raster_cache=!1,d.is_hidden=!0,d.svg_con=r.getSVGContainerForHiddenCanvas(),(a=new Sk.Canvas(l,g,d)).setCanvasKey(t),a.clipRect(i))},Sk.Deduper={Type:{kPicture:0,kImage:1,kPath:2,kGlyph:3,kPaint:4,kTextBlob:5,kTypeface:6,kFontData:7,kFlattenable:8},ObjectMap:function(){var e,t,r,n=this;n.add=function(r,n,i){e.hasOwnProperty(r)||(n.deduper&&n.deduper.index,n.deduper.index=r,e[r]=n,t.size+=i,t.min_obj_size=t.count?Math.min(t.min_obj_size,i):i,t.max_obj_size=t.count?Math.max(t.max_obj_size,i):i,t.count+=1)},n.get=function(r){return e.hasOwnProperty(r)?(t.hits+=1,e[r]):null},n.setOnWillReset=function(e){r=e},n.reset=function(){r&&r(e),e={},(t={}).size=0,t.count=0,t.hits=0,t.min_obj_size=0,t.max_obj_size=0},n.getStats=function(){return{stats:t,avg_obj_size:t.count?t.size/t.count:0}},n.reset()},GlyphCache:function(e,t){var r,n=this,i=(new Sk.Logger("sk-glyph-cache",{level:"info"}),new Sk.Deduper.ObjectMap),o=new Sk.SVGEmitter,a=new Sk.PathTools(o);function s(e){return"glyph-"+t+":"+e}function l(){return r||((r=e.createElement("defs")).setAttribute("id","sv-def-glyphs"),e.appendChild(r)),r}function c(t,r){r.path||r.image,r.path?function(t,r){var n=e.createElement("path"),i=void 0!==r.path.fill_rule?r.path.fill_rule:Sk.FillRule.kWinding,c=Sk.Paint.skFillRuleToCanvasFillRule(i);n.id=s(t),a.drawPath(r.path,Sk.ClipOp.kIntersect),n.setAttribute("d",o.flushPathList().join(" ")),n.setAttribute("fill-rule",c),l().appendChild(n)}(t,r):r.image&&function(t,r){var n=e.createElement("image"),i=r.image;n.id=s(t),n.setAttribute("href",i.getImageSrc()),n.setAttribute("x",Sk.Rect.getX(r.bounds)),n.setAttribute("y",Sk.Rect.getY(r.bounds)),l().appendChild(n)}(t,r)}n.add=function(e,t,r){i.add(e,t,r)},n.get=function(e,t){var r=i.get(e);return r&&t&&!document.getElementById(s(e))&&c(e,r),r},n.getStats=i.getStats,n.reset=function(){i.reset(),r&&(r.parentNode.removeChild(r),r=null)},n.reset()},FlattenableCache:function(){var e=this,t=(new Sk.Logger("sk-flattenable-cache",{level:"info"}),new Sk.Deduper.ObjectMap);e.add=t.add,e.get=t.get,e.getStats=t.getStats,e.reset=t.reset,t.setOnWillReset((function(e){e&&Sk.Util.forEachItem(e,(function(e,t){var r=t.deduper.by_id;r&&Sk.Util.forEachItem(r,(function(e,t){t&&t.parentNode&&t.parentNode.removeChild(t)}))}))}))},Cache:function(e,t){var r,n,i,o=this,a=(new Sk.Logger("sk-cache-host",{level:"info"}),{});o.add=function(e,t,r,n){a[e].add(t,r,n)},o.get=function(e,t){return a[e].get.apply(a[e],Sk.Util.argumentsToArray(arguments).slice(1))},o.getStats=function(e){return{draw_cache:a[e].getStats()}},o.release=function(){var e;for(e in Sk.Deduper.Type)Sk.Deduper.Type.hasOwnProperty(e)&&a[Sk.Deduper.Type[e]].reset();i&&i.parentNode&&i.parentNode.removeChild(i),i=null},o.setNeedsRelease=function(){n=!0},o.addReference=function(e){r||(r=new Sk.Set((function(e){return e.getId()}))),r.add(e)},o.removeReference=function(e){r.remove(e),r.empty()&&(r=null,n&&o.release())},o.getContainer=function(){return i},function(){var r;for(r in(i=Sk.Util.createSVGRootElement(1,1)).setAttribute("id","sv-cache-defs"),i.style.display="none",Sk.Deduper.Type)if(Sk.Deduper.Type.hasOwnProperty(r))switch(Sk.Deduper.Type[r]){case Sk.Deduper.Type.kGlyph:a[Sk.Deduper.Type.kGlyph]=new Sk.Deduper.GlyphCache(i,t);break;case Sk.Deduper.Type.kTypeface:a[Sk.Deduper.Type.kTypeface]=e;break;case Sk.Deduper.Type.kFlattenable:a[Sk.Deduper.Type.kFlattenable]=new Sk.Deduper.FlattenableCache;break;default:a[Sk.Deduper.Type[r]]=new Sk.Deduper.ObjectMap}}()}},Sk.Point={fromXY:function(e,t){return[e,t]},isValid:function(e){return"object"==typeof e&&2===e.length}},Sk.Quad=new function(){this.isRect=function(e){return e[0][0]===e[3][0]&&e[1][0]===e[2][0]&&e[0][1]===e[1][1]&&e[2][1]===e[3][1]}},Sk.Region=new function(){var e=this;e.makeEmpty=function(){return[]},e.makeRect=function(e){return[e]},e.makeCopy=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(Sk.Rect.makeCopy(e[t]));return r},e.isEmpty=function(t){return Sk.Rect.isEmpty(e.getBoundingIntRect(t))},e.addRect=function(e,t){var r,n=!0;if(Sk.Rect.isValid(t),Sk.Rect.isEmpty(t))return e;for(r=0;r<e.length;r+=1)if(Sk.Rect.intersects(t,e[r])){n=!1,Sk.Rect.join(e[r],t);break}return n&&e.push(t),e},e.subtractRect=function(t,r,n){var i,o,a;for(Sk.Rect.isValid(r),n&&t.length>1&&(o=e.getBoundingIntRect(t),t.splice(0,t.length),t.push(o)),i=t.length-1;i>=0;i-=1)if(o=t[i],Sk.Rect.contains(r,o))t.splice(i,1);else if(a=Sk.Rect.intersection(o,r),!Sk.Rect.isEmpty(a)){var s=Sk.Rect.getLeft(o),l=Sk.Rect.getTop(o),c=Sk.Rect.getRight(o),d=Sk.Rect.getBottom(o),u=Sk.Rect.getLeft(a),f=Sk.Rect.getTop(a),p=Sk.Rect.getRight(a),g=Sk.Rect.getBottom(a),m=[Sk.Rect.fromLTRB(s,l,u,d),Sk.Rect.fromLTRB(u,l,p,f),Sk.Rect.fromLTRB(u,g,p,d),Sk.Rect.fromLTRB(p,l,c,d)];t.splice(i,1),m.forEach((function(e){Sk.Rect.isEmpty(e)||t.push(e)}))}return t},e.addRegion=function(t,r){var n;for(n=0;n<r.length;n+=1)e.addRect(t,r[n])},e.getBoundingIntRect=function(e,t){var r,n,i=Sk.Rect.makeEmpty();for(r=0;r<e.length;r+=1)n=t?Sk.Rect.intersection(e[r],t):e[r],Sk.Rect.join(i,n);return Sk.Rect.roundOut0(i)},e.getBoundingRect=e.getBoundingIntRect,e.intersectsRect=function(e,t){var r;for(r=0;r<e.length;r+=1)if(Sk.Rect.intersects(e[r],t))return!0;return!1},e.containsPoint=function(e,t){var r;for(r=0;r<e.length;r+=1)if(Sk.Rect.containsPoint(e[r],t))return!0;return!1},e.iterate=function(e,t){var r;for(r=0;r<e.length;r+=1)t(e[r])},e.iterateSafeFromUpdate=function(t,r){var n,i=e.makeCopy(t);for(n=0;n<i.length;n+=1)r(i[n])}},Sk.Rect={toXYWH:function(e){return this.isValid(e),[e[0],e[1],e[2]-e[0],e[3]-e[1]]},toQuad:function(e){var t=[];return t.push([e[0],e[1]]),t.push([e[2],e[1]]),t.push([e[2],e[3]]),t.push([e[0],e[3]]),t},toString:function(e){return(e[0]<=-Number.MAX_VALUE?"MIN":e[0])+":"+(e[1]<=-Number.MAX_VALUE?"MIN":e[1])+":"+(e[2]>=Number.MAX_VALUE?"MAX":e[2])+":"+(e[3]>=Number.MAX_VALUE?"MAX":e[3])},toCSSStyle:function(e,t){"absolute"===t.position||t.position,t.left=Sk.Rect.getLeft(e)+"px",t.top=Sk.Rect.getTop(e)+"px",t.width=Sk.Rect.getWidth(e)+"px",t.height=Sk.Rect.getHeight(e)+"px"},toCSSClip:function(e){return this.isValid(e),"rect("+e[1]+"px "+e[2]+"px "+e[3]+"px "+e[0]+"px)"},toCSSClipPath:function(e,t){return this.isValid(e)&&this.isValid(t),"inset("+Sk.Rect.getTop(t)+"px "+(Sk.Rect.getWidth(e)-Sk.Rect.getRight(t))+"px "+(Sk.Rect.getHeight(e)-Sk.Rect.getBottom(t))+"px "+Sk.Rect.getLeft(t)+"px)"},fromQuad:function(e){return this.bboxRect(e)},fromXYWH:function(e,t,r,n){var i=[e,t,e+r,t+n];return this.isValid(i),i},fromWH:function(e,t){var r=[0,0,e,t];return this.isValid(r),r},fromLTRB:function(e,t,r,n){var i=[e,t,r,n];return this.isValid(i),i},fromRect:function(e){return this.isValid(e),[e[0],e[1],e[2],e[3]]},set:function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,this.isValid(e),e},setXYWH:function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=t+n,e[3]=r+i,this.isValid(e),e},setEmpty:function(e){return e[0]=e[1]=e[2]=e[3]=0,this.isValid(e),e},bboxRect:function(e){var t,r,n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(!e.length)return[0,0,0,0];for(t=0;t<e.length;t+=1)r=e[t],n=Math.min(n,r[0]),o=Math.min(o,r[1]),i=Math.max(i,r[0]),a=Math.max(a,r[1]);return[n,o,i,a]},roundOut:function(e){return this.fromLTRB(Math.floor(e[0]),Math.floor(e[1]),Math.ceil(e[2]),Math.ceil(e[3]))},roundIn:function(e){return this.fromLTRB(Math.ceil(e[0]),Math.ceil(e[1]),Math.floor(e[2]),Math.floor(e[3]))},roundOut0:function(e){return this.isValid(e),e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3]),e},makeCopy:function(e){return[e[0],e[1],e[2],e[3]]},makeEmpty:function(){return[0,0,0,0]},makeInset:function(e,t,r){return this.isValid(e),this.fromLTRB(e[0]+t,e[1]+r,e[2]-t,e[3]-r)},makeOutset:function(e,t,r){return this.isValid(e),this.fromLTRB(e[0]-t,e[1]-r,e[2]+t,e[3]+r)},MIN_INT32:1<<31,MAX_INT32:~(1<<31),makeLargest:function(){return[this.MIN_INT32,this.MIN_INT32,this.MAX_INT32,this.MAX_INT32]},isLargest:function(e){return e[0]<=this.MIN_INT32&&e[1]<=this.MIN_INT32&&e[2]>=this.MAX_INT32&&e[3]>=this.MAX_INT32},makeOffset:function(e,t,r){return this.set(e,e[0]+t,e[1]+r,e[2]+t,e[3]+r)},makeFromMidpoint:function(e,t,r){return[e.x-t,e.y-r,e.x+t,e.y+r]},moveToOrigin:function(e){return this.makeOffset(e,-this.getX(e),-this.getY(e))},isEmpty:function(e){return e.length,e[2]-e[0]<=0||e[3]-e[1]<=0},isValid:function(e){return 4===e.length&&Number.isFinite(e[0])&&Number.isFinite(e[1])&&Number.isFinite(e[2])&&Number.isFinite(e[3])&&e[this.LEFT]<=e[this.RIGHT]&&e[this.TOP]<=e[this.BOTTOM]},isIntRect:function(e){return Sk.Rect.equals(e,Sk.Rect.roundOut(e))},isSizeEqual:function(e,t){return Sk.Rect.getWidth(e)===Sk.Rect.getWidth(t)&&Sk.Rect.getHeight(e)===Sk.Rect.getHeight(t)},getArea:function(e){return Sk.Rect.getWidth(e)*Sk.Rect.getHeight(e)},getX:function(e){return e[0]},getY:function(e){return e[1]},getLeft:function(e){return this.getX(e)},getTop:function(e){return this.getY(e)},getRight:function(e){return e[2]},getBottom:function(e){return e[3]},getWidth:function(e){return e[2]-e[0]},getHeight:function(e){return e[3]-e[1]},getOvalRadii:function(e){var t,r;return this.isValid(e),[t=this.getWidth(e)/2,r=this.getHeight(e)/2,t,r,t,r,t,r]},getCenter:function(e){return[this.getX(e)+this.getWidth(e)/2,this.getY(e)+this.getHeight(e)/2]},resize:function(e,t){return this.isValid(e),[e[0]-t,e[1]-t,e[2]+t,e[3]+t]},equals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},isEqual:function(e,t){return this.equals(e,t)},intersects:function(e,t){return this.isValid(e),this.isValid(t),!(Sk.Rect.isEmpty(e)||Sk.Rect.isEmpty(t)||this.getLeft(t)>=this.getRight(e)||this.getRight(t)<=this.getLeft(e)||this.getTop(t)>=this.getBottom(e)||this.getBottom(t)<=this.getTop(e))},intersection:function(e,t){var r,n,i,o;return this.isValid(e)&&this.isValid(t),Sk.Rect.isEmpty(e)||Sk.Rect.isEmpty(t)?r=n=i=o=0:(r=Math.max(Sk.Rect.getX(e),Sk.Rect.getX(t)),n=Math.max(Sk.Rect.getY(e),Sk.Rect.getY(t)),i=Math.min(Sk.Rect.getRight(e),Sk.Rect.getRight(t)),o=Math.min(Sk.Rect.getBottom(e),Sk.Rect.getBottom(t))),(r>=i||n>=o)&&(r=n=i=o=0),this.fromXYWH(r,n,i-r,o-n)},contains:function(e,t){return this.isValid(e)&&this.isValid(t),Sk.Rect.getX(t)>=Sk.Rect.getX(e)&&Sk.Rect.getRight(t)<=Sk.Rect.getRight(e)&&Sk.Rect.getY(t)>=Sk.Rect.getY(e)&&Sk.Rect.getBottom(t)<=Sk.Rect.getBottom(e)},containsPoint:function(e,t){return"number"==typeof t.x&&t.y,this.contains(e,this.fromXYWH(t.x,t.y,0,0))},join:function(e,t){return this.isValid(e)&&this.isValid(t),this.getLeft(t)>=this.getRight(t)||this.getTop(t)>=this.getBottom(t)?e:this.getLeft(e)>=this.getRight(e)||this.getTop(e)>=this.getBottom(e)?this.set(e,this.getLeft(t),this.getTop(t),this.getRight(t),this.getBottom(t)):this.set(e,Math.min(this.getLeft(e),this.getLeft(t)),Math.min(this.getTop(e),this.getTop(t)),Math.max(this.getRight(e),this.getRight(t)),Math.max(this.getBottom(e),this.getBottom(t)))},subtract:function(e,t){var r=this.getX(e),n=this.getY(e),i=this.getRight(e),o=this.getBottom(e);return this.intersects(e,t)?this.contains(t,e)?this.set(e,0,0,0,0):(Sk.Rect.getY(t)<=n&&Sk.Rect.getBottom(t)>=o?Sk.Rect.getX(t)<=r?r=Sk.Rect.getRight(t):Sk.Rect.getRight(t)>=i&&(i=Sk.Rect.getX(t)):Sk.Rect.getX(t)<=r&&Sk.Rect.getRight(t)>=i&&(Sk.Rect.getY(t)<=n?n=Sk.Rect.getBottom(t):Sk.Rect.getBottom(t)>=o&&(o=Sk.Rect.getY(t))),this.set(e,r,n,i,o)):e},scaleXY:function(e,t,r){return 1===t&&1===r?Sk.Rect.makeCopy(e):Sk.Matrix.mapRect(Sk.Matrix.makeScale(t,r),e)},scale:function(e,t){return this.scaleXY(e,t,t)},translate:function(e,t,r){return e[this.LEFT]+=t,e[this.RIGHT]+=t,e[this.TOP]+=r,e[this.BOTTOM]+=r,e},LEFT:0,TOP:1,RIGHT:2,BOTTOM:3},Sk.Radii={isValid:function(e){return e&&8===e.length},makeEmpty:function(){return[0,0,0,0,0,0,0,0]},makeCopy:function(e){return this.isValid(e)?e.slice():null},getUpperLeftX:function(e){return e[0]},getUpperLeftY:function(e){return e[1]},getSimpleRadii:function(e){return[this.getUpperLeftX(e),this.getUpperLeftY(e)]},getUpperRightX:function(e){return e[2]},getUpperRightY:function(e){return e[3]},getLowerRightX:function(e){return e[4]},getLowerRightY:function(e){return e[5]},getLowerLeftX:function(e){return e[6]},getLowerLeftY:function(e){return e[7]},resize:function(e,t){var r,n=[];if(!this.isValid(e))return e;for(r=0;r<e.length;r++)n.push(e[r]+t);return n},isEqual:function(e,t){var r;if(!this.isValid(e)&&!this.isValid(t))return!0;if(!this.isValid(e)||!this.isValid(t))return!1;for(r=0;r<8;++r)if(e[r]!==t[r])return!1;return!0},toCSSStyle:function(e,t){"absolute"===t.position||t.position,t.borderTopLeftRadius=this.getUpperLeftX(e)+"px "+this.getUpperLeftY(e)+"px",t.borderTopRightRadius=this.getUpperRightX(e)+"px "+this.getUpperRightY(e)+"px",t.borderBottomRightRadius=this.getLowerRightX(e)+"px "+this.getLowerRightY(e)+"px",t.borderBottomLeftRadius=this.getLowerLeftX(e)+"px "+this.getLowerLeftY(e)+"px"}},Sk.RRect={isValid:function(e){return Sk.Rect.isValid(e.rect)},isEqual:function(e,t){return Sk.Rect.isEqual(e.rect,t.rect)&&Sk.Radii.isEqual(e.radii,t.radii)},makeEmpty:function(){return{rect:Sk.Rect.makeEmpty(),radii:Sk.Radii.makeEmpty()}},makeCopy:function(e){return{rect:Sk.Rect.makeCopy(e.rect),radii:Sk.Radii.makeCopy(e.radii)}},scaleRadii:function(e){this.isValid(e),Sk.Radii.isValid(e.radii)&&(Sk.Rect.getWidth(e.rect),Sk.Rect.getHeight(e.rect),Sk.Radii.getUpperLeftX(e.radii),Sk.Radii.getUpperRightX(e.radii),Sk.Radii.getLowerRightX(e.radii),Sk.Radii.getLowerLeftX(e.radii),Sk.Radii.getUpperRightY(e.radii),Sk.Radii.getLowerRightY(e.radii),Sk.Radii.getUpperLeftY(e.radii),Sk.Radii.getLowerLeftY(e.radii))}},Sk.Conic={isValid:function(e){return 7===e.length},chop:function(e){var t=.5,r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=1/(1+l),d=Math.sqrt(t+l*t),u=l*i,f=l*o,p=(r+u+u+a)*c*t,g=(n+f+f+s)*c*t,m=(r+u)*c,_=(n+f)*c,h=(u+a)*c,y=(f+s)*c,v=[];return v[0]=[r,n,0,0,0,0,d],v[0][2]=m,v[0][3]=_,v[0][4]=p,v[0][5]=g,v[1]=[0,0,0,0,a,s,d],v[1][0]=p,v[1][1]=g,v[1][2]=h,v[1][3]=y,v},getP0X:function(e){return this.isValid(e),e[0]},getP0Y:function(e){return this.isValid(e),e[1]},getP1X:function(e){return this.isValid(e),e[2]},getP1Y:function(e){return this.isValid(e),e[3]},getP2X:function(e){return this.isValid(e),e[4]},getP2Y:function(e){return this.isValid(e),e[5]},setP0X:function(e,t){this.isValid(e),e[0]=t},setP0Y:function(e,t){this.isValid(e),e[1]=t},setP1X:function(e,t){this.isValid(e),e[2]=t},setP1Y:function(e,t){this.isValid(e),e[3]=t},setP2X:function(e,t){this.isValid(e),e[4]=t},setP2Y:function(e,t){this.isValid(e),e[5]=t},between:function(e,t,r){return(e-t)*(r-t)<=0},subdivide:function(e,t,r){var n,i,o,a,s;if(0===r)return t.push(this.getP1X(e)),t.push(this.getP1Y(e)),t.push(this.getP2X(e)),void t.push(this.getP2Y(e));(n=this.chop(e)).length,i=this.getP0Y(e),o=this.getP2Y(e),this.between(i,this.getP1Y(e),o)&&(a=this.getP2Y(n[0]),this.between(i,a,o)||(s=Math.abs(a-i)<Math.abs(a-o)?i:o,this.setP2Y(n[0],s),this.setP0Y(n[1],s)),this.between(i,this.getP1Y(n[0]),this.getP2Y(n[0]))||this.setP1Y(n[0],i),this.between(this.getP0Y(n[1]),this.getP1Y(n[1]),o)||this.setP1Y(n[1],o),this.between(i,this.getP1Y(n[0]),this.getP2Y(n[0])),this.between(this.getP1Y(n[0]),this.getP2Y(n[0]),this.getP1Y(n[1])),this.between(this.getP2Y(n[0]),this.getP1Y(n[1]),o)),--r,this.subdivide(n[0],t,r),this.subdivide(n[1],t,r)},convertConicToQuads:function(e,t){var r=[];return r.push(this.getP0X(e)),r.push(this.getP0Y(e)),this.subdivide(e,r,t),r.length,r}},Sk.Ellipse=function(e,t,r){var n=this;n.cartesianPointAt=function(n){var i=Sk.Util.degToRad(n);return[e[0]+t*Math.cos(i),e[1]+r*Math.sin(i)]},n.getRadii=function(){return[t,r]},n.getCenterPoint=function(){return e},e&&e.length},Sk.HTMLCanvasDevice=function(e,t,r,n,i){var o,a,s,l,c,d,u,f,p,g,m=this,_=new Sk.Logger("sk-canvas-device",{level:"info"}),h=0,y=!0,v=new Sk.TextBlobIterator;function k(){d&&d.parentNode&&d.parentNode.removeChild(d),u=null,d=null}function S(e,t,r){var n,i=t.length>1?1/(t.length-1):0;for(t.length,t.length,n=0;n<t.length;n+=1)e.addColorStop(r?r[n]:i*n,Sk.Paint.skColorToCSSColor(t[n]))}function b(e,t,r,n){return a.createRadialGradient(e[0],e[1],r,t[0],t[1],n)}function w(t,i){var o,a=function(){var e=Sk.Matrix.multiply(Sk.Matrix.makeTranslation(-r.x,-r.y),s.getCTM());return Sk.Util.FEQ(n,1)?e:Sk.Matrix.postScale(e,n,n)}(),c=Sk.SVGFilterHelper.hashFilterId(t,l,a),f=document.getElementById(c);return f||((d||((o=s.getDeviceContainerNode())?(d=Sk.Util.createSVGRootElement(0,0),u=d.createElement("defs"),d.appendChild(u),o.appendChild(d),1):(_.error({event:"no-container-node",purpose:e}),0)))&&(f=Sk.SVGFilterHelper.buildWith(t,a,i))?(f.setAttribute("id",c),u.appendChild(f),Sk.SVGFilterHelper.onFilterNodeCreated(t,f),f):null)}function C(e){var t;e&&(t=a.strokeStyle,a.strokeStyle="rgba(0,0,0,0)",a.stroke()),a.clip(),e&&(a.strokeStyle=t)}function T(e,t){var r,i,o,l,c;e.color_filter&&!e.color_filter.is_luma_color_filter&&(l=s?s.getCTM():Sk.Matrix.identity(),c=Sk.Matrix.getDecomposedScale(l),i=function(e,t,r){var n=t;return e.style&&e.style!==Sk.Paint.Style.kFill_Style&&e.strokeWidth>1&&(n=Sk.Rect.resize(t,e.strokeWidth/2)),Sk.Rect.resize(n,r+1)}(e,t,r=Sk.Paint.getShadowBlurRadius(e,l)),a.save(),a.beginPath(),a.rect.apply(a,Sk.Rect.toXYWH(i)),a.closePath(),C(!0),a.shadowColor=Sk.Paint.skColorToCSSColor(e.color_filter.color),a.shadowBlur=r*n,o=Sk.Rect.getWidth(i)+1,a.shadowOffsetX-=o*n*c[0],a.translate(o,0))}function E(e){e.color_filter&&!e.color_filter.is_luma_color_filter&&a.restore()}function A(e,t){var r=e.strokeWidth;if(t&(Sk.PaintUsage.kGeometry|Sk.PaintUsage.kPaint)){if(e.shader)try{!function(e){var t,r,n=e.shader.image,i=e.shader.picture,o=function(e,t){return t.linear_gradient?function(e,t){var r=e.createLinearGradient(t.start[0],t.start[1],t.end[0],t.end[1]);return S(r,t.colors,t.position),r}(e,t.linear_gradient):t.radial_gradient?(S(n=b((r=t.radial_gradient).center,r.center,0,r.radius),r.colors,r.position),n):t.sweep_gradient?function(e,t){var r;return BrowserDetect.isIE()?null:(S(r=e.createConicGradient(0,t.center[0],t.center[1]),t.colors,t.position),r)}(e,t.sweep_gradient):t.conical_gradient?function(e,t){var r=b(t.center_1,t.center_2,t.radius_1,t.radius_2);return S(r,t.colors,t.position),r}(0,t.conical_gradient):null;var r,n}(a,e.shader);o?a.fillStyle=a.strokeStyle=o:n?((r=n.image).getActiveFrame()?a.fillStyle=a.strokeStyle=a.createPattern(r.getActiveFrame(),(n.tile_mode_x,n.tile_mode_y,"repeat")):a.fillStyle=a.strokeStyle=Sk.isDebugEnabled()?"green":"rgba(0, 0, 0, 0)",r.isComplete()||s.setNeedsRedrawOnLoad(r,Sk.Rect.makeLargest())):i&&(t=s.rasterShader(i,m.createShaderDevice(i),{use_raster_cache:!0,text_boxes:!1}))&&(Sk.HTMLCanvasDevice,a.fillStyle=a.strokeStyle=a.createPattern(t.getNode(),(i.tile_mode_x,i.tile_mode_y,"repeat")),t.release(),t=null),a.fillStyle&&a.strokeStyle,a.globalAlpha=e.alphaFloat}(e)}catch(t){_.error({event:"apply-shader-error",paint:e})}else e.style===Sk.Paint.Style.kFill_Style?a.fillStyle=e.cssColor:e.style===Sk.Paint.Style.kStroke_Style?a.strokeStyle=e.cssColor:a.fillStyle=a.strokeStyle=e.cssColor;t&Sk.PaintUsage.kText&&(r/=e.textSize/Sk.Paint.kCanonicalTextSizeForPaths||1),e.path_effect&&(a.setLineDash(e.path_effect.intervals),a.lineDashOffset=e.path_effect.phase),r!==Sk.Paint.Default.strokeWidth&&(a.lineWidth=r),e.strokeMiter!==Sk.Paint.Default.strokeMiter&&(a.miterLimit=e.strokeMiter),e.strokeCap!==Sk.Paint.Default.strokeCap&&(a.lineCap=e.strokeCapStr),e.strokeJoin!==Sk.Paint.Default.strokeJoin&&(a.lineJoin=e.strokeJoinStr)}t&Sk.PaintUsage.kImage&&(e.color,e.filterQuality,a.globalAlpha=e.alphaFloat,e.filterQuality!==Sk.FilterQuality.kNone?(e.filterQualityStr,e.filterQuality,Sk.Util.setImageSmoothingEnabled(a,!0),void 0!==a.imageSmoothingQuality&&(a.imageSmoothingQuality=e.filterQualityStr)):Sk.Util.setImageSmoothingEnabled(a,!1)),e.blendMode,e.blendMode!==Sk.BlendMode.kSrcOver&&function(e){var t=e.blendModeStr;e.blendMode,"clear"===t?(a.globalCompositeOperation="copy",a.fillStyle=a.strokeStyle="rgba(0, 0, 0, 0)",a.globalCompositeOperation):(a.globalCompositeOperation=t,a.globalCompositeOperation!==t&&(a.globalCompositeOperation="source-over",a.globalCompositeOperation)),a.globalCompositeOperation}(e),function(e){var t,r,n=e.image_filter;e.color_filter&&e.color_filter.is_luma_color_filter&&(r=e.color_filter),(n||r)&&(t=w(n||r))&&(BrowserDetect.isSafari()||BrowserDetect.isIE()||BrowserDetect.isEdge()?function(e){var t,r,n;(t=e.querySelectorAll("feColorMatrix"))&&1===t.length&&t[0]&&(n="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0",(r=t[0].getAttribute("values"))&&r.slice(0,n.length)===n&&(a.globalAlpha=Number(r.split(" ")[18])))}(t):(a.filter=Sk.Util.urlWrap("#"+t.getAttribute("id")),a.filter))}(e)}function R(){a.setTransform(1,0,0,1,0,0),a.scale(n,n),(r.x||r.y)&&m.translate(-r.x,-r.y)}function x(e,t){var r,n,i,o,s,l;switch(void 0===t&&(t=Sk.FillRule.kWinding),r=Sk.Paint.skFillRuleToCanvasFillRule(t),e.shader&&(i=e.shader.image||e.shader.picture,o=e.shader.radial_gradient||e.shader.conical_gradient||e.shader.sweep_gradient,i?n=i.matrix:o&&(n=o.transform),n&&(a.save(),a.transform.apply(a,n),e.shader.picture&&f&&(f.length,s=Sk.Matrix.makeScale(1/f[0],1/f[1]),a.transform.apply(a,Sk.Matrix.toMat2D(s)),a.lineWidth&&(a.lineWidth*=Math.max.apply(null,f)),f=null))),e.style){case Sk.Paint.Style.kFill_Style:a.fill(r);break;case Sk.Paint.Style.kStroke_Style:a.stroke();break;case Sk.Paint.Style.kStrokeAndFill_Style:a.stroke(),a.fill(r);break;default:l={event:"unknown-paint-style",style:e.style},Sk.fatal("HTMLCanvasDeviceError",l)}n&&a.restore()}function D(e,t,r){var n,i,o={};(i=t.blendMode)!==Sk.BlendMode.kClear&&i!==Sk.BlendMode.kSrc&&i!==Sk.BlendMode.kSrcIn&&i!==Sk.BlendMode.kDstIn&&i!==Sk.BlendMode.kSrcOut&&i!==Sk.BlendMode.kDstATop||(a.beginPath(),void 0===t.style||t.style===Sk.Paint.Style.kFill_Style||t.strokeWidth<=1?c.drawRRectPath(e):(n=t.strokeWidth/2,o.rect=Sk.Rect.resize(e.rect,n),e.radii&&(o.radii=Sk.Radii.resize(e.radii,n)),c.drawRRectPath(o)),a.closePath(),C(r))}function I(e,t,r,n){if(e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||VideoFrame,Sk.Rect.isValid(t),Sk.Rect.isValid(r),Sk.Rect.isEmpty(t)||Sk.Rect.isEmpty(r))HTMLVideoElement;else{if(a.save(),A(n,Sk.PaintUsage.kImage),D({rect:r},n),n.blendMode===Sk.BlendMode.kClear)m.clearRect(r);else{T(n,r);try{a.drawImage(e,Sk.Rect.getX(t),Sk.Rect.getY(t),Sk.Rect.getWidth(t),Sk.Rect.getHeight(t),Sk.Rect.getX(r),Sk.Rect.getY(r),Sk.Rect.getWidth(r),Sk.Rect.getHeight(r))}catch(e){_.error({event:"draw-image-error",e:e})}E(n)}a.restore()}}m.setCanvas=function(e){s=e},m.deviceToLocalBounds=function(e){return s?s.deviceToLocalBounds(e):null},m.getSizeRect=function(){return o},m.getNode=function(){return a.canvas,a.canvas},m.save=function(){h+=1,a.save()},m.restoreToCount=function(e){for(;h>e;)a.restore(),h-=1},m.restore=function(){0!==h&&m.restoreToCount(h-1)},m.concat=function(e){e.length,a.transform.apply(a,e)},m.translate=function(e,t){a.translate(e,t)},m.scale=function(e,t){a.scale(e,t)},m.skew=function(e,t){a.transform(1,e,t,1,0,0)},m.playbackMatrixAndClipOps=function(e){var t,r;for(t=0;t<e.length;t+=1)(r=e[t]).concat_mat?m.concat(r.concat_mat):r.set_mat?m.setMatrix(r.set_mat):r.clip_rrect?m.clipRRect(r.clip_rrect,r.clip_op):r.clip_path?m.clipPath(r.clip_path,r.clip_op):r.clip_quad&&m.clipQuad(r.clip_quad,r.clip_op)},m.setMatrix=function(e,t){e.length,R(),t&&a.transform.apply(a,Sk.Matrix.toMat2D(t)),a.transform.apply(a,e)},m.clipRRect=function(e,t){a.beginPath(),c.drawRRect(e,t),a.closePath(),a.clip()},m.clipRect=function(e,t){Sk.Rect.isValid(e),m.clipRRect({rect:e},t)},m.clipQuad=function(e,t){t===Sk.ClipOp.kIntersect||Sk.ClipOp.kDifference,e.length,Sk.Quad.isRect(e)?m.clipRect(Sk.Rect.fromQuad(e),t):(a.beginPath(),c.drawQuad(e,t),a.closePath(),a.clip())},m.clearRect=function(e){Sk.Rect.isValid(e),a.clearRect.apply(a,Sk.Rect.toXYWH(e))},m.drawPath=function(e,t,r,n,i){a.save(),void 0!==r&&a.translate(r.x,r.y),void 0!==n&&a.scale(n,n),A(t,Sk.PaintUsage.kGeometry|(i?Sk.PaintUsage.kText:0)),i?function(e){var t=[],r=!1;function n(e){e&&e.hasAttribute("flood-opacity")&&e.setAttribute("flood-opacity",1)}e.color_filter&&!e.color_filter.is_luma_color_filter&&t.push(w(e.color_filter,n)),e.mask_filter&&e.mask_filter.image_filter&&t.push(w(e.mask_filter.image_filter,n)),t=t.map((function(e){return e?(r=!0,Sk.Util.urlWrap("#"+e.getAttribute("id"))):""})),r&&(a.filter=t.join(" "))}(t):T(t,e.bounds),a.beginPath(),c.drawPath(e,Sk.ClipOp.kIntersect),x(t,e.fill_rule),i||E(t),a.restore()},m.drawTextBlob=function(e,t,r,n){!function(e,t,r,n){v.forEachRun(e,n,(function(e,n,i){var o=Sk.Paint.getTextScale(i);n.glyph_count&&e.forEachGlyph(n,t,r,(function(e,t,r){var n={x:t,y:r};e.path?m.drawPath(e.path,i,n,o,!0):e.image&&function(e,t,r,n,i){var o;s?(a.save(),void 0!==r&&a.translate(r.x,r.y),void 0!==n&&a.scale(n,n),i&&Sk.Rect.isValid(i)&&a.translate(Sk.Rect.getX(i),Sk.Rect.getY(i)),(o=Sk.Util.copyDict(t)).filterQuality=Sk.FilterQuality.kMedium,o.filterQualityStr=Sk.Paint.skFilterQualityToCanvasFilterQuality(o.filterQuality),s.drawImageRect(e,null,[0,0],o),a.restore()):_.warn({event:"no-canvas-for-glyph-image",position:r})}(e.image,i,n,o,e.bounds)}))}))}(e,t,r,n)},m.clipPath=function(e,t){a.beginPath(),c.drawPath(e,t),a.clip()},m.drawPaint=function(e){a.save(),A(e,Sk.PaintUsage.kPaint),a.setTransform(1,0,0,1,0,0),a.fillRect.apply(a,m.getSizeRect()),a.restore()},m.drawPoints=function(e,t,r,n){Sk.PointMode.kLines,a.save(),A(n,Sk.PaintUsage.kGeometry),a.beginPath(),c.drawPointsPath(r),x(n,Sk.FillRule.kWinding),a.restore()},m.drawArc=function(e,t,r,n,i){a.save(),A(i,Sk.PaintUsage.kGeometry),a.beginPath(),c.drawArc(e,t,r,n),x(i,Sk.FillRule.kWinding),a.restore()},m.drawRRect=function(e,t){a.save(),D(e,t,!0),A(t,Sk.PaintUsage.kGeometry),T(t,e.rect),a.beginPath(),c.drawRRectPath(e),a.closePath(),x(t),E(t),a.restore()},m.fillText=function(e,t,r,n){a.save(),a.font=n||"10px arial",a.fillText(e,t,r),a.restore()},m.fillRect=function(e,t){a.save(),a.fillStyle=t,a.globalAlpha=.3,a.fillRect.apply(a,Sk.Rect.toXYWH(e)),a.restore()},m.drawDebugRect=function(e,t){Sk.isDebugEnabled()&&m.fillRect(e,t||"green")},m.drawDebugDeviceRect=function(e,t){Sk.isDebugEnabled()&&(a.save(),R(),m.drawDebugRect(e,t),a.restore())},m.drawImageRect=function(e,t,r,n){I(e.getActiveFrame(),t,r,n)},m.drawVideoRect=function(e,t,r,n){I(e,t,r,n)},m.getDeviceBounds=function(){return t},m.createDevice=function(e,t,r){var i={x:Sk.Rect.getX(t)/n,y:Sk.Rect.getY(t)/n},o=new Sk.HTMLCanvasDevice(e,t,i,n);return Sk.Rect.isIntRect(t),o.tryAlloc()?(r&&o.playbackMatrixAndClipOps(r),o.setCanvas(s),o):(_.error({event:"create-device-alloc-failed",device_bounds:t,mem:Sk.canvasMemoryUsage}),null)},m.getShaderMatrixForDraw=function(){return p},m.setShaderMatrixForDraw=function(e){p=e},m.createShaderDevice=function(e){var t,r=Sk.Rect.makeCopy(e.tile),n=function(e,t){var r,n,i,o,a=Sk.Matrix.fromMat2D(t),l=Sk.Matrix.multiply(s.getCTM(),a),c=[1,1];return Sk.Matrix.decomposeScale(l,c)||(c=[1,1]),(r=(i=c[0]*Sk.Rect.getWidth(e))*(o=c[1]*Sk.Rect.getHeight(e)))>4194304&&(i*=n=Math.sqrt(4194304/r),o*=n),[Math.ceil(i),Math.ceil(o)]}(r,e.matrix),i=Sk.Rect.fromWH(n[0],n[1]);return(t=new Sk.HTMLCanvasDevice("shader",i,{x:Sk.Rect.getX(i),y:Sk.Rect.getY(i)},1)).tryAlloc()?(f=[Sk.Rect.getWidth(i)/Sk.Rect.getWidth(r),Sk.Rect.getHeight(i)/Sk.Rect.getHeight(r)],t.setShaderMatrixForDraw(Sk.Matrix.makeRectToRect(r,i)),t):(_.error({event:"picture-shader",details:"unable to allocate new device",index:e.index}),null)},m.drawDevice=function(e,t,i,o){Sk.Rect.isIntRect(t),m.save(),a.setTransform(1,0,0,1,0,0),o&&a.scale(n,n),(r.x||r.y)&&(o?m.translate(-r.x,-r.y):m.translate(-r.x*n,-r.y*n)),I(e.getNode(),e.getSizeRect(),t,i),m.restore()},m.onSnapshotCreated=function(e){g||(g=new Sk.Set((function(e){return e.getId()}))),g.add(e)},m.release=function(){a&&a.canvas,k(),g&&(g.forEachItem((function(e,t){t.willReleaseSrcDevice()})),g=null),i||(a.canvas.width=a.canvas.height=0),a=null,s=null,c=null,Sk.htmlCanvasDeviceCount-=1,Sk.canvasMemoryUsage[e]-=m.getMemoryUsage(),Sk.htmlCanvasDeviceById.hasOwnProperty(l),delete Sk.htmlCanvasDeviceById[l]},m.reset=function(s,l,c,d){a&&a.canvas,y||(Sk.canvasMemoryUsage[e]-=m.getMemoryUsage()),t=l,o=Sk.Rect.fromWH(Sk.Rect.getWidth(t),Sk.Rect.getHeight(t)),r=c,n=d,e=s,k(),Sk.canvasMemoryUsage[e],Sk.canvasMemoryUsage[e]+=m.getMemoryUsage(),y=!1,m.restoreToCount(0),a.globalCompositeOperation,a.globalAlpha,i||(a.canvas.width=Sk.Rect.getWidth(t),a.canvas.height=Sk.Rect.getHeight(t)),Sk.Rect.getArea(t),Sk.maxPlatformCanvasArea,Sk.Rect.getArea(t),Sk.maxPlatformCanvasArea,m.save(),R()},m.toDataURL=function(e){e(m.getNode().toDataURL())},m.getDeviceScaleFactor=function(){return n},m.getMemoryUsage=function(){return 4*Sk.Rect.getArea(t)},m.getId=function(){return l},m.tryAlloc=function(){return o=Sk.canvasMemoryUsage[e],s=Sk.canvasMemoryLimit[e],!(o+m.getMemoryUsage()>s||!(a=(d=t,i||(u=document.createElement("canvas"),Sk.Rect.isValid(d),u.width=Sk.Rect.getWidth(d),u.height=Sk.Rect.getHeight(d),u)).getContext("2d"))||(c=new Sk.PathTools(new Sk.CanvasEmitter(a),m),m.reset(e,t,r,n),Sk.Util.setImageSmoothingEnabled(a,!1),Sk.htmlCanvasDeviceById[l]=m,0));var o,s,d,u},Sk.Rect.isIntRect(t),l=Sk.nextHTMLCanvasDeviceId,Sk.nextHTMLCanvasDeviceId+=1},Sk.HitTestCanvas=function(){var e=this,t=(new Sk.Logger("sk-hit-canvas",{level:"info"}),[{canvas_clip:Sk.Rect.makeLargest(),ctm:Sk.Matrix.identity()}]),r=[],n=new Sk.OrderedMap,i=[];function o(){return t[t.length-1]}function a(){return o().ctm}function s(){return o().canvas_clip}function l(e){o().ctm=e}function c(e){return Sk.Rect.isValid(e),Sk.Rect.roundOut0(Sk.Matrix.mapRect(a(),e))}function d(e,t){var r;t===Sk.ClipOp.kIntersect&&(r=Sk.Rect.intersection(s(),c(e)),o().canvas_clip=r)}e.save=function(){var e=t.length;return t.length,t.push({canvas_clip:Sk.Rect.makeCopy(s()),ctm:a().slice(0)}),e},e.saveLayer=function(t,r){e.save()},e.restore=function(){return t.length,t.pop(),t.length},e.concat=function(e){l(Sk.Matrix.multiply(a(),Sk.Matrix.fromMat2D(e)))},e.setMatrix=function(e,t){e.length,l(t?Sk.Matrix.multiply(t,Sk.Matrix.fromMat2D(e)):Sk.Matrix.fromMat2D(e))},e.scale=function(t,r){e.concat([t,0,0,r,0,0])},e.translate=function(t,r){e.concat([1,0,0,1,t,r])},e.clipRRect=function(e,t){Sk.Rect.isValid(e.rect),void 0===t&&(t=Sk.ClipOp.kIntersect),d(e.rect,t)},e.clipRect=function(t){Sk.Rect.isValid(t),e.clipRRect({rect:t})},e.clearRect=function(e){},e.drawRRect=function(e,t){},e.fillText=function(e,t,r,n){},e.fillRect=function(e,t){},e.drawImageRect=function(e,t,r,n){var o,a=i[i.length-1];a&&(o=a.data)&&o.type===Sk.HT.ElementType.kImageElement&&e&&e instanceof Sk.Image&&(a.image_src=e.getImageSrc(!0),a.is_sk_image=!0)},e.drawPicture=function(t,o,l,d){var u,f,p,g=c(t.getCullRect());Sk.Rect.isValid(o)&&!function(e){return Sk.Rect.intersects(e,s())}(o)||((u=t.getHitTestData())&&(f={visual_rect:o,canvas_bounds:g,data:u,blobs:[]},u.node_uid,(p=n.get(u.node_uid))||(p=n.set(u.node_uid,[])),p.push(f),r.push(f),i.push(f)),e.save(),e.translate(t.getCullRect()[0],t.getCullRect()[1]),t.playback(e,{original_ctm:a().slice(0)}),e.restore(),u&&i.pop())},e.clipPath=function(e,t){d(e.bounds,t)},e.clipQuad=function(e,t){d(Sk.Rect.bboxRect(e),t)},e.drawPath=function(e,t){},e.drawTextBlob=function(e,t,r,n){var o=i[i.length-1],s={x:t,y:r,blob:e,paint:n,ctm:a().slice(0)};o&&o.blobs.push(s)},e.drawAnnotation=function(e,t){var r=i[i.length-1];r&&(r.border_box_rect=c(e))},e.drawPaint=function(e){},e.drawPoints=function(e,t,r,n){},e.drawArc=function(e,t,r,n,i){},e.usesRasterCache=function(){return!1},e.getItemMap=function(){return n},e.getItemList=function(){return r}},Sk.ImageLoader=function(e,t,r){var n,i=new Sk.Logger("sk-image-loader",{level:"info"}),o=[[],[],[]],a=0,s=0;function l(e){return"blob:"===e.slice(0,5)}function c(e,n,o){var a=r;return!!n&&(void 0===a&&(a=1e3*Math.pow(2,Math.max(0,t-n))),i.warn({event:"image-load-needs-retry",url:e,retries_left:n,delay_ms:a}),setTimeout(o.curry(n-1),a),!0)}function d(e,t,r,n,o,s){a-=1,g(),n?t(!0,o,s):c(e,r,u.curry(e,t))||(i.error({event:"image-fetch-failed",url:e}),t(!1,null,null))}function u(e,t,r){void 0===r&&(r=0),Sk.fetchImage(e,d.curry(e,t,r)),a+=1,s+=1}function f(e,t,r,n){r.src,n=n&&r.complete,l(r.src)?window.URL.revokeObjectURL(r.src):(a-=1,g()),r.onload=r.onerror=null,n?t(!0,r):c(r.src,e,p.curry(r.src,t))||(i.error({event:"image-load-failed",src:r.src}),t(!1,r))}function p(e,r,n){var i;void 0===n&&(n=t),void 0===window.Util?((i=new Image).onload=f.curry(n,r,i,!0),i.onerror=f.curry(n,r,i,!1),i.src=e):window.Util.getImageFromURL(e,f.curry(n,r)),l(e)||(a+=1,s+=1)}function g(t){var r,i,l,c=e(o,t,s),d=!1;for(n&&(clearTimeout(n),n=null),i=0;i<o.length;i+=1){for(l="number"==typeof c[i]?c[i]:Sk.defaultMaxConcurrentImageLoads;o[i].length&&a<l;)(3===(r=o[i].shift()).length?u:p)(r[0],r[1]);o[i].length&&(d=!0)}d&&!n&&(n=setTimeout((function(){g(t)}),200))}this.submit=function(e,t,r,n,i){var a=[e,n];i&&a.push(!0),o.length,o[t].push(a),g(r)},this.release=function(){n&&(clearTimeout(n),n=null)},void 0===t&&(t=Sk.defaultMaxImageLoadRetries)},Sk.FrameUpdateObserver=function(e){var t=this,r=1,n=!1;t.onUpdateFrameCount=function(t){var n;if(t!==r){if(!e.usesImageDecoder())for(n=r;n<t;n+=1)e.loadAnimatedFrame(n);r=t,e.updateFrameCount(r)}},t.willRequestRemoteInvalidation=function(){n=!0},t.didRequestRemoteInvalidation=function(){return n}},Sk.ImageDecoder=function(e,t,r){var n,i=this,o=new Sk.Logger("sk-image-decoder",{level:"info"}),a=0,s=1,l=!1,c=!1;function d(e){o.error({event:e,current_frame_count:s,current_index:a}),r&&r({frame_count:s,decoded_idx:a})}function u(){if(a>=s)return l=!1,void(c&&(n&&n.close(),n=null,t&&t({frame_count:s,decoded_idx:a})));l=!0,n.decode({frameIndex:a}).then((function(e){f(!0,e.image)})).catch((function(e){e instanceof RangeError?setTimeout(u,1e3):f(!1,null)}))}function f(t,r){e(a,t,r),t?(++a,u()):l=!1}function p(e){new window.Promise((function(e,t){var r=n.tracks;r.selectedTrack?e(r.selectedTrack):r.ready.then((function(){e(r.selectedTrack)}),t)})).then((function(t){var r=s;s=t.frameCount,e&&(c=!0),(r!==s||c)&&i.startDecoding()}),d.curry("update-frame-count-error"))}i.startDecoding=function(){l||u()},i.init=function(e,t){var r,i;ReadableStream,r=t.tee(),n=new window.ImageDecoder({data:r[0],type:e}),(i=r[1].getReader()).read().then((function e(t){if(!t.done)return p(!1),i.read().then(e);n.completed.then(p.curry(!0))}),d.curry("chunk-reader-error"))}},Sk.Image=function(e,t,r,n,i,o){var a,s,l,c,d,u,f,p,g,m,_,h,y=new Sk.Logger("sk-image",{level:"info"}),v=this,k=0,S={},b=0,w=!0,C=0,T=!1,E=1,A=!1;function R(){return Sk.Util.getNodeKey(c,l)}function x(){return!!(C&Sk.DefineImageExtra.kIncompleteDataUrl)}function D(){return!(!BrowserDetect.supportsImageDecoder()||x()||A||!(C&Sk.DefineImageExtra.kDecodeAnimatedImage))}function I(e){var t,r;for(t in b=2,w=e,S)S.hasOwnProperty(t)&&(r=S[t],delete S[t],r(v))}function O(){var e,t=Sk.getOrCreateHiddenCanvasCache(),r=R(),n=t.get(r);return v.isSrcCanvasAttached(),n?n.value:((e=new Sk.HiddenCanvas(d,r,p)).isValid()&&t.add(r,e,e.getMemoryUsage()),e)}function U(e){return"blob:"===e.slice(0,5)}function M(e,t,r){if("number"==typeof e&&r.src&&r.complete,U(r.src)&&window.URL.revokeObjectURL(r.src),!t)return y.error({event:"image-load-failed",frame_idx:e,image:v.asDict()}),void I(!1);v.shouldAnimate()?p.onImageFrameLoaded(g,e,r):s=r,k+=1,0===e&&(I(!0),v.asDict())}function F(e,t){var a,l=t,c=n;if(v.shouldAnimate()){if(x())return void(m.didRequestRemoteInvalidation()||p.mapDataUrlToBlob(g));if(p.getFrameByIndex(g,e))return}s||(0===e&&(c=r),t&&!U(t)&&(a=-1===t.indexOf("?")?"?":"&",l=t+a+"q="+c,v.shouldAnimate()&&(l+="&fi="+e),l+="&io=true"),i.submit(l,0===e?0:2,o,M.curry(e)))}function P(e,t,r){t?(p.onImageFrameLoaded(g,e,r),k+=1,0===e&&(I(!0),v.asDict())):y.error({event:"image-decode-failed",paint_image_id:g,frame_idx:e})}function L(e,t,r){if(!e)return y.info({event:"fallback-to-frames-loading",reason:"fetch-failed",image:v.asDict()}),A=!0,b=0,void v.startLoading();(_=new Sk.ImageDecoder(P)).init(t,r),_.startDecoding()}function N(e){e?(Sk.HTMLCanvasDevice,e.onSnapshotCreated(v),s=e.getNode(),k=1,I(!0)):I(!1)}function B(t){var r,n=h[t];if(!n){if(!(r=p.getFrameByIndex(g,t)))return null;(n={}).canvas=function(e){var t=document.createElement("canvas");return t.width=e.codedWidth,t.height=e.codedHeight,t.getContext("2d").drawImage(e,0,0),t}(r);try{n.data_url=n.canvas.toDataURL()}catch(r){n.data_url=null,y.warn({event:"frame-to-data-url",url:e,frame_idx:t})}h[t]=n}return n}v.setCompletionCallback=function(e,t){S[e]=t},v.getPictureId=function(){return u},v.getCanvasKey=R,v.isCanvasSnapshot=function(){return!!(C&Sk.DefineImageExtra.kCanvasSnapshot)},v.isSrcCanvasAttached=function(){return!!(C&Sk.DefineImageExtra.kSrcCanvasAttached)},v.isVideoFrame=function(){return!!(C&Sk.DefineImageExtra.kFromVideoNode)},v.shouldAnimate=function(){return!!(C&Sk.DefineImageExtra.kShouldAnimate)},v.usesImageDecoder=D,v.startLoading=function(t){var r,n,a;if(v.asDict(),b=1,t&&v.setCompletionCallback("startLoading",t),e&&U(e))F(0,e);else if(v.shouldAnimate()&&D())a=e,U(e)||(n=-1===e.indexOf("?")?"?":"&",a=e+n+"io=true"),i.submit(a,1,o,L,!0);else for(r=0;r<E;r+=1)F(r,e)},v.startLoadingCanvasSnapshot=function(e){var t;if(b=1,e&&v.setCompletionCallback("startLoadingCanvasSnapshot",e),!v.isSrcCanvasAttached())return(t=O()).isValid()?void(u?p.waitForPicture(u,(function(e,r){!function(e,t){var r=O();r.isValid()&&r.queueTextureUpdate(t,d)}(0,r),t.setCompletionCallback("sn:"+a,N)})):t.setCompletionCallback("sn:"+a,N)):void I(!1);Sk.waitForCanvas(R(),N)},v.isComplete=function(){return 2===b},v.isSuccess=function(){return!!w},v.asDict=function(){return{id:a,url:e,frame_count:E,load_state:b,load_success:w,nr_frames_loaded:k,canvas_id:l,uses_image_decoder:D(),is_snapshot:v.isCanvasSnapshot(),is_attached:v.isSrcCanvasAttached(),is_animated:v.shouldAnimate()}},v.getId=function(){return a},v.getActiveFrame=function(){var e;return v.isSuccess()?v.isCanvasSnapshot()&&T?p.isFallingBackToRemoteCanvasSrc()?null:v.isSrcCanvasAttached()&&(e=Sk.getCanvasDeviceByCanvasKey(R()))?(T=!1,N(e),s):(y.error({event:"attempt-to-use-discarded-snapshot",canvas_key:R()}),null):v.isVideoFrame()?p.getMediaNodeByUid(c,f):v.shouldAnimate()?p.getActiveFrame(g):(v.isComplete(),v.asDict(),s):null},v.getActiveFrameIndex=function(){return v.shouldAnimate()?p.getFrameIndexForImage(g):0},v.getBlob=function(){return t},v.getImageSrc=function(t){var r;return v.getBlob()?window.URL.createObjectURL(v.getBlob()):t?e:(r=v.getActiveFrame())?r.src:e},v.willReleaseSrcDevice=function(){T=!0,s=null},v.initAsCanvasSnapshot=function(e,t,r){var n,i=new Sk.BinaryReader(t);C=e,p=r,n=i.readUint32(),c=Sk.Util.marshalFrameToken(i.readUint32(),i.readUint32()),l=n>>1&2147483647,1&n&&(d=i.readRect(),u=i.readUint32())},v.initAsVideoFrame=function(e,t,r){var n=new Sk.BinaryReader(t);C=e,p=r,f=n.readUint32(),c=Sk.Util.marshalFrameToken(n.readUint32(),n.readUint32())},v.loadAnimatedFrame=function(t){D(),F(t,e)},v.updateFrameCount=function(e){E=e},v.getPaintedFrame=function(e){return D(),h||(h={}),B(e)},v.getPaintImageId=function(){return v.shouldAnimate(),g},v.initAsAnimatedImage=function(e,t,r){C=e,g=t,p=r,m=new Sk.FrameUpdateObserver(v),p.onSkImageCreated(g,m)},v.startLoadingVideoFrame=function(e){b=1,e&&v.setCompletionCallback("startLoadingVideoFrame",e),p.waitForMediaNode(c,f,(function(){k=1,I(!0)}))},v.deduper={},e&&U(e)&&(E=1),a=Sk.nextImageId,Sk.nextImageId+=1},Sk.ImagePool=function(){var e={},t=(new Sk.Logger("sk-img-pool",{level:"info"}),{}),r={};return e.get=function(e,n,i){var o,a,s,l=n.getActiveFrameIndex(),c=[n.getId(),l,i].join(":"),d=t[c];if(Sk.Image,d&&d.length)a=d.shift();else if(i)(a=Sk.Util.createSVGElement("image")).setAttribute("href",n.getImageSrc());else if(n.usesImageDecoder()){if(!(s=n.getPaintedFrame(l))||!s.data_url)return null;(a=new Image).src=s.data_url}else(a=new Image).src=n.getImageSrc();return a?(r.hasOwnProperty(e)||(r[e]={}),(o=r[e]).hasOwnProperty(c)||(o[c]=[]),o[c].push(a),a):null},e.put=function(e){var n=r[e];n&&(Sk.Util.forEachItem(n,(function(e){var r,i;for(t[e]||(t[e]=[]),r=0;r<n[e].length;r+=1)(i=n[e][r]).parentNode&&i.parentNode.removeChild(i),i.setAttribute("style",""),i instanceof SVGElement?i.setAttribute("transform",""):i.style.transform,t[e].length>20&&t[e].shift(),t[e].push(i);t[e].length})),delete r[e])},e}(),Sk.LRU=function(e,t){var r,n,i=this,o=(new Sk.Logger("sk-lru",{level:"info"}),{}),a=0,s=0;i.size=function(){return a},i.cost=function(){return s},i.forEachEntry=function(e){var t;for(t in o)o.hasOwnProperty(t)&&e(t,o[t])},i.updateCost=function(t,r){var n=o[t];if(!n)throw"key not found";for(s-=n.cost,n.cost=r,s+=n.cost;s>e&&i.shift(););},i.reserve=function(t){for(;s+t>e;)if(!i.shift())return!1;return!0},i.add=function(t,l,c){var d=o[t];if(d)throw"entry already exists";if(null==c&&(c=1),c>e)return null;for(o[t]=d={key:t,value:l,cost:c},n?(n.newer=d,d.older=n):r=d,n=d,a+=1,s+=c;s>e;)i.shift();return d},i.peek=function(e){return o[e]},i.get=function(e){var t=o[e];if(t)return function(e){e!==n&&(e.newer&&(e===r&&(r=e.newer),e.newer.older=e.older),e.older&&(e.older.newer=e.newer),e.newer=null,e.older=n,n&&(n.newer=e),n=e)}(t),t},i.detach=function(e){var t=o[e];if(t)return t.newer&&t.older?(t.older.newer=t.newer,t.newer.older=t.older):t.newer?(t.newer.older=null,r=t.newer):t.older?(t.older.newer=null,n=t.older):r=n=null,delete o[e],a-=1,s-=t.cost,t},i.remove=function(e){var r=i.detach(e);if(r)return t&&t(r),r},i.shift=function(){return r?i.remove(r.key):null},i.clear=function(){for(;i.shift(););}},Sk.Matrix={kScalar1Int:1065353216,Shift:Object.freeze({kTranslate:0,kScale:1,kAffine:2,kPerspective:3,kRectStaysRect:4}),TypeMask:Object.freeze({kIdentity:0,kTranslate:1,kScale:2,kAffine:4,kPerspective:8,kRectStaysRect:16,kOnlyPerspectiveValid:64,kUnknown:128,kORable:15,kAll:31}),kMScaleX:0,kMSkewY:1,kMPersp0:2,kMSkewX:3,kMScaleY:4,kMPersp1:5,kMTransX:6,kMTransY:7,kMPersp2:8,isValid:function(e){return"object"==typeof e&&9===e.length},identity:function(){return mat3.identity([])},computeTypeMask:function(e){var t,r,n,i,o=0;return this.hasPerspective(e)?this.TypeMask.kORable:(0===this.getTranslateX(e)&&0===this.getTranslateY(e)||(o|=this.TypeMask.kTranslate),t=Sk.Util.floatAs2sCompliment(this.getScaleX(e)),r=Sk.Util.floatAs2sCompliment(this.getSkewX(e)),n=Sk.Util.floatAs2sCompliment(this.getSkewY(e)),i=Sk.Util.floatAs2sCompliment(this.getScaleY(e)),r|n?(o|=this.TypeMask.kAffine|this.TypeMask.kScale,o|=((0==(t|i)?1:0)&(r=0!==r?1:0)&(n=0!==n?1:0))<<this.Shift.kRectStaysRect):(t^this.kScalar1Int|i^this.kScalar1Int&&(o|=this.TypeMask.kScale),o|=((t=0!==t?1:0)&(i=0!==i?1:0))<<this.Shift.kRectStaysRect),o)},getType:function(e){return(!e.hasOwnProperty("fTypeMask")||e.fTypeMask&this.TypeMask.kUnknown)&&(e.fTypeMask=this.computeTypeMask(e)),15&e.fTypeMask},isIdentity:function(e){return 0===this.getType(e)},isTranslate:function(e){return!(this.getType(e)&~this.TypeMask.kTranslate)},isScaleTranslate:function(e){return!(this.getType(e)&~(this.TypeMask.kScale|this.TypeMask.kTranslate))},rectStaysRect:function(e){return(!e.hasOwnProperty("fTypeMask")||e.fTypeMask&this.TypeMask.kUnknown)&&(e.fTypeMask=this.computeTypeMask(e)),!!(e.fTypeMask&this.TypeMask.kRectStaysRect)},isIdentityOrTranslation:function(e){return this.isValid(e),this.isTranslate(e)},fromMat2D:function(e){var t=[];return e.length,mat3.fromMat2d(t,e),t},toMat2D:function(e){this.isValid(e);var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t[4]=e[6],t[5]=e[7],t},toMat2DStr:function(e){return"matrix("+this.toMat2D(e).join(",")+")"},makeScale:function(e,t){return mat3.fromScaling([],[e,t])},makeTranslation:function(e,t){return mat3.fromTranslation([],[e,t])},makeRotation:function(e){return mat3.fromRotation([],e).map((function(e){return Sk.Util.FEQ(e,0)?0:e}))},makeRectToRect:function(e,t){var r,n,i,o,a;return Sk.Rect.isEmpty(e)||Sk.Rect.isEmpty(t)?null:(i=Sk.Rect.getWidth(t)/Sk.Rect.getWidth(e),o=Sk.Rect.getHeight(t)/Sk.Rect.getHeight(e),a=this.makeScale(i,o),r=Sk.Rect.getLeft(t)-Sk.Rect.getLeft(e)*i,n=Sk.Rect.getTop(t)-Sk.Rect.getTop(e)*o,this.setTranslate(a,r,n),a)},multiply:function(e,t){var r=[];return e.length,t.length,mat3.multiply(r,e,t),r},postScale:function(e,t,r){var n=[];return mat3.multiply(n,this.makeScale(t,r),e),n},preScale:function(e,t,r){var n=[];return mat3.multiply(n,e,this.makeScale(t,r)),n},copy:function(e,t){e.length,t.length,mat3.copy(e,t)},getScaleX:function(e){return e[this.kMScaleX]},getScaleY:function(e){return e[this.kMScaleY]},getSkewX:function(e){return e[this.kMSkewX]},getSkewY:function(e){return e[this.kMSkewY]},getTranslateX:function(e){return e[this.kMTransX]},getTranslateY:function(e){return e[this.kMTransY]},updateTranslateMask:function(e){0!==this.getTranslateX(e)||0!==this.getTranslateY(e)?e.fTypeMask|=this.TypeMask.kTranslate:e.fTypeMask&=~this.TypeMask.kTranslate},setTranslate:function(e,t,r){e.length,e[this.kMTransX]=t,e[this.kMTransY]=r,e.hasOwnProperty("fTypeMask")&&this.updateTranslateMask(e)},hasPerspective:function(e){return e.length,0!==e[this.kMPersp0]||0!==e[this.kMPersp1]||1!==e[this.kMPersp2]},getScaleSkewKey:function(e){function t(e){return Math.round(1024*e)/1024}return""+t(Sk.Matrix.getScaleX(e))+t(Sk.Matrix.getSkewX(e))+t(Sk.Matrix.getSkewY(e))+t(Sk.Matrix.getScaleY(e))},asString:function(e){return e.join(":")},getDecomposedScale:function(e){var t,r;return e.length,0===Sk.Matrix.getSkewX(e)&&0===Sk.Matrix.getSkewY(e)?(t=Sk.Matrix.getScaleX(e),r=Sk.Matrix.getScaleY(e)):Sk.Matrix.hasPerspective(e)?t=r=1:(t=vec2.length([Sk.Matrix.getScaleX(e),Sk.Matrix.getSkewY(e)]),r=vec2.length([Sk.Matrix.getSkewX(e),Sk.Matrix.getScaleY(e)])),[t,r]},decomposeScale:function(e,t){var r,n;return e.length,t.length,!(this.hasPerspective(e)||(r=vec2.length([Sk.Matrix.getScaleX(e),Sk.Matrix.getSkewY(e)]),n=vec2.length([Sk.Matrix.getSkewX(e),Sk.Matrix.getScaleY(e)]),!Number.isFinite(r)||!Number.isFinite(n)||Sk.Util.FEQ(r,0)||Sk.Util.FEQ(n,0)||(t[0]=r,t[1]=n,0)))},invert:function(e){return mat3.invert([],e)},mapVector:function(e,t,r){var n,i=[],o=[];return e.length,t.length,void 0!==r?(n=[(i=vec3.transformMat3(i,t,e))[0]/i[2],i[1]/i[2]],vec2.subtract(n,n,r)):(mat3.copy(o,e),Sk.Matrix.setTranslate(o,0,0),n=[(i=vec3.transformMat3(i,t,o))[0]/i[2],i[1]/i[2]]),n},mapRadius:function(e,t){var r,n,i,o,a=[t,0,1],s=[0,t,1];return e.length,Sk.Matrix.hasPerspective(e)&&(i=[(o=vec3.transformMat3(o,[0,0,1],e))[0]/o[2],o[1]/o[2]]),r=Sk.Matrix.mapVector(e,a,i),n=Sk.Matrix.mapVector(e,s,i),Math.sqrt(vec2.length(r)*vec2.length(n))},mapPoints:function(e,t){var r,n,i,o,a=[];for(r=0;r<t.length;r+=1)i=[(n=t[r])[0],n[1],1],o=[],vec3.transformMat3(o,i,e),o[2]&&(o[2]=1/o[2]),a.push([o[0]*o[2],o[1]*o[2]]);return a},mapRect:function(e,t){return Sk.Matrix.isIdentityOrTranslation(e)?Sk.Rect.translate(Sk.Rect.makeCopy(t),Sk.Matrix.getTranslateX(e),Sk.Matrix.getTranslateY(e)):Sk.Rect.bboxRect(Sk.Matrix.mapPoints(e,Sk.Rect.toQuad(t)))},isSizeEqual:function(e,t){return Sk.Rect.getWidth(e)===Sk.Rect.getWidth(t)&&Sk.Rect.getHeight(e)===Sk.Rect.getHeight(t)},mapRRect:function(e,t){var r,n,i,o,a,s,l,c,d,u,f,p=function(e,t,r){e[2*r]=[e[2*t],e[2*t]=e[2*r]][0],e[2*r+1]=[e[2*t+1],e[2*t+1]=e[2*r+1]][0]};if(Sk.RRect.isValid(t),this.isIdentity(e))return Sk.RRect.makeCopy(t);if(!this.rectStaysRect(e))return Sk.RRect.makeEmpty();if(r=this.mapRect(e,t.rect),n=Sk.Radii.makeEmpty(),!Sk.Rect.isValid(r)||Sk.Rect.isEmpty(r))return Sk.RRect.makeEmpty();if(t.hasOwnProperty("type")){if(Sk.RRectType.kRect===t.type)return{rect:r};if(Sk.RRectType.kOval===t.type){for(l=0;l<4;++l)n[2*l]=Sk.Rect.getWidth(r)/2,n[2*l+1]=Sk.Rect.getHeight(r)/2;return{rect:r,radii:n}}}if(i=this.getScaleX(e),o=this.getScaleY(e),this.isScaleTranslate(e))n=Sk.Radii.makeCopy(t.radii);else for(a=this.getSkewX(e)<0,i=this.getSkewY(e)*(a?1:-1),o=this.getSkewX(e)*(a?-1:1),s=a?3:1,l=0;l<4;++l)c=l+s>=4?(l+s)%4:l+s,n[2*l]=t.radii[2*c+1],n[2*l+1]=t.radii[2*c];for((u=i<0)&&(i=-i),(f=o<0)&&(o=-o),l=0;l<4;++l)n[2*l]*=i,n[2*l+1]*=o;return u?f?(p(n,0,2),p(n,1,3)):(p(n,1,0),p(n,2,3)):f&&(p(n,0,3),p(n,1,2)),Sk.Radii.isValid(n)?(d={rect:r,radii:n},Sk.RRect.scaleRadii(d),d):Sk.RRect.makeEmpty()}},Sk.SafeviewRecording=function(e,t,r,n,i,o,a,s,l){var c,d,u,f,p,g,m,_=this,h=new Sk.Logger("skr",{level:"info"}),y=0,v=0,k=!1;function S(e){Sk.fatal("SkSafeviewRecordingError",e)}function b(){r.onPictureLoaded(_),t&&(t(_),t=null)}function w(e){v+=1,_.allAssetsLoaded()&&b()}function C(e,t,i){var l,c,d,u,f=i.readUint32(),p=i.readByteArray(),g=!1;function m(e){return!!(f&e)}if(l=m(Sk.DefineImageExtra.kShouldAnimate),!m(Sk.DefineImageExtra.kCanvasSnapshot|Sk.DefineImageExtra.kFromVideoNode))switch(e){case Sk.Verb.DefineImage:c=new window.Blob([p],{type:"image/*"}),d=window.URL.createObjectURL(c);break;case Sk.Verb.DefineImageURL:g=!0,d=o.get_resource_url(p,l);break;case Sk.Verb.DefineImageRewrittenURL:g=!0,d=o.get_url_str(p)}function _(e){e.isComplete(),w()}u=new Sk.Image(d,c,Sk.imageQuality[0],Sk.imageQuality[1],a,g&&!s),m(Sk.DefineImageExtra.kCanvasSnapshot),m(Sk.DefineImageExtra.kFromVideoNode),n.add(Sk.Deduper.Type.kImage,t,u),m(Sk.DefineImageExtra.kCanvasSnapshot)?u.initAsCanvasSnapshot(f,p,r):m(Sk.DefineImageExtra.kFromVideoNode)?u.initAsVideoFrame(f,p,r):m(Sk.DefineImageExtra.kShouldAnimate)&&u.initAsAnimatedImage(f,i.readInt32(),r),!g||s?(y+=1,m(Sk.DefineImageExtra.kCanvasSnapshot)?u.startLoadingCanvasSnapshot(_):m(Sk.DefineImageExtra.kFromVideoNode)?u.startLoadingVideoFrame(_):u.startLoading(_)):u.startLoading()}function T(e,t){var r=t.bytesRead("readPathDef");n.add(Sk.Deduper.Type.kPath,e,r.object,r.bytes_read)}function E(e,t){var r,i,o=t.bytesRead("readGlyphDef");(r=o.object).image&&(i=Sk.Util.makeImageBlobFromU8Array(r.image),r.image=new Sk.Image(window.URL.createObjectURL(i),i,Sk.imageQuality[0],Sk.imageQuality[1],a,!1),s?(y+=1,r.image.startLoading((function(e){e.isComplete(),w()}))):r.image.startLoading()),n.add(Sk.Deduper.Type.kGlyph,e,o.object,o.bytes_read)}function A(e,t){var r=t.bytesRead("readTextBlobDef");n.add(Sk.Deduper.Type.kTextBlob,e,r.object,r.bytes_read)}function R(e,t){var r=t.bytesRead("readPaintDef");n.add(Sk.Deduper.Type.kPaint,e,r.object,r.bytes_read)}function x(e,t){var r=t.bytesRead("readTypefaceDef");n.add(Sk.Deduper.Type.kTypeface,e,r.object,r.bytes_read)}function D(e,t){var r=t.bytesRead("readFontDataDef");n.add(Sk.Deduper.Type.kFontData,e,r.object,r.bytes_read)}function I(e,t){var r=t.bytesRead("readFlattenableDef");n.add(Sk.Deduper.Type.kFlattenable,e,r.object,r.bytes_read)}function O(e,t,l){var c,d,u=l.readByteArray();y+=1,c=function(e,t){return new Sk.SafeviewRecording(e,w,r,n,i,o,a,s,t)}(u,t),n.add(Sk.Deduper.Type.kPicture,t,c,u.length),e&&(y+=1,d=Sk.Util.makeImageBlobFromU8Array(l.readByteArray()),new Sk.Image(window.URL.createObjectURL(d),d,Sk.imageQuality[0],Sk.imageQuality[1],a,!1).startLoading((function(e){c.setRasterImage(e),w()})))}function U(e,t){var r;t.typeface_id=e.readUint32(),r=e.readUint32(),t.font_generic_family=15&r,t.font_style=r>>4&15,t.font_weight=r>>8&4095,t.text_align=r>>20&15,t.font_flags=r>>24&255,t.font_flags&Sk.HT.FontFlags.kHasStretchOrSpacing?(t.font_stretch=e.readFloat32(),t.letter_spacing=e.readFloat32(),t.word_spacing=e.readFloat32()):(t.font_stretch=100,t.letter_spacing=0,t.word_spacing=0)}function M(e){var t={};switch(t.display_item_type=e.readUint32(),t.type=e.readUint32(),t.flags=e.readUint32(),t.node_id=String(e.readInt32()),t.frame_token=Sk.Util.marshalFrameToken(e.readUint32(),e.readUint32()),t.node_uid=Sk.Util.getNodeKey(t.frame_token,t.node_id),t.owner_node_id=String(e.readInt32()),t.owner_node_uid=Sk.Util.getNodeKey(t.frame_token,t.owner_node_id),t.flags&Sk.HT.ElementFlags.kHasDebugData&&(t.debug_name=e.readString(),t.debug_item_type=e.readInt32()),t.flags&Sk.HT.ElementFlags.kHasLink&&(t.link_url=e.readString()),t.flags&Sk.HT.ElementFlags.kHasCursor&&(t.cursor=e.readUint32()),t.flags&Sk.HT.ElementFlags.kHasScrollableContainerId&&(t.scrollable_container_id=e.readUint32()),t.type){case Sk.HT.ElementType.kFormControl:t.formctrl=function(e){var t,r={};switch(t=e.readUint32(),r.type=65535&t,r.flags=t>>16&65535,r.id_attr=e.readString(),r.name_attr=e.readString(),r.autocomplete_attr=e.readString(),r.flags&Sk.HT.FormControlElement.Flags.kHasEnterKeyHint&&(r.enterkeyhint_attr=e.readString()),U(e,r),r.font_size=e.readInt32(),r.color=e.readUint32(),r.padding_left=e.readFloat32(),r.padding_top=e.readFloat32(),r.padding_right=e.readFloat32(),r.padding_bottom=e.readFloat32(),r.border_width_left=e.readFloat32(),r.border_width_top=e.readFloat32(),r.border_width_right=e.readFloat32(),r.border_width_bottom=e.readFloat32(),r.text_indent=e.readFloat32(),r.type){case Sk.HT.FormControlElement.Type.kInput:r.input={},t=e.readUint32(),r.input.type=65535&t,r.input.flags=t>>16&65535,r.input.flags&Sk.HT.InputElement.Flags.kIsBaseTemporal?(r.input.value=e.readFloat32(),r.input.min=e.readFloat32(),r.input.max=e.readFloat32()):r.input.type===Sk.HT.InputElement.Type.kColor&&(r.input.color=e.readUint32()),r.input.flags&Sk.HT.InputElement.Flags.kHasDataList&&(r.input.data_list=function(e){var t,r,n,i={},o=e.readUint32();for(i.flags=255&o,i.node_id=e.readInt32(),i.options=[],r=o>>8&16777215,t=0;t<r;++t)(n={}).flags=e.readUint32(),n.flags&Sk.HT.DataListOptionItem.Flags.kHasValue&&(n.value=e.readString()),i.options.push(n);return i}(e));break;case Sk.HT.FormControlElement.Type.kTextArea:r.textarea={},r.flags&Sk.HT.FormControlElement.Flags.kHasTextAreaInfo&&(t=e.readUint32(),r.textarea.flags=255&t,r.textarea.rows=t>>8&4095,r.textarea.cols=t>>20&4095);break;case Sk.HT.FormControlElement.Type.kContentEditable:r.contenteditable={};break;case Sk.HT.FormControlElement.Type.kSelect:r.select=function(e){var t,r,n,i,o=[],a=e.readUint32();for(n=16777215&a,i=a>>24&255,t=0;t<n;t+=1)r={},a=e.readUint32(),r.type=15&a,r.flags=a>>4&4095,r.index=a>>16&65535,r.label=e.readString(),r.tool_tip=e.readString(),o.push(r);return{items:o,flags:i}}(e)}return r}(e);break;case Sk.HT.ElementType.kTextNode:t.text=e.readString(),t.box_rect=e.readRect(),U(e,t);break;case Sk.HT.ElementType.kCustomScrollbar:t.custom_scrollbar=function(e){var t,r,n=e.readUint32(),i={};for(i.scroll_element_id=e.readUint32(),i.flags=n>>16&65535,t=65535&n,i.parts={},r=0;r<t;++r)i.parts[e.readUint32()]=e.readRect();return i}(e);break;case Sk.HT.ElementType.kElementNode:case Sk.HT.ElementType.kUnknown:case Sk.HT.ElementType.kInnerEditorElement:case Sk.HT.ElementType.kImageElement:case Sk.HT.ElementType.kPlugInElement:case Sk.HT.ElementType.kDataListIndicator:case Sk.HT.ElementType.kPickerIndicator:break;default:t.type}return t}function F(e,t,r){var n=r>>1&1,i=r>>2&15,o=t.readRRect(i);e.clipRRect(o,n)}function P(e,t,r){var n=t.readRRect(r),i=t.readPaint();e.drawRRect(n,i)}function L(e,t,r){var n=t.readRect(),i={rect:n,radii:Sk.Rect.getOvalRadii(n),type:Sk.RRectType.kOval},o=t.readPaint();e.drawRRect(i,o)}function N(e,t,r){var n=null,i=t.readImage(),o=t.readFloat32(),a=t.readFloat32(),s=Sk.Point.fromXY(o,a);r&Sk.DrawImageMask.HasPaint&&(n=t.readPaint()),e.drawImageRect(i,null,s,n)}function B(e,t,r){var n,i,o=null,a=null;Sk.DrawImageRectMask.Constraint,n=t.readImage(),r&Sk.DrawImageRectMask.HasSrcRect&&(a=t.readRect()),i=t.readRect(),r&Sk.DrawImageRectMask.HasPaint&&(o=t.readPaint()),e.drawImageRect(n,a,i,o)}function H(e,t,r){var n={};r&Sk.SaveLayerMask.HasBounds&&(n.local_bounds=t.readRect()),r&Sk.SaveLayerMask.HasPaint&&(n.paint=t.readPaint()),r&Sk.SaveLayerMask.HasBackdrop&&(n.backdrop=t.readFlattenable()),r&Sk.SaveLayerMask.HasClipMask&&(n.clip_mask=t.readImage()),r&Sk.SaveLayerMask.HasClipMatrix&&(n.clip_matrix=t.readMatrix()),e.saveLayer(n,r)}function V(e,t,r){var i,o,a,s=r,l=n.get(Sk.Deduper.Type.kPicture,s);s?(l||S({event:"draw-picture-error",reason:"pic not found",index:s}),i=t.readRect(),r&Sk.DrawPictureMask.HasMatrix&&(a=t.readMatrix()),r&Sk.DrawPictureMask.HasPaint&&(o=t.readPaint()),e.drawPicture(l,i,a,o)):h.error({event:"draw-picture-error",reason:"index is 0 -- server encode error?",index:s})}function W(e,t,r){e.drawAnnotation(t.readRect())}function z(e,t,r){var n=t.readTextBlobByIndex(r),i=t.readFloat32(),o=t.readFloat32(),a=t.readPaint();e.drawTextBlob(n,i,o,a)}function G(e,t,r,n){var i=!!(r&Sk.TypeMask.SetMatrix),o=t.readSparseMatrix(r);i?e.setMatrix(o,n):e.concat(o)}function j(e,t,r){var n=t.readPathByIndex(r),i=t.readUint32()>>1&1;e.clipPath(n,i)}function Y(e,t,r){var n=t.readPathByIndex(r),i=t.readPaint();e.drawPath(n,i)}function X(e,t,r){e.drawPaint(t.readPaint())}function q(e,t,r){var n=t.readUint32(),i=[],o=t.readFloat32Array(2*n);Sk.Util.scalarArrayToPoints(i,o),e.drawPoints(r,n,i,t.readPaint(),o)}function K(e,t,r){var n=t.readRect(),i=t.readFloat32(),o=t.readFloat32(),a=t.readPaint();e.drawArc(n,i,o,r,a)}_.allAssetsLoaded=function(){return k&&y===v},_.getCullRect=function(){return c},_.playback=function(e,t){var r,n,i,o=f;for(o.reset();!o.eof();)switch(n=(r=o.readUint32())>>24&255,i=16777215&r,o.offset(),n){case Sk.Verb.ClipRect:case Sk.Verb.ClipRRect:F(e,o,n===Sk.Verb.ClipRRect?i:i|Sk.RRectType.kRect<<2);break;case Sk.Verb.ClipPath:j(e,o,i);break;case Sk.Verb.Save:e.save();break;case Sk.Verb.SaveLayer:H(e,o,i);break;case Sk.Verb.Restore:e.restore();break;case Sk.Verb.Concat:G(e,o,i,t?t.original_ctm:null);break;case Sk.Verb.DrawRect:case Sk.Verb.DrawRRect:P(e,o,n===Sk.Verb.DrawRRect?i:Sk.RRectType.kRect);break;case Sk.Verb.DrawOval:L(e,o);break;case Sk.Verb.DrawImage:N(e,o,i);break;case Sk.Verb.DrawImageRect:B(e,o,i);break;case Sk.Verb.DrawTextBlob:z(e,o,i);break;case Sk.Verb.DrawPath:Y(e,o,i);break;case Sk.Verb.DrawPaint:X(e,o);break;case Sk.Verb.DrawPoints:q(e,o,i);break;case Sk.Verb.DrawPicture:V(e,o,i);break;case Sk.Verb.DrawAnnotation:W(e,o);break;case Sk.Verb.DrawArc:K(e,o,i);break;default:S({event:"unknown-draw-op",op:n})}},_.isSuitableForRasterCaching=function(e){return!(d&Sk.PictureFlags.kHasPictures||d&Sk.PictureFlags.kHintDoNotCache||d&Sk.PictureFlags.kHintDoNotRasterCache||Sk.Rect.getArea(e.toDeviceBounds(c))>Sk.maxRasterArea||d&Sk.PictureFlags.kHasImages||!(d&(Sk.PictureFlags.kHasText|Sk.PictureFlags.kHasPaths)))},_.getProperties=function(){return d},_.getHitTestData=function(){return u},_.getId=function(){return p},_.getMemoryUsage=function(){return e.length},_.getContentId=function(){return l},_.getRasterImage=function(){return g},_.setRasterImage=function(e){g=e},_.getRasterCache=function(){return i},_.getAssetCache=function(){return n},_.getCullRect=function(){return c},_.deduper={},m=new Sk.BinaryReader(e,n),p=Sk.nextRecordingId,Sk.nextRecordingId+=1,function(e){c=e.readRect()}(m),function(e){for(var t,r,i,o=!1;!o;)switch(i=16777215&(t=e.readUint32()),r=t>>24&255){case Sk.Verb.DefineImage:case Sk.Verb.DefineImageURL:case Sk.Verb.DefineImageRewrittenURL:C(r,i,e);break;case Sk.Verb.DefinePath:T(i,e);break;case Sk.Verb.DefineGlyph:E(i,e);break;case Sk.Verb.DefineTextBlob:A(i,e);break;case Sk.Verb.DefinePaint:R(i,e);break;case Sk.Verb.DefineTypeface:x(i,e);break;case Sk.Verb.DefineFontData:D(i,e);break;case Sk.Verb.DefinePicture:case Sk.Verb.DefineRasterPicture:O(r===Sk.Verb.DefineRasterPicture,i,e);break;case Sk.Verb.DefineDrawOps:d=i,f=new Sk.BinaryReader(e.readByteArray(),n);break;case Sk.Verb.DefineHitTestData:u=M(e);break;case Sk.Verb.DefineFlattenable:I(i,e);break;case Sk.Verb.EndDefinitions:o=!0;break;default:S({event:"unknown-definition-verb",verb:r})}k=!0,y===v&&b()}(m)},Sk.RasterCacheClass=function(){var e=this,t=(new Sk.Logger("sk-raster-cache",{level:"info"}),Sk.canvasMemoryLimit.rcache),r=new Sk.LRU(t,(function(e){e.value.release()})),n={};e.getOrCreate=function(e,t,i){var o,a=e+":"+Sk.Matrix.getScaleSkewKey(i.getCTM())+":"+i.getDeviceScaleFactor(),s=r.get(a);return s?(n.hit_count+=1,s.value):(n.miss_count+=1,t.isSuitableForRasterCaching(i)&&(o=function(e,t){var n,i,o,a=e.getCullRect(),s=t.getCTM();return(n=function(e,t){var n={x:Sk.Rect.getX(e)/t,y:Sk.Rect.getY(e)/t},i=new Sk.HTMLCanvasDevice("rcache",e,n,t);for(Sk.Rect.getArea(e),Sk.maxRasterArea,r.reserve(i.getMemoryUsage());!i.tryAlloc();)if(!r.shift())return null;return Sk.Rect.isIntRect(e),Sk.Rect.getWidth(e),Sk.Rect.getHeight(e),i}(t.toDeviceBounds(a),t.getDeviceScaleFactor()))?((o=Sk.Util.copyDict(t.getOptions())).use_raster_cache=!1,(i=new Sk.Canvas(n,null,o)).setHostCanvas(t),i.setMatrix(Sk.Matrix.toMat2D(s)),i.clipRect(a),i.translate(Sk.Rect.getX(a),Sk.Rect.getY(a)),e.playback(i,{original_ctm:s}),Sk.getDebugFlags()&Sk.DebugFlags.kHighlightRasterCacheItems&&(i.fillRect(a,"rgba(0, 160, 200, 0.5)"),i.fillText(e.getId()+":"+n.getId(),Sk.Rect.getX(a),Sk.Rect.getY(a)+8)),n.setCanvas(null),i.setHostCanvas(null),i=null,n):null}(t,i)),o&&(r.remove(a),r.add(a,o,o.getMemoryUsage())||(o=null)),o)},e.remove=function(e){r.remove(e)},e.getMemoryUsage=function(){return r.cost()},e.flush=function(){r.clear(),(n={}).hit_count=0,n.miss_count=0},e.getStats=function(){return n}},Sk.CanvasEmitter=function(e){this.emitVerb=function(t,r){var n;switch(r.length,t){case Sk.PathVerb.kMove:r.length,e.moveTo(r[0][0],r[0][1]);break;case Sk.PathVerb.kClose:r.length,e.closePath();break;case Sk.PathVerb.kLine:r.length,e.lineTo(r[0][0],r[0][1]);break;case Sk.PathVerb.kQuad:r.length,e.quadraticCurveTo(r[0][0],r[0][1],r[1][0],r[1][1]);break;case Sk.PathVerb.kCubic:r.length,e.bezierCurveTo(r[0][0],r[0][1],r[1][0],r[1][1],r[2][0],r[2][1]);break;case Sk.PathVerb.kArc:r.length,r[0],n=r[0],e.ellipse(n.center[0],n.center[1],n.radii[0],n.radii[1],n.x_axis_rotation,Sk.Util.degToRad(n.start_angle),Sk.Util.degToRad(n.end_angle),!n.sweep_flag)}}},Sk.SVGEmitter=function(){var e,t=this,r=[];t.setTransform=function(t){e=t},t.flushPathList=function(t){var n=r;return r=[],e=null,n},t.emitVerb=function(t,n){var i;switch(n.length,t){case Sk.PathVerb.kMove:n.length,r.push("M");break;case Sk.PathVerb.kClose:n.length,r.push("Z");break;case Sk.PathVerb.kLine:n.length,r.push("L");break;case Sk.PathVerb.kQuad:n.length,r.push("Q");break;case Sk.PathVerb.kCubic:n.length,r.push("C");break;case Sk.PathVerb.kArc:n.length,n[0],r.push("A"),(i=n[0]).radii.forEach((function(e){r.push(e)})),r.push(i.x_axis_rotation),r.push(i.large_arc_flag),r.push(i.sweep_flag),n=[i.end_point]}!function(t,r){var n,i;for(e&&(r=Sk.Matrix.mapPoints(e,r)),n=0;n<r.length;n+=1)i=r[n],t.push(i[0].toFixed(3),i[1].toFixed(3))}(r,n)}},Sk.PathTools=function(e,t){var r=this,n=(new Sk.Logger("sk-path-tools",{level:"info"}),Sk.Rect.resize(Sk.Rect.fromWH(10,10),1e6)),i=e.emitVerb;function o(e,t,r,n,o,a,s){var l,c=[e,t,r,n,o,a,s];(l=Sk.Conic.convertConicToQuads(c,1)).length,l[0],l[1],l[8],l[9],i(Sk.PathVerb.kQuad,[[l[2],l[3]],[l[4],l[5]]]),i(Sk.PathVerb.kQuad,[[l[6],l[7]],[l[8],l[9]]])}function a(e,t,r,n,a,s){var l=0;switch(e){case Sk.PathVerb.kLine:t[n],t[n+1],l=1,i(e,[[t[n],t[n+1]]]),r[0]=t[n],r[1]=t[n+1];break;case Sk.PathVerb.kQuad:t[n],t[n+1],t[n+a],t[n+a+1],l=2,i(e,[[t[n],t[n+1]],[t[n+a],t[n+a+1]]]),r[0]=t[n+a],r[1]=t[n+a+1];break;case Sk.PathVerb.kConic:t[n],t[n+1],t[n+a],t[n+a+1],l=2,o(r[0],r[1],t[n],t[n+1],t[n+a],t[n+a+1],s),r[0]=t[n+a],r[1]=t[n+a+1];break;case Sk.PathVerb.kCubic:t[n],t[n+1],t[n+a],t[n+a+1],t[n+2*a],t[n+2*a+1],l=3,i(e,[[t[n],t[n+1]],[t[n+a],t[n+a+1]],[t[n+2*a],t[n+2*a+1]]]),r[0]=t[n+2*a],r[1]=t[n+2*a+1]}return l}function s(e){var t,r,n,o=e.points_f32a,s=0,l=e.verbs_u8a,c=e.weights_f32a,d=0,u=[],f=[];for(r=0;r<l.length;r+=1){switch(l[r]){case Sk.PathVerb.kMove:o[s],o[s+1],t=1,i(l[r],[[o[s],o[s+1]]]),u[0]=f[0]=o[s],u[1]=f[1]=o[s+1];break;case Sk.PathVerb.kClose:f[0],f[1],t=0,i(l[r],[]),u[0]=f[0],u[1]=f[1];break;case Sk.PathVerb.kConic:e.weight_count,n=c[d],d+=1,t=a(l[r],o,u,s,2,n);break;default:t=a(l[r],o,u,s,2,n)}s+=2*t,n=void 0}}function l(e,t){var r,n,o=e.length;for(i(Sk.PathVerb.kMove,[e[0]]),r=1;r<o;r+=1)n=t?e[o-r]:e[r],i(Sk.PathVerb.kLine,[n])}function c(e){var i;t&&(i=t.deviceToLocalBounds(t.getDeviceBounds())),i||(i=n),r.drawRRectPath({rect:i},e)}r.drawRRectPath=function(e,t){var r,n,a,s,l,c,d,u,f=Sk.Rect.getX(e.rect),p=Sk.Rect.getY(e.rect),g=Sk.Rect.getRight(e.rect),m=Sk.Rect.getBottom(e.rect),_=[];if(Sk.Radii.isValid(e.radii)){for(r=Sk.Radii.getUpperLeftX(e.radii),n=Sk.Radii.getUpperLeftY(e.radii),a=Sk.Radii.getUpperRightX(e.radii),s=Sk.Radii.getUpperRightY(e.radii),l=Sk.Radii.getLowerRightX(e.radii),_=[f,p+n,f,p,f+r,p,g-a,p,g,p,g,p+s,g,m-Sk.Radii.getLowerRightY(e.radii),g,m,g-l,m,f+Sk.Radii.getLowerLeftX(e.radii),m,f,m,f,m-Sk.Radii.getLowerLeftY(e.radii)],!0===t?(d=_.length-2,u=-2):(d=0,u=2),i(Sk.PathVerb.kMove,[[_[d],_[d+1]]]),c=d;o(_[c],_[c+1],_[c+u],_[c+u+1],_[c+2*u],_[c+2*u+1],.707106781),!((c+=3*u)<0||c>=_.length);)i(Sk.PathVerb.kLine,[[_[c],_[c+1]]]);i(Sk.PathVerb.kLine,[[_[d],_[d+1]]])}else i(Sk.PathVerb.kMove,[[f,p]]),t?(i(Sk.PathVerb.kLine,[[f,m]]),i(Sk.PathVerb.kLine,[[g,m]]),i(Sk.PathVerb.kLine,[[g,p]])):(i(Sk.PathVerb.kLine,[[g,p]]),i(Sk.PathVerb.kLine,[[g,m]]),i(Sk.PathVerb.kLine,[[f,m]])),i(Sk.PathVerb.kLine,[[f,p]])},r.drawPointsPath=l,r.drawRRect=function(e,t){t===Sk.ClipOp.kIntersect||Sk.ClipOp.kDifference;var n=t===Sk.ClipOp.kDifference;n&&c(),r.drawRRectPath(e,n)},r.drawQuad=function(e,t){t===Sk.ClipOp.kIntersect||Sk.ClipOp.kDifference;var r=t===Sk.ClipOp.kDifference;r&&c(),l(e,r)},r.drawPath=function(e,t){if(t===Sk.ClipOp.kIntersect||Sk.ClipOp.kDifference,t===Sk.ClipOp.kDifference)return c(),e.first_direction,void(e.first_direction===Sk.PathDirection.kCCW_Direction?s(e):function(e){var t,r,n,o,s=e.points_f32a,l=e.verbs_u8a,c=e.weights_f32a,d=e.weight_count-1,u=[],f=[],p=!1,g=!0;for(l&&l.length,s&&s.length,r=s.length-2,n=l.length-1;n>=0;n-=1){switch(g&&(i(Sk.PathVerb.kMove,[[s[r],s[r+1]]]),u[0]=f[0]=s[r],u[1]=f[1]=s[r+1],g=!1),l[n]){case Sk.PathVerb.kMove:s[r],s[r+1],t=1,p&&(i(Sk.PathVerb.kClose,[]),p=!1),g=!0;break;case Sk.PathVerb.kClose:f[0],f[1],t=0,p=!0;break;case Sk.PathVerb.kConic:o=c[d],d-=1,t=a(l[n],s,u,r-2,-2,o);break;default:t=a(l[n],s,u,r-2,-2,o)}r-=2*t,o=void 0}}(e));(function(e){return 0!=(e.fill_rule&Sk.FillRule.kInverseWinding)})(e)&&c(e.first_direction===Sk.PathDirection.kCW_Direction),s(e)},r.drawArc=function(e,t,r,n,o){var a=new Sk.Ellipse(Sk.Rect.getCenter(e),Sk.Rect.getWidth(e)/2,Sk.Rect.getHeight(e)/2),s=t+r,l={};l.center=a.getCenterPoint(),l.start_angle=t,l.end_angle=s,l.end_point=360===r?a.cartesianPointAt(s-.1):a.cartesianPointAt(s),l.large_arc_flag=Math.abs(r)>180?1:0,l.x_axis_rotation=0,l.radii=a.getRadii(),l.sweep_flag=r>0?1:0,o&&i(Sk.PathVerb.kMove,[a.cartesianPointAt(t)]),i(Sk.PathVerb.kArc,[l])}},Sk.Font=function(){var e={};function t(e){switch(e){case Sk.HT.FontStyle.kNormal:return"normal";case Sk.HT.FontStyle.kItalic:return"italic";case Sk.HT.FontStyle.kOblique:return"oblique";default:return""}}function r(e){switch(e){case 400:return"normal";case 700:return"bold";default:return String(e)}}return new Sk.Logger("sk-font",{level:"info"}),e.getFamilyName=function(e,t){return["Face",e,t].join("_")},e.toCSSFont=function(n,i,o,a,s){var l=[];return l.push('"'+e.getFamilyName(s,a)+'"'),l.push(function(e){switch(e){case Sk.HT.GenericFontFamily.kNoFamily:case Sk.HT.GenericFontFamily.kStandardFamily:case Sk.HT.GenericFontFamily.kSansSerifFamily:return"sans-serif";case Sk.HT.GenericFontFamily.kSerifFamily:return"serif";case Sk.HT.GenericFontFamily.kMonospaceFamily:return"monospace";case Sk.HT.GenericFontFamily.kCursiveFamily:return"cursive";case Sk.HT.GenericFontFamily.kFantasyFamily:return"fantasy";default:return""}}(n.font_generic_family)),[t(n.font_style),r(n.font_weight),i+"px / "+o+"px",l.join(",")].join(" ")},e.applyFontStyle=function(t,r,n,i,o,a){t.style.font=e.toCSSFont(r,n,i,o,a),r.font_flags&Sk.HT.FontFlags.kHasStretchOrSpacing&&(t.style.fontStretch=r.font_stretch+"%",t.style.letterSpacing=r.letter_spacing+"px",t.style.wordSpacing=r.word_spacing+"px"),r.font_flags&Sk.HT.FontFlags.kAntialiased&&(t.style.webkitFontSmoothing="antialiased"),r.font_flags&Sk.HT.FontFlags.kRightToLeft&&(t.style.direction="rtl"),r.font_flags&Sk.HT.FontFlags.kUseKerning||(t.style.fontKerning="none"),r.font_flags&Sk.HT.FontFlags.kSmallCaps&&(t.style.fontVariant="small-caps"),t.style.width=null,t.style.height=null,t.style.padding=t.style.margin="0px",t.style.whiteSpace="pre",t.style.boxSizing="border-box"},e}(),Sk.TextBlobIterator=function(e){var t=this;function r(t){var r,n,i=t.glyph_reader,o={};switch(t.positioning){case Sk.GlyphPositioning.kDefault:case Sk.GlyphPositioning.kHorizontal:r=i.readFloat32(),n=t.offset[1];break;case Sk.GlyphPositioning.kFull:r=i.readFloat32(),n=i.readFloat32()}return o.x_pos=r,o.y_pos=n,o.glyph=i.readGlyphByIndex(void 0,e),o}t.forEachGlyph=function(e,t,n,i){var o,a;for(e.glyph_reader.reset(),o=0;o<e.glyph_count;o+=1)i((a=r(e)).glyph,t+a.x_pos,n+a.y_pos)},t.readGlyphAtIndex=function(e,t){var n=e.glyph_reader,i=e.positioning===Sk.GlyphPositioning.kFull?8:4;return i+=4,n.reset(),n.skip(t*i),r(e)},t.forEachRun=function(e,r,n,i){var o,a,s=null===r||Sk.Util.copyDict(r);for(i=void 0!==i?Math.min(e.runs.length,i):e.runs.length,o=0;o<i;o+=1)a=e.runs[o],null!==r&&Sk.Paint.applyTextRunPaint(s,a.paint),n(t,a,s)}},Sk.TextUtils=function(){var e={},t=(new Sk.Logger("sk-text-fitter",{level:"info"}),document.createElement("canvas"));function r(e,r,n){var i=function(e,r){var n,i=t.getContext("2d");return i.font=r,void 0!==(n=i.measureText(function(e){var t,r="",n=!1;for(t=e.length-1;t>=0;t-=1)" "!==e[t]||n?(r=e[t]+r,n=!0):r="l"+r;return r}(e))).actualBoundingBoxLeft?Math.abs(n.actualBoundingBoxLeft)+Math.abs(n.actualBoundingBoxRight):(n.width,n.width)}(e,r);return i+=n*e.length,Number.isFinite(i),i}return e.getBestUnderfit=function(e,t,n,i,o,a,s){var l,c,d=i,u=Number.MAX_SAFE_INTEGER;do{c=(o+i)/2,(l=r(e,Sk.Font.toCSSFont(n,c,Sk.Rect.getHeight(t),a,s),n.letter_spacing)-Sk.Rect.getWidth(t))<=0?(i=c+.1,Math.abs(l)<Math.abs(u)&&(u=l,d=c)):o=c-.1}while(i<o&&0!==l);return{size:d,delta:u}},e}(),Sk.TextFitter=function(e,t){var r,n,i=this,o=(new Sk.Logger("sk-dom",{level:"info"}),[]);function a(e,r,n,i,o){Sk.Font.applyFontStyle(e,r,o,Sk.Rect.getHeight(n),i,t),e.textContent=r.text}function s(e){var r,i=e.target,o=e.contentRect.width;i&&i.parentNode&&i.run_bounds&&(r=o-Sk.Rect.getWidth(i.run_bounds),Math.abs(r)<=3||(function(e,r,n,i,o){var s;r.text.length&&(o>0&&(s=Sk.TextUtils.getBestUnderfit(r.text,n,r,1,i.textSize,i.typeface.id,t),a(e,r,n,i.typeface.id,s.size),o=s.delta,Sk.isDebugEnabled()&&(e.style.backgroundColor="rgba(173,216,230,0.6)")),o<0&&(e.style.letterSpacing=r.letter_spacing+Math.abs(o)/r.text.length+"px",Sk.isDebugEnabled()&&(e.style.backgroundColor="rgba(173,216,230,0.6)")))}(i,i.htd,i.run_bounds,i.paint,r),n.unobserve(i)))}function l(e){e.forEach(s)}function c(){o.forEach((function(e){a(e,e.htd,e.run_bounds,e.paint.typeface.id,e.paint.textSize),n.observe(e)}))}i.registerDiv=function(e){a(e,e.htd,e.run_bounds,e.paint.typeface.id,e.paint.textSize),o.push(e),n&&n.observe(e)},i.reset=function(){n&&(n.disconnect(),e.deregisterCallback(r)),window.ResizeObserver&&(o=[],n=new window.ResizeObserver(l),e.registerCallback(r,c))},i.release=function(){o=null,n&&(n.disconnect(),n=null,e.deregisterCallback(r))},r="tld:"+Sk.nextTextFitterId,Sk.nextTextFitterId+=1,i.reset()},Sk.HTMLPaintApplicator=function(e){new Sk.Logger("sk-html-paint",{level:"info"}),this.applyPaint=function(t,r,n,i,o){return HTMLElement,!e.shouldUseSVG()&&!!function(t){var r;if(t.shader){if(t.shader.sweep_gradient)return t.shader.sweep_gradient.interpolate_in_premul,!0;if(t.shader.conical_gradient&&t.shader.conical_gradient.interpolate_in_premul,!(r=t.shader.linear_gradient||t.shader.radial_gradient)||!r.interpolate_in_premul||!e.isCSSGradientsAllowed())return!1}return t.strokeCap===Sk.Paint.Cap.kButt&&t.strokeJoin===Sk.Paint.Join.kMiter}(r)&&(i&(Sk.PaintUsage.kGeometry|Sk.PaintUsage.kPaint)&&function(e,t,r){var n=t.strokeWidth||1;t.style!==Sk.Paint.Style.kFill_Style&&t.style!==Sk.Paint.Style.kStrokeAndFill_Style||(t.shader?function(e,t,r){t.linear_gradient||t.radial_gradient||t.sweep_gradient,t.linear_gradient?function(e,t,r){var n,i,o,a,s,l,c,d,u=[t.start[0]-t.end[0],t.start[1]-t.end[1]];for(t.colors.length,o=1/(t.colors.length-1),i="linear-gradient("+Sk.Util.angleBetween([0,1],u,!0)+"deg",n=0;n<t.colors.length;++n)i+=","+Sk.Paint.skColorToCSSColor(t.colors[n])+" ",i+=100*(t.position?t.position[n]:o*n)+"%";e.style.backgroundImage=i+")",t.gradient_size&&(t.gradient_size.length,c=Sk.Rect.getLeft(r),d=Sk.Rect.getTop(r),a=Sk.Rect.bboxRect([t.start,t.end]),s=Sk.Rect.getCenter(a),0===u.x?(s[0]=t.gradient_size[0]/2,c=0):0===u.y&&(s[1]=t.gradient_size[1]/2,d=0),l=Sk.Rect.makeFromMidpoint({x:s[0],y:s[1]},t.gradient_size[0]/2,t.gradient_size[1]/2),Sk.Rect.translate(l,-c,-d),e.style.backgroundPosition=Sk.Rect.getLeft(l)+"px "+Sk.Rect.getTop(l)+"px",e.style.backgroundSize=t.gradient_size[0]+"px "+t.gradient_size[1]+"px")}(e,t.linear_gradient,r):t.radial_gradient?function(e,t,r){var n,i,o,a,s,l,c=t.center,d=t.radius,u=[];for(t.colors.length,o=1/(t.colors.length-1),t.transform?(u=Sk.Matrix.fromMat2D(t.transform),l=Sk.Matrix.makeTranslation(-Sk.Rect.getLeft(r),-Sk.Rect.getTop(r)),u=Sk.Matrix.multiply(l,u),c=Sk.Matrix.mapPoints(u,[c])[0],a=Sk.Matrix.getScaleX(u),s=Sk.Matrix.getScaleY(u)):a=s=1,i=a===s?"radial-gradient("+d+"px circle at "+c[0]+"px "+c[1]+"px":"radial-gradient("+d*a+"px "+d*s+"px ellipse at "+c[0]+"px "+c[1]+"px",n=0;n<t.colors.length;++n)i+=","+Sk.Paint.skColorToCSSColor(t.colors[n])+" ",i+=100*(t.position?t.position[n]:o*n)+"%";e.style.backgroundImage=i+")"}(e,t.radial_gradient,r):t.sweep_gradient&&function(e,t,r){var n,i,o=0,a=t.center,s=Sk.Matrix.fromMat2D(t.transform),l=Sk.Matrix.mapVector(s,[1,0,1]);t.colors.length,n=1/(t.colors.length-1),i=t.colors.map((function(e,r){return Sk.Paint.skColorToCSSColor(e)+" "+360*(t.position?t.position[r]:n*r)+"deg"})),s=Sk.Matrix.multiply(Sk.Matrix.makeTranslation(-Sk.Rect.getLeft(r),-Sk.Rect.getTop(r)),s),a=Sk.Matrix.mapPoints(s,[a])[0],o=Sk.Util.angleBetween([0,-1],l,!0),e.style.backgroundImage="conic-gradient(from "+o.toFixed(1)+"deg at "+a[0]+"px "+a[1]+"px, "+i.join(",")+")"}(e,t.sweep_gradient,r)}(e,t.shader,r):e.style.backgroundColor=t.cssColor),t.style!==Sk.Paint.Style.kStroke_Style&&t.style!==Sk.Paint.Style.kStrokeAndFill_Style||(e.style.border=n+"px solid "+t.cssColor)}(t,r,o),i&Sk.PaintUsage.kText&&function(e,t){var r=t.strokeWidth||1;t.shader,t.style!==Sk.Paint.Style.kFill_Style&&t.style!==Sk.Paint.Style.kStrokeAndFill_Style?(t.style,Sk.Paint.Style.kStroke_Style,void 0!==e.style.webkitTextStrokeWidth&&e.style.webkitTextStrokeColor,e.style.webkitTextStrokeWidth=r+"px",e.style.webkitTextStrokeColor=t.cssColor,e.style.webkitTextFillColor="rgba(0,0,0,0)"):e.style.color=t.cssColor}(t,r),i&Sk.PaintUsage.kImage&&(r.shader,1!==r.alphaFloat&&(t.style.opacity=String(r.alphaFloat))),Sk.Paint.applyBlendMode(t,r),i&Sk.PaintUsage.kText?e.applyTextShadow(t,r,n):function(e,t,r){t.color_filter&&(e.style.filter,e.style.backgroundColor=Sk.Paint.skColorToCSSColor(t.color_filter.color),e.style.filter="blur("+Sk.Paint.getShadowSigma(t,r)+"px)")}(t,r,n),e.applyFilterDag(t,r,n),!0)}},Sk.SVGPaintApplicator=function(e){var t=new Sk.Logger("sk-svg-paint",{level:"info"});function r(t){var r=Sk.Util.createSVGElement(t),n=e.generateResourceId();return r.setAttribute("id",n),r}function n(e,t,r){var n,i,o=t.length>1?1/(t.length-1):0;for(t.length,t.length,n=0;n<t.length;n+=1)(i=Sk.Util.createSVGElement("stop")).setAttribute("offset",100*(r?r[n]:o*n)+"%"),i.setAttribute("stop-color",Sk.Paint.skColorToCSSColor(t[n])),e.appendChild(i)}function i(e,t,n,i){var o=r("radialGradient");return o.setAttribute("fx",e[0]+"px"),o.setAttribute("fy",e[1]+"px"),o.setAttribute("cx",t[0]+"px"),o.setAttribute("cy",t[1]+"px"),o.setAttribute("fr",n+"px"),o.setAttribute("r",i+"px"),o.setAttribute("gradientUnits","userSpaceOnUse"),o}function o(o,a){var s,l,c,d,u,f,p,g,m,_=a.shader;if(!_)return null;if(Sk.isDebugEnabled()&&(o.setAttribute("shader",Sk.Util.splunkify(_)),_.sweep_gradient&&t.warn({event:"conic-gradient-on-svg"})),_.linear_gradient)g=_.linear_gradient,(m=r("linearGradient")).setAttribute("x1",g.start[0]+"px"),m.setAttribute("y1",g.start[1]+"px"),m.setAttribute("x2",g.end[0]+"px"),m.setAttribute("y2",g.end[1]+"px"),m.setAttribute("gradientUnits","userSpaceOnUse"),n(m,g.colors,g.position),s=m;else if(_.radial_gradient)s=function(e,t){var r=i(t.center,t.center,0,t.radius);return n(r,t.colors,t.position),t.transform&&r.setAttribute("gradientTransform",Sk.Util.toSVGTransformAttribute(t.transform)),r}(0,_.radial_gradient);else if(_.conical_gradient)s=function(e,t){var r=i(t.center_1,t.center_2,t.radius_1,t.radius_2);return n(r,t.colors,t.position),t.transform&&r.setAttribute("gradientTransform",Sk.Util.toSVGTransformAttribute(t.transform)),r}(0,_.conical_gradient);else if(_.image)p=(f=(d=_.image).image).getActiveFrame(),Sk.Image,s=f.isComplete()?((u=r("pattern")).appendChild(Sk.ImagePool.get(e.getRootDevice().getId(),f,!0)),u.setAttribute("x","0"),u.setAttribute("y","0"),u.setAttribute("width",p.naturalWidth),u.setAttribute("height",p.naturalHeight),u.setAttribute("patternUnits","userSpaceOnUse"),u.setAttribute("patternContentUnits","userSpaceOnUse"),u.setAttribute("patternTransform",Sk.Matrix.toMat2DStr(Sk.Matrix.fromMat2D(d.matrix))),u):(e.getCanvas().setNeedsRedrawOnLoad(f,Sk.Rect.makeLargest()),null);else if(_.picture)return(c=function(r,n){var i,o,a,s=function(t){var r=t.index,n=Sk.Matrix.toMat2DStr(Sk.Matrix.fromMat2D(t.matrix));return["ps",e.getId(),r,n].join("-")}(n);if(i=function(t){var r=e.getPatternById(t);return r?document.getElementById(r):null}(s))return[i,null];try{if(!(o=e.getCanvas().rasterShader(n,e.createShaderDevice(n),{use_raster_cache:!1})))return[null,null];if(!o.getPattern())return o.release(),o=null,[null,null];i=o.getPattern(),a=o.getSVGRoot(),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("width",Sk.Rect.getWidth(n.tile)),i.setAttribute("height",Sk.Rect.getHeight(n.tile)),i.setAttribute("patternUnits","userSpaceOnUse"),i.setAttribute("patternContentUnits","userSpaceOnUse"),i.setAttribute("patternTransform",Sk.Matrix.toMat2DStr(Sk.Matrix.fromMat2D(n.matrix))),e.recordPattern(s,i)}catch(e){t.error({event:"picture-shader-error",shader:n})}finally{o&&(o.release(),o=null)}return[i,a]}(0,_.picture))&&c.length,s=c[0],(l=c[1])&&e.getDefs().appendChild(l),s;return s&&e.getDefs().appendChild(s),s}this.applyPaint=function(t,n,i,a){return SVGElement,a&(Sk.PaintUsage.kGeometry|Sk.PaintUsage.kPaint|Sk.PaintUsage.kText)&&function(e,t,r){var n=t.strokeWidth,i=o(e,t);t.style===Sk.Paint.Style.kFill_Style||t.style===Sk.Paint.Style.kStrokeAndFill_Style?i?(e.setAttribute("fill",Sk.Util.urlWrap("#"+i.getAttribute("id"))),1!==t.alphaFloat&&e.setAttribute("fill-opacity",String(t.alphaFloat))):e.setAttribute("fill",t.cssColor):e.setAttribute("fill","none"),t.style===Sk.Paint.Style.kStroke_Style||t.style===Sk.Paint.Style.kStrokeAndFill_Style?(i?(e.setAttribute("stroke",Sk.Util.urlWrap("#"+i.getAttribute("id"))),1!==t.alphaFloat&&e.setAttribute("stroke-opacity",String(t.alphaFloat))):e.setAttribute("stroke",t.cssColor),r&Sk.PaintUsage.kText&&(n/=t.textSize/Sk.Paint.kCanonicalTextSizeForPaths||1),0===n&&(n=1,e.setAttribute("vector-effect","non-scaling-stroke")),e.setAttribute("stroke-width",n),e.setAttribute("stroke-linecap",t.strokeCapStr),e.setAttribute("stroke-join",t.strokeJoinStr),t.strokeJoin===Sk.Paint.Join.kMiter&&e.setAttribute("stroke-miterlimit",t.strokeMiter),t.path_effect&&(e.setAttribute("stroke-dashoffset",t.path_effect.phase),e.setAttribute("stroke-dasharray",t.path_effect.intervals.join(" ")))):e.setAttribute("stroke","none")}(t,n,a),a&Sk.PaintUsage.kImage&&1!==n.alphaFloat&&(t.style.opacity=String(n.alphaFloat)),Sk.Paint.applyBlendMode(t,n),a&Sk.PaintUsage.kText?e.applyTextShadow(t,n,i):function(t,n,i){var o,a;n.color_filter&&((o=r("filter")).setAttribute("x","-20%"),o.setAttribute("y","-40%"),o.setAttribute("width","140%"),o.setAttribute("height","160%"),(a=Sk.Util.createSVGElement("feGaussianBlur")).setAttribute("stdDeviation",String(Sk.Paint.getShadowSigma(n,i))),o.appendChild(a),e.getDefs().appendChild(o),t.style.filter=Sk.Util.urlWrap("#"+o.getAttribute("id")),t.setAttribute("fill",Sk.Paint.skColorToCSSColor(n.color_filter.color)))}(t,n,i),e.applyFilterDag(t,n,i),!0}},Sk.DOMDevice=function(e,t,r,n,i,o,a,s){var l,c,d,u,f,p,g,m,_,h,y=this,v=(new Sk.Logger("sk-dom",{level:"info"}),Sk.Rect.fromWH(Sk.Rect.getWidth(t),Sk.Rect.getHeight(t))),k=new Sk.SVGEmitter,S=new Sk.PathTools(k,y),b=new Sk.TextBlobIterator(!0),w=new Sk.HTMLPaintApplicator(y),C=new Sk.SVGPaintApplicator(y),T=0,E=0,A=-1,R=!1,x={},D=!1;function I(){return u[u.length-1]}function O(){return I().ctm}function U(){var e=document.createElement("div");return e.style.position="absolute",e.style.padding=e.style.margin="0px",e.style.boxSizing="border-box",D&&(e.style.willChange="transform"),e}function M(e){return f.createElement(e)}function F(e,t,r){e.setAttributeNS(null,t,r)}function P(e,t,r,n){return e instanceof SVGElement?C.applyPaint(e,t,O(),r):w.applyPaint(e,t,O(),r,n)}function L(e,t,r){Sk.Matrix.isIdentity(t)||(e instanceof SVGElement?e.setAttribute("transform",Sk.Matrix.toMat2DStr(t)):(Element,e.style.position,e.style.transform=Sk.Matrix.toMat2DStr(t),e.style.transformOrigin=void 0!==r?-Sk.Rect.getLeft(r)+"px "+-Sk.Rect.getTop(r)+"px":"0px 0px 0px"))}function N(e,t){"svg"===e.localName.toLowerCase()||(e.namespaceURI,d.namespaceURI),e.parentNode,Sk.isDebugEnabled()&&t&&(e.id=["op",c,E,t].join("-"),e.setAttribute("detail",t),E+=1),d.appendChild(e)}function B(e,r,n){var i=Sk.Util.createSVGRootElement(Sk.Rect.getWidth(t),Sk.Rect.getHeight(t)),o=i,a=n?Sk.Matrix.multiply(O(),n):O();i.style.position="absolute",i.style.top="0px",i.style.left="0px",Sk.Matrix.isIdentity(a)||(L(o=M("g"),a),i.appendChild(o)),r(o),N(i,e)}function H(e,t){var r,n=M("path");return void 0===t&&(t=Sk.FillRule.kWinding),r=Sk.Paint.skFillRuleToCanvasFillRule(t),F(n,"d",e.join(" ")),F(n,"clip-rule",r),F(n,"fill-rule",r),n}function V(e){var t=M("clipPath");return e&&SVGElement,t.id=["cl",c,T].join("-"),T+=1,t.appendChild(e),g.appendChild(t),t.id}function W(){var e=U();return e.style.left="0px",e.style.top="0px",e.style.width="auto",e.style.height="auto",e}function z(e,t){var r,i;if(y.shouldUseSVG())return F(i=M("g"),"clip-path",Sk.Util.urlWrap("#"+V(H(e)))),N(i,t),void(d=i);(r=W()).style.clipPath,r.style.clipPath=n?'path("'+e.join(" ")+'")':Sk.Util.urlWrap("#"+V(H(e))),N(r,t),d=r}function G(e,t,r,n){B(n,(function(n){var i=H(e,t);P(i,r,Sk.PaintUsage.kGeometry),n.appendChild(i)}))}function j(e,t){var r=t.strokeWidth;return r>0?Sk.Rect.resize(e,r/2):e}function Y(e,t,r){var n=U(),i=j(e,t);if(P(n,t,Sk.PaintUsage.kGeometry,i))return Sk.Rect.toCSSStyle(i,n.style),L(n,O(),i),void N(n,r);B(r,(function(r){var n=M("rect");P(n,t,Sk.PaintUsage.kGeometry),F(n,"x",Sk.Rect.getX(e)),F(n,"y",Sk.Rect.getY(e)),F(n,"width",Sk.Rect.getWidth(e)),F(n,"height",Sk.Rect.getHeight(e)),r.appendChild(n)}))}function X(e,t,r){var n=Sk.SVGFilterHelper.hashFilterId(e,c,t),i=document.getElementById(n);return i||((i=Sk.SVGFilterHelper.buildWith(e,t,r))?(i.setAttribute("id",n),g.appendChild(i),Sk.SVGFilterHelper.onFilterNodeCreated(e,i),i):null)}function q(){!function(e){var t;for(t=e.childNodes.length-1;t>=0;t-=1)e.removeChild(e.childNodes[t]);e.childNodes.length}(l),f=Sk.Util.createSVGRootElement(Sk.Rect.getWidth(t),Sk.Rect.getHeight(t)),g=f.createElement("defs"),f.appendChild(g),y.shouldUseSVG()?d=f:(l.appendChild(f),d=l),T=0,u=[{ctm:Sk.Matrix.makeTranslation(-r.x,-r.y),saved_cursor:d}],g.parentNode,f.parentNode||y.shouldUseSVG(),o&&o.reset()}y.deviceToLocalBounds=function(e){return m.deviceToLocalBounds(e)},y.isCSSGradientsAllowed=function(){return i},y.save=function(){u.push({ctm:Sk.Util.copyArray(O()),saved_cursor:d})},y.restore=function(){u.length,u.length>1&&(d=u.pop().saved_cursor)},y.concat=function(e){I().ctm=Sk.Matrix.multiply(O(),Sk.Matrix.fromMat2D(e))},y.setMatrix=function(e,t){var n=Sk.Matrix.makeTranslation(-r.x,-r.y);t&&(n=Sk.Matrix.multiply(n,t)),n=Sk.Matrix.multiply(n,Sk.Matrix.fromMat2D(e)),I().ctm=n},y.translate=function(e,t){I().ctm=Sk.Matrix.multiply(O(),Sk.Matrix.makeTranslation(e,t))},y.scale=function(e,t){I().ctm=Sk.Matrix.multiply(O(),Sk.Matrix.makeScale(e,t))},y.clipRRect=function(e,r){var n,i,o=Sk.Matrix.mapPoints(O(),Sk.Rect.toQuad(e.rect));if(!y.shouldUseSVG()&&Sk.Quad.isRect(o)&&!Sk.Radii.isValid(e.radii)&&r===Sk.ClipOp.kIntersect)return n=Sk.Rect.bboxRect(o),"clipRect",void(Sk.Rect.contains(n,t)||((i=W()).style.clip=Sk.Rect.toCSSClip(n),N(i,"clipRect"),d=i));k.setTransform(O()),S.drawRRect(e,r),z(k.flushPathList(),"clipRRect")},y.clipRect=function(e,t){y.clipRRect({rect:e},t)},y.clipPath=function(e,t){k.setTransform(O()),S.drawPath(e,t),z(k.flushPathList(),"clipPath")},y.clipQuad=function(e,t){t===Sk.ClipOp.kIntersect||Sk.ClipOp.kDifference,e.length,Sk.Quad.isRect(e)?y.clipRect(Sk.Rect.fromQuad(e),t):(k.setTransform(O()),S.drawQuad(e,t),z(k.flushPathList(),"clipQuad"))},y.drawPath=function(e,t,r,n,i){y.save(),void 0!==r&&y.translate(r.x,r.y),void 0!==n&&y.scale(n,n),e.fill_rule,S.drawPath(e,Sk.ClipOp.kIntersect),G(k.flushPathList(),e.fill_rule,t,"drawPath"),y.restore()},y.drawRRect=function(e,t){e.radii?function(e,t,r){var n=U(),i=j(e.rect,t);return!!P(n,t,Sk.PaintUsage.kGeometry,i)&&(Sk.Rect.toCSSStyle(i,n.style),e.radii&&Sk.Radii.toCSSStyle(function(e,t){var r=t.strokeWidth;return r>0?Sk.Radii.resize(e,r/2):e}(e.radii,t),n.style),L(n,O(),i),N(n,r),!0)}(e,t,"drawRRect")||(S.drawRRect(e,Sk.ClipOp.kIntersect),G(k.flushPathList(),void 0,t,"drawRRect")):Y(e.rect,t,"drawRect")},y.drawPaint=function(e){y.save(),I().ctm=Sk.Matrix.identity(),Y(y.getSizeRect(),e,"drawPaint"),y.restore()},y.drawPoints=function(e,t,r,n){Sk.PointMode.kLines,S.drawPointsPath(r),G(k.flushPathList(),Sk.FillRule.kWinding,n,"drawPoints")},y.drawArc=function(e,t,r,n,i){S.drawArc(e,t,r,n,!0),G(k.flushPathList(),void 0,i,"drawArc")},y.applyTextShadow=function(e,t,r){var n,i,o=!1;function a(e){e&&e.hasAttribute("flood-opacity")&&e.setAttribute("flood-opacity",1)}t.color_filter&&(n=[],t.color_filter&&!t.color_filter.is_luma_color_filter&&n.push(X(t.color_filter,r,a)),t.mask_filter&&t.mask_filter.image_filter&&((i=X(t.mask_filter.image_filter,r,a)).setAttribute("x","-100%"),i.setAttribute("y","-100%"),i.setAttribute("width","300%"),i.setAttribute("height","300%"),n.push(i)),n=n.map((function(e){return e?(o=!0,Sk.Util.urlWrap("#"+e.getAttribute("id"))):""})),o&&(e.style.filter=n.join(" ")))},y.applyFilterDag=function(e,t,r){var n=t.image_filter?X(t.image_filter,r):null;n&&(e.style.filter=Sk.Util.urlWrap("#"+n.getAttribute("id")))},y.drawTextBlob=function(e,t,r,n){e.runs.length&&(function(){return!(!o||!p||!p.text||(e=p).type===Sk.HT.ElementType.kTextNode&&(e.flags&Sk.HT.ElementFlags.kHasContentEditableOwner||e.flags&Sk.HT.ElementFlags.kInShadowTree&&(e.flags&Sk.HT.ElementFlags.kHasInputElementOwner||e.flags&Sk.HT.ElementFlags.kHasTextAreaOwner)&&!(e.flags&Sk.HT.ElementFlags.kIsPlaceholderText)));var e}()?function(e,t,r,n){var i=p.box_rect;b.forEachRun(e,n,(function(e,t,r){var n=U();y.drawDebugRect(i,"rgba(150,150,150,0.3)"),Sk.Rect.toCSSStyle(i,n.style),P(n,r,Sk.PaintUsage.kText),r.textSize,L(n,O(),i),n.run_bounds=i,n.htd=p,n.paint=r,o.registerDiv(n),N(n,"TextRun")}))}(e,0,0,n):function(e,t,r,n){B("drawTextBlobAsSVG",(function(i){b.forEachRun(e,n,(function(e,n,o){var a,l=Sk.Paint.getTextScale(o);n.glyph_count&&(P(a=M("g"),o,Sk.PaintUsage.kText),e.forEachGlyph(n,t,r,(function(e,t,r){var n=M("use");e.deduper.index,n.setAttribute("href","#glyph-"+s+":"+e.deduper.index),n.setAttribute("transform","translate("+[t,r].join(" ")+") scale("+l+")"),a.appendChild(n)})),i.appendChild(a))}))}))}(e,t,r,n))},y.clearRect=function(e){},y.drawImageRect=function(e,t,r,n){var i=Sk.ImagePool.get(a.getId(),e,!1),o=Sk.Matrix.makeRectToRect(t,r);y.shouldUseSVG()?B("drawImageRect",(function(t){var r=e.getActiveFrame();F(i=M("image"),"href",e.getImageSrc()),F(i,"x","0"),F(i,"y","0"),F(i,"width",r.naturalWidth),F(i,"height",r.naturalHeight),P(i,n,Sk.PaintUsage.kImage),t.appendChild(i)}),o):(HTMLImageElement,i.src,i.style.position="absolute",i.style.left="0px",i.style.top="0px",P(i,n,Sk.PaintUsage.kImage),L(i,Sk.Matrix.multiply(O(),o)),y.save(),y.clipRect(r,Sk.ClipOp.kIntersect),N(i,"drawImageRect"),Sk.isDebugEnabled()&&(d.setAttribute("src",t),d.setAttribute("dst",r)),i.src,y.restore())},y.drawVideoRect=function(e,t,r,n){HTMLVideoElement},y.playbackMatrixAndClipOps=function(e){var t,r;for(t=0;t<e.length;t+=1)(r=e[t]).concat_mat?y.concat(r.concat_mat):r.set_mat&&y.setMatrix(r.set_mat)},y.setForceSVG=function(e){u.length,f.parentNode&&f.parentNode.removeChild(f),e?((_=M("pattern")).id=y.generateResourceId(),f.appendChild(_),d=_):d=f,I().saved_cursor=d,R=!0},y.shouldUseSVG=function(){return R},y.createDevice=function(e,l,c){var d=new Sk.DOMDevice(e,t,r,n,i,o,a,s);return y.shouldUseSVG()&&d.setForceSVG(),c&&d.playbackMatrixAndClipOps(c),Sk.isDebugEnabled()&&d.getNode().setAttribute("device_bounds",l),d},y.recordPattern=function(e,t){var r=Object.keys(x);r.length>20&&delete x[r[0]],x[e]=t.getAttribute("id")},y.getPatternById=function(e){return x.hasOwnProperty(e)?x[e]:null},y.createShaderDevice=function(e){var t=Sk.Rect.roundOut(e.tile);return new Sk.DOMDevice("shader",t,{x:Sk.Rect.getX(t),y:Sk.Rect.getY(t)},n,!1,null,null,s)},y.drawDevice=function(e,t,n,i){var o,a=Sk.Matrix.makeRectToRect(e.getSizeRect(),t),s=Sk.Matrix.makeTranslation(-r.x,-r.y),l=Sk.Matrix.multiply(s,a),c=e.shouldUseSVG()?e.getSVGRoot():e.getNode();P(c,n,Sk.PaintUsage.kImage),Sk.isDebugEnabled()&&c.setAttribute("dst_device_rect",t),L(c,l),(o=c).style.isolation,o.style.isolation="isolate",N(c,"drawDevice")},y.onWillDrawPicture=function(e,t){var r;p=e.getHitTestData(),e.getProperties()&Sk.PictureFlags.kIsPictureShader?y.setForceSVG(!0):Sk.isDebugEnabled()&&!y.shouldUseSVG()&&(y.save(),N(r=document.createElement("div"),"drawPicture"),r.setAttribute("htd",Sk.Util.splunkify(p)),r.setAttribute("visual_rect",t),d=r)},y.onDidDrawPicture=function(){Sk.isDebugEnabled()&&!y.shouldUseSVG()&&y.restore()},y.drawDebugRect=function(e,t){var r;Sk.isDebugEnabled()&&!y.shouldUseSVG()&&(r=U(),Sk.Rect.toCSSStyle(e,r.style),r.style.backgroundColor=t||"rgba(255, 0, 0, 0.4)",L(r,O(),e),N(r,"debugRect"))},y.getId=function(){return c},y.generateResourceId=function(){return["res",c,A+=1].join("-")},y.getDeviceBounds=function(){return t},y.setCanvas=function(e){(m=e)&&m.getOptions&&(D=(m.getOptions()||{}).use_single_raster_tile)},y.getMemoryUsage=function(){return 0},y.getDeviceScaleFactor=function(){return 1},y.getNode=function(){return l},y.toDataURL=function(e){var r,n,i,o=new Image,a=document.createElement("canvas");y.shouldUseSVG()?(n=(new XMLSerializer).serializeToString(f),i=window.btoa(n),o.onload=function(){a.width=Sk.Rect.getWidth(t),a.height=Sk.Rect.getHeight(t),(r=a.getContext("2d")).clearRect(0,0,a.width,a.height),r.drawImage(o,0,0);try{e(a.toDataURL())}catch(t){e("failed")}},o.src="data:image/svg+xml;base64,"+i):e("failed")},y.getSizeRect=function(){return v},y.release=function(e){y===a&&(l&&l.parentNode&&l.parentNode.removeChild(l),l=null,o&&o.release(),Sk.ImagePool.put(c),x={})},y.reset=function(){q(),Sk.ImagePool.put(a.getId())},y.getDefs=function(){return g},y.getSVGRoot=function(){return f},y.getCanvas=function(){return m},y.getRootDevice=function(){return a},y.getPattern=function(){return _},Sk.Rect.isIntRect(t),c=Sk.nextDOMDeviceId,Sk.nextDOMDeviceId+=1,a=a||y,(h=U()).style.left="0px",h.style.top="0px",h.style.width=Sk.Rect.getWidth(t)+"px",h.style.height=Sk.Rect.getHeight(t)+"px",h.style.overflow="hidden",Sk.isDebugEnabled()&&(h.setAttribute("detail","SkDOMDevice"),h.setAttribute("bounds",t),h.setAttribute("origin",Sk.Util.splunkify(r)),h.setAttribute("purpose",e)),l=h,q()},Sk.SVGMatrixColorFilterBuilder=function(){var e,t;this.build=function(r,n,i,o){"SkMatrixColorFilter"===r.name||r.name,e=[],(t=Sk.Util.createSVGElement("feColorMatrix")).setAttribute("type","matrix"),t.setAttribute("values",r.matrix.join(" ")),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),t.setAttribute("in",Sk.SVGFilterHelper.getInput(o,0)),i&&i(t),e.push(t)},this.getProduct=function(){return e}},Sk.SVGTableColorFilterBuilder=function(){var e,t;this.build=function(r,n,i,o){var a,s,l,c=["A","R","G","B"];for("SkTableColorFilter"===r.name||r.name,e=[],(t=Sk.Util.createSVGElement("feComponentTransfer")).setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),a=0;a<c.length;++a)l=c[a],r.table_color_filter.hasOwnProperty(l)&&((s=Sk.Util.createSVGElement("feFunc"+l)).setAttribute("type","discrete"),s.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),s.setAttribute("tableValues",r.table_color_filter[l].join(" ")),t.appendChild(s));i&&i(t),t.setAttribute("in",Sk.SVGFilterHelper.getInput(o,0)),e.push(t)},this.getProduct=function(){return e}},Sk.SVGLumaColorFilterBuilder=function(){var e,t;this.build=function(r,n,i){r.name,e=[],r.is_luma_color_filter&&((t=Sk.Util.createSVGElement("feColorMatrix")).setAttribute("type","luminanceToAlpha"),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),i&&i(t),e.push(t))},this.getProduct=function(){return e}},Sk.SVGComposeColorFilterBuilder=function(){var e,t;function r(e){return e&&0!==e.length?e[e.length-1]:null}this.build=function(n,i,o,a){var s,l,c,d;n.name,e=[],n.inner&&(Sk.SVGFilterHelper.isColorFilter(n.inner.name),(t=Sk.SVGFilterHelper.createColorFilterBuilder(n.inner.name)).build(n.inner,i,o,a),(s=r(e=t.getProduct()))&&(c=n.inner.name+"_"+Sk.SVGFilterHelper.nextFilterId(),s.setAttribute("result",c))),n.outer&&(Sk.SVGFilterHelper.isColorFilter(n.outer.name),(t=Sk.SVGFilterHelper.createColorFilterBuilder(n.outer.name)).build(n.outer,i,o,a),d=t.getProduct(),e=e.concat(d),(l=r(d))&&s&&l.setAttribute("in",c))},this.getProduct=function(){return e}},Sk.SVGBlendModeColorFilterBuilder=function(){var e,t;this.build=function(r,n,i,o){var a;"SkBlendModeColorFilter"===r.name||r.name,e=[],a="src-color-"+Sk.SVGFilterHelper.nextFilterId(),(t=Sk.Util.createSVGElement("feFlood")).setAttribute("flood-color",Sk.Paint.skColorToCSSColor(r.color)),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),t.setAttribute("result",a),i&&i(t),e.push(t),r.mode!==Sk.BlendMode.kSrc&&(t.setAttribute("flood-opacity",Sk.Paint.skColorToCanvasAlpha(r.color)),Sk.Paint.isBlendOp(r.mode)?(t=Sk.Util.createSVGElement("feBlend")).setAttribute("mode",Sk.Paint.skBlendModeToFeBlendMode(r.mode)):(t=Sk.Util.createSVGElement("feComposite")).setAttribute("operator",Sk.Paint.skBlendModeToFeCompositeOp(r.mode)),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),t.setAttribute("in",a),t.setAttribute("in2",Sk.SVGFilterHelper.getInput(o,0)),i&&i(t),e.push(t))},this.getProduct=function(){return e}},Sk.SVGColorSpaceXformColorFilterBuilder=function(){this.build=function(e){var t=e.dst_color_space;e.name,Sk.SVGFilterHelper.setCurrentColorSpace(Sk.Paint.skNamedColorSpaceToColorInterpolation(t))},this.getProduct=function(){return[]}},Sk.SVGBlurImageFilterImplBuilder=function(){var e,t;function r(e){return!!(1&e)}function n(e,t){var n=t.sigma;return function(e){return r(e.flags>>1)}(t)?(n=n[0],function(e){return!r(e.flags)}(t)&&(n*=n/Sk.Matrix.mapRadius(e,n)),[n=Sk.Matrix.mapRadius(e,n),n]):Sk.Matrix.mapVector(e,[n[0],n[1],1]).slice(0,2)}this.build=function(r,i,o){var a,s=[];r.name,r.base.inputs.length,a=n(i,r),e=Sk.SVGFilterHelper.buildImageFilterBase(r.base,i,o,s),(t=Sk.Util.createSVGElement("feGaussianBlur")).setAttribute("stdDeviation",a.join(" ")),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),t.setAttribute("in",Sk.SVGFilterHelper.getInput(s,0)),o&&o(t),e.push(t)},this.getProduct=function(){return e}},Sk.SVGColorFilterImageFilterImplBuilder=function(){var e,t;this.build=function(r,n,i){var o=[];r.name,r.base.inputs.length,e=Sk.SVGFilterHelper.buildImageFilterBase(r.base,n,i,o),r.color_filter&&((t=Sk.SVGFilterHelper.createColorFilterBuilder(r.color_filter.name)).build(r.color_filter,n,i,o),e=e.concat(t.getProduct()))},this.getProduct=function(){return e}},Sk.SVGDropShadowImageFilterImplBuilder=function(){var e,t,r;this.build=function(n,i,o){n.name,n.base.inputs.length,e=Sk.SVGFilterHelper.buildImageFilterBase(n.base,i,o),t=Sk.Util.createSVGElement("feDropShadow"),r=n.offset.concat([1]),r=Sk.Matrix.mapVector(i,r),t.setAttribute("dx",r[0]),t.setAttribute("dy",r[1]),r=n.sigma.concat([1]),r=Sk.Matrix.mapVector(i,r),t.setAttribute("stdDeviation",r.join(" ")),t.setAttribute("flood-color",Sk.Paint.skColorToCSSColor(n.color)),t.setAttribute("flood-opacity",Sk.Paint.skColorToCanvasAlpha(n.color)),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),o&&o(t),e.push(t)},this.getProduct=function(){return e}},Sk.SVGMatrixTransformImageFilterBuilder=function(){var e,t;this.build=function(r,n,i){var o,a,s=[];r.name,r.base.inputs.length,r.matrix,o=Sk.Matrix.fromMat2D(r.matrix),Sk.Matrix.isIdentityOrTranslation(o),a=Sk.Matrix.mapVector(n,[Sk.Matrix.getTranslateX(o),Sk.Matrix.getTranslateY(o),1]),e=Sk.SVGFilterHelper.buildImageFilterBase(r.base,n,i,s),(t=Sk.Util.createSVGElement("feOffset")).setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),t.setAttribute("dx",a[0]),t.setAttribute("dy",a[1]),i&&i(t),t.setAttribute("in",Sk.SVGFilterHelper.getInput(s,0)),e.push(t)},this.getProduct=function(){return e}},Sk.SVGBlendImageFilterBuilder=function(){var e,t;this.build=function(r,n,i){var o=[];r.name,r.base.inputs.length,e=[],r.custom_blend_mode||(e=Sk.SVGFilterHelper.buildImageFilterBase(r.base,n,i,o),Sk.Paint.isBlendOp(r.blend_mode)?(t=Sk.Util.createSVGElement("feBlend")).setAttribute("mode",Sk.Paint.skBlendModeToFeBlendMode(r.blend_mode)):((t=Sk.Util.createSVGElement("feComposite")).setAttribute("operator",Sk.Paint.skBlendModeToFeCompositeOp(r.blend_mode)),r.arithmetic_coefficients&&r.arithmetic_coefficients.forEach((function(e,r){t.setAttribute("k"+(r+1),e)}))),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),i&&i(t),["in2","in"].forEach((function(e,r){t.setAttribute(e,Sk.SVGFilterHelper.getInput(o,r))})),e.push(t))},this.getProduct=function(){return e}},Sk.SVGCropImageFilterBuilder=function(){var e,t,r=.001;function n(e){e.setAttribute("x",Sk.Rect.getX(t)+"px"),e.setAttribute("y",Sk.Rect.getY(t)+"px"),e.setAttribute("width",Sk.Rect.getWidth(t)+"px"),e.setAttribute("height",Sk.Rect.getHeight(t)+"px")}this.build=function(i,o){i.name,i.base.inputs.length,i.crop_rect,t=function(e,t){var n=Sk.Matrix.mapRect(t,e.crop_rect);return e.tile_mode===Sk.TileMode.kDecal?(n=Sk.Rect.makeInset(n,r,r),Sk.Rect.roundOut(n)):(n=Sk.Rect.makeOutset(n,r,r),Sk.Rect.roundIn(n))}(i,o),e=Sk.SVGFilterHelper.buildImageFilterBase(i.base,o,n)},this.getProduct=function(){return e}},Sk.SVGMergeImageFilterBuilder=function(){var e,t;this.build=function(r,n,i){var o=[];r.name,e=Sk.SVGFilterHelper.buildImageFilterBase(r.base,n,i,o),t=Sk.Util.createSVGElement("feMerge"),o.forEach((function(e){var r=Sk.Util.createSVGElement("feMergeNode");r.setAttribute("in",e||"SourceGraphic"),t.appendChild(r)})),t.setAttribute("color-interpolation-filters",Sk.SVGFilterHelper.getCurrentColorSpace()),i&&i(t),e.push(t)},this.getProduct=function(){return e}},Sk.SVGFilterHelper=function(){var e={},t="sRGB",r=0;function n(){return r++}return e.isImageFilter=function(e){return"SkColorFilterImageFilterImpl"===e||"SkBlurImageFilterImpl"===e||"SkDropShadowImageFilterImpl"===e||"SkCropImageFilter"===e||"SkBlendImageFilter"===e||"SkMatrixTransformImageFilter"===e||"SkMergeImageFilter"===e},e.isColorFilter=function(e){return"SkBlendModeColorFilter"===e||"SkModeColorFilter"===e||"SkMatrixColorFilter"===e||"SkColorFilter_Matrix"===e||"SkTableColorFilter"===e||"SkTable_ColorFilter"===e||"SkRuntimeColorFilter"===e||"SkComposeColorFilter"===e||"SkColorSpaceXformColorFilter"===e},e.isMaskFilter=function(e){return"SkBlurMaskFilterImpl"===e},e.isShader=function(e){return"SkLinearGradient"===e||"SkRadialGradient"===e||"SkConicalGradient"===e||"SkImageShader"===e||"SkPictureShader"===e||"SkSweepGradient"===e},e.isSupportedPathEffect=function(e){return"SkDashImpl"===e},e.hashFilterId=function(t,r,n){var i=["filter",r,function(t){return!(!t||!t.name)&&!!e.isImageFilter(t.name)&&t.base.uses_ctm}(t)?Sk.Matrix.toMat2DStr(n):0,t.deduper.index].join("-");return Sk.Util.hashCode(i)},e.onFilterNodeCreated=function(e,t){e.deduper,e.deduper.by_id||(e.deduper.by_id={}),e.deduper.by_id[t.getAttribute("id")]=t},e.createColorFilterBuilder=function(t){return e.isColorFilter(t),"SkComposeColorFilter"===t?new Sk.SVGComposeColorFilterBuilder:"SkMatrixColorFilter"===t||"SkColorFilter_Matrix"===t?new Sk.SVGMatrixColorFilterBuilder:"SkTableColorFilter"===t||"SkTable_ColorFilter"===t?new Sk.SVGTableColorFilterBuilder:"SkRuntimeColorFilter"===t?new Sk.SVGLumaColorFilterBuilder:"SkBlendModeColorFilter"===t||"SkModeColorFilter"===t?new Sk.SVGBlendModeColorFilterBuilder:"SkColorSpaceXformColorFilter"===t?new Sk.SVGColorSpaceXformColorFilterBuilder:void 0},e.createImageFilterBuilder=function(t){return e.isImageFilter(t),"SkColorFilterImageFilterImpl"===t?new Sk.SVGColorFilterImageFilterImplBuilder:"SkBlurImageFilterImpl"===t?new Sk.SVGBlurImageFilterImplBuilder:"SkDropShadowImageFilterImpl"===t?new Sk.SVGDropShadowImageFilterImplBuilder:"SkCropImageFilter"===t?new Sk.SVGCropImageFilterBuilder:"SkBlendImageFilter"===t?new Sk.SVGBlendImageFilterBuilder:"SkMatrixTransformImageFilter"===t?new Sk.SVGMatrixTransformImageFilterBuilder:"SkMergeImageFilter"===t?new Sk.SVGMergeImageFilterBuilder:void 0},e.createFilterBuilder=function(t){return e.isColorFilter(t)?e.createColorFilterBuilder(t):e.isImageFilter(t)?e.createImageFilterBuilder(t):void 0},e.setCurrentColorSpace=function(e){t=e},e.getCurrentColorSpace=function(){return t},e.nextFilterId=n,e.buildImageFilterBase=function(t,r,i,o){var a=!!o,s=[];return t.inputs&&t.inputs.length?(t.inputs.forEach((function(t){var l,c,d,u;t&&t.name?((d=e.createFilterBuilder(t.name)).build(t,r,i),l=d.getProduct(),s=s.concat(l),a&&(l.length?(c=l[l.length-1],u=t.name+"_"+n(),c.setAttribute("result",u),o.push(u)):o.push(null))):a&&o.push(null)})),s):[]},e.getInput=function(e,t){return e&&e[t]?e[t]:"SourceGraphic"},e.buildWith=function(t,r,n){var i;if(t)return(i=e.createFilterBuilder(t.name)).build(t,r),function(e,t){var r,n;if(!e||0===e.length)return null;for(r=Sk.Util.createSVGElement("filter"),n=0;n<e.length;++n)t&&t(e[n]),r.appendChild(e[n]);return r}(i.getProduct(),n)},e}(),Sk.FlattenableReader=function(){var e={};function t(e){var t,r={};return r.flags=t=e.readUint32(),r.colors=e.readUint32Array(),r.interpolate_in_premul=!!(t&Sk.GradientSerializationFlags.kInterpolationInPremul),t&Sk.GradientSerializationFlags.kHasPosition&&(r.colors,r.position=e.readScalarArray(),r.position),r.transform=t&Sk.GradientSerializationFlags.kHasLocalMatrix?e.readMatrix():[1,0,0,1,0,0],r.local_matrix=Sk.Matrix.fromMat2D(r.transform),r}return new Sk.Logger("sk-flattenable-reader",{level:"info"}),e.readFrom=function(e){var r,n;return r=e.readString(),n=e.readUint32(),Sk.SVGFilterHelper.isImageFilter(r)?function(e,t,r){var n={};return n.name=t,n.base=function(e){var t,r=e.readUint32(),n=r>>8&16777215,i=!!(255&r),o=[];for(t=0;t<n;++t)e.readBool()?o.push(e.readFlattenable()):o.push(null);return{inputs:o,uses_ctm:i}}(e),"SkColorFilterImageFilterImpl"===t?(n.base.inputs.length,n.color_filter=e.readFlattenable()):"SkBlurImageFilterImpl"===t?(n.base.inputs.length,n.sigma=[e.readFloat32(),e.readFloat32()],n.flags=e.readUint32()):"SkDropShadowImageFilterImpl"===t?(n.base.inputs.length,n.offset=[e.readFloat32(),e.readFloat32()],n.sigma=[e.readFloat32(),e.readFloat32()],n.color=e.readUint32(),n.shadow_only=e.readInt32()):"SkCropImageFilter"===t?(n.crop_rect=e.readRect(),n.tile_mode=e.readInt32()):"SkBlendImageFilter"===t?(n.blend_mode=e.readUint32(),n.blend_mode===Sk.BlendMode.kArithmetic_SkBlendMode?(n.arithmetic_coefficients=[e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32()],n.enforce_premul=e.readBool()):n.blend_mode===Sk.BlendMode.kCustom_SkBlendMode&&(n.custom_blend_mode=!0,e.skip(r-4))):"SkMatrixTransformImageFilter"===t?(n.matrix=e.readMatrix(),n.sampling=e.readSampling()):"SkMergeImageFilter"===t||e.skip(r),n}(e,r,n):Sk.SVGFilterHelper.isColorFilter(r)?function(e,t,r){var n,i={};return i.name=t,"SkBlendModeColorFilter"===t||"SkModeColorFilter"===t?(i.color=e.readUint32(),i.mode=e.readUint32()):"SkMatrixColorFilter"===t||"SkColorFilter_Matrix"===t?(i.matrix=e.readScalarArray(),i.domain=e.readBool()):"SkComposeColorFilter"===t?(i.outer=e.readFlattenable(),i.inner=e.readFlattenable()):"SkTableColorFilter"===t||"SkTable_ColorFilter"===t?((n=e.readByteArray())&&n.length,i.table_color_filter=function(e){var t,r,n,i=[],o={},a=["A","R","G","B"];for(t=0;t<256;t++)i.push(t);for(t=0;t<a.length;++t)n=a[t],r=Array.prototype.slice.call(e.subarray(256*t,256*(t+1))),JSON.stringify(r)!==JSON.stringify(i)&&(o[n]=r.map((function(e){return 1*e/255})));return o}(n)):"SkRuntimeColorFilter"===t?i.is_luma_color_filter=e.readBool():"SkColorSpaceXformColorFilter"===t?4===r?i.dst_color_space=e.readUint32():(i.dst_color_space=Sk.NamedColorSpace.kSRGB,e.skip(r)):e.skip(r),i}(e,r,n):Sk.SVGFilterHelper.isMaskFilter(r)?function(e,t,r){var n,i,o;return"SkBlurMaskFilterImpl"===t?(n=e.readFloat32(),(i=e.readUint32())>>1&1&&(o=e.readFlattenable()),{sigma:n,blur_style:i>>16&65535,ignore_ctm:!!(1&i),image_filter:o}):(e.skip(r),null)}(e,r,n):Sk.SVGFilterHelper.isShader(r)?function(e,r,n){var i,o={};return o.name=r,"SkLinearGradient"===r?(o=t(e),i=[e.readPoint(),e.readPoint()],o.flags&Sk.GradientSerializationFlags.kHasLocalMatrix&&(i=Sk.Matrix.mapPoints(o.local_matrix,i)),o.start=i[0],o.end=i[1],e.readBool()&&(o.gradient_size=[e.readFloat32(),e.readFloat32()]),{linear_gradient:o}):"SkRadialGradient"===r?((o=t(e)).center=e.readPoint(),o.radius=e.readFloat32(),{radial_gradient:o}):"SkImageShader"===r?(o.image={},o.image.tile_mode_x=e.readUint32(),o.image.tile_mode_y=e.readUint32(),o.image.matrix=e.readMatrix(),o.image.image=e.readImage(),o):"SkPictureShader"===r?(safeview.compositor.getConfig().useNewPictureShader()?(o.picture={},e.readBool()?o.picture.matrix=e.readMatrix():o.picture.matrix=[1,0,0,1,0,0],o.picture.tile_mode_x=e.readUint32(),o.picture.tile_mode_y=e.readUint32(),o.picture.tile=e.readRect(),o.picture.index=e.readUint32()):(o.image={},o.image.matrix=e.readMatrix(),o.image.tile_mode_x=e.readUint32(),o.image.tile_mode_y=e.readUint32(),e.readBool()&&(o.image.image=e.readImage())),o):"SkSweepGradient"===r?((o=t(e)).center=e.readPoint(),{sweep_gradient:o}):"SkConicalGradient"===r?((o=t(e)).center_1=e.readPoint(),o.center_2=e.readPoint(),o.radius_1=e.readFloat32(),o.radius_2=e.readFloat32(),{conical_gradient:o}):(e.skip(n),null)}(e,r,n):Sk.SVGFilterHelper.isSupportedPathEffect(r)?function(e,t,r){return"SkDashImpl"===t?{name:t,phase:e.readFloat32(),intervals:e.readScalarArray()}:(e.skip(r),null)}(e,r,n):(e.skip(n),null)},e}(),Sk.TypefaceDelegate=function(e){var t=this,r=(new Sk.Logger("ff-del",{level:"info"}),new Sk.Deduper.ObjectMap),n={},i={};function o(e){switch(e){case Sk.FontSlant.kNormal:return"normal";case Sk.FontSlant.kItalic:return"italic";case Sk.FontSlant.kOblique:return"oblique"}}function a(e){switch(e){case Sk.FontStretch.kUltraCondensed_Width:return"ultra-condensed";case Sk.FontStretch.kExtraCondensed_Width:return"extra-condensed";case Sk.FontStretch.kCondensed_Width:return"condensed";case Sk.FontStretch.kSemiCondensed_Width:return"semi-condensed";case Sk.FontStretch.kNormal_Width:return"normal";case Sk.FontStretch.kSemiExpanded_Width:return"semi-expanded";case Sk.FontStretch.kExpanded_Width:return"expanded";case Sk.FontStretch.kExtraExpanded_Width:return"extra-expanded";case Sk.FontStretch.kUltraExpanded_Width:return"ultra-expanded"}}function s(e){switch(e.toLowerCase()){case"ital":case"opsz":case"slnt":case"wdth":case"wght":return!0}return!1}function l(e){var t,r="";for(t=3;t>=0;t-=1)r+=String.fromCharCode(e>>8*t&255);return r}function c(e){var t,r,n,i=[];if(e.coordinates.length){for(t=0;t<e.coordinates.length;t+=1)n=s(n=l((r=e.coordinates[t])[0]))?n.toLowerCase():n.toUpperCase(),i.push('"'+n+'" '+r[1].toFixed(0));return i.join(", ")}}function d(e,t,r){var n,i;for(i=0;i<e.coordinates.length;i+=1)if(l((n=e.coordinates[i])[0]).toLowerCase()===t.toLowerCase())return n[1].toFixed(0);return r}t.registerCallback=function(e,t){n[e]=t},t.deregisterCallback=function(e){n.hasOwnProperty(e),delete n[e]},t.add=function(t,s,l){r.add(t,s,l),BrowserDetect.supportsFontAPI()&&s.font_data&&function(t){t.font_data;var r=Sk.Font.getFamilyName(e,t.id),s={weight:String(d(t,"wght",t.weight)),stretch:d(t,"wdth")?void 0:a(t.width),style:d(t,"slnt")?void 0:o(t.slant),display:"swap",featureSettings:c(t)},l=new window.FontFace(r,t.font_data,s);l.load(),document.fonts.add(l),i[r],i[r]=l,l.loaded.then((function(){Sk.Util.forEachItem(n,(function(e,t){t()}))}))}(s)},t.reset=function(){Sk.Util.forEachItem(i,(function(e,t){document.fonts.delete(t)})),i={},r.reset()},t.release=function(){t.reset()},t.get=r.get,t.getStats=r.getStats,t.reset()};var Compositor={};Compositor.Options=Object.freeze({kDisableVideo:1,kEnableDebug:2,kEnableBBoxView:4,kSyncImageLoad:8,kDisableNativeVideo:16,kEnableHUD:32,kEnableDebugAnnotation:64,kEnableNativeOVSLScrolling:128,kHideScrollbarLayers:256,kEnableLogStats:512}),Compositor.HitTest=Object.freeze({kNonFastRegion:0,kLayer:1,kDrawing:2,kTouchActionRegion:3,kScrollingOrScrollbarLayer:4,kTextureLayer:5,kWheelEventRegion:6,kTouchEventRegion:7,kScrollableContainerId:8,kEventTarget:9}),Compositor.CommitState=Object.freeze({kLoadNotStarted:0,kLoadStarted:1,kLoadComplete:2}),Compositor.DrawFrameReason=Object.freeze({kRecordingsLoaded:1,kLayerProjectionChanged:2,kTilesBecameDirty:4,kBecameVisible:8,kVideoSizeChanged:16,kDebugRectsChanged:32,kLayerEffectChanged:64,kParentLayerTreeHostChanged:128,kAnimatedImages:256,k3DSortingChanged:512,kHiddenCanvas:1024}),Compositor.Config=function(e){var t=this,r={flags:0},n=!1,i=!1;function o(e,n){var i=r.flags,o=Util.copyDict(r||{});n?i|=e:i&=~e,o.flags=i,t.setConfig(o)}t.getPreDrawDistanceFactor=function(){return r.pre_draw_distance_factor},t.getPreDrawDistanceFactorForDOMRaster=function(){var e=r.pre_draw_distance_factor_for_dom_raster,n=5;return!t.getEnableDOMText()&&document.getElementsByTagName("*").length>4e3&&(n=BrowserDetect.isDesktop()&&BrowserDetect.isChrome()?1:3),e>=1?e:n},t.getPreferScrollingCorrectness=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kPreferScrollingCorrectness)},t.getTouchSize=function(){return{width:50,height:50}},t.getMouseEmulationTimeoutMs=function(){return 1e3},t.getMaxPreDrawDistance=function(){return r.max_pre_draw_distance||4096},t.getEnableDOMRasterization=function(){return!BrowserDetect.isIE()&&!BrowserDetect.isEdge()&&!(BrowserDetect.isFirefox()&&BrowserDetect.getVersion()<80)&&Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kEnableDOMRasterization)},t.setEnableDOMRasterization=function(e){o(Compositor.ConfigFlags.kEnableDOMRasterization,e)},t.getSelectionOverApproximation=function(){return{horizontal:128,vertical:128}},t.getEnableDOMText=function(){return!(!BrowserDetect.supportsResizeObserver()||!BrowserDetect.supportsFontAPI())&&t.getEnableDOMRasterization()&&Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kEnableDOMText)},t.setPreferScrollingCorrectness=function(e){o(Compositor.ConfigFlags.kPreferScrollingCorrectness,e)},t.getEnableCSSGradients=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kAllowCSSGradients)},t.setEnableDOMText=function(e){o(Compositor.ConfigFlags.kEnableDOMText,e)},t.setEnableCSSGradientsForTest=function(e){n=e,o(Compositor.ConfigFlags.kAllowCSSGradients,e)},t.getPruneOccludedTiles=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kPruneOccludedTiles)},t.useFocusPlaceholder=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kUseFocusPlaceholder)},t.getEnableDisplayListDeltaForDrag=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kAllowDisplayListDeltaForDrag)},t.isLocalDLForTextureAllowed=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kAllowLocalDLForTexture)},t.useNewPictureShader=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kUseNewPictureShader)},t.allowClientCanvasSrc=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kAllowClientCanvasSrc)},t.allowMFI=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kAllowMFI)},t.allowSingleRasterTile=function(){return Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kAllowSingleRasterTile)},t.setAllowSingleRasterTile=function(e){o(Compositor.ConfigFlags.kAllowSingleRasterTile,e)},t.setAllow3dCompositing=function(e){o(Compositor.ConfigFlags.kAllow3dCompositing,e)},t.allow3dCompositing=function(){return!BrowserDetect.isIE()&&!BrowserDetect.isEdge()&&Compositor.Util.checkFlag(r.flags,Compositor.ConfigFlags.kAllow3dCompositing)},t.setRetainTextMetrics=function(e){i=e},t.retainTextMetrics=function(){return i},t.setConfig=function(t){var i=0;r&&JSON.stringify(r)===JSON.stringify(t)||(n&&(t.flags|=Compositor.ConfigFlags.kAllowCSSGradients),void 0!==r.flags&&(r.flags,i=r.flags^t.flags),r=t,e&&e(i))}},Compositor.Stats=function(){var e=this,t={},r=null,n=Date.now();e.inc=function(e,r){t.hasOwnProperty(e)||(t[e]=0),void 0===r&&(r=1),t[e]+=r},e.get=function(e){return t.hasOwnProperty(e)?t[e]:0},e.get_dict=function(){return t},e.get_start_time=function(){return n},e.reset=function(){t={},n=Date.now()},e.startLogging=function(){r||(r=setInterval((function(){window.reportClientEvent("tc-compositor-stats",t,!1,!0)}),5e3))},e.stopLogging=function(){r&&(clearInterval(r),r=null)}},Compositor.EventType={kWheel:0,kTouch:1,kMouse:2},Compositor.Display=function(e){var t,r,n,i,o,a,s,l,c,d,u,f,p,g,m,_,h,y,v,k,S,b=this,w=0,C=Compositor.Options.kEnableNativeOVSLScrolling,T=new Compositor.ManagedListeners,E=new Compositor.Stats,A=1e3,R=0,x=!1,D=Sk.Rect.makeEmpty(),I={},O={},U={},M="0:0",F=[],P=new Util.BiMap,L=!1,N={};function B(t){var r;return!b.isLthAlive(t)&&(r=new Compositor.LayerTreeHost(e,b,t),I[t]=r,document.body.appendChild(r.getDiv()),r.isMainFrame()||(r.getDiv().style.display="none"),!0)}function H(e){var t,r=[_];function n(e,t){b.isLthAlive(e)&&r.push(I[e])}for(;r.length&&!e(t=r.pop());)t.forEachChildLth(n)}function V(e){var t,r;return e.screen_rect?(t=Sk.Rect.getCenter(e.screen_rect),r=Sk.Rect.getCenter(b.getScreenRect()),Math.sqrt(Math.pow(t[0]-r[0],2)+Math.pow(t[1]-r[1],2))):Number.MAX_VALUE}function W(e,t){var r=e.getLayerTreeHost(),n=t.getLayerTreeHost();if(r.getFrameSinkId()===n.getFrameSinkId()){if(e.paintsBefore(t))return 1}else if(r.paintsBefore(n,e,t))return 1;return-1}function z(){var e,t;return H((function(e){e.invalidateTilesForNewlyExposedRegions()})),t=[],H((function(e){t=t.concat(e.gatherDirtyTiles())})),e=t,a.getPruneOccludedTiles()?function(e){var t=[],r=[];return e.sort((function(e,t){return W(e.layer,t.layer)})),e.forEach((function(e){var n=e.layer;n.willDraw(),function(e){var r,n;if(e.layer.is3dSorted())return!0;if(!e.screen_rect)return!0;for(n=Sk.Rect.makeCopy(e.screen_rect),r=0;r<t.length&&!Sk.Rect.isEmpty(n);r+=1)Sk.Rect.subtract(n,t[r]);return!Sk.Rect.isEmpty(n)}(e)&&(e.screen_rect&&(e.screen_rect.rect_stays_rect,n.occludesContentBelow()&&e.screen_rect.rect_stays_rect&&t.push(e.screen_rect)),r.push(e))})),r}(e):e}function G(){var e={now:[],soon:[]},t=z();return E.inc("visible_tiles_count",t.length),t.sort((function(e,t){return V(e)<V(t)?-1:1})),t.forEach((function(t){t.screen_rect&&Sk.Rect.intersects(b.getScreenRect(),t.screen_rect)?e.now.push(t):e.soon.push(t)})),b.isDebugEnabled()&&e.now.length>8&&(t.length,e.now.length,e.soon.length),e}function j(e,t){for(var r,n,i={tile_draw_failed:!1};e.length&&t>0;){if(n=Date.now(),!(r=e[0]).layer.drawTilesInRect(r.tile_rect)){i.tile_draw_failed=!0;break}e.shift(),r.draw_time_ms=Date.now()-n,t-=r.draw_time_ms}return e.forEach((function(e){e.layer.getLayerTreeHost().setLayerTilesBecameDirty(e.layer.getID())})),i.time_remaining_ms=Math.max(0,t),i}function Y(){var e,t,r,n,i;x=!0,w+=1,b.callback.fire("begin-animation-frame"),i=!1,H((function(e){if(e.arePropertyTreesDirty())return i=!0,!0})),(i||R)&&(e=Date.now(),R=0,H((function(e){e.activateReadyTrees()})),n=_.getPropertyTrees().getClipTree(),b.getInnerViewportScrollLayer()&&b.getOuterViewportScrollLayer()&&(t=b.getInnerViewportScrollLayer().getClipTreeIndex(),(r=n.getNode(t))&&r.setClipRect(b.getScreenRect())),H((function(e){e.invalidateLayerProjectionsAndClips()})),H((function(e){e.getPropertyTrees().willDraw(),e.updateProjections(),e.updateClips(),e.updateEffects(),e.updateDebugRects(),e.update3dContexts()})),b.callback.fire("will-draw"),function(){var e,t,r,n;do{(n=j((e=G()).now,1e3)).tile_draw_failed&&(r=Math.min(A,Math.ceil(o)),(r=Math.max(r-1,1))<A&&(t=Util.copyDict(Sk.canvasMemoryUsage),b.setMaxRasterScaleFactor(r)))}while(r>1&&!n.tile_draw_failed);(n.tile_draw_failed||t)&&(window.reportClientEvent(n.tile_draw_failed?"tc-compositor-draw-retry-fail":"tc-compositor-dsf-fallback",{final_max_rsf:A,mem_usage:t,mem_limit:Sk.canvasMemoryLimit}),n.tile_draw_failed)||j(e.soon,Math.min(100,n.time_remaining_ms))}(),E.inc("frames_drawing_time",Date.now()-e),E.inc("frames_drawing_count")),H((function(e){e.clearDirtyLayers(),e.cleanUpHiddenCanvasCache()})),x=!1}function X(t){e.surrogate_channel&&e.surrogate_channel.send.apply(e.surrogate_channel,t)}function q(e,t){var r=Util.Uint8ArrayToBase64(t);E.inc("tx_bytes",r.length),X(["CM",e,r])}function K(){var e=Compositor.MessageFlags.kInvalidateLayerTree,t=new Sk.BinaryWriter(4);t.writeUint32(e),q(0,t.getData())}function Q(){H((function(e){e.hardInvalidateTiles()}))}function J(e){var t=Compositor.MessageFlags.kAttachLayerTreeHost,r=new Sk.BinaryWriter(4);r.writeUint32(t),q(e,r.getData())}function Z(){Compositor.Util.toggleStyle("sv-tile-style",".sv-tile { outline: 1px solid green }"),Compositor.Util.toggleStyle("sv-tile-label-style",".sv-tile-label { display: block !important; }"),Compositor.Util.toggleStyle("sv-layer-style",".svl { outline: 1px solid orange; }")}function $(){var e,t=a.getMaxPreDrawDistance();return a.getEnableDOMRasterization()?e=a.getPreDrawDistanceFactorForDOMRaster():(e=BrowserDetect.isDesktop()&&BrowserDetect.isChrome()?1:3,a.getPreDrawDistanceFactor()>=0&&(e=a.getPreDrawDistanceFactor())),Math.min(Math.round(Sk.Rect.getHeight(D)*e),t)}function ee(e){var t,r,n=MetricsUtils.getVisualViewportMetrics();return t=Sk.Rect.fromXYWH(0,0,n.width,BrowserDetect.isDesktop()?MetricsUtils.getWebViewSize().height:MetricsUtils.getScreenHeight()),r=Sk.Rect.resize(t,$()),!(!e&&Sk.Rect.isEqual(t,D)&&Sk.Rect.isEqual(r,i)||(D=t,i=r,b.invalidateLthProjections(M),0))}function te(){H((function(e){e.getLayerTree()&&e.getLayerTree().freeTiles((function(e){return!e.layer.isTextureLayer()&&e.type===Compositor.TileType.kCanvasDevice})),e.flushRasterCache()})),Sk.flushCaches()}function re(){ee(),o=MetricsUtils.getAllMetrics().device_scale_factor}function ne(e){var t=Compositor.MessageFlags.kRemoteCanvasSrc,r=new Sk.BinaryWriter(4);window.reportClientEvent("fallback-to-remote-canvas-src",{tclevel:"tc-info",reason:e||"OOM"},!0,!0),H((function(e){e.fallbackToRemoteCanvasSrc()})),r.writeUint32(t),q(0,r.getData())}function ie(e){var t=e.is_main_frame?M:e.frame_sink_id;if(e.is_frame_sink_id)return e.is_main_frame,e.fid,void(b.isLthAlive(t)?J(e.fid):N[t]=e.fid);e.flags&Compositor.CommitFlags.kDirtyConfig&&e.is_main_frame&&a.setConfig(e.config),B(t),I[t].onCompositorMessage(e),e.is_main_frame&&e.flags&Compositor.CommitFlags.kDirtyConfig&&re(),function(e){b.commit_count+=1,E.inc("commit_count"),e.full_tree&&(b.full_tree_commit_count+=1,E.inc("full_tree_commit_count")),e.transform_tree_mutations&&E.inc("transform_tree_mutation_count",e.transform_tree_mutations.length),e.clip_tree_mutations&&E.inc("clip_tree_mutation_count",e.clip_tree_mutations.length),e.scroll_tree_mutations&&E.inc("scroll_tree_mutation_count",e.scroll_tree_mutations.length),e.effect_tree_mutations&&E.inc("effect_tree_mutation_count",e.effect_tree_mutations.length)}(e)}function oe(e){e.forEachChildLth((function(t,r){var n=I[t],i=e.getLayerTree().getLayer(r);n&&oe(n),i&&F.push(i)}))}function ae(){0===F.length&&(oe(_),F.sort(W))}function se(e,t,r,n,i){var o;return!e.hasChildLth()||n>2?i(e.getFid(),r):e.hitTestLayerTree(t,(function(a,s){return!a.isUnHittableSurface()&&(a.isSurfaceForChildFrame()&&(o=b.getLthFromSurface(a))?se(o,t,s,n+1,i):!!a.hasHittableItemAt(s)&&i(e.getFid(),r))}))}function le(e){var t=O[e];t&&function(e){var t=I[e];t.isMainFrame()||(delete O[t.getFid()],t.release(),delete I[e],b.resetCachedSurfaceLayerList(),Util.forEachItem(U,(function(t,r){r===e&&delete U[t]})))}(t)}b.getTileManager=function(){return y},b.getRemoteInputTracker=function(){return v},b.getRAFManager=function(){return d},b.getMainFrame=function(){return _},b.getMainFrameSinkId=function(){return M},b.getDeviceScaleFactor=function(){return o},b.getDebugRectsEnabled=function(){return c},b.getImageLoader=function(){return r},b.getStats=function(){return E},b.setSpecialIds=function(e){m=e,L&&m&&-1!==m.outer_content&&b.setFlags(C&~Compositor.Options.kHideScrollbarLayers)},b.getInnerViewportScrollNode=function(){return m?_.getPropertyTrees().getScrollTree().getNode(m.inner_scroll):null},b.getOuterViewportScrollNode=function(){return m?_.getPropertyTrees().getScrollTree().getNode(m.outer_scroll):null},b.isOuterViewportScrollNode=function(e,t){return e.isMainFrame()&&m&&t===m.outer_scroll},b.getPageScaleTransformNode=function(){return m?_.getPropertyTrees().getTransformTree().getNode(m.page_scale):null},b.getInnerViewportScrollLayer=function(){var e=b.getInnerViewportScrollNode();return e?_.getLayerTree().getLayerByElementId(e.getElementId()):null},b.getOuterViewportScrollLayer=function(){var e=b.getOuterViewportScrollNode();return e?_.getLayerTree().getLayerByElementId(e.getElementId()):null},b.getOuterViewportContentLayer=function(){return m?-1===m.outer_content?b.getOuterViewportScrollLayer():_.getLayerTree().getLayer(m.outer_content):null},b.updateFrameSink=function(e,t){O[e]=t},b.isLthAlive=function(e){return I.hasOwnProperty(e)},b.invalidateLthProjections=function(e){I[e].setInvalidateProjections()},b.invalidateLthClips=function(e){I[e].setInvalidateClips()},b.invalidateLthEffects=function(e){I[e].setInvalidateEffects()},b.resetCachedSurfaceLayerList=function(){F=[]},b.registerSurface=function(e,t,r){var n,i=r.getSurfaceFrameSinkId();B(i)&&(n=N[i])&&(J(n),delete N[i]),I[i].registerParentLth(e,t,r.getSiblingRank()),r.getChildrenDiv().appendChild(I[i].getDiv()),I[i].getDiv().style.display="block",b.resetCachedSurfaceLayerList()},b.unregisterSurface=function(e){var t=I[e];t&&(t.unregisterParentLth(),document.body.appendChild(t.getDiv()),t.getDiv().style.display="none",b.resetCachedSurfaceLayerList(),f&&f.getShadowElementManager().unregisterSurface(e))},b.isLthTreeReady=function(e){for(;e&&e.getParentLthFrameSinkId();)e=I[e.getParentLthFrameSinkId()];return e&&e.isMainFrame()},b.getLthCount=function(){var e=0;return H((function(t){e+=1})),e},b.updateLthChildPaintRanks=function(e){e.forEachChildLth((function(t,r){var n,i;i=e.getLayerTree().getLayer(r),b.isLthAlive(t)&&i&&((n=I[t]).updatePaintRanks(e.getPaintRanks(),i.getSiblingRank(),!0),b.updateLthChildPaintRanks(n))}))},b.setNeedsDrawFrame=function(e){R|=e},b.isInAnimationFrame=function(){return x},b.sendCommand=X,b.sendCompositorMessage=q,b.requestDisplayListDelta=function(e){var t=Compositor.MessageFlags.kDisplayListDelta,r=new Sk.BinaryWriter(8);r.writeUint32(t),r.writeUint32(e),q(0,r.getData())},b.sendRepaintRequest=function(e,t){var r=Compositor.MessageFlags.kInvalidateLayerRect,n=new Sk.BinaryWriter(24);n.writeUint32(r),n.writeInt32(e),n.writeRect(t),q(0,n.getData())},b.setDebugDataEnabled=function(e){var t=Compositor.MessageFlags.kSetDebugDataEnabled,r=new Sk.BinaryWriter(8);r.writeUint32(t),r.writeUint32(e),q(0,r.getData())},b.setHUDVisibility=function(e){e?(b.isLogStatsEnabled(),n.start(),n.show()):n&&(n.stop(),n.hide())},b.setDebugKeysEnabled=function(e){return l=e},b.setDebugRectsEnabled=function(e){c=e},b.getHUD=function(){return n},b.getInputDelegate=function(){return f},b.getIframeDelegate=function(){return p},b.isScrollbarVisible=function(){return!(C&Compositor.Options.kHideScrollbarLayers)},b.sendCompositorMessage=q,b.toggleTileAndLayerBorders=Z,b.invalidateLayerTree=K,b.getTimeFromLastInput=function(){var e=(b.input||f).getLastActivityTime();return Date.now()-e.input},b.getLastMousePos=function(){return(b.input||f).getLastMousePos()},b.setFlags=function(e){C=e,Sk.setDebugEnabled(C&Compositor.Options.kEnableDebug)},b.getFlags=function(){return C},b.isVideoEnabled=function(){return!(C&Compositor.Options.kDisableVideo)},b.isNativeVideoEnabled=function(){return b.isVideoEnabled()},b.isBBoxViewEnabled=function(){return!!(C&Compositor.Options.kEnableBBoxView)},b.isHUDEnabled=function(){return!!(C&Compositor.Options.kEnableHUD)},b.isLogStatsEnabled=function(){return!!(C&Compositor.Options.kEnableLogStats)},b.isDebugEnabled=function(){return!!(C&Compositor.Options.kEnableDebug)},b.isDebugAnnotationEnabled=function(){return!!(C&Compositor.Options.kEnableDebugAnnotation)},b.isNativeOVSLScrollingEnabled=function(){return!!(C&Compositor.Options.kEnableNativeOVSLScrolling)},b.getFPS=function(){return d?d.getFPS():60},b.getFrameCount=function(){return w},b.getMinimumDistanceBeforeDrawRectUpdate=function(){return $()>512?512:0},b.getScreenRect=function(){return D},b.getDrawRect=function(){return i},b.getLowResRSF=function(){return BrowserDetect.isDesktop()?b.getDeviceScaleFactor():1},b.setDeviceScaleFactor=function(e){o!==e&&(o=e,b.callback.fire("device-scale-factor-changed"))},b.getMaxRasterScaleFactor=function(){return A},b.setMaxRasterScaleFactor=function(e){A=e,H((function(e){e.hardInvalidateTiles()}))},b.getVisualViewportBounds=function(){return D},b.getConfig=function(){return a},b.isFullscreen=function(){return e.fullscreen.isFullscreen()},b.enableComparatorMode=function(){return b.setFlags(Compositor.Options.kDisableVideo|Compositor.Options.kSyncImageLoad|Compositor.Options.kHideScrollbarLayers),e.feedback_bar&&e.feedback_bar.removeFeedbackBar(),u&&(u.style.opacity="0"),b.setDebugRectsEnabled(!1),L=!0,e.surrogate_channel&&e.surrogate_channel.send("show-tab"),H((function(e){e.enableComparatorMode()})),b.invalidateLayerTree(),b.full_tree_commit_count},b.hasValidViewportLayers=function(){var e=b.getInnerViewportScrollLayer(),t=b.getOuterViewportScrollLayer(),r=b.getOuterViewportContentLayer();return e&&t&&r},b.resetDeduperForTest=function(){var e,t;return e=Compositor.MessageFlags.kResetDeduper,(t=new Sk.BinaryWriter(4)).writeUint32(e),q(0,t.getData()),new window.Promise((function(e,t){var r,n;function i(e,r){e!==r&&t()}b.callback.registerOneShot("will-reset-cache",0,{on_success:function(){r=_.collectDeduperStats()}}),n=b.callback.register("did-activate-tree",(function(t){var o;t&&r&&(b.callback.deregister(n),o=_.collectDeduperStats(),Util.forEachItem(Sk.Deduper.Type,(function(e,t){var n=o[t].stats,a=r[t].stats;i(n.size,a.size),i(n.count,a.count),i(n.min_obj_size,a.min_obj_size),i(n.max_obj_size,a.max_obj_size)})),e())}))}))},b.getMediaDiv=function(){return t},b.getLayoutViewportDiv=function(){return u},b.fallbackToRemoteCanvasSrcForTest=function(){Sk.fallbackToRemoteCanvasSrc("test"),E.reset()},b.getPerfStats=function(){var e=(Date.now()-E.get_start_time())/1e3,t={};return t.commit_count=E.get("commit_count"),e>0&&(t.commit_kb_per_sec=Math.round(E.get("commit_rx_bytes")/1024/e),t.commit_count_per_sec=Math.round(E.get("commit_count")/e)),E.get("frames_drawing_count")>0&&(t.time_ms_per_frame=parseFloat((E.get("frames_drawing_time")/E.get("frames_drawing_count")).toFixed(2))),t},b.asDict=function(){var e=b.getOuterViewportScrollNode(),t=b.getInnerViewportScrollNode(),r=_.getPropertyTrees().getScrollTree(),n=b.getInnerViewportScrollLayer(),i=_.getPropertyTrees().getTransformTree().getNode(n.getTransformTreeIndex()),o=b.getOuterViewportScrollLayer(),a=_.getPropertyTrees().getTransformTree().getNode(o.getTransformTreeIndex()),s=b.getOuterViewportContentLayer(),l=_.getPropertyTrees().getTransformTree().getNode(s.getTransformTreeIndex()),c=b.getPageScaleTransformNode();return{ivsn:{container_bounds:t.getContainerBounds(),content_bounds:t.getContentBounds(),eid:t.getElementId(),max_off:t.maxScrollOffset(),current_off:r.getScrollOffset(t.getElementId()),tn:i.asDict()},ovsn:{container_bounds:e.getContainerBounds(),content_bounds:e.getContentBounds(),eid:e.getElementId(),max_off:e.maxScrollOffset(),current_off:r.getScrollOffset(e.getElementId()),tn:a.asDict()},ovcl_tn:l.asDict(),pstn:c.asDict(),psf:_.getPageScaleFactor(),vv:MetricsUtils.getVisualViewportMetrics(),screen_rect:b.getScreenRect(),draw_rect:b.getDrawRect(),layout_viewport_rect:b.getLayoutViewportDiv().getBoundingClientRect()}},b.getDrawDstId=function(e){switch(e){case Compositor.Projection.kOVCL:return b.getOuterViewportContentLayer().getTransformTreeIndex();case Compositor.Projection.kIVSL:return b.getInnerViewportScrollLayer().getTransformTreeIndex();case Compositor.Projection.kScreenSpace:return 0}},b.getProjectionMatrix=function(e,t){var r,n,i,o,a=t.getLayerTreeHost(),s=h;for(mat4.identity(s);a&&t;)o=a.isMainFrame()?b.getDrawDstId(e):a.getLayerTree().getRoot().getTransformTreeIndex(),r=t.getProjectionMatrix(o),mat4.multiply(s,r,s),n=a.getFrameSinkId(),(i=a.getParentLthFrameSinkId())?t=(a=I[i]).getSurfaceLayerForChildLth(n):a=null;return s},b.calcProjectedClipRect=function(e,t,r){for(var n,i,o,a,s,l,c=e.getLayerTreeHost(),d=Sk.Rect.makeLargest();c&&e;)s=c.isMainFrame()?t:c.getLayerTree().getRoot().getClipTreeIndex(),l=c.isMainFrame()?r:c.getLayerTree().getRoot().getTransformTreeIndex(),n=e.calcClipRect(s,l),Sk.Rect.isLargest(d)?d=Sk.Rect.intersection(n,d):(i=e.getProjectionMatrix(l),d=Sk.Rect.intersection(Compositor.Matrix3D.mapRect(i,d),n)),o=c.getFrameSinkId(),(a=c.getParentLthFrameSinkId())?e=(c=I[a]).getSurfaceLayerForChildLth(o):c=null;return d},b.calcClipRect=function(e){var t=b.getOuterViewportContentLayer().getTransformTreeIndex(),r=b.getOuterViewportContentLayer().getClipTreeIndex(),n=b.getInnerViewportScrollLayer().getTransformTreeIndex(),i=b.getInnerViewportScrollLayer().getClipTreeIndex(),o=e.isFixedToViewport();return b.calcProjectedClipRect(e,o?i:r,o?n:t)},b.projectMFI=function(e){var t=b.getOuterViewportContentLayer().getTransformTreeIndex(),r=b.getInnerViewportScrollLayer().getTransformTreeIndex(),n=e.isFixedToViewport();return function(e,t){for(var r,n,i,o,a,s=e.getLayerTreeHost();s&&e;)o=s.isMainFrame()?t:s.getLayerTree().getRoot().getTransformTreeIndex(),a?(a.rect,Sk.Rect.isValid(a.rect),r=e.getProjectionMatrix(o),a=Compositor.Matrix3D.mapRRect(r,a)):a=e.calcProjectedMFI(o),n=s.getFrameSinkId(),(i=s.getParentLthFrameSinkId())?e=(s=I[i]).getSurfaceLayerForChildLth(n):s=null;return a}(e,n?r:t)},b.getScreenSpaceClipRect=function(e){return b.calcProjectedClipRect(e,0,0)},b.getLthFromSurface=function(e){var t=e.getSurfaceFrameSinkId();return t?I[t]:null},b.hitTestSurface=function(e,t){var r,n,i,o;for(ae(),r=0;r<F.length;r+=1)if((n=F[r].hitTestPoint(e))&&(i=F[r].getBoundsRect(),Sk.Rect.containsPoint(i,n)&&(o=b.getLthFromSurface(F[r]))&&t(o,n,F[r])))return;t(_,e,null)},b.findTargetAndCallback=function(e,t){se(_,e,e,0,t)},b.getFidFromScreenPos=function(t,r){var n=e.fid,i=Compositor.Offset.makeXY(t,r);return b.findTargetAndCallback(i,(function(e,t){return n=e,!0})),n},b.getLthForFrame=function(e){var t=O[e];return t?I[t]:null},b.getSurfaceLayerForFrame=function(e){var t,r=O[e];return r&&(t=I[r].getParentLthFrameSinkId())?I[t].getSurfaceLayerForChildLth(r):null},b.getMainFrameSurfaceLayer=function(e){var t,r;for(e.isMainFrame();e&&!e.isMainFrame();)t=e.getParentLthFrameSinkId(),r=e.getFrameSinkId(),e=I[t];return e?e.getSurfaceLayerForChildLth(r):null},b.toScreenBounds=function(e,t){var r=b.getSurfaceLayerForFrame(e);return r?r.toScreenSpaceRect(t):t},b.wheelHandlerStateChanged=function(e,t){var r=function(e){var t,r,n;return(t=b.getLthForFrame(e)||function(e){var t=U[e];return t?I[t]:null}(e))?t:(r=b.getLastMousePos(),n=b.getFrameToken(e),r&&n?(b.findTargetAndCallback(r,(function(i){var o=b.getLthForFrame(i);return o&&o.hitTestLayerTree(r,(function(r,i){var a=r.getHitTestResultAt(i);return a&&a.hitsUncompositedFrameElement(n)&&(U[e]=o.getFrameSinkId(),t=o),!!t})),!!t})),t):null)}(e);assert_unimplemented(r,{event:"no-lth-for-wheel-handler",fid:e,event_type:t}),r&&r.getScrollDelegate().wheelHandlerStateChanged(t)},b.processCommit=ie,b.release=function(){b.input&&(b.input.release(),b.input=null),f&&(f.release(),f=null),p&&(p.release(),p=null),n&&(n.release(),n=null),d&&(d.release(),d=null),b.in_page_searcher&&(b.in_page_searcher.release(),b.in_page_searcher=null),T&&(T.release(),T=null),g&&(g.release(),g=null),H((function(e){e.release()})),t&&t.parentNode&&(t.parentNode.removeChild(t),t=null),u&&u.parentNode&&(u.parentNode.removeChild(u),u=null),r&&(r.release(),r=null),L=!1,Sk.fini()},b.getFrameTreeNodeId=function(e){return P.getKeyByVal(e)},b.getFrameToken=function(e){return P.getValByKey(e)},b.onRenderFrameDeleted=le,S={},a=new Compositor.Config((function(e){ee(!0),e&Compositor.ConfigFlags.kEnableDOMRasterization&&(a.getEnableDOMRasterization()&&te(),Q()),(e&Compositor.ConfigFlags.kEnableDOMText||e&Compositor.ConfigFlags.kAllowCSSGradients)&&Q(),e&Compositor.ConfigFlags.kAllowClientCanvasSrc&&a.allowClientCanvasSrc()&&Sk.setRemoteCanvasSrcCallback(ne),e&Compositor.ConfigFlags.kAllowSingleRasterTile&&H((function(e){var t=e.getLayerTree();t&&t.getRoot()&&t.walkDepthFirst((function(e){var t;e.getTilingSet()&&(t=e.getBounds(),e.getTilingSet().resize(t.width,t.height,"srs"))}))}))})),window.mat3=glMatrix.mat3,window.mat4=glMatrix.mat4,window.vec2=glMatrix.vec2,window.vec3=glMatrix.vec3,window.vec4=glMatrix.vec4,h=mat4.create(),S.Logger=Logger,S.assert=assert,S.assertUnimplemented=assert_unimplemented,S.Set=Compositor.Set,S.OrderedMap=Compositor.OrderedMap,S.fetchImage=function(t,r){new window.Promise((function(r,n){Util.areAuthTokensInUse()?e.xbrowser.createBlobSrc(t).then(r,n):r(t)})).then((function(e){return window.fetch(e)})).then((function(e){r(!0,e.headers.get("content-type")||"",e.body)})).catch(r.curry(!1))},Sk.init({tile:BrowserDetect.isDesktop()?1<<29:1<<27,invisible:1<<29,rcache:1<<25,shader:1<<24,"save-layer":1<<27,"hit-test":1<<23},S),Sk.Util.init(Compositor,Util),window.DEBUG&&b.setFlags(C|Compositor.Options.kEnableDebug),["safeview-info","sv-template"].forEach((function(e){for(var t;(t=document.getElementsByTagName(e))&&t.length;)t[0].parentNode.removeChild(t[0])})),b.callback=new CallbackSupport,B(M),_=I["0:0"],e.interp.registerBinaryHandler((function(e,t){return e!==MSG_KIND_COMPOSITOR_COMMIT||(ie((new Compositor.BinaryReader).readCommit(t)),b.commit_bytes+=t.length,E.inc("commit_rx_bytes",t.length)),!0})),b.commit_count=0,b.full_tree_commit_count=0,b.commit_bytes=0,t=document.createElement("div"),b.isDebugEnabled()&&(t.id="sv-media"),t.style.display="none",document.body.appendChild(t),e.media_objects.setClient({new_media_node:function(e,r,n){var i=document.createElement(e);return i.style.padding=i.style.margin="0px",b.isDebugEnabled()&&(i.id="sv-video:"+r+":"+n),t.appendChild(i),setNodeIds(i,n,r),b.callback.fire("media-node-inserted",n,r),i},did_remove_media_node:function(e,t){var r=getNodeByUid(e,t);r&&(r.parentNode.removeChild(r),b.callback.fire("remove-media-node",e,t),removeUidNodeEntry(e,t))},get_media_node:function(e,t){return getNodeByUid(e,t)}}),re(),r=new Sk.ImageLoader((function(e,t,r){var n,i,o,a,s=b.input||f,l=[25,25,3];return t?s?(n=s.getLastActivityTime(),i=Date.now()-n.input,o=Date.now()-n.key,Date.now(),n.click,e.length,i<1e3?[a=o<1e3?0:25,a,0]:l):l:[100,100,100]})),(g=new Compositor.VisualViewportDelegate(e,b)).asDict(),BrowserDetect.isDesktop()?(b.input=new Compositor.Input(e,b),b.selection=new Compositor.Selection(e,b),b.ime=new Compositor.IME(e)):f=new Compositor.InputDelegate(e,b),b.in_page_searcher=new Compositor.InPageSearcher(e),p=new Compositor.IframeDelegate(e,b),new Compositor.Extras(e).init(),new Compositor.ScrollContentPrefetcher(e,(function(e){var t=Compositor.MessageFlags.kPixelDistance,r=new Sk.BinaryWriter(8);r.writeUint32(t),r.writeUint32(e),q(0,r.getData())})).init(),s=new Compositor.FlowController(e,b),b.isDebugEnabled()&&(b.debug=new Compositor.Debug(b)),n=new Compositor.HUD((function(e){var t,r,n,i,o=["#FF0000","#00FF00","#0000FF","#FFFCF9"],a=0,l=0;function c(e){return e/(1<<20)}function d(e,t){var r=[],n=0;return Util.forEachItem(e,(function(e,i){r.push([t?t(i):i,o[n%o.length]]),n+=1})),r}e.cps.update([[E.get("commit_count")]]),t={rx:E.get("commit_rx_bytes")/1024,tx:E.get("tx_bytes")/1024},e.crx.update(d(t)),e.cql.update([[(i=0,H((function(e){i+=e.getPendingCommitCount()})),i)]]),e.sfps.update([[1e3/s.getSenderDelay()]]),e.fps.update([[b.getFPS()]]),e.canvas.update(d(Sk.canvasMemoryUsage,c)),e.hidden_canvas.update([[c(Sk.canvasMemoryUsage.invisible||0)]]),r=function(){var e={Transform:0,Clip:0,Scroll:0,Effect:0};return H((function(t){e.Transform+=t.getPropertyTrees().getTransformTree().getSize(),e.Clip+=t.getPropertyTrees().getClipTree().getSize(),e.Scroll+=t.getPropertyTrees().getScrollTree().getSize(),e.Effect+=t.getPropertyTrees().getEffectTree().getSize()})),e}(),e.ptn_count.update(d(r)),n={Transform:E.get("transform_tree_mutation_count"),Clip:E.get("clip_tree_mutation_count"),Scroll:E.get("scroll_tree_mutation_count"),Effect:E.get("effect_tree_mutations_count")},e.ptn_mutations.update(d(n)),0!==E.get("frames_drawing_count")&&(a=E.get("frames_drawing_time")/E.get("frames_drawing_count"),l=E.get("visible_tiles_count")/E.get("frames_drawing_count")),e.fdt.update([[a]]),e.vtc.update([[l]]),E.reset()})),b.setHUDVisibility(b.isHUDEnabled()),b.setDebugKeysEnabled(b.isDebugEnabled()),b.setDebugDataEnabled(b.isDebugEnabled()),document.body.appendChild(n.getDiv()),(k=document.createElement("div")).id="sv-lvp-div",k.style.display="block",k.style.position="fixed",k.style.backgroundColor="blue",b.isDebugEnabled()||(k.style.opacity="0"),k.style.height="1px",k.style.width="100%",k.style.left="0px",k.style.top="0px",k.style.webkitUserSelect="none",k.style.userSelect="none",document.body.appendChild(k),u=k,b.in_page_searcher.insertInput(),(d=new Compositor.RequestAnimationFrame((function(){var t;try{Y()}catch(r){t={stacktrace:printStackTrace(r),exception:r?r.toString():null},e.fatalError("tc-draw-frame-exception",t)}}))).start(),y=new Compositor.TileManager(b),v=new Compositor.RemoteInputTracker(e,b),e.callback.fire("remoting-v2-activated"),e.callback.register("metrics-changed",(function(e,t){b.setDeviceScaleFactor(e.device_scale_factor),ee()})),e.callback.register("window-resized",(function(e){BrowserDetect.isMobile()||X(["resize",Sk.Rect.getWidth(D),Sk.Rect.getHeight(D),e.device_scale_factor])})),e.callback.register("ftimu",(function(t,r,n){t=t.toLowerCase(),n?P.erase(r,t):P.set(r,t),e.callback.fire("ftim-updated",t,r,n)})),e.metrics_observer.checkForMetricsChange("init"),T.add([[document,"keydown",function(e){var t,r;if(l&&function(e){return!(!e.shiftKey||!e.ctrlKey||"keydown"!==e.type)}(e))switch(e.keyCode){case"F".charCodeAt(0):K();break;case"H".charCodeAt(0):b.setFlags(C^Compositor.Options.kEnableHUD),b.setHUDVisibility(b.isHUDEnabled());break;case"I".charCodeAt(0):Sk.setImageQuality(1),K();break;case"R".charCodeAt(0):t=Compositor.MessageFlags.kInvalidateAllLayers,(r=new Sk.BinaryWriter(4)).writeUint32(t),q(0,r.getData());break;case"L".charCodeAt(0):b.setMaxRasterScaleFactor(1);break;case"D".charCodeAt(0):H((function(e){e.hardInvalidateTiles()}));break;case"T".charCodeAt(0):Z();break;case"V".charCodeAt(0):b.setFlags(C^Compositor.Options.kDisableNativeVideo),H((function(e){e.toggleVideoMode()}));break;case"U".charCodeAt(0):b.setFlags(C^Compositor.Options.kEnableDebugAnnotation),K();break;case"Z".charCodeAt(0):a.setEnableDOMRasterization(!a.getEnableDOMRasterization());break;case"Y".charCodeAt(0):a.setAllowSingleRasterTile(!a.allowSingleRasterTile());break;case"N".charCodeAt(0):a.setEnableDOMText(!a.getEnableDOMText());break;case"P".charCodeAt(0):b.setFlags(C^Compositor.Options.kEnableLogStats),b.isLogStatsEnabled()?(b.isHUDEnabled(),E.startLogging()):E.stopLogging()}},!1],[document,"visibilitychange",function(){!Util.isTabVisible()&&BrowserDetect.isMobile()&&te(),Util.isTabVisible()&&b.setNeedsDrawFrame(Compositor.DrawFrameReason.kBecameVisible)},!1],[window,"unload",function(){b.release()}]]),e.interp.registerOpcodeHandler("sifd",le)},Compositor.Offset=function(){var e={isValid:function(e){return"number"==typeof e.x&&"number"==typeof e.y},makeXY:function(e,t){return{x:e,y:t}},makeZero:function(){return e.makeXY(0,0)},makeCopy:function(t){return e.isValid(t),e.makeXY(t.x,t.y)},setToZero:function(e){e.x=e.y=0},setToMax:function(e,t){return e.x=e.x>=t.x?e.x:t.x,e.y=e.y>=t.y?e.y:t.y,e},setToMin:function(e,t){return e.x=e.x<=t.x?e.x:t.x,e.y=e.y<=t.y?e.y:t.y,e},add:function(t,r,n){var i=n||e.makeCopy(t);return i.x+=r.x,i.y+=r.y,i},subtract:function(t,r,n){var i=n||e.makeCopy(t);return i.x-=r.x,i.y-=r.y,i},multiply:function(t,r,n){var i=n||e.makeCopy(t);return i.x*=r.x,i.y*=r.y,i},scale:function(t,r,n){var i=n||e.makeCopy(t);return i.x*=r,i.y*=r,i},roundDown:function(e){return e.x=Math.floor(e.x),e.y=Math.floor(e.y),e},abs:function(t){return e.makeXY(Math.abs(t.x),Math.abs(t.y))},sign:function(t){return e.makeXY(Math.sign(t.x),Math.sign(t.y))},isEqual:function(t,r){return e.isValid(t)&&e.isValid(r),t.x===r.x&&t.y===r.y},isZero:function(t){return e.isValid(t),0===t.x&&0===t.y},angleBetween:function(e,t,r){var n,i=vec2.fromValues(e.x,e.y),o=vec2.fromValues(t.x,t.y);return 0===(n=r?Math.sign(vec2.cross([],i,o)[2]):1)&&(n=1),vec2.angle(i,o)*n*180/Math.PI}};return e}(),Compositor.CSS={toCursorName:function(e){switch(e){case Sk.HT.CursorType.kNone:return"none";case Sk.HT.CursorType.kCopy:return"copy";case Sk.HT.CursorType.kAuto:return"auto";case Sk.HT.CursorType.kCrosshair:return"crosshair";case Sk.HT.CursorType.kDefault:return"default";case Sk.HT.CursorType.kPointer:return"pointer";case Sk.HT.CursorType.kMove:return"move";case Sk.HT.CursorType.kVerticalText:return"vertical-text";case Sk.HT.CursorType.kCell:return"cell";case Sk.HT.CursorType.kContextMenu:return"context-menu";case Sk.HT.CursorType.kAlias:return"alias";case Sk.HT.CursorType.kProgress:return"progress";case Sk.HT.CursorType.kNoDrop:return"no-drop";case Sk.HT.CursorType.kNotAllowed:return"not-allowed";case Sk.HT.CursorType.kZoomIn:return"zoom-in";case Sk.HT.CursorType.kZoomOut:return"zoom-out";case Sk.HT.CursorType.kEResize:return"e-resize";case Sk.HT.CursorType.kNeResize:return"ne-resize";case Sk.HT.CursorType.kNwResize:return"nw-resize";case Sk.HT.CursorType.kNResize:return"n-resize";case Sk.HT.CursorType.kSeResize:return"se-resize";case Sk.HT.CursorType.kSwResize:return"sw-resize";case Sk.HT.CursorType.kSResize:return"s-resize";case Sk.HT.CursorType.kWResize:return"w-resize";case Sk.HT.CursorType.kEwResize:return"ew-resize";case Sk.HT.CursorType.kNsResize:return"ns-resize";case Sk.HT.CursorType.kNeswResize:return"nesw-resize";case Sk.HT.CursorType.kNwseResize:return"nwse-resize";case Sk.HT.CursorType.kColResize:return"col-resize";case Sk.HT.CursorType.kRowResize:return"row-resize";case Sk.HT.CursorType.kText:return"text";case Sk.HT.CursorType.kWait:return"wait";case Sk.HT.CursorType.kHelp:return"help";case Sk.HT.CursorType.kAllScroll:return"all-scroll";case Sk.HT.CursorType.kGrab:return"grab";case Sk.HT.CursorType.kGrabbing:return"grabbing";default:return"default"}},toOverscrollBehavior:function(e){switch(e){case Compositor.OverscrollBehaviorType.kNone:return"none";case Compositor.OverscrollBehaviorType.kAuto:return"auto";case Compositor.OverscrollBehaviorType.kContain:return"contain";default:return"auto"}}},Compositor.Bounds=function(){var e={isValid:function(e){return"number"==typeof e.width&&"number"==typeof e.height},isEmpty:function(e){return e.width*e.height==0},makeZero:function(){return{width:0,height:0}},makeCopy:function(e){return{width:e.width,height:e.height}},scale:function(e,t){return{width:e.width*t,height:e.height*t}},setToMin:function(e,t){return{width:Math.min(e.width,t.width),height:Math.min(e.height,t.height)}},ceil:function(e){return{width:Math.ceil(e.width),height:Math.ceil(e.height)}},areEqual:function(t,r){return e.isValid(t)&&e.isValid(r),t.width===r.width&&t.height===r.height}};return e}(),Compositor.Util=function(){var e={quadBezier:function(e,t,r,n){var i=1-e;return t*(i*i)+2*r*i*e+n*(e*e)},toggleStyle:function(e,t){var r=document.getElementById(e);r?r.parentNode.removeChild(r):((r=document.createElement("style")).id=e,r.appendChild(document.createTextNode(t)),document.head.appendChild(r))},checkFlag:function(e,t){return!!(e&t)},filterTypeToString:function(e){switch(e){case Compositor.FilterType.GRAYSCALE:return"GRAYSCALE";case Compositor.FilterType.SEPIA:return"SEPIA";case Compositor.FilterType.SATURATE:return"SATURATE";case Compositor.FilterType.HUE_ROTATE:return"HUE_ROTATE";case Compositor.FilterType.INVERT:return"INVERT";case Compositor.FilterType.BRIGHTNESS:return"BRIGHTNESS";case Compositor.FilterType.CONTRAST:return"CONTRAST";case Compositor.FilterType.OPACITY:return"OPACITY";case Compositor.FilterType.BLUR:return"BLUR";case Compositor.FilterType.DROP_SHADOW:return"DROP_SHADOW";case Compositor.FilterType.COLOR_MATRIX:return"COLOR_MATRIX";case Compositor.FilterType.ZOOM:return"ZOOM";case Compositor.FilterType.REFERENCE:return"REFERENCE";default:return"UNKNOWN"}}};return e}(),Compositor.Set=function(e){var t=this,r={},n=0;t.add=function(t){var i=e(t);r.hasOwnProperty(i)?r[i]=t:(r[i]=t,n+=1)},t.remove=function(t){var i=e(t);return!!r.hasOwnProperty(i)&&(n-=1,delete r[i],!0)},t.has=function(t){var n=e(t);return r.hasOwnProperty(n)},t.size=function(){return n},t.empty=function(){return 0===n},t.clear=function(){r={},n=0},t.forEachItem=function(e){Util.forEachItem(r,e)},t.asDict=function(){return r}},Compositor.OrderedMap=function(){var e=this,t={},r=[],n=0;e.set=function(e,i){return t.hasOwnProperty(e)?(t[e]=i,i):(t[e]=i,r.push(e),n+=1,i)},e.get=function(e){return t[e]},e.has=function(e){return t.hasOwnProperty(e)},e.size=function(){return n},e.forEachEntryInOrder=function(e){var n,i=0;for(i=0;i<r.length;i+=1)n=r[i],t.hasOwnProperty(n)&&e(n,t[n])}},Compositor.ManagedListeners=function(){var e=[];this.add=function(t){t.forEach((function(t){e.push(t)})),t.forEach((function(e){EventListener.addListener.apply(EventListener,e)}))},this.release=function(){e.forEach((function(e){EventListener.removeListener.apply(EventListener,e)})),e=[]}},Compositor.FloatingPoint=function(){var e={TOLERANCE:1e-5,isEqual:function(t,r,n){return arguments.length<3&&(n=e.TOLERANCE),Math.abs(t-r)<=n||0!==t&&0!==r&&(Math.abs((t-r)/r)<=n||Math.abs((t-r)/t)<=n)}};return e}(),Compositor.kNextTextureLayerClientId=0,Compositor.TextureLayerClient=function(){var e,t,r,n,i=this;function o(){t=[],r=null,n=null}i.playback=function(e){var o=[],a=r||t,s=!1;0!==a.length&&(a.forEach((function(t,r){(s|=e(t))||o.unshift(r)})),o.forEach((function(e){a.splice(e,1)})),r&&!r.length&&(n.removeReference(i),n=null,r=null))},i.recordTextureUpdate=function(e){t.push(e)},i.clearTextureUpdates=function(e){var o;if(!e||!t||!t.length)return!0;for(r=[],o=t.shift();o;){if(o.getAssetCache()!==e){t.unshift(o);break}r.push(o),o=t.shift()}return r.length?(e.addReference(i),n=e,!1):(r=null,n=null,!0)},i.hasPendingRecords=function(){return!!(r||t).length},i.getId=function(){return e},i.reset=i.release=o,e=Compositor.kNextTextureLayerClientId++,o()},Compositor.TileType=Object.freeze({kSolidColor:0,kCanvasDevice:1,kDOMDevice:2}),Compositor.TilingSet=function(e){var t,r,n,i=this,o=0,a=0,s={},l={},c=null,d=Sk.Region.makeEmpty(),u=null,f=!1,p=!1,g=e.layer,m=e.display_list,_=!1;function h(e){Sk.Region.subtractRect(d,e)}function y(e,t){return e|t<<16}function v(e){return e.type===Compositor.TileType.kCanvasDevice||e.type===Compositor.TileType.kDOMDevice}function k(t){var r,n=g.getDisplay().getConfig(),i=0,o=!1;return g.hasVideoContent()||e.delta_mode?Compositor.TileType.kCanvasDevice:void 0!==l[t.key]?l[t.key]:void 0===m.getSolidColorInRect(t.rect)||g.hasCaret()?(i|=Sk.PictureFlags.kHasHardCompositingOp,i|=Sk.PictureFlags.kHasSweepGradientPictureShader,(BrowserDetect.isSafari()||BrowserDetect.isIE()||BrowserDetect.isEdge())&&(BrowserDetect.supportsComplexCSSClipPath()||(i|=Sk.PictureFlags.kHasComplexClip),i|=Sk.PictureFlags.kHasColorFilter,i|=Sk.PictureFlags.kHasBlendOp,(r=m.hasPictureFlagsSetInRect(t.rect,[Sk.PictureFlags.kHasImageFilter,Sk.PictureFlags.kHasHardCompositingOp,i&~Sk.PictureFlags.kHasHardCompositingOp,Sk.PictureFlags.kHasCSSGradientShader,i&~Sk.PictureFlags.kHasColorFilter]))[0]&&r[1]&&!r[2]&&(o=!0),r[3]&&!r[4]&&(o=!0)),!n.getEnableDOMRasterization()||!o&&m.hasPictureFlagsInRect(t.rect,i)?Compositor.TileType.kCanvasDevice:Compositor.TileType.kDOMDevice):Compositor.TileType.kSolidColor}function S(e){return n&&Sk.Rect.intersects(e,n)?g.getRasterScaleFactor():g.getDisplay().getLowResRSF()}function b(e){return e.canvas?e.canvas.getNode():e.div}function w(e){g.applyDrawTransform(b(e),e.rect)}function C(e){g.applyDrawClip(b(e),e.rect,u)}function T(e){g.applyDrawOpacity(b(e))}function E(n,s){var l,c,d=Sk.Rect.fromXYWH(o*n,a*s,o,a),u=Sk.Rect.intersection(r,d),f={rect:u,index_x:n,index_y:s,key:y(n,s),lid:g.getID(),layer:g,fid:g.getLayerTreeHost().getFid(),mem_size:0,force_realloc:!1,rsf:S(d)};if(f.type=k(f),f.type===Compositor.TileType.kSolidColor)f.div=(l=u,(c=document.createElement("div")).style.position="absolute",c.style.width=Sk.Rect.getWidth(l)+"px",c.style.height=Sk.Rect.getHeight(l)+"px",c.className=e.class_name||"sv-tile",DEBUG&&c.setAttribute("rect",Sk.Rect.toString(l)),c),t.appendChild(f.div);else{if(f.canvas=function(t){var r,n,o,a,s={};if(v(t),t.type===Compositor.TileType.kCanvasDevice){if(!(r=new Sk.HTMLCanvasDevice("tile",Sk.Rect.roundOut0(Sk.Rect.scale(t.rect,t.rsf)),{x:Sk.Rect.getX(t.rect),y:Sk.Rect.getY(t.rect)},t.rsf)).tryAlloc())return null;s.use_raster_cache=!0}else g.getDisplay().getConfig().getEnableDOMText()&&(a=new Sk.TextFitter(g.getLayerTreeHost().getTypefaceDelegate(),g.getLayerTreeHost().getFid())),r=new Sk.DOMDevice("tile",t.rect,{x:Sk.Rect.getX(t.rect),y:Sk.Rect.getY(t.rect)},BrowserDetect.supportsComplexCSSClipPath(),g.getDisplay().getConfig().getEnableCSSGradients(),a,null,g.getLayerTreeHost().getFid()),s.use_raster_cache=!1,s.use_single_raster_tile=g.useSingleRasterTile();return s.text_boxes=!1,s.hit_item_listener=g.onHitTestData,n=new Sk.Canvas(r,i.invalidateRect,s,{lid:g.getID()}),g.isTextureLayer()&&g.getDisplay().getConfig().allowClientCanvasSrc()&&(s.use_raster_cache=!1,n.setCanvasKey(Sk.Util.getNodeKey(g.getLayerTreeHost().getFrameToken(),g.getDOMNodeId()))),(o=n.getNode()).style.position="absolute",o.style.width=Sk.Rect.getWidth(t.rect)+"px",o.style.height=Sk.Rect.getHeight(t.rect)+"px",o.className=e.class_name||"sv-tile",DEBUG&&(o.id="tile-"+g.getLayerTreeHost().getFid()+":"+g.getID()+"-"+t.index_x+"-"+t.index_y,o.setAttribute("rect",Sk.Rect.toString(t.rect))),n}(f),!f.canvas)return null;f.mem_size=f.canvas.getDevice().getMemoryUsage(),t.appendChild(f.canvas.getNode())}return g.useSingleRasterTile()&&(b(f).style.willChange="transform"),w(f),C(f),T(f),DEBUG&&(f.label_div=function(e){var t,r=document.createElement("div"),n=g.getScreenSpaceScaleFactor(),i=Math.max(n[0],n[1]);return r.style.display="none",r.style.position="absolute",r.style.left=Sk.Rect.getX(e.rect)+"px",r.style.top=Sk.Rect.getY(e.rect)+"px",r.style.backgroundColor="teal",r.style.color="white",r.style.whiteSpace="nowrap",r.style.pointerEvents="none",r.style.fontSize=Math.max(Math.floor(12/i),1)+"px",r.style.transformStyle="inherit",r.className="sv-tile-label",g.applyDrawTransform(r,e.rect),t="["+g.getLayerTreeHost().getFid()+":"+g.getID()+"]",g.isSurfaceForChildFrame()&&(t+=" ("+g.getSurfaceFrameSinkId()+")"),t+=" X: "+e.index_x+", Y: "+e.index_y,t+=" "+o+"x"+a,t+=" T: ",e.type===Compositor.TileType.kCanvasDevice?t+="C":e.type===Compositor.TileType.kDOMDevice?t+="D":t+="S",t+=" RSF: "+e.rsf.toFixed(1),e.canvas&&e.canvas.getDevice()&&(t+=" "+(e.canvas.getDevice().getMemoryUsage()/1048576).toFixed(1)+" MB"),r.textContent=t,r}(f),t.appendChild(f.label_div)),g.getDisplay().getTileManager().addTile(f),f}function A(e){s[e.key],delete s[e.key],v(e)?e.canvas&&(t.removeChild(e.canvas.getNode()),e.canvas.release(),e.canvas=null):(e.type,Compositor.TileType.kSolidColor,t.removeChild(e.div),e.div=null),e.label_div&&e.label_div.parentNode&&e.label_div.parentNode.removeChild(e.label_div),g.getDisplay().getTileManager().removeTile(e)}function R(e){var t,n,s,l,c=Sk.Rect.intersection(r,e);return Sk.Rect.isEmpty(c)?null:(t=Math.floor(Sk.Rect.getY(c)/a),n=Math.floor((Sk.Rect.getBottom(c)-1)/a),s=Math.floor(Sk.Rect.getX(c)/o),l=Math.floor((Sk.Rect.getRight(c)-1)/o),Math.ceil(i.height()/a),i.height(),Math.ceil(i.width()/o),{start_r:t,end_r:n,start_c:s,end_c:l})}function x(){var e,t,n,i,o,a,s=(a=g.getScreenSpaceScaleFactor(),g.isAttached()?(n=g.getDisplay().getScreenRect(),i=Sk.Rect.fromWH(Sk.Rect.getWidth(n),Sk.Rect.getHeight(n)/2),e=Math.max(1,a[0]),t=Math.max(1,a[1]),o=Sk.Rect.roundOut0(Sk.Rect.scaleXY(i,1/e,1/t)),{width:Math.min(2048,Sk.Rect.getWidth(o)),height:Math.min(512,Sk.Rect.getHeight(o))}):{width:0,height:0}),l=s.width,c=s.height;return l=Math.min(Sk.Rect.getWidth(r),l),c=Math.min(Sk.Rect.getHeight(r),c),l=Math.ceil(l),c=Math.ceil(c),{width:l=Math.min(2048,l),height:c=Math.min(512,c)}}function D(t,r,n,i,o){var a=t.getCullRect(),s=i.canvas;i.type!==Compositor.TileType.kSolidColor?(v(i),g.subtractHittableRect(o),s.save(),s.clipRect(Sk.Rect.intersection(a,o)),e.delta_mode||r||s.clearRect(o),s.translate(Sk.Rect.getX(a),Sk.Rect.getY(a)),t.playback(s,n),s.restore()):i.div.style.backgroundColor=Sk.Paint.skColorToCSSColor(m.getSolidColorInRect(o))}function I(e,t,r,n){r.type===Compositor.TileType.kDOMDevice&&(n=r.rect,r.canvas.getDevice().reset()),m.forEachAllocatedTileInRect(n,(function(n,i){var o=m.getTileByKey(n);o&&(o.getRecording()?D(o.getRecording(),e,t,r,i):o.getTextureLayerClient()&&o.getTextureLayerClient().playback((function(n){var i,o=r.canvas;return D(n,e,t,r,n.getCullRect()),i=o.needsRedraw(),o.clearNeedsRedraw(),i})))}))}i.isRectDirty=function(e){return Sk.Region.intersectsRect(d,e)},i.getDirtyRegion=function(){return d},i.invalidateRect=function(e,t){var r=g.getLayerTreeHost(),n=g.getDisplay().getConfig().isLocalDLForTextureAllowed();Sk.Rect.isEmpty(e)||(g.isTextureLayer()&&!n||g.isSurfaceLayerForOSC()?r.setNeedsRepaint(g.getID(),e):(Sk.Region.addRect(d,e),r.setLayerTilesBecameDirty(g.getID())))},i.onCanvasNodeIdChange=function(){var e=g.getDOMNodeId(),t=g.getLayerTreeHost().getFrameToken(),r=Sk.Util.getNodeKey(t,e);Util.forEachItem(s,(function(e,t){t.canvas&&t.canvas.onCanvasKeyChange(r)}))},i.attachToNewLayer=function(e){e.getDOMNodeId(),g=e,m=e.getDisplayList(),g.initScreenSpaceScaleFactorForReattach()},i.getDomNode=function(){return t},i.width=function(){return Sk.Rect.getWidth(r)},i.height=function(){return Sk.Rect.getHeight(r)},i.removeKnownTilesType=function(){c&&(clearTimeout(c),c=null),c=setTimeout((function(){l={}}),1e3)},i.requestTileType=function(e,t,r){r===Compositor.TileType.kCanvasDevice||r===Compositor.TileType.kDOMDevice||Compositor.TileType.kSolidColor,i.forEachTileInRect(e,(function(e,n,i){var o,a=y(n,i);l[a]=r,e&&e.type!==r&&(A(e),o=(e=E(n,i)).rect,e&&(b(e),s[e.key]=e,h(o),I(t,null,e,o)))}))},i.forEachTileInRect=function(e,t){var r,n,i;if(i=R(e))for(r=i.start_r;r<=i.end_r;r+=1)for(n=i.start_c;n<=i.end_c;n+=1)t(s[y(n,r)],n,r)},i.forEachAllocatedTileInRect=function(e,t){var r,n,i;(i=R(e))&&Util.forEachItem(s,(function(e,o){n=function(e){return 65535&Number(e)}(e),r=function(e){return Number(e)>>16&65535}(e),n<i.start_c||n>i.end_c||r<i.start_r||r>i.end_r||t(o,n,r)}))},i.freeTiles=function(e){Date.now();Util.forEachItem(s,(function(t,r){e&&!e(r)||A(r)})),Date.now()},i.hasTiles=function(){return!Util.isDictEmpty(s)},i.numOfTiles=function(){var e=0;return Util.forEachItem(s,(function(t,r){e+=1})),e},i.setHighResWindowToRect=function(e){n&&Sk.Rect.isEqual(e,n)||(n=Sk.Rect.makeCopy(e),Util.forEachItem(s,(function(e,t){var r=S(t.rect);t.type===Compositor.TileType.kCanvasDevice&&(t.rsf<r?i.hardInvalidateTilesInRect(t.rect):t.rsf>r&&(function(e){A(e),e.key,s[e.key]}(t),i.invalidateRect(t.rect,"downgrade")))})))},i.getTileRectByIndices=function(e,t){return Sk.Rect.fromXYWH(o*e,a*t,o,a)},i.drawTilesInRect=function(e,t){Sk.Rect.isValid(e);var n=Sk.Rect.intersection(r,e),o=!0;return Sk.Rect.isEmpty(n)||(_&&(i.freeTiles(),_=!1),i.forEachTileInRect(n,(function(e,r,i){var a;if(!e||e.type,e&&(e.force_realloc||function(e){return e&&e.type,e.type!==k(e)}(e))&&(a=e.rect,A(e),e=null),!e){if(!(e=E(r,i)))return void(o=!1);b(e),e.force_realloc,s[e.key]=e}a||(a=Sk.Rect.intersection(n,e.rect)),h(a),Sk.Rect.isEmpty(a),t(e,a)}))),o},i.hardInvalidateTilesInRect=function(e){i.forEachAllocatedTileInRect(e,(function(t){t.force_realloc=!0,i.invalidateRect(e,"invalidate-tiles")}))},i.hardInvalidateWithTileRecalc=function(){var e;e=g.isUntiled()||g.useSingleRasterTile()?{width:Sk.Rect.getWidth(r),height:Sk.Rect.getHeight(r)}:x(),o===e.width&&a===e.height||(i.hardInvalidateTilesInRect(r),_=!0,o=e.width,a=e.height)},i.resize=function(e,t,s){var l,c,d=r;d&&Sk.Rect.getWidth(d)===e&&Sk.Rect.getHeight(d)===t&&f===g.isUntiled()&&p===g.useSingleRasterTile()||(f=g.isUntiled(),p=g.useSingleRasterTile(),l=Sk.Rect.fromWH(e,t),i.freeTiles(),r=l,g.isTextureLayer()&&g.getDisplay().getConfig().allowClientCanvasSrc()&&(n=Sk.Rect.makeCopy(r)),Sk.Rect.isEmpty(l)||(g.isUntiled()||g.useSingleRasterTile()?(o=e,a=t):(c=x(),o=c.width,a=c.height),i.invalidateRect(l,"resize")))},i.drawRect=function(e,t,r){return Sk.Rect.isIntRect(e),i.drawTilesInRect(e,I.curry(t,r))},i.playback=function(t,r,n,o){return e.delta_mode,i.drawTilesInRect(r,D.curry(t,n,o))},i.release=function(){i.freeTiles(),r=Sk.Rect.makeEmpty(),t&&t.parentNode&&(t.parentNode.removeChild(t),t=null),u=null},i.updateProjection=function(){i.forEachAllocatedTileInRect(r,(function(e){b(e)&&w(e)}))},i.updateClip=function(e){(u||e)&&(u&&e&&Sk.Rect.isEqual(u,e)||(u=e?Sk.Rect.makeCopy(e):null,i.forEachAllocatedTileInRect(r,(function(e){b(e)&&C(e)}))))},i.updateOpacity=function(){i.forEachAllocatedTileInRect(r,(function(e){b(e)&&T(e)}))},i.getLayer=function(){return g},i.getRasterTileSize=function(){return{width:o,height:a}},e.delta_mode,(t=document.createElement("div")).style.transformStyle="inherit",i.resize(0,0,"init")},Compositor.Input=function(e,t){var r,n,i,o,a,s,l,c,d=new Logger("r2-input",{level:"info"}),u=this,f=t.getMainFrame(),p=!1,g=Object.freeze({kClosed:0,kOpened:1}),m={x:0,y:0,type:""},_={x:0,y:0,fid:f.getFid()},h=new KeyMap,y=new ShortcutKeyHandler(e),v=null,k=null,S=null,b=0,w={last_click_time:0,last_mouse_time:0,last_key_time:0},C={},T=!1,E=f.getFid(),A=f.getFid(),R=f.getFid(),x={},D=null;function I(t){e.surrogate_channel&&e.surrogate_channel.send.apply(e.surrogate_channel,t)}function O(){return e.ctx_menu_mode&&e.ctx_menu_mode.backend_driven}function U(e){return!!Util.findPredicateOnBranch(e.target,(function(e){return e.getAttribute&&!!e.getAttribute("sv-prevent-push")}))}function M(e){if(O()&&(2===e.button||BrowserDetect.isMac()&&0===e.button&&e.ctrlKey))return U(e);if(1===e.button||2===e.button)return!0;if(BrowserDetect.isMac()&&0===e.button){if(e.ctrlKey)return!0;if(e.metaKey)return!0}return!!e.__sv_synthesized_s_click||U(e)}function F(e){var t=e.target,r=e.type;return!(!t||!t.opening_text_data_list_chooser||"mousedown"!==r&&"mouseup"!==r&&"click"!==r)}function P(){return _.fid}function L(e){e.type,e.button,function(e){return!M(e)&&!F(e)&&"click"===e.type}(e)?e.preventDefault():(M(e)&&e.stopPropagation(),"click"===e.type&&("select"===e.target.tagName.toLowerCase()?(function(e){var t=e.target.node_id,r=P(),n=e.type;I(["CM-simulate-event",r,t,String(n)])}(e),e.target.hasAttribute("sv-active")?e.target.removeAttribute("sv-active"):e.target.setAttribute("sv-active","")):BrowserDetect.isSafari()&&e.target.hasAttribute("sv-base-temporal")&&e.target.setAttribute("sv-picker-state",g.kOpened)))}function N(e,t,r,n,i,o){var a=e?EventListener.addListener:EventListener.removeListener;r.forEach((function(e){a(t,e,n,!!i,!!o)}))}function B(e){var t=e.target.value,r=e.target.node_id;I(["CM-select",P(),r,Number(t)])}function H(e){e.target.hasAttribute("sv-active")&&13===e.keyCode?e.target.removeAttribute("sv-active"):e.target.hasAttribute("sv-active")||38!==e.keyCode&&40!==e.keyCode||e.target.setAttribute("sv-active","")}function V(e){e.node_id;var t=e.items,r=null,n=null;e.textContent="",t.forEach((function(t){switch(t.type){case"separator":(r=document.createElement("option")).textContent="-----",r.setAttribute("disabled",!0),e.appendChild(r),n=null;break;case"group":(r=document.createElement("optgroup")).setAttribute("label",t.label),e.appendChild(r),n=r;break;case"option":(r=document.createElement("option")).textContent=t.label,r.setAttribute("value",t.index),t.checked&&r.setAttribute("selected",!0),t.enabled||r.setAttribute("disabled",!0),t.hidden&&(r.setAttribute("hidden",!0),r.style.display="none",r.style.visibility="hidden"),t.in_group?n.appendChild(r):(n=null,e.appendChild(r));break;default:d.error({event:"tc-unrecognized-select-item-type",type:t.type})}}))}function W(e){var r=e.target,n=e.type;"change"===n&&r.hasAttribute("sv-picker-state")&&r.setAttribute("sv-picker-state",g.kClosed),r.hasAttribute("sv-datalist")&&(r.opening_text_data_list_chooser=!1),t.sendCommand([n,r.frame_id,r.node_id,r.value])}function z(e,r){var n,i,o,a,s=r.node_id,l=r.viewport_bounds;return a=r.type,BrowserDetect.isIE()||(BrowserDetect.isSafari()||BrowserDetect.isFirefox())&&("month"===a||"time"===a||"week"===a)?null:(l=t.toScreenBounds(e,l))?((n=document.createElement("input")).node_id=s,n.frame_id=e,n.style.position="fixed",n.style.opacity="0",n.style.cursor="inherit",n.setAttribute("type",r.type),Sk.Rect.toCSSStyle(l,n.style),r.is_base_temporal?(n.setAttribute("sv-picker-state",g.kClosed),n.setAttribute("sv-base-temporal",!0),BrowserDetect.isSafari()&&n.setAttribute("sv-prevent-push",!0),["value","min","max"].forEach((function(e){r.hasOwnProperty(e)&&n.setAttribute(e,r[e])}))):r.is_color?(n.setAttribute("sv-picker-state",g.kClosed),n.setAttribute("value",Sk.Paint.rgbToHexadecimalColor(r.red,r.green,r.blue))):(r.data_list,n.setAttribute("sv-datalist","")),r.data_list&&(i=document.createElement("datalist"),r.data_list.options.forEach((function(e){var t=e.flags,r=document.createElement("option");t&Sk.HT.DataListOptionItem.Flags.kDisabled&&r.setAttribute("disabled",!0),t&Sk.HT.DataListOptionItem.Flags.kHasValue&&r.setAttribute("value",e.value),i.appendChild(r)})),o=e+":"+r.data_list.node_id,i.id=o,n.appendChild(i),n.setAttribute("list",o)),n):null}function G(t,r){var n,o,a,s={user_initiated:!0,uri:r,target_uri:Util.rewriteRawHref(r)};if(!BrowserDetect.isIE())return(a=new window.MouseEvent("click",{bubbles:!0,shiftKey:!0,button:0})).__sv_synthesized_s_click=!0,o=t||i,void(window.navigator.userActivation&&window.navigator.userActivation.isActive?o.dispatchEvent(a):(s.new_window_cb=function(e){"allow"===e&&o.dispatchEvent(a)},e.ui_frame.call("showPopupOpenModal",s)));n=["innerWidth","innerHeight","screenX","screenY"].reduce((function(e,t){return window[t]?e+","+t+"="+window[t]+"px":e}),"toolbar,location,scrollbars,menubar,resizable"),s.feature_str=n,e.tab.openTabWithInfo(s)}function j(e,r){var n,i,o,a=t.getLthForFrame(e);return(o=a?a.hitTest(Compositor.HitTest.kEventTarget,r):null)?(i=o.getLayer(),(n=o.hitsImageNode())?function(e,t){var r,n,i,o=[e];return(r=new Compositor.ShadowImageNode).layer=t,r.init(o),n=r.getNode(),r.release(),n.style.position="fixed",i=t.toScreenSpaceRect(e.visual_rect),Sk.Rect.toCSSStyle(i,n.style),n}(n,i):null):null}function Y(t,r){var n,i,o,a,s,l;return t.select_items&&t.select_items.length?(o=t.node_id,a=t.select_items,s=t.viewport_bounds,(l=document.createElement("select")).node_id=o,l.items=a,l.setAttribute("sv-prevent-push",!0),l.style.position="fixed",l.style.left=Sk.Rect.getLeft(s)+"px",l.style.top=Sk.Rect.getTop(s)+"px",l.style.width=Sk.Rect.getWidth(s)+"px",l.style.height=Sk.Rect.getHeight(s)+"px",BrowserDetect.isSafari()&&(l.style.webkitAppearance="none"),l.style.opacity="0",l.style.cursor="inherit",V(l),N(!0,l,["change"],B,!1),N(!0,l,["keyup"],H,!0),n=l):t.url&&!O()?n=function(t){var r=document.createElement("a"),n=document.createElement("div");return n.style.position="fixed",n.style.left=Sk.Rect.getLeft(t.viewport_bounds)+"px",n.style.top=Sk.Rect.getTop(t.viewport_bounds)+"px",n.style.width=Sk.Rect.getWidth(t.viewport_bounds)+"px",n.style.height=Sk.Rect.getHeight(t.viewport_bounds)+"px",r.style.cursor="inherit",r.href=Util.rewriteRawHref(t.url),r.appendChild(n),t.link_target_blank?EventListener.addListener(r,"click",(function(r){e.tab.tabPreOpen(t.url)&&r.preventDefault()}),!1):EventListener.addListener(r,"click",(function(r){r.ctrlKey&&e.tab.tabPreOpen(t.url)&&r.preventDefault()})),r}(t):t.extra_input&&t.extra_input.type&&(n=z(t.frame_id,t.extra_input)),i=j(t.frame_id,r),n?i&&i instanceof HTMLImageElement&&n.appendChild(i):n=i,t.title&&(n||(n=function(e){var t=document.createElement("div");return t.style.position="fixed",t.style.left=Sk.Rect.getLeft(e.viewport_bounds)+"px",t.style.top=Sk.Rect.getTop(e.viewport_bounds)+"px",t.style.width=Sk.Rect.getWidth(e.viewport_bounds)+"px",t.style.height=Sk.Rect.getHeight(e.viewport_bounds)+"px",t.style.backgroundColor="teal",t.style.opacity="0",t}(t)),function(e,t){var r;t.title&&(e.hasAttribute("sv-base-temporal")&&BrowserDetect.isChrome()||((r=document.createElement("div")).style.display="none",r.style.position="fixed",r.style.maxWidth="200px",r.style.backgroundColor="gray",r.style.background="radial-gradient(circle, rgba(79,83,83,1) 0%, rgba(107,106,105,1) 100%)",r.style.color="white",r.style.font="10px sans-serif",r.style.padding="5px",r.style.border="1px white",r.style.borderRadius="2px",r.textContent=t.title,document.body.appendChild(r),e.tt=r,e.tt_timer||(e.tt_timer=setTimeout((function(){e.tt&&(e.tt.style.display="block",e.tt.style.left=m.x+"px",e.tt.style.top=m.y+20+"px",e.tt_timer=null)}),500))))}(n,t)),n}function X(e){i instanceof HTMLImageElement||(N(e,i,["mousedown","mouseup","click"],L,!1),(i.hasAttribute("sv-picker-state")||i.hasAttribute("sv-datalist"))&&N(e,i,["change","input"],W,!1))}function q(){i&&i.tt&&i.tt.parentNode&&(i.tt.parentNode.removeChild(i.tt),i.tt_timer&&(clearTimeout(i.tt_timer),i.tt_timer=null),i.tt=null)}function K(){return!!i&&(q(),i.parentNode.removeChild(i),X(!1),i=null,!0)}function Q(e,t){var r;r=function(e){var t,r="default";return e.url?r="pointer":(e.is_text||e.is_editable)&&(r="text"),"auto"!==(t=e.cursor_name)&&(r=t),r}(t),document.documentElement.style.cursor=r,function(e,t){var r;K(),v=t,(r=Y(t,e))&&(document.body.appendChild(r),i=r,X(!0))}(e,t)}function J(){a&&(clearTimeout(a),a=null,I(r),r=null,n=null)}function Z(e){return BrowserDetect.isIE()&&("mousedown"===e.type||"mouseup"===e.type||"mousemove"===e.type)&&e.detail>=4&&e.detail>b?b:e.detail}function $(){var e;c&&(c=null,(e=t.getLthForFrame(E))&&e.getScrollDelegate().doScroll(Compositor.GestureType.kScrollEnd),E=f.getFid())}function ee(e,t,r){r.fid=e,r.x=t.x,r.y=t.y}function te(o){var l,u,h,y,v,k=MetricsUtils.clientToScreenPos(o.clientX,o.clientY),S={fid:f.getFid(),x:k.x,y:k.y},T=t.getConfig().getEnableDisplayListDeltaForDrag();if("mousedown"===o.type&&(o.shiftKey&&(e.interp.hasOpcodeHandler("WINDOW_new")&&e.interp.deregisterOpcodeHandler("WINDOW_new"),e.interp.registerOpcodeHandler("WINDOW_new",G.curry(o.target))),e.clipboard.piggyback(o),e.callback.fire("interaction",o),q()),function(e){!BrowserDetect.isIE()||"mousedown"!==e.type&&"mouseup"!==e.type&&"mousemove"!==e.type||("mousedown"===e.type?(b+=1,s&&(clearTimeout(s),s=null)):"mouseup"===e.type&&(s=setTimeout((function(){b=0}),500)))}(o),e.detached)e.prevent_reattach||(e.detached=!1,Util.xframe_reload());else if(w.last_mouse_time=Date.now(),$(),o.type,k.x,k.y,Util.getMouseAndKeyboardModifiers(o,d),o.button,Z(o),Util.get_node_tag(o.target),!t.in_page_searcher.mouse_event_search_input(o)&&!U(o)){if("mousemove"===o.type&&i){if(BrowserDetect.isChromiumEdge()&&i.hasAttribute("sv-active"))return;if(Number(i.getAttribute("sv-picker-state"))===g.kOpened)return;if(i.opening_text_data_list_chooser)return}if("contextmenu"!==o.type){if("mousemove"!==o.type||"mousemove"!==m.type||k.x!==m.x||k.y!==m.y){var E,R,x;switch(m.x=_.x=k.x,m.y=_.y=k.y,m.type=o.type,E=m.x,R=m.y,(x=document.getElementById("sv-drag-img"))&&(x.style.left=E+"px",x.style.top=R+"px"),t.findTargetAndCallback(k,(function(e,r){return ee(e,r,S),ee(e,r,_),function(e,r,n){var i=t.getLthForFrame(r),o=e.target;i&&"mousedown"===e.type&&o.hasAttribute("sv-datalist")&&i.hitTestLayerTree(n,(function(e,t){var r=e.getHitTestResultAt(t);return!(!r||!r.hitsDataListIndicatorElement()||(o.opening_text_data_list_chooser=!0,0))}))}(o,e,k),!0})),y=function(e,r,n){var i,o,a,s=t.getLthForFrame(e),l={type:Compositor.PointerResultType.kUnhandled};if(!s)return Compositor.ScrollAction.kNoAction;switch(o=s.getScrollbarController(),a=s.getScrollDelegate(),n.type){case"mousedown":0===n.button&&(l=o.handlePointerDown(r,n.shiftKey||n.ctrlKey));break;case"mouseup":0===n.button&&(l=o.handlePointerUp(r));break;case"mousemove":l=o.handlePointerMove(r)}return"mousemove"===n.type&&A!==e&&(i=t.getLthForFrame(A))&&i.getScrollDelegate()&&i.getScrollbarController()&&i.getScrollbarController().scrollbarScrollIsActive()&&(o=i.getScrollbarController(),a=i.getScrollDelegate(),l=o.handlePointerUp(r)),l.type===Compositor.PointerResultType.kScrollbarScroll?(n.__sv_mouse_event_handled=!0,A=e,a.onPointerEventScrollResult(r,l)):Compositor.ScrollAction.kNoAction}(S.fid,k,o)){case Compositor.ScrollAction.kNoAction:break;case Compositor.ScrollAction.kForwardToSurrogate:case Compositor.ScrollAction.kForwardToNextFrame:d.warn({event:"scrollbar-scroll",details:"unexpected scroll action",action:y}),o.preventDefault();break;case Compositor.ScrollAction.kPreventNativeScroll:o.preventDefault();default:o.__sv_scrollbar_scrolled=!0}o.__sv_mouse_event_handled||(o.__sv_set_foreground=document.hasFocus(),v=Util.getMouseAndKeyboardModifiers(o,d),l=["CM-mouse",S.fid,o.type,k.x,k.y,S.x,S.y,o.button,v,Z(o)],fe(),c&&(clearTimeout(c),c=null),"mousemove"===o.type&&(!p&&o.buttons&&T&&(p=!0,t.requestDisplayListDelta(!0)),u=Util.calculateMouseMovement(o),n&&(u.x+=n.x,u.y+=n.y),l.push(u.x),l.push(u.y)),"mousemove"!==o.type||o.buttons?(p&&T&&"mouseup"===o.type&&(p=!1,t.requestDisplayListDelta(!1),t.callback.fire("partial-dl-drag-end")),J(),I(l)):(a||(a=setTimeout((function(){J()}),10)),r=l,n=u),function(e){return"mousedown"===e.type||"mouseup"===e.type}(o)&&(C[o.button]={is_down:!1,modifiers:v},"mousedown"===o.type&&(C[o.button].is_down=!0),w.last_click_time=Date.now(),F(o)||o.preventDefault(),BrowserDetect.isIE()&&"mousedown"===o.type&&(h=document.activeElement,document.body.focus(),h&&h.focus())))}}else O()&&o.preventDefault()}}function re(t){"html"===Util.get_node_tag(t.target)&&delete e.last_mouse_pos}function ne(t,r,n,i,o,a,s,l){i.relative_to_target=!1,e.surrogate_channel.send("drag",t,{t:r,y:n,p:i,m:o,d:a,f:s,i:l})}function ie(){k&&(ne(k.frame,k.node,"dragleave",{x:0,y:0},{x:0,y:0},0,[{type:"text/plain"}],{0:{}}),k=null,S=null)}function oe(r){var n,i,o,a,s,l,c,u,p=MetricsUtils.clientToScreenPos(r.clientX,r.clientY),g={fid:f.getFid(),x:p.x,y:p.y};if(e.allow_backend_dragdrop)if(t.findTargetAndCallback(p,(function(e,t){return ee(e,t,g),!0})),r.__sv_set_foreground=document.hasFocus(),v){if(s=g.fid,l=v.node_id,a=r.type,r.preventDefault(),"drop"===a){if(e.copy_paste_ctrl.enforce_on_user_action(r.target,r))return;e.upload.setupDroppedUpload(r.dataTransfer.files)}n={x:r.clientX,y:r.clientY,wx:g.x,wy:g.y},i=Util.calculateDragMovement(r),o=Util.getMouseAndKeyboardModifiers(r,d),c=Util.gen_dragdrop_file_list(r.dataTransfer),u=r.dataTransfer.items,k&&l===k.node||(ne(s,l,"dragenter",n,{x:0,y:0},o,c,u),k&&ne(k.frame,k.node,"dragleave",n,{x:0,y:0},o,c,u)),ne(s,l,a,n,i,o,c,u),"drop"!==a?(k={frame:s,node:l},S&&clearTimeout(S),S=setTimeout(ie,550)):k=null}else I(["CM-mouse",g.fid,"mousemove",r.clientX,r.clientY,g.x,g.y,r.button,Util.getMouseAndKeyboardModifiers(r,d),r.detail])}function ae(r){var n,i=h.getKeyCode(r),o=r.keyCode,a=r.ctrlKey,s=r.shiftKey,l=r.metaKey,c=r.altKey,d=!1;e.detached?e.prevent_reattach||(e.detached=!1,Util.xframe_reload()):(w.last_key_time=Date.now(),r.type,r.keyCode,r.charCode,n=y.get_operation(r),"keydown"!==r.type||t.in_page_searcher.is_search_focused()||(e.clipboard.piggyback(r),e.callback.fire("interaction",r),"copy"===n||"cut"===n?t.selection.preprocess_ctrl_c_or_ctrl_x(n):"paste"===n?t.selection.on_paste_keypress(r,!1):"specialPaste"===n?t.selection.on_paste_keypress(r,!0):"selectAll"!==n&&"undo"!==n&&"redo"!==n||r.preventDefault()),e.callback.fire("key-event",r.target,r),e.print_handler.handlePrintKeyEventIfNeeded(r,n)||(o=Util.get_corresponding_chrome_keycode(r,o),"keypress"===r.type&&r.altKey&&(BrowserDetect.isIE()||RegExp("^.$","u").test(r.key))&&(a=!1,l=!1,c=!1,d=!0),"keyup"!==r.type&&!d&&y.tryProcess(r)||t.in_page_searcher.is_key_event_search_input(r)||U(r)||(I(["kbd",R||f.getFid(),0,r.type,o,r.charCode,i,h.getCode(r),s,a,c,l,0,!1]),e.key_ctrl.should_prevent_default(D,D&&x.hasOwnProperty(D)?x[D]:null,r.type,o,a,s,c,l)?r.preventDefault():function(e,t,r,n){return t||r||n||"keydown"===e.type&&!h.SPECIAL_KEYS.hasOwnProperty(e.keyCode)}(r,l,a,c)&&!t.in_page_searcher.is_search_operation(r)||r.preventDefault())))}function se(r){var n,i,o,a=void 0===r.deltaX?0:Math.round(r.deltaX),s=void 0===r.deltaY?0:Math.round(r.deltaY),u=void 0===r.wheelDeltaX?-3*a:r.wheelDeltaX,p=void 0===r.wheelDeltaY?-3*s:r.wheelDeltaY,g=e.xbrowser.getEventTarget(r),m=MetricsUtils.clientToScreenPos(r.clientX,r.clientY),_={fid:f.getFid(),x:m.x,y:m.y},h=f.getScrollDelegate(),y=new Compositor.ScrollState(Compositor.EventType.kWheel,Compositor.Offset.makeXY(m.x,m.y),Compositor.Offset.makeZero()),v=new Compositor.ScrollState(Compositor.EventType.kWheel,Compositor.Offset.makeXY(m.x,m.y),Compositor.Offset.makeXY(a,s)),k=m;if(g){if(g.getAttribute&&(r.__sv_set_foreground=document.hasFocus(),function(e){var r=MetricsUtils.clientToScreenPos(e.clientX,e.clientY),n={fid:f.getFid(),x:r.x,y:r.y},i=e.button,o=Util.getMouseAndKeyboardModifiers(e,d);assert_unimplemented(0===i,"non-zero button for wheel"),K(),l&&clearTimeout(l),t.findTargetAndCallback(r,(function(e,t){return ee(e,t,n),!0})),l=setTimeout((function(){I(["CM-mouse",n.fid,"mousemove",r.x,r.y,n.x,n.y,i,o,0,0,0]),l=null}),100)}(r),!U(r))){if(c?(clearTimeout(c),i=t.getLthForFrame(E),(o=t.getSurfaceLayerForFrame(E))&&(k=o.hitTestPoint(m)),k&&i?(h=i.getScrollDelegate(),ee(E,k,_),n=h.doScroll(Compositor.GestureType.kScrollUpdate,v),c=setTimeout((function(){$()}),100)):($(),n=Compositor.ScrollAction.kNoAction,c=null)):(t.findTargetAndCallback(m,(function(e,r){var o;return!(!(i=t.getLthForFrame(e))||(h=i.getScrollDelegate(),(n=h.doScroll(Compositor.GestureType.kScrollBegin,y))===Compositor.ScrollAction.kRequiresMainThreadHitTest&&(h.doScroll(Compositor.GestureType.kScrollEnd),y.reset(),(o=i.hitTest(Compositor.HitTest.kScrollableContainerId,m))&&(y.setHasMainThreadHitTestedReasons(),y.setTargetElementId(o.data.scrollable_container_id),n=h.doScroll(Compositor.GestureType.kScrollBegin,y))),n===Compositor.ScrollAction.kForwardToNextFrame?(h.doScroll(Compositor.GestureType.kScrollEnd),y.reset(),1):(n=h.doScroll(Compositor.GestureType.kScrollUpdate,v))===Compositor.ScrollAction.kForwardToNextFrame?(h.doScroll(Compositor.GestureType.kScrollEnd),y.reset(),v.reset(),1):(E=e,ee(e,r,_),0)))})),c=setTimeout((function(){$()}),100)),m.x,m.y,fe(E,m),n===Compositor.ScrollAction.kForwardToSurrogate)return r.__sv_wheel_default_prevented=h.didHandlerPreventDefault(Compositor.EventType.kWheel),I(["CM-wheel",_.fid,m.x,m.y,_.x,_.y,a,s,u,p,!0,Util.getMouseAndKeyboardModifiers(r,d)]),void r.preventDefault();n===Compositor.ScrollAction.kPreventNativeScroll&&r.preventDefault(),h.getLth().hasEventListener(Compositor.EventType.kWheel)&&I(["CM-wheel",_.fid,m.x,m.y,_.x,_.y,a,s,u,p,!1,Util.getMouseAndKeyboardModifiers(r,d)])}}else d.error({event:"tc-wheel-event-error",reason:"invalid target"})}function le(e){var t=e?EventListener.addListener:EventListener.removeListener;t(document,"mousemove",te,!1),t(document,"mousedown",te,!1),t(document,"contextmenu",te,!1),t(document,"mouseup",te,!1),t(document,"mouseout",re,!1)}function ce(e){var t=e?EventListener.addListener:EventListener.removeListener;t(document,"dragover",oe,!1),t(document,"drop",oe,!1)}function de(t){var r=t?EventListener.addListener:EventListener.removeListener;r(document,"keydown",ae,!1),r(document,"keypress",ae,!1),r(document,"keyup",ae,!1),e.print_handler.attachKeyEventHandler(t)}function ue(e,t){o&&(EventListener.removeListener.apply(Util,o),o=null),e&&(o=[document,"wheel",se,!1,t],EventListener.addListener.apply(Util,o))}function fe(e,r){var n;e=e||_.fid,r=r||m,(n=(t.getLthForFrame(e)||f).getScrollDelegate().willScrollNatively(Compositor.EventType.kWheel,r))===T&&o||ue(!0,T=n)}e.interp.registerOpcodeHandler("htr",(function(e,r,n,i,o,a,s,l,c,d,u,f){var p={is_text:r,is_selected:n,is_editable:i,url:o,link_target_blank:a,cursor_name:s,frame_id:e,title:l,node_id:c,viewport_bounds:t.toScreenBounds(e,d),select_items:u,extra_input:f};Q(m,p),t.selection.onHitTestResult(p)})),e.interp.registerOpcodeHandler("show-picker",(function(){i&&i.hasAttribute("sv-picker-state")&&(i.setAttribute("sv-picker-state",g.kOpened),i.showPicker())})),e.interp.registerOpcodeHandler("drag-start",(function(e){var t=document.getElementById("sv-drag-img"),r=m.x+"px",n=m.y+"px",i="data:image/png;base64,"+e;t||((t=document.createElement("img")).setAttribute("id","sv-drag-img"),t.src=i,t.style.position="fixed",t.style.opacity="0.7",t.style.filter="drop-shadow(0px 0px 4px gray)",t.style.left=r,t.style.top=n,t.style.transformOrigin="0px 0px 0px",t.style.transform="scale("+1/Util.getDeviceScaleFactor()+")",document.body.appendChild(t))})),e.interp.registerOpcodeHandler("drag-stop",(function(){var e=document.getElementById("sv-drag-img");e&&e.parentNode&&e.parentNode.removeChild(e)})),e.interp.registerOpcodeHandler("did_wh_pd",(function(e,r){t.wheelHandlerStateChanged(e,r)})),u.didUpdateDisplayList=function(e){var t,r,n,o,a;i&&"select"===(t=Util.get_node_tag(i))&&(r=i.getBoundingClientRect(),r=Sk.Rect.fromLTRB(r.left,r.top,r.right,r.bottom),(r=e.fromScreenSpaceRect(r))&&(o=(n=e.getDisplayList())?n.hitTestRect(r):null)&&"select"===t&&(i.node_id,i.items,(a=o.hitsFormControlNode())&&Number(a.data.node_id)===i.node_id&&a.data.formctrl.type===Sk.HT.FormControlElement.Type.kSelect&&function(e,t){var r=e.items,n=[];t.forEach((function(e){var t={};switch(t.checked=!!(e.flags&Sk.HT.SelectItem.Flags.kChecked),t.enabled=!!(e.flags&Sk.HT.SelectItem.Flags.kEnabled),t.hidden=!!(e.flags&Sk.HT.SelectItem.Flags.kHidden),t.in_group=!!(e.flags&Sk.HT.SelectItem.Flags.kInGroup),t.index=e.index,t.label=e.label,t.tool_tip=e.tool_tip,e.type){case Sk.HT.SelectItem.Type.kSeparator:t.type="separator";break;case Sk.HT.SelectItem.Type.kGroup:t.type="group";break;case Sk.HT.SelectItem.Type.kOption:t.type="option";break;default:t.type="local-htd-unknown"}n.push(t)})),JSON.stringify(n)!==JSON.stringify(r)&&(e.items=n,V(e))}(i,a.data.formctrl.select.items)))},u.getLastMousePos=function(){return{x:m.x,y:m.y}},u.getLastActivityTime=function(){return{key:w.last_key_time,mouse:w.last_mouse_time,click:w.last_click_time,input:Math.max(w.last_key_time,w.last_mouse_time)}},u.release=function(){ce(!1),de(!1),ue(!1),le(!1)},ce(!0),de(!0),fe(),e.interp.registerOpcodeHandler("focus_changed",(function(e,t,r){switch(r){case"n":x[e]=t;break;case"f":x[e]=t,D=e}})),t.callback.register("wheel-handler-state-changed",fe),t.callback.register("wheel-event-listener-changed",fe),t.callback.register("scroll-container-scrolled",(function(){Util.forEachItem(C,(function(e,t){t.is_down&&(t.is_down=!1,I(function(e,t,r,n,i,o,a,s,l,c,d){var u=["CM-mouse",t,"mouseup",r,n,i,o,a||0,s||0,0];return u}(0,_.fid,m.x,m.y,_.x,_.y,Number(e),t.modifiers)))}))})),t.callback.register("input-focused",(function(e){R=e})),le(!0)},Compositor.IME=function(e){var t,r,n,i,o,a=!1,s=!1,l=!1,c=0,d=0;function u(e){switch(e){case"compositionstart":return 0;case"compositionupdate":return 1;case"compositionend":return 2}}function f(){return t.value.substring(d)}function p(){var e,o;e=r+0,BrowserDetect.isIE()||BrowserDetect.isEdge()||(e-=20),o=n+0,t.style.top=o+i-12+"px",t.style.height="12px",t.style.left=e+"px",(BrowserDetect.isIE()||BrowserDetect.isEdge())&&(t.style.padding="0px",t.style.height="0px")}function g(){a=!1,c=0,l&&(p(),l=!1)}function m(r){switch(r.type,r.data,r.type){case"compositionend":r.data,e.surrogate_channel.send("composition",2,r.data,r.data.length),o=null,d=t.value.length,g(),s=!0,setTimeout((function(){s=!1}),0);break;case"compositionstart":case"compositionupdate":a=!0,(o={}).data=r.data,o.type=u(r.type);break;case"selectionchange":o&&(o.type,o.data,e.surrogate_channel.send("composition",o.type,o.data,t.selectionEnd-d),o=null);break;case"textInput":if(a||s)break;r.data,e.surrogate_channel.send("composition",0,r.data,0),r.data,e.surrogate_channel.send("composition",2,r.data,r.data.length),g(),r.preventDefault()}}function _(r){var n,i,o,s,m;switch(r.type,r.data,f(),t.selectionEnd,r.type){case"compositionend":Util.is_korean_char(r.data)?(m=r.data,e.surrogate_channel.send("composition",2,m,m.length),d=t.value.length,g()):(s=(s=f()).substring(c,s.length),e.surrogate_channel.send("composition",2,s,s.length),d=t.value.length,g()),a=!1;break;case"compositionstart":case"compositionupdate":a=!0,i=(n=function(){var e,n,i,o,a=r.data,s=f(),l=t.selectionEnd-d;if(DEBUG,!a)return f(),{finalized_text:"",transient_text:f()};for(n=l-1,i=a.length-1;n>=c&&a[i]===s[n];)n-=1,i-=1;return e=c,c=n+1,o={finalized_text:s.substring(e,c),transient_text:s.substring(c,s.length)},JSON.stringify(o),o}()).finalized_text,o=n.transient_text,i&&(e.surrogate_channel.send("composition",1,i,i.length),e.surrogate_channel.send("composition",2,i,i.length)),o&&(u(r.type),e.surrogate_channel.send("composition",u(r.type),o,o.length)),i&&l&&(BrowserDetect.isIE()||BrowserDetect.isEdge())&&(p(),l=!1);break;case"selectionchange":a&&(f(),e.surrogate_channel.send("composition",1,f(),t.selectionEnd-d))}}function h(r){switch(r.type,r.data,r.type){case"compositionend":r.data,e.surrogate_channel.send("composition",2,r.data,r.data.length),o=null,d=t.value.length,g();break;case"compositionstart":case"compositionupdate":a=!0,(o={}).data=r.data,o.type=u(r.type);break;case"input":o?(o.type,o.data,e.surrogate_channel.send("composition",o.type,o.data,t.selectionEnd-d),o=null):a&&(f(),e.surrogate_channel.send("composition",1,f(),t.selectionEnd-d))}}e.interp.registerOpcodeHandler("caret_pos",(function(e,o,s,c){var u=o===n;DEBUG,a&&u&&(l=!0),r=e,i=c-(n=o),t||t||(t=document.createElement("input"),d=0,t.id="ime_overlay",t.setAttribute("type","text"),t.style.position="fixed",t.style.opacity=0,t.style.backgroundColor="yellow",t.style.width="100px",t.style.borderWidth="0px",t.style.paddingLeft="0px",t.style.pointerEvents="none",t.disabled=!0,t.style.paddingLeft="20px",t.style.letterSpacing="-1em",document.body.appendChild(t),function(){var e,r,n,i={Chrome:["selectionchange","textInput"],Safari:["selectionchange","textInput"],Explorer:["selectionchange"],Firefox:["input"],Edge:[],Other:[]},o={Chrome:m,Safari:m,Explorer:_,Firefox:h,Edge:_,Other:m},a=browser.name;for("ChromiumEdge"===a&&(a="Chrome"),e=(e=i[a]||i.Other).concat(["compositionstart","compositionupdate","compositionend"]),r=o[a]||o.Other,n=0;n<e.length;n+=1)"selectionchange"===e[n]?EventListener.addListener(document,e[n],r,!0):EventListener.addListener(t,e[n],r,!0)}()),l||(u||a||(t.value="",d=0),p())})),e.interp.registerOpcodeHandler("ready_for_input",(function(e){var r;t&&!a&&(e?(t.disabled=!1,document.activeElement===t||(r=document.activeElement)&&r.opening_text_data_list_chooser||t.focus()):t.disabled=!0)}))},Compositor.Selection=function(e,t){var r,n,i,o=this,a=!1,s=!1,l=!1,c=!1,d={},u=null,f=!1,p=null,g=null,m=!1,_=!1;function h(){a||s?(r||((r=document.createElement("div")).style.position="fixed",r.style.opacity=0,r.style.backgroundColor="blue",r.style.height="10px",r.style.width="10px",r.style.borderWidth="0px",r.style.overflow="clip",document.body.appendChild(r),n=function(e){r.style.left=d.is_editable||d.is_selected?e.clientX-5+"px":e.clientX+5+"px",r.style.top=e.clientY-5+"px"},EventListener.addListener(document,"mousemove",n,!1,!0),EventListener.addListener(document,"mousedown",n,!1)),m&&(r.style.display="none"),r.contentEditable=s,r.style.textIndent=a||!BrowserDetect.isIE()?"0px":"-99999px"):r&&(r.parentNode.removeChild(r),r=void 0,EventListener.removeListener(document,"mousemove",n,!1),EventListener.removeListener(document,"mousedown",n,!1),n=void 0)}function y(t){var r=null,n=null;u&&(r=u.text,n=u.html),e.clipboard.copy_event_handler(t,r,n)}function v(){p&&(p.focus&&p.focus(),p=null)}function k(e){e!==a&&(a=e,h())}function S(){var e,t;r&&(u?(r.textContent=u.text,(e=document.createRange()).selectNodeContents(r),(t=window.getSelection()).removeAllRanges(),t.addRange(e)):r.textContent="")}function b(t){var r,n,i,o=d.frame_id||1,a=d.node_id||1;e.copy_paste_ctrl.enforce_on_user_action(t.target,t)||(r=e.copy_paste_ctrl.has_paste_restriction(),g&&(clearTimeout(g),g=null),c&&e.surrogate_channel.send("pre-paste"),n=function(t,n,i){var s;for(r&&Util.filterPasteDataList(i),s=0;s<i.length;s+=2)"file_obj_list"===i[s+1]&&(e.upload.setupDroppedUpload(i[s]),i[s]="placeholder");e.surrogate_channel.send("paste",o,a,i,t,n)}.curry(l,c),i=function(t){t&&e.surrogate_channel.send("empty-paste")}.curry(c),Util.makePasteDataList(t,window,n,i),l=!1,c=!1,t.preventDefault())}function w(e){e!==s&&(s=e,h())}o.onHitTestResult=function(e){r&&d.is_selected!==e.is_selected&&e.is_selected&&S(),d=e,e.is_selected?k(!0):u||k(!1),e.is_editable?w(!0):f||w(!1)},o.disable=function(){m=!0,r&&(r.style.display="none")},o.enable=function(){m=!1,r&&(r.style.display="")},o.preprocess_ctrl_c_or_ctrl_x=function(e){"cut"===e&&(_=!0),BrowserDetect.isIE()&&u&&r&&document.activeElement!==r&&(p=document.activeElement,S())},o.on_paste_keypress=function(e,t){l=!!t,c=!0,BrowserDetect.isIE()&&(g=setTimeout((function(){b(e)}),200))},o.getOverlayForTest=function(){return r},e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_SET_SELECTIONS,(function(e,t){(u=JSON.parse(t)).text?(k(!0),S(),i=e):(k(!1),u=null,S(),i=void 0)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_FOCUS_ELEMENT,(function(e,r,n){n&&(f=!0,w(!0)),t.callback.fire("input-focused",e)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_FOCUS_OUT,(function(e,t,r){r&&!d.is_editable&&(w(!1),f=!1)})),EventListener.addListener(document,"paste",b,!1),EventListener.addListener(document,"copy",(function(t){e.copy_paste_ctrl.enforce_on_user_action(t.target,t)||(y(t),v())}),!1),EventListener.addListener(document,"cut",(function(t){e.copy_paste_ctrl.enforce_on_user_action(t.target,t)||(y(t),void 0===i||_||e.surrogate_channel.send("execcmd",i,"cut"),_=!1,v())}),!1),EventListener.addListener(document,"contextmenu",(function(t){e.copy_paste_ctrl.enforce_on_user_action(t.target,t)||S()}),!1)},Compositor.Extras=function(e){function t(e){document.title=e}function r(t){e.stats.stop("t_tdl"),e.stats.stop("t_tnl"),e.callback.fire("dom-loaded",{mode:"r2",fs:Util.getFramingStatus(),pxy:window.TPROXY_ENABLED?1:0,has_first_commit:t})}this.init=function(){e.interp.registerOpcodeHandler("set_title",t),e.interp.registerOpcodeHandler("did_finish_load",r.curry(!0)),e.interp.registerOpcodeHandler("did_fail_load",r.curry(!0)),e.interp.registerOpcodeHandler("wait_first_compositor_commit",r.curry(!1))}},Compositor.ScrollContentPrefetcher=function(e,t){var r,n=null,i=0;function o(e){r!==e&&(r=e,t(Math.round(e)))}function a(){n&&(clearTimeout(n),n=null)}function s(e,t){a(),o(1e5),n=setTimeout((function(){o(4096),n=null,t&&t()}),e)}function l(){s(3e3)}function c(){a(),o(4096)}function d(){(i+=1)>200&&(c(),i=0)}function u(){e.active_tab.is_active?s(3e3):c()}function f(){setTimeout((function(){s(1e4)}),1e3)}this.init=function(){EventListener.addListener(window,"scroll",l),EventListener.addListener(document,"mousemove",d,!1),EventListener.addListener(document,"mousedown",d,!1),EventListener.addListener(document,"mouseup",d,!1),e.interp.registerOpcodeHandler("dfvnep",f),e.callback.register("window-became-active",u),e.callback.register("window-became-passive",u)}},Compositor.FlowController=function(e,t){var r,n,i=Math.floor(1e3/30),o=3e3;function a(e){var r,n,a=.5*t.getFPS();return Util.isTabVisible()?(r=e||1e3/a,n=Util.isTabVisible()?1e3:o,Math.min(Math.max(r,i),n)):o}function s(e,n){var i,o,s;i=a(e),s=Compositor.MessageFlags.kFrameDelay,(i=Math.floor(i))!==r&&(r=i,(o=new Sk.BinaryWriter(8)).writeUint32(s),o.writeUint32(i),t.sendCompositorMessage(0,o.getData()),1)&&t.getFPS()}function l(){Util.isTabVisible()?(s(n||i),n=null):n||(n=r,s(o))}this.getSenderDelay=function(){return r},setInterval(s,1e3),EventListener.addListener(window,"visibilitychange",l),l()},Compositor.ItemListConcatenator={itemToKey:function(e){return e.data.node_uid+":"+e.data.display_item_type+":"+Sk.Rect.toString(e.visual_rect)},concat:function(e,t){var r={};return e.forEach((function(e){var t=Compositor.ItemListConcatenator.itemToKey(e);r[t]=e})),t.forEach((function(t){var n=Compositor.ItemListConcatenator.itemToKey(t);r.hasOwnProperty(n)?r[n].canvas_bounds=Sk.Rect.join(r[n].canvas_bounds,t.canvas_bounds):(r[n]=t,e.push(t))})),e}},Compositor.HitTestResult=function(e,t){var r=this,n=t.getItemList(),i=t.getItemMap();function o(e){return e.flags&Sk.HT.ElementFlags.kHitTestable}r.concat=function(e){n=Compositor.ItemListConcatenator.concat(n,e.getItemList()),e.getItemMap().forEachEntryInOrder((function(e,t){var r=i.get(e)||[];r=Compositor.ItemListConcatenator.concat(r,t),i.set(e,r)}))},r.getFirstItem=function(){return n.length?n[n.length-1]:null},r.getFirstHittableItem=function(){var e,t;if(!n.length)return null;for(e=n.length-1;e>=0;e-=1)if((t=n[e].data)&&t.node_uid&&o(t))return n[e];return null},r.getItemClosestToPoint=function(t){var r,i,o,a,s,l,c=e.fromScreenPoint(t),d=Number.MAX_VALUE,u=-1;if(!n.length)return null;for(r=0;r<n.length;r+=1)(l=n[r].data)&&l.node_uid&&l.type===Sk.HT.ElementType.kTextNode&&(o=n[r].visual_rect,a=Math.min(Math.abs(Sk.Rect.getLeft(o)-c.x),Math.abs(Sk.Rect.getRight(o)-c.x)),s=Math.min(Math.abs(Sk.Rect.getTop(o)-c.y),Math.abs(Sk.Rect.getBottom(o)-c.y)),(i=Math.hypot(a,s))<d&&(d=i,u=r));return-1===u?null:n[u]},r.hitsFormControlNode=function(){var e,t,n=r.getFirstHittableItem();return n?((e=i.get(n.data.owner_node_uid))&&(t=e[0]),t&&n.data.node_uid!==n.data.owner_node_uid&&(n=t),n.data.formctrl?n:null):null},r.hitsTextNode=function(){var e=r.getFirstHittableItem();return e&&e.data.type===Sk.HT.ElementType.kTextNode?e:null},r.hitsUncompositedFrameElement=function(e){var t,r;if(!n.length)return null;for(t=n.length-1;t>=0;t-=1)if((r=n[t].data)&&r.frame_token===e)return n[t];return null},r.hitsNodeWithLink=function(){var e=r.getFirstHittableItem();return e&&e.data.flags&Sk.HT.ElementFlags.kHasLink?e:null},r.hitsImageNode=function(){var t=r.getFirstHittableItem();return t&&t.data.type===Sk.HT.ElementType.kImageElement?(t.image_src||(t.image_src=e.getDisplayList().getImageForItem(t)),t):null},r.hitsScrollableContainer=function(){var e,t;if(!n.length)return null;for(e=n.length-1;e>=0;e-=1)if((t=n[e].data)&&t.flags&Sk.HT.ElementFlags.kHasScrollableContainerId)return n[e];return null},r.hitsDataListIndicatorElement=function(){var e,t;if(!n.length)return null;for(e=n.length-1;e>=0;e-=1)if((t=n[e].data)&&t.type===Sk.HT.ElementType.kDataListIndicator)return n[e];return null},r.getItemMap=function(){return i},r.getItemList=function(){return n},r.getLayer=function(){return e}},Compositor.DisplayListTile=function(e,t,r){var n,i,o=this;o.setRecording=function(e){n=e},o.getRecording=function(){return n},o.createTextureLayerClient=function(){i=new Compositor.TextureLayerClient},o.recordTextureUpdate=function(e){i.recordTextureUpdate(e)},o.getTextureLayerClient=function(){return i},o.getKey=function(){return t},o.getTileRect=function(){return r},o.getLayer=function(){return e},o.hitTest=function(t){var r,i;return n?(r=new Sk.HitTestCanvas,i=n.getCullRect(),r.save(),t&&r.clipRect(t),r.translate(Sk.Rect.getX(i),Sk.Rect.getY(i)),n.playback(r),r.restore(),new Compositor.HitTestResult(e,r)):null},o.getImageAt=function(t,r){var i,o,a,s,l;n&&e.getTilingSet()&&e.getTilingSet().getDomNode()&&(l=e.getTilingSet().getDomNode(),a={x:Sk.Rect.getX(t),y:Sk.Rect.getY(t)},(o=new Sk.HTMLCanvasDevice("hit-test",t,a,1)).tryAlloc()&&(i=new Sk.Canvas(o,null,{}),l.appendChild(i.getNode()),i.save(),i.clipRect(t),i.drawPicture(n,n.getCullRect()),i.restore(),s=o.getSizeRect(),r.drawImage(i.getNode(),Sk.Rect.getX(s),Sk.Rect.getY(s),Sk.Rect.getWidth(s),Sk.Rect.getHeight(s),Sk.Rect.getX(t),Sk.Rect.getY(t),Sk.Rect.getWidth(t),Sk.Rect.getHeight(t)),l.removeChild(i.getNode()),i.release(),i=null,o=null))}},Compositor.DisplayList=function(e,t,r){var n=this,i=new Logger("dl",{level:"info"}),o={},a=new Compositor.OrderedMap,s=!1,l={};function c(e,t){return Sk.Rect.fromXYWH(e*r.width,t*r.height,r.width,r.height)}function d(e,t){return e|t<<16}function u(e){return Sk.Rect.isEmpty(e)||!Sk.Rect.intersects(e,t.getBoundsRect())?null:{start_y:Math.floor(Sk.Rect.getY(e)/r.height),end_y:Math.floor((Sk.Rect.getBottom(e)-1)/r.height),start_x:Math.floor(Sk.Rect.getX(e)/r.width),end_x:Math.floor((Sk.Rect.getRight(e)-1)/r.width)}}function f(e){return{x:65535&e,y:e>>16&65535}}function p(e,r){var n,i=o[e];i||(n=f(e),i=new Compositor.DisplayListTile(t,e,c(n.x,n.y)),o[e]=i),l={},s=!0,i.setRecording(r)}n.forEachAllocatedTileInRect=function(e,r){var n,i=Sk.Rect.intersection(e,t.getBoundsRect());Sk.Rect.isEmpty(i)||(n=u(i))&&Util.forEachItem(o,(function(e,t){var o,a=function(e){return 65535&Number(e)}(e),s=function(e){return Number(e)>>16&65535}(e);if(!(a<n.start_x||a>n.end_x||s<n.start_y||s>n.end_y||(o=Sk.Rect.intersection(c(a,s),i),Sk.Rect.isEmpty(o))))return!1===r(e,o)||void 0}))},n.getTileByKey=function(e){return o[e]},n.getSolidColorInRect=function(e){var r,i=0;if(t.isPictureLayer())return n.forEachAllocatedTileInRect(e,(function(e){var t,n=o[e];if(i+=1,!n)return r=void 0,!1;if(!(t=n.getRecording()))return r=void 0,!1;if(1===i)r=t.solid_color;else if(r!==t.solid_color)return r=void 0,!1})),r},n.hasPictureFlagsInRect=function(e,t){var r=!1;return n.forEachAllocatedTileInRect(e,(function(e){var n=o[e].getRecording();if(n)return n.getProperties()&t?(r=!0,!1):void 0})),r},n.hasPictureFlagsSetInRect=function(e,t){var r=0,i=t.map((function(){return!1}));return n.forEachAllocatedTileInRect(e,(function(e){var n=o[e].getRecording();if(n)return t.forEach((function(e,t){n.getProperties()&e&&(i[t]=!0,r+=1)})),r!==t.length&&void 0})),i},n.hitTestPoint=function(e){var t=function(e){var t=u(Sk.Rect.fromXYWH(e.x,e.y,1,1));return t?(t.start_x,t.end_x,t.start_y,t.end_y,o[d(t.start_x,t.start_y)]):null}(e);return t?t.hitTest(Sk.Rect.fromXYWH(e.x,e.y,1,1)):null},n.hitTestRect=function(e){var t=null;return n.forEachAllocatedTileInRect(e,(function(r){var n=o[r];n&&(t?t.concat(n.hitTest(e)):t=n.hitTest(e))})),t},n.getImageForItem=function(e){var t,r,a,s,c;if(e.is_sk_image)return e.image_src||"";if(!e.visual_rect||!Sk.Rect.isValid(e.visual_rect))return"";if(a=Sk.Rect.roundOut(e.visual_rect),s=Sk.Rect.toString(a),l.hasOwnProperty(s))return l[s];if((r=document.createElement("canvas")).width=Sk.Rect.getWidth(a),r.height=Sk.Rect.getHeight(a),!(t=r.getContext("2d")))return null;t.translate(-Sk.Rect.getX(a),-Sk.Rect.getY(a)),n.forEachAllocatedTileInRect(a,(function(e,r){var n=o[e];n&&n.getImageAt(r,t)})),(c=Object.keys(l)).length>=20&&delete l[c[0]];try{l[s]=r.toDataURL()}catch(e){l[s]="",i.error({event:"hit-test-image-error",details:"unable to get data image src",visual_rect:a})}finally{t=null,r=null}return l[s]},n.getItemMap=function(){var e;return a&&!s||(e=new Compositor.OrderedMap,n.forEachAllocatedTileInRect(t.getBoundsRect(),(function(t){var r=o[t];r&&r.hitTest().getItemMap().forEachEntryInOrder((function(t,r){var n=e.get(t)||[];n=Compositor.ItemListConcatenator.concat(n,r),e.set(t,n)}))})),a=e,s=!1),a},n.applyTileUpdates=function(e,t){var r,n,i;for(r=0;r<e.length;r+=1)i=d((n=e[r]).index_x,n.index_y),n.skr.solid_color=n.solid_color,p(i,n.skr),Sk.Region.iterate(n.invalidation_region,t)},n.applyTextureUpdate=function(e){t.isUntiled(),function(e,r){var n,i=o[e];i||(n=f(e),(i=new Compositor.DisplayListTile(t,e,c(n.x,n.y))).createTextureLayerClient(),o[e]=i),i.recordTextureUpdate(r)}(d(0,0),e)},n.freeAllTiles=function(e){var r=!0;return t.isTextureLayer()&&t.getDisplay().getConfig().isLocalDLForTextureAllowed()&&n.forEachAllocatedTileInRect(t.getBoundsRect(),(function(t){var n=o[t],i=n?n.getTextureLayerClient():null;i&&(r&=i.clearTextureUpdates(e))})),r&&(o={}),l={},r},n.fallbackToRemoteCanvasSrc=function(){o={},l={}},n.asDict=function(){return{tile_map:o}}},Compositor.ScrollElementWrapper=function(e,t,r){var n,i=this,o=e.getDisplay();function a(e){var i=Util.getBrowserScrollOffset(t,o.getLayoutViewportDiv().getBoundingClientRect());(function(e){var t;return!!n&&(t=Compositor.Offset.abs(Compositor.Offset.subtract(e,n)),n=null,t.x<=2&&t.y<=2)})(i)||r(i)}function s(e,t){var r=t?EventListener.addListener:EventListener.removeListener,n=window.visualViewport;if(e===window&&n&&BrowserDetect.isMobileSafari())return r(n,"scroll",a),void r(n,"resize",a);r(e,"scroll",a)}i.scrollTo=function(e){return n=Compositor.Offset.makeCopy(e),t!==window?(t.scrollLeft=e.x,t.scrollTop=e.y):t.scrollTo(e.x,e.y),!0},i.getNode=function(){return t},i.release=function(){t&&(s(t,!1),t=null)},s(t,!0)},Compositor.CustomScrollbar=function(e){var t=this,r=0,n={},i=Sk.Rect.makeEmpty(),o=Compositor.Offset.makeZero(),a=0;function s(e){return n[e]||Sk.Rect.makeEmpty()}t.containsPoint=function(e){return Sk.Rect.containsPoint(i,e)},t.getScrollElementId=function(){return a},t.setScrollElementId=function(e){a=e},t.isScrollbarHorizontal=function(){return e},t.isLeftSideVerticalScrollbar=function(){return!!(r&Sk.HT.CustomScrollbar.Flags.kIsLeftSideVertical)},t.jumpOnTrackClick=function(){return!!(r&Sk.HT.CustomScrollbar.Flags.kJumpOnTrackClick)},t.supportsDragSnapBack=function(){return!!(r&Sk.HT.CustomScrollbar.Flags.kSupportsDragSnapBack)},t.getThumbSize=function(){var e=s(Sk.ScrollbarPart.kThumbPart);return{width:Sk.Rect.getWidth(e),height:Sk.Rect.getHeight(e)}},t.getTrackRect=function(){var e=s(Sk.ScrollbarPart.kTrackBGPart);return Sk.Rect.isEmpty(e)?i:e},t.getThumbRect=function(){return s(Sk.ScrollbarPart.kThumbPart)},t.getBackButtonRect=function(){return s(Sk.ScrollbarPart.kBackButtonStartPart)},t.getBackButtonEndRect=function(){return s(Sk.ScrollbarPart.kBackButtonEndPart)},t.getForwardButtonStartRect=function(){return s(Sk.ScrollbarPart.kForwardButtonStartPart)},t.getForwardButtonRect=function(){return s(Sk.ScrollbarPart.kForwardButtonEndPart)},t.update=function(e,t){var s;r=e.flags,s=t,Sk.Rect.isEqual(i,s)||(i=Sk.Rect.makeCopy(s),o=Compositor.Offset.makeXY(Sk.Rect.getX(i),Sk.Rect.getY(i))),Sk.Util.forEachItem(e.parts,(function(e,t){n[e]=Sk.Rect.translate(Sk.Rect.makeCopy(t),o.x,o.y)})),a=e.scroll_element_id},t.release=function(){r=0,i=null,o=null,n=null,a=null}},Compositor.CustomScrollbarHelper=function(e,t){var r,n,i,o=this,a=0,s=Compositor.Offset.makeZero(),l=Compositor.Bounds.makeZero(),c=Compositor.Bounds.makeZero();function d(e){return function(e){return!!(e.flags&Sk.HT.CustomScrollbar.Flags.kIsHorizontal)}(e)?(r||(r=new Compositor.CustomScrollbar(!0)),r):(n||(n=new Compositor.CustomScrollbar(!1)),n)}o.updateScrollbar=function(r,n){var i=d(r);!function(r,n){a===r&&n.getScrollElementId()===r||((a=n.getScrollElementId())&&t.getLayerTree().unregisterScrollbar(e,n.isScrollbarHorizontal()),a=r,n.setScrollElementId(a),t.getLayerTree().registerScrollbar(e,n.isScrollbarHorizontal()))}(r.scroll_element_id,i),i.update(r,n)},o.getScrollElementId=function(){return a},o.setCurrentOffset=function(e){s=Compositor.Offset.makeCopy(e)},o.getCurrentOffset=function(){return s},o.setClipLayerSize=function(e){l=Compositor.Bounds.makeCopy(e)},o.getClipLayerSize=function(){return l},o.setScrollLayerSize=function(e){c=Compositor.Bounds.makeCopy(e)},o.getScrollLayerSize=function(){return c},o.getActiveScrollbar=function(){return i},o.hitTestOverflowControl=function(t){var i=e.hitTestPoint(t);return i?r&&r.containsPoint(i)?r:n&&n.containsPoint(i)?n:null:null},o.hitLock=function(e){var t=o.hitTestOverflowControl(e);t&&(i=t)},o.doHitLockForTest=function(e){i=e?r:n},o.hitUnlock=function(){i=null},o.release=function(){i=null,l=null,s=null,c=null,a=0,r&&(r.release(),r=null),n&&(n.release(),n=null)}},Compositor.ScrollbarOrientation=Object.freeze({HORIZONTAL:0,VERTICAL:1}),Compositor.ScrollbarPart=Object.freeze({THUMB:0,TRACK_BUTTONS_TICKMARKS:1,BACK_BUTTON:2,FORWARD_BUTTON:3,BACK_TRACK:4,FORWARD_TRACK:5,NO_PART:6}),Compositor.PointerResultType=Object.freeze({kUnhandled:0,kScrollbarScroll:1}),Compositor.AutoScrollStatus=Object.freeze({AUTOSCROLL_WAITING:0,AUTOSCROLL_READY:1,AUTOSCROLL_SCROLLING:2}),Compositor.AutoScrollDirection=Object.freeze({AUTOSCROLL_BACKWARD:0,AUTOSCROLL_FORWARD:1}),Compositor.ScrollbarController=function(e){var t,r,n,i,o,a=this,s=e.getScrollDelegate();function l(){return e.getPropertyTrees().getScrollTree()}function c(){return e.getLayerTree()}function d(e){return e.isScrollbarHorizontal()?Compositor.ScrollbarOrientation.HORIZONTAL:Compositor.ScrollbarOrientation.VERTICAL}function u(e){return!!e.isScrollbar()||e.hasActiveCustomScrollbar()}function f(){var e,r,n,i;if(!t)return null;for(r=t.scroll_element_id,n=c().getScrollbarsFor(r),i=0;i<n.length;++i)if(u(e=n[i])&&d(e)===t.orientation)return e;return null}function p(t){return e.hitTestLayerTree(t,(function(e,r){return e.isScrollbar()||e.containsCustomScrollbar()&&e.getCustomScrollbarHelper().hitTestOverflowControl(t)?e:null}))}function g(e){var t=p(e);return t?t.isTransparent()?Compositor.PointerResultType.kUnhandled:l().findNodeFromElementId(t.getScrollElementId())?Compositor.PointerResultType.kScrollbarScroll:Compositor.PointerResultType.kUnhandled:Compositor.PointerResultType.kUnhandled}function m(){return c()&&c().getPageScaleFactorLimits()?c().getPageScaleFactorLimits().current:1}function _(){var e,t,r,n,i=f();return c().updateScrollbarGeometries(),e=i.getScrollLayerLength(),t=i.getTrackLength(),r=i.getThumbLength(),n=function(){var e,t=f();return(e=l().findNodeFromElementId(t.getScrollElementId())).scrollsOuterViewport()?(t.isScrollbarHorizontal()?Util.getInnerWidth():Util.getInnerHeight())/m():t.isScrollbarHorizontal()?e.getContainerBounds().width:e.getContainerBounds().height}(),t===r?0:(e-n)/(t-r)}function h(e,t){var n=0,i=f();switch(e){case Compositor.ScrollbarPart.BACK_BUTTON:case Compositor.ScrollbarPart.FORWARD_BUTTON:n=40*i.getScreenSpaceScaleFactorForScroll();break;case Compositor.ScrollbarPart.BACK_TRACK:case Compositor.ScrollbarPart.FORWARD_TRACK:n=function(){var e,t,n,i,o=f();return c().updateScrollbarGeometries(),e=o.hitTestPoint(r),n=(o.isScrollbarHorizontal()?e.x:e.y)-o.getThumbLength()/2,i=o.computeThumbQuadRect(),t=o.isScrollbarHorizontal()?Sk.Rect.getX(i):Sk.Rect.getY(i),Math.round(Math.abs(n-t))*_()*m()}();break;default:n=0}return n}function y(){var e,t=Date.now(),n=f(),i=t-o.last_tick_time,a=o.velocity*i/1e3,l=n.isScrollbarHorizontal()?Compositor.Offset.makeXY(a,0):Compositor.Offset.makeXY(0,a);c().updateScrollbarGeometries(),o.timer=null,o.last_tick_time=t,e=new Compositor.ScrollState(Compositor.EventType.kWheel,Compositor.Offset.makeXY(r.x,r.y),l),s.scrollUpdate(e)&&(o.timer=setTimeout(y,16))}function v(){var e=t.scroll_element_id,r=l().findNodeFromElementId(e),i=f();r&&n&&(o.last_tick_time=Date.now(),o.scroll_node=r,o.scroll_layer_length=i.getScrollLayerLength(),o.timer=setTimeout(y,16))}function k(){o&&(f()?(o.status=Compositor.AutoScrollStatus.AUTOSCROLL_SCROLLING,v()):o.status=Compositor.AutoScrollStatus.AUTOSCROLL_READY)}function S(){o&&o.timer&&(clearTimeout(o.timer),o.timer=null)}function b(){var e,n,i,a,s,l,d=f();o&&t&&o.status===Compositor.AutoScrollStatus.AUTOSCROLL_SCROLLING&&(c().updateScrollbarGeometries(),(e=d.hitTestPoint(r))&&(a=d.computeThumbQuadRect(),d.isScrollbarHorizontal()?(n=Sk.Rect.getX(a),i=Sk.Rect.getX(a)+Sk.Rect.getWidth(a),s=e.x):(n=Sk.Rect.getY(a),i=Sk.Rect.getY(a)+Sk.Rect.getHeight(a),s=e.y),(o.direction===Compositor.AutoScrollDirection.AUTOSCROLL_FORWARD&&i>s||o.direction===Compositor.AutoScrollDirection.AUTOSCROLL_BACKWARD&&n<s)&&S(),o.direction===Compositor.AutoScrollDirection.AUTOSCROLL_FORWARD&&o.scroll_layer_length!==d.getScrollLayerLength()&&(S(),v()),l=function(e){var t=f();return e===Compositor.ScrollbarPart.BACK_BUTTON?t.getBackButtonRect():e===Compositor.ScrollbarPart.FORWARD_BUTTON?t.getForwardButtonRect():e===Compositor.ScrollbarPart.BACK_TRACK?t.getBackTrackRect():e===Compositor.ScrollbarPart.FORWARD_TRACK?t.getForwardTrackRect():Sk.Rect.makeEmpty()}(o.pressed_scrollbar_part),Sk.Rect.containsPoint(l,e)?o.scroll_element_id===d.getScrollElementId()&&v():S()))}a.getScrollbarLayerForTest=f,a.getCapturedScrollbarMetadataForTest=function(){return t},a.didRegisterScrollbar=function(e){var r=e.getScrollElementId(),n=d(e);o&&o.status===Compositor.AutoScrollStatus.AUTOSCROLL_READY&&t.scroll_element_id===r&&t.orientation===n&&setTimeout(k,0)},a.didUnregisterScrollbar=function(e){var r=e.getScrollElementId(),n=d(e);o&&o.status===Compositor.AutoScrollStatus.AUTOSCROLL_SCROLLING&&t.scroll_element_id===r&&t.orientation===n&&(setTimeout(S,0),o.status=Compositor.AutoScrollStatus.AUTOSCROLL_READY)},a.hitTest=g,a.scrollbarScrollIsActive=function(){return n},a.handlePointerDown=function(e,a){var s,l,u,m,_,y={type:Compositor.PointerResultType.kUnhandled};return g(e)!==Compositor.PointerResultType.kScrollbarScroll||((s=p(e)).containsCustomScrollbar()&&s.getCustomScrollbarHelper().hitLock(e),u=s.getScrollElementId(),t={scroll_element_id:u,orientation:d(s)},r=e,n=!0,y.phase=Compositor.GestureType.kScrollBegin,y.target_scroller=u,y.type=Compositor.PointerResultType.kScrollbarScroll,c().updateScrollbarGeometries(),l=function(e){var t=f(),r=t.hitTestPoint(e);return t.identifyScrollbarPart(r)}(e),m=s.jumpOnTrackClick()!==a,y.scroll_delta=function(e,t){var r=h(e),n=f();return e===Compositor.ScrollbarPart.BACK_BUTTON?n.isScrollbarHorizontal()?Compositor.Offset.makeXY(-r,0):Compositor.Offset.makeXY(0,-r):e===Compositor.ScrollbarPart.FORWARD_BUTTON?n.isScrollbarHorizontal()?Compositor.Offset.makeXY(r,0):Compositor.Offset.makeXY(0,r):e===Compositor.ScrollbarPart.BACK_TRACK?n.isScrollbarHorizontal()?Compositor.Offset.makeXY(-r,0):Compositor.Offset.makeXY(0,-r):e===Compositor.ScrollbarPart.FORWARD_TRACK?n.isScrollbarHorizontal()?Compositor.Offset.makeXY(r,0):Compositor.Offset.makeXY(0,r):Compositor.Offset.makeZero()}(l),(l===Compositor.ScrollbarPart.THUMB||m)&&((i={scroller_displacement:0}).drag_origin=m?function(e){var t=e.computeThumbQuadRect();return e.isScrollbarHorizontal()?Compositor.Offset.makeXY(Sk.Rect.getX(t)+Sk.Rect.getWidth(t)/2,0):Compositor.Offset.makeXY(0,Sk.Rect.getY(t)+Sk.Rect.getHeight(t)/2)}(s):s.hitTestPoint(e),i.scroll_position_at_start=s.getCurrentPos(),i.scroller_length_at_previous_move=s.getScrollLayerLength()),Compositor.Offset.isZero(y.scroll_delta)||m||!function(e){return e===Compositor.ScrollbarPart.BACK_BUTTON||e===Compositor.ScrollbarPart.FORWARD_BUTTON}(l)||((o={}).velocity=(_=y.scroll_delta,20*(f().isScrollbarHorizontal()?_.x:_.y)),o.direction=function(e){return(f().isScrollbarHorizontal()?e.x:e.y)<0?Compositor.AutoScrollDirection.AUTOSCROLL_BACKWARD:Compositor.AutoScrollDirection.AUTOSCROLL_FORWARD}(y.scroll_delta),o.pressed_scrollbar_part=l,o.scroll_element_id=u,setTimeout(k,250))),y},a.handlePointerMove=function(e){var t,n,o,a={type:Compositor.PointerResultType.kUnhandled},s=f();return r=e,s&&i?(b(),a.type=Compositor.PointerResultType.kScrollbarScroll,a.phase=Compositor.GestureType.kScrollUpdate,function(e){var t,r,n,i,o,a,s,l,d=f();if(!d||!d.supportsDragSnapBack())return!1;if(c().updateScrollbarGeometries(),r=d.getForwardTrackRect(),!(n=d.getTrackThickness())){if(!(i=d.getThumbThickness()))return!1;n=i}return o=8*n,a=d.isScrollbarHorizontal()?Sk.Rect.getY(r)-o:Sk.Rect.getX(r)-o,s=d.isScrollbarHorizontal()?Sk.Rect.getY(r)+n+o:Sk.Rect.getX(r)+n+o,t=d.fromScreenPoint(e),(l=d.isScrollbarHorizontal()?t.y:t.x)<a||l>s}(e)?(t=s.getCurrentPos()-i.scroll_position_at_start,a.scroll_delta=s.isScrollbarHorizontal()?Compositor.Offset.makeXY(-t,0):Compositor.Offset.makeXY(0,-t),a):(n=function(e){var t,r=f(),n=r.fromScreenPoint(e);return t=(r.isScrollbarHorizontal()?n.x-i.drag_origin.x:n.y-i.drag_origin.y)*_(),(i.scroll_position_at_start+t-r.getCurrentPos())*m()}(e),i.scroller_length_at_previous_move!==s.getScrollLayerLength()?(i.scroller_displacement=n,i.scroller_length_at_previous_move=s.getScrollLayerLength(),a):(n-=i.scroller_displacement,o=s.isScrollbarHorizontal()?Compositor.Offset.makeXY(n,0):Compositor.Offset.makeXY(0,n),Compositor.Offset.isZero(o)||(a.scroll_delta=o),a))):a},a.handlePointerUp=function(e){var r,a={type:Compositor.PointerResultType.kUnhandled};return a.phase=Compositor.GestureType.kScrollEnd,n&&((r=f())&&r.containsCustomScrollbar()&&r.getCustomScrollbarHelper().hitUnlock(),n=!1,a.type=Compositor.PointerResultType.kScrollbarScroll),S(),i=null,o=null,t=null,a}},Compositor.ScrollbarDelegate=function(e){var t,r,n,i=this,o=null,a={};function s(t){var r=e.getLayerTreeHost(),n=e.getOwnerScrollLayer();e.isScrollbarHorizontal()?r.getPropertyTrees().getScrollTree().setScrollOffsetX(n.getScrollNode().getElementId(),t.x):r.getPropertyTrees().getScrollTree().setScrollOffsetY(n.getScrollNode().getElementId(),t.y)}i.create=function(){return t=document.createElement("div"),n=new Compositor.ScrollElementWrapper(e.getLayerTreeHost(),t,s),t.style.display="none",t.style.position="absolute",e.isScrollbarHorizontal()?(t.style.overflowX="scroll",t.style.overflowY="hidden"):(t.style.overflowX="hidden",t.style.overflowY="scroll"),t},i.getScrollbarDivForTesting=function(){return t},i.release=function(){n&&(n.release(),n=null),t&&t.parentNode&&t.parentNode.removeChild(t),o=null,a={}},i.updateBounds=function(){var r=e.getBounds(),n=Util.getScrollbarThickness(),i=Math.max(r.width,n[0]+1),o=Math.max(r.height,n[1]+1);t.style.width=i+"px",t.style.height=o+"px"},i.update=function(){var n,i;t.style.display="block",(i=e.getOwnerScrollLayer())&&(n=i.getScrollNode().getContentBounds(),a.width===n.width&&a.height===n.height||(a.width=n.width,a.height=n.height,r||((r=document.createElement("div")).style.position="absolute",r.style.display="block",t.appendChild(r)),e.isScrollbarHorizontal()?(r.style.width=n.width+"px",r.style.height="1px"):(r.style.width="1px",r.style.height=n.height+"px")))},i.setPosition=function(t){var r=Compositor.Offset.makeCopy(t);e.isScrollbarHorizontal()?r.y=0:r.x=0,n.scrollTo(r)},i.updateProjection=function(){e.applyDrawTransform(t)},i.updateClip=function(r){var n=e.getBoundsRect();(o||r)&&(o&&r&&Sk.Rect.isEqual(o,r)||(o=r?Sk.Rect.makeCopy(r):null,e.applyDrawClip(t,n,o)))},i.updateOpacity=function(){e.applyDrawOpacity(t)}},Compositor.VelocityObserver=function(e,t){var r,n,i,o=[],a=Date.now();function s(){return 0===n.x&&0===n.y}function l(){var l,c,d,u;!function(){var t=e.fromScreenPoint({x:0,y:0,z:0});if(t){for(;o.length>5||(o.length&&Date.now()-o[0].ts)>500;)o.shift();o.push({point:t,ts:Date.now()})}}(),u=Compositor.Offset.makeZero(),o.length>=2&&(l=Date.now()-o[0].ts,c=Compositor.Offset.subtract(o[o.length-1].point,o[0].point),u=l?Compositor.Offset.makeXY(c.x/l,c.y/l):Compositor.Offset.makeZero()),n&&(d=Date.now()-a,i=Compositor.Offset.makeXY((u.x-n.x)/d,(u.y-n.y)/d),a=Date.now()),n&&Compositor.Offset.isEqual(n,u)||(n=u,0)||t(i,n),r&&s()&&(clearInterval(r),r=null)}this.update=function(){l(),r||!n||s()||(r=setInterval(l,50))},this.release=function(){r&&(clearInterval(r),r=null)}},Compositor.SortingContext3D=function(e,t){var r,n,i=this;function o(e){var t=[];return r.forEachItem((function(e,r){t.push(r.getSiblingIndex())})),t.sort((function(e,t){return Number(e)-Number(t)})).indexOf(e)}function a(){n.parentNode&&n.parentNode.removeChild(n),n.parentNode}i.siblingIndexToPositionForTest=o,i.insertChild=function(t,i){var a,s,l=t.getContainer(),c=r.empty();return r.add(t),c?(t.isFixedToViewport()&&(n.style.position="fixed"),n.appendChild(l),e.isDebugEnabled()&&(n.setAttribute("sibling_rank",t.getSiblingRank()),n.id="layer-3d-container:"+t.getLayerTreeHost().getFid()+":"+t.getID()),n):(a=o(i),(s=n.childNodes[a])?n.insertBefore(l,s):n.appendChild(l),t.getOrCreate3dContainer())},i.removeChild=function(e){r&&(r.remove(e),r.empty()&&a())},i.release=function(){r.clear(),r=null,a(),n=null},i.getContext=function(){return n},(n=document.createElement("div")).style.position="static",n.style.left=n.style.top="0px",n.style.transformStyle="preserve-3d",e.isDebugEnabled()&&n.setAttribute("sorting-context-id",t),r=new Compositor.Set((function(e){return e.getID()}))},Compositor.Projection=Object.freeze({kScreenSpace:0,kIVSL:1,kOVCL:2}),Compositor.Layer=function(e){var t,r,n,i,o,a,s,l,c,d,u,f,p,g,m,_,h,y,v,k,S,b,w,C,T,E,A,R,x,D,I=this,O=[],U=!1,M=Sk.Region.makeEmpty(),F=Sk.Region.makeEmpty(),P=0,L={},N={},B={},H={},V=Sk.Rect.makeEmpty(),W={},z=mat4.create(),G=mat4.create(),j=Math.floor(Number.MAX_SAFE_INTEGER/1e6),Y=null,X=Sk.Rect.makeEmpty(),q=null,K=0,Q=!0,J={};function Z(e){return!!(N.flags&e)}function $(e){return!!(N.dirty_props&e)}function ee(){return!!E&&!!E.getActiveScrollbar()}function te(){return I.containsCustomScrollbar(),E.getActiveScrollbar()}function re(){return ee()?te().getThumbSize():N.scrollbar_flags&Compositor.ScrollbarFlags.kHasThumb?N.thumb_size:{width:0,height:0}}function ne(){return i===Compositor.LayerType.PaintedScrollbarLayer?N.back_button_rect:ee()?te().getBackButtonRect():Sk.Rect.makeEmpty()}function ie(){return i===Compositor.LayerType.PaintedScrollbarLayer?N.forward_button_rect:ee()?te().getForwardButtonRect():Sk.Rect.makeEmpty()}function oe(){return i===Compositor.LayerType.PaintedScrollbarLayer||i===Compositor.LayerType.PaintedOverlayScrollbarLayer?N.track_rect:ee()?te().getTrackRect():Sk.Rect.makeEmpty()}function ae(){var e,t,r,n,o,a;return i===Compositor.LayerType.PaintedScrollbarLayer||I.containsCustomScrollbar()?(e=I.computeThumbQuadRect(),t=oe(),r=Sk.Rect.getX(t),n=Sk.Rect.getY(t),I.isScrollbarHorizontal()?(o=Sk.Rect.getX(e)-r,a=Sk.Rect.getHeight(t)):(o=Sk.Rect.getWidth(t),a=Sk.Rect.getY(e)-n),Sk.Rect.fromXYWH(r,n,o,a)):Sk.Rect.makeEmpty()}function se(){var e,t,r,n,o,a,s;return i===Compositor.LayerType.PaintedScrollbarLayer||I.containsCustomScrollbar()?(e=I.computeThumbQuadRect(),t=oe(),I.isScrollbarHorizontal()?(r=Sk.Rect.getRight(t),n=Sk.Rect.getRight(e),o=Sk.Rect.getY(t),a=r-n,s=Sk.Rect.getHeight(t)):(r=Sk.Rect.getBottom(t),n=Sk.Rect.getX(t),o=Sk.Rect.getBottom(e),a=Sk.Rect.getWidth(t),s=r-o),Sk.Rect.fromXYWH(n,o,a,s)):Sk.Rect.makeEmpty()}function le(e){return"number"==typeof e&&e>=0}function ce(){return X}function de(){return o.getPropertyTrees().getScrollTree().getNode(I.getScrollTreeIndex())}function ue(){return o.getPropertyTrees().getTransformTree()}function fe(){return ue().getNode(I.getTransformTreeIndex())}function pe(){var e;a.getConfig().allow3dCompositing()&&(e=fe().getSortingContextId(),P!==e&&(P=e,o.setLayerSortingContextIdChanged(I.getID())))}function ge(){return o.getPropertyTrees().getEffectTree().getNode(I.getEffectTreeIndex())}function me(e,t,r){t=null===t?"":t,(r=r||l).style[e]!==t&&(r.style[e]=t),a.isDebugEnabled()&&(r.style[e],r.style[e])}function _e(){var e,t=ge().getRenderTargetId(),r=function(){for(var e=fe(),t=ue(),r=I.getTransformTreeIndex();e&&e.delegatesToParentForBackface();)r=e.getParentId(),e=t.getNode(r);return r}(),n=a.getDrawDstId(Compositor.Projection.kScreenSpace);return ge().isContentsRoot()||(n=o.getPropertyTrees().getEffectTree().getNode(t).getTransformId()),e=ue().combineTransforms(r,n),Compositor.Matrix3D.isBackFaceVisible(e)}function he(e){o.getPropertyTrees().getScrollTree().setScrollOffset(de().getElementId(),e,Compositor.ScrollOrigin.kOriginScrollEvent),a.callback.fire("scroll-container-scrolled")}function ye(){var e,t,r,n,i,s;if(I.isOuterViewportScrollLayer()&&I.isScrollable()&&(u||(u=new Compositor.ScrollElementWrapper(o,window,he))),I.isOuterViewportScrollLayer())return t=(e=a.getOuterViewportScrollLayer().getScrollNode()).isUserScrollableHorizontal()&&e.maxScrollOffset().x>0,r=e.isUserScrollableVertical()&&e.maxScrollOffset().y>0,document.body.style.overflowX=t?"visible":"hidden",void(document.body.style.overflowY=r?"visible":"hidden");I.isScrollbar()&&(f&&f.update(),I.isCustomScrollbar()?l.style.display=a.isScrollbarVisible()?"block":"none":(s=I.getOwnerScrollLayer())&&!s.isOuterViewportScrollLayer()&&(i=o.getPropertyTrees().getScrollTree().getNode(s.getScrollTreeIndex()),n=I.isScrollbarHorizontal()?i.isUserScrollableHorizontal():i.isUserScrollableVertical(),l.style.display=n&&a.isScrollbarVisible()?"block":"none"))}function ve(){var e=o.getImageAnimationController();Util.forEachItem(J,(function(t,r){var n=r.metadata;n&&e.unregisterAnimationDriver(n.paint_image_id,I)}))}function ke(){var e,t;for(O.length,e=0;e<O.length;e+=1)t=e*j,O[e].setSiblingRank(t);a.updateLthChildPaintRanks(o),a.resetCachedSurfaceLayerList()}function Se(e){var t=I.getProjectionMatrixInverse(Compositor.Projection.kScreenSpace);return t?Compositor.Matrix3D.projectFlatPoint(t,e):null}I.asDict=function(){return{id:I.id,parent_id:r?r.id:null,sorting_context_id:P,type:i,props:N,label:I.getLabels()}},I.updateProperties=function(e){var t;if(Util.forEachItem(e,(function(e,t){"skr_u8a"!==e&&"tile_updates"!==e&&(N[e]=t)})),Z(Compositor.LayerFlags.kIsDisplayListDelta)){if(!I.getTilingSet())return;t=ce(),I.getTilingSet().requestTileType(t,I.isContentOpaque(),Compositor.TileType.kCanvasDevice),I.runOn("partial-dl-drag-end",(function(){I.getTilingSet().removeKnownTilesType(),I.getLayerTreeHost().setNeedsRepaint(I.getID(),t)}))}},I.setTree=function(e){s=e},I.setSortingContext3D=function(e){d=e},I.getSortingContext3D=function(){return d},I.isAttached=function(){return!!s},I.getID=function(){return I.id},I.getType=function(){return i},I.isDrawable=function(){return Z(Compositor.LayerFlags.kIsDrawable)},I.isContentOpaque=function(){return Z(Compositor.LayerFlags.kContentsOpaque)},I.shouldCheckBackfaceVisibility=function(){return Z(Compositor.LayerFlags.kShouldCheckBackfaceVisibility)},I.isCanvasBacking=function(){return Z(Compositor.LayerFlags.kIsCanvasBacking)},I.isScrollbar=function(){return Z(Compositor.LayerFlags.kIsScrollbar)},I.isCustomScrollbar=function(){return I.isScrollbar()&&I.isPictureLayer()},I.containsCustomScrollbar=function(){return!!E&&I.isPictureLayer()},I.getCustomScrollbarHelper=function(){return E},I.isHitTestable=function(){return N.hit_test_opaqueness!==Compositor.HitTestOpaqueness.kTransparent},I.isOpaqueToHitTest=function(){return N.hit_test_opaqueness===Compositor.HitTestOpaqueness.kOpaque},I.hasActiveCustomScrollbar=ee,I.getBackButtonRect=ne,I.getForwardButtonRect=ie,I.getThumbLength=function(){var e=re();return I.isScrollbarHorizontal()?e.width:e.height},I.getThumbThickness=function(){var e=re();return I.isScrollbarHorizontal()?e.height:e.width},I.getTrackLength=function(){var e=oe();return I.isScrollbarHorizontal()?Sk.Rect.getWidth(e):Sk.Rect.getHeight(e)},I.getTrackThickness=function(){var e=oe();return I.isScrollbarHorizontal()?Sk.Rect.getHeight(e):Sk.Rect.getWidth(e)},I.setCurrentPos=function(e){T=e},I.getCurrentPos=function(){return ee()?I.isScrollbarHorizontal()?E.getCurrentOffset().x:E.getCurrentOffset().y:T},I.setClipLayerLength=function(e){w=e},I.getClipLayerLength=function(){return ee()?I.isScrollbarHorizontal()?E.getClipLayerSize().width:E.getClipLayerSize().height:w},I.setScrollLayerLength=function(e){C=e},I.getScrollLayerLength=function(){return ee()?I.isScrollbarHorizontal()?E.getScrollLayerSize().width:E.getScrollLayerSize().height:C},I.setVerticalAdjust=function(e){K=e},I.computeThumbQuadRect=function(){var e,t,r,n,i=I.getTrackLength(),o=I.getThumbLength(),a=I.getThumbThickness(),s=Math.max(C-w,0),l=T,c=(n=oe(),I.isScrollbarHorizontal()?Sk.Rect.getX(n):Sk.Rect.getY(n));return ee()?te().getThumbRect():(l<0?l=0:l>s&&(l=s),s>0&&(e=l/s,t=i-o,c+=Math.round(e*t)),r=0*a,I.isScrollbarHorizontal()?Sk.Rect.fromXYWH(c,K+r,o,a-r):Sk.Rect.fromXYWH(I.isLeftSideVerticalScrollbar()?I.getBounds().width-a:r,c,a-r,o))},I.getBackTrackRect=ae,I.getForwardTrackRect=se,I.identifyScrollbarPart=function(e){return I.isScrollbar()||I.containsCustomScrollbar(),Sk.Rect.containsPoint(ne(),e)||Sk.Rect.containsPoint(ee()?te().getBackButtonEndRect():Sk.Rect.makeEmpty(),e)?Compositor.ScrollbarPart.BACK_BUTTON:Sk.Rect.containsPoint(ie(),e)||Sk.Rect.containsPoint(ee()?te().getForwardButtonStartRect():Sk.Rect.makeEmpty(),e)?Compositor.ScrollbarPart.FORWARD_BUTTON:Sk.Rect.containsPoint(ae(),e)?Compositor.ScrollbarPart.BACK_TRACK:Sk.Rect.containsPoint(se(),e)?Compositor.ScrollbarPart.FORWARD_TRACK:Sk.Rect.containsPoint(I.computeThumbQuadRect(),e)?Compositor.ScrollbarPart.THUMB:Compositor.ScrollbarPart.NO_PART},I.jumpOnTrackClick=function(){return i===Compositor.LayerType.PaintedScrollbarLayer?!!(N.scrollbar_flags&Compositor.ScrollbarFlags.kJumpOnTrackClick):!!ee()&&te().jumpOnTrackClick()},I.supportsDragSnapBack=function(){return i===Compositor.LayerType.PaintedScrollbarLayer?!!(N.scrollbar_flags&Compositor.ScrollbarFlags.kSupportsDragSnapBack):!!ee()&&te().supportsDragSnapBack()},I.isScrollable=function(){var e=o.getPropertyTrees().getScrollTree();return!!I.getElementId()&&!!e.findNodeFromElementId(I.getElementId())},I.isScrollerOrScrollbar=function(){return I.isScrollbar()||I.isScrollable()},I.getElementId=function(){return N.element_id,N.element_id},I.getScrollElementId=function(){return I.containsCustomScrollbar()?E.getScrollElementId():N.scroll_element_id},I.getOwnerScrollLayer=function(){return I.getScrollElementId()?o.getLayerTree().getLayerByElementId(I.getScrollElementId()):null},I.isScrollbarHorizontal=function(){return ee()?te().isScrollbarHorizontal():!!(N.scrollbar_flags&Compositor.ScrollbarFlags.kIsHorizontal)},I.isLeftSideVerticalScrollbar=function(){return ee()?te().isLeftSideVerticalScrollbar():!!(N.scrollbar_flags&Compositor.ScrollbarFlags.kIsLeftSideVertical)},I.getBounds=function(){return N.bounds,e.id,N.bounds},I.isUntiled=function(){return!(!I.isTextureLayer()||!a.getConfig().allowClientCanvasSrc()&&!a.getConfig().isLocalDLForTextureAllowed())||Z(Compositor.LayerFlags.kIsUntiled)},I.useSingleRasterTile=function(){return!!I.isPictureLayer()&&a.getConfig().allowSingleRasterTile()},I.onHitTestData=function(t,r){var n=r.flags;n&Sk.HT.ElementFlags.kHitTestable&&Sk.Region.addRect(M,t),n&Sk.HT.ElementFlags.kInsideBlockingTouchEventHandler&&Sk.Region.addRect(F,t),r.type===Sk.HT.ElementType.kCustomScrollbar&&(r.custom_scrollbar&&(r.display_item_type,Sk.HT.DisplayItemType.kScrollbar),E||(E=new Compositor.CustomScrollbarHelper(I,e.lth)),E.updateScrollbar(r.custom_scrollbar,t))},I.subtractHittableRect=function(e){Sk.Region.subtractRect(M,e,!0)},I.hasHittableItemAt=function(e){return Sk.Region.containsPoint(M,e)},I.isUnHittableSurface=function(){return!(!I.isSurfaceLayer()||void 0===N.pointer_events_none)&&N.pointer_events_none},I.getTextureBounds=function(){return I.isTextureLayer()&&N.texture_bounds,N.texture_bounds},I.getOffsetToTransformParent=function(){return N.offset_to_transform_parent,N.offset_to_transform_parent.x,e.id,N.offset_to_transform_parent.y,e.id,N.offset_to_transform_parent},I.isTransparent=function(){return I.getScreenSpaceOpacity()<=.001},I.occludesContentBelow=function(){return!I.is3dSorted()&&I.isContentOpaque()&&1===I.getScreenSpaceOpacity()},I.getTransformTreeIndex=function(){return le(N.transform_tree_index),N.transform_tree_index},I.getClipTreeIndex=function(){return le(N.clip_tree_index),N.clip_tree_index},I.getScrollTreeIndex=function(){return le(N.scroll_tree_index),N.scroll_tree_index},I.getEffectTreeIndex=function(){return le(N.effect_tree_index),N.effect_tree_index},I.getDOMNodeId=function(){return N.node_id,N.node_id},I.getNonFastScrollableRects=function(){return N.non_fast_scrollable_rects,N.non_fast_scrollable_rects},I.getTouchActionRects=function(){return N.touch_action_region,N.touch_action_region.whole_region},I.hasMainThreadScrollingReasons=function(){return!!N.main_thread_scrolling_reasons},I.isSurfaceForChildFrame=function(){return I.isSurfaceLayer()&&!!N.frame_sink_id},I.getSurfaceFrameSinkId=function(){return N.frame_sink_id},I.getTree=function(){return s},I.getParent=function(){return r},I.setParent=function(e){r=e},I.isRoot=function(){return!I.getParent()},I.getChildren=function(){return O},I.getDisplayList=function(){return v},I.isMaskLayer=function(){return U},I.setMaskLayer=function(e){!e||e.isMaskLayer(),n=e},I.getMaskLayer=function(){return n},I.isPictureLayer=function(){return i===Compositor.LayerType.PictureLayer},I.isTextureLayer=function(){return i===Compositor.LayerType.TextureLayer},I.isSurfaceLayer=function(){return i===Compositor.LayerType.SurfaceLayer},I.isLocallyPaintedScrollbarLayer=function(){return i===Compositor.LayerType.SolidColorScrollbarLayer||i===Compositor.LayerType.PaintedScrollbarLayer||i===Compositor.LayerType.PaintedOverlayScrollbarLayer},I.isSurfaceLayerWithVideo=function(){return I.isSurfaceLayer()&&Z(Compositor.LayerFlags.kIsSurfaceLayerWithVideo)},I.isSurfaceLayerForOSC=function(){return I.isSurfaceLayer()&&Z(Compositor.LayerFlags.kIsSurfaceLayerForOSC)},I.hasVideoContent=function(){return i===Compositor.LayerType.VideoLayer||I.isSurfaceLayerWithVideo()},I.hasCaret=function(){var e=v?v.hitTestRect(ce()):null;return!!e&&e.getItemList().some((function(e){return e.data.display_item_type===Sk.HT.DisplayItemType.kCaret}))},I.getHitTestResultAt=function(e){var t;return v&&(t=v.hitTestPoint(e))&&t.getItemList().length?t:null},I.getBoundsRect=ce,I.hasVisualIntersect=function(e){var t=I.toScreenSpaceRect(),r=e.toScreenSpaceRect();return!(!t||!r)&&I.isDrawable()&&e.isDrawable()&&Sk.Rect.intersects(t,r)},I.isOccludedBy=function(e){return I.paintsBefore(e)&&I.hasVisualIntersect(e)},I.getHudDiv=function(){return l?_?(l.parentNode,_):((_=document.createElement("div")).id="post",_.style.position="absolute",_.style.top="0px",_.style.left="0px",_.style.width="100%",_.style.height="100%",_.style.overflow="visible",_.style.pointerEvents="none",l.appendChild(_),_):null},I.getScrollNode=de,I.getTransformNode=fe,I.getSortingContextId=function(){return P},I.is3dSorted=function(){return!!a.getConfig().allow3dCompositing()&&0!==I.getSortingContextId()},I.update3dContext=function(){var e,t,n;I.isAttached()&&(a.getConfig().allow3dCompositing(),e=s,t=r,n=I.getSiblingIndex(),I.remove(),t.insertChild(e,I,n))},I.getClipNode=function(){return o.getPropertyTrees().getClipTree().getNode(I.getClipTreeIndex())},I.willDraw=function(){if(!I.isDrawable()&&!I.isSurfaceLayerForOSC())return!1;if(!ge().isDrawn()){if(!(I.isTextureLayer()&&a.getConfig().allowClientCanvasSrc()&&I.isTransparent()))return!1;I.getID()}return!!I.getProjectionMatrixInverse(Compositor.Projection.kScreenSpace)&&ge().getBlendMode()!==Compositor.BlendMode.kDstIn},I.isInnerViewportScrollLayer=function(){return a.getInnerViewportScrollLayer()===I},I.isOuterViewportScrollLayer=function(){return a.getOuterViewportScrollLayer()===I},I.isOuterViewportContentLayer=function(){return a.getOuterViewportContentLayer()===I},I.scrollTo=function(e){u.scrollTo(e)},I.getScrollbarDelegate=function(){return f},I.isFixedToViewport=function(){var e,t,r,n;return I.getLayerTreeHost().isMainFrame()?(r=(t=a.getOuterViewportContentLayer()).getTransformTreeIndex(),n=t.getScrollTreeIndex(),!!ue().shouldForceFixedPosition(I.getTransformTreeIndex(),r,n)||!function(){var e=a.getOuterViewportContentLayer().getTransformTreeIndex();return ue().hasPath(I.getTransformTreeIndex(),e)}()):!(!(e=a.getMainFrameSurfaceLayer(o))||!e.isFixedToViewport())},I.isFixedToBottom=function(){return!!I.getLayerTreeHost().isMainFrame()&&!!fe()&&ue().movedByOuterViewportBoundsDeltaY(fe().getId())},I.updateProjection=function(){I.isRoot()||(I.isFixedToViewport()?(me("position","fixed"),I.isFixedToBottom()&&(me("height","100%"),me("bottom","0px"),me("top",null)),me("position","absolute",S)):(I.isFixedToBottom(),me("position","static"),S.style.clip||me("position","static",S)),p&&p.updateProjection(),y&&y.updateProjection(),I.isLocallyPaintedScrollbarLayer()&&f&&f.updateProjection(),a.getInputDelegate()&&a.getInputDelegate().didUpdateProjection(I),a.getIframeDelegate()&&a.getIframeDelegate().didUpdateProjection(I))},I.calcClipRect=function(e,t){return o.getPropertyTrees().getClipTree().combineClips(I.getClipTreeIndex(),e,t)},I.calcProjectedMFI=function(e){return o.getPropertyTrees().getEffectTree().calcProjectedMFI(I.getEffectTreeIndex(),e)},I.updateShadowElementClip=function(){var e=null,t=I.getDrawMatrix();Q?S.childNodes.length>0&&Y?(e=Sk.Rect.toCSSClip(Compositor.Matrix3D.mapRect(t,Y)),me("position","absolute",S)):I.isFixedToViewport()||me("position","static",S):(Compositor.Matrix3D.rectStaysRect(t),"absolute"===l.style.position||l.style.position,me("position","absolute",S)),me("clip",e,S)},I.updateClip=function(){var e,t,r;I.isRoot()||(t=I.isFixedToViewport()?a.getInnerViewportScrollLayer().getBoundsRect():a.getOuterViewportContentLayer().getBoundsRect(),e=a.calcClipRect(I),Y=null,Sk.Rect.contains(e,t)||(r=Sk.Rect.intersection(e,t),(Q=Compositor.Matrix3D.rectStaysRect(I.getDrawMatrix()))?Y=function(e){var t=I.isFixedToViewport()?Compositor.Projection.kIVSL:Compositor.Projection.kOVCL,r=I.getProjectionMatrixInverse(t),n=t>I.getTransformTreeIndex();return r?Compositor.Matrix3D.mapRect(r,e,!n):null}(r):(I.isFixedToViewport()||me("position","absolute"),I.is3dSorted()||me("clip",Sk.Rect.toCSSClip(r)))),p&&p.updateClip(Y),y&&y.updateClip(Y),I.isLocallyPaintedScrollbarLayer()&&f&&f.updateClip(Y),a.getIframeDelegate()&&a.getIframeDelegate().didUpdateClip(I,Y),I.updateShadowElementClip(),a.isDebugEnabled()&&l.setAttribute("clip_rect",Sk.Rect.toString(e)))},I.getScreenSpaceOpacity=function(){return ge().getScreenSpaceOpacity()},I.updateEffect=function(){var e;e=I.getScreenSpaceOpacity(),p&&p.updateOpacity(),y&&y.updateOpacity(),I.isLocallyPaintedScrollbarLayer()&&f&&f.updateOpacity(),a.getInputDelegate()&&a.getInputDelegate().didUpdateOpacity(I),a.getIframeDelegate()&&a.getIframeDelegate().didUpdateOpacity(I),a.isDebugEnabled()&&l.setAttribute("opacity",e),function(){var e=ge().getFilters(),t=[];e?(e.forEach((function(e){t.push(function(e){switch(e.type){case Compositor.FilterType.DROP_SHADOW:return"drop-shadow("+[e.offset.x+"px",e.offset.y+"px",e.amount+"px",Sk.Paint.skColorToCSSColor(e.drop_shadow_color)].join(" ")+")";default:return""}}(e))})),I.isFixedToViewport()||me("position","absolute"),me("filter",t.join(" "))):me("filter",null),a.isDebugEnabled()&&(e?l.setAttribute("sv-filter",Util.splunkify(e)):l.hasAttribute("sv-filter")&&l.removeAttribute("sv-filter"))}(),a.getConfig().allowMFI()&&function(){var e;BrowserDetect.isIE()||BrowserDetect.isMobileSafari()&&BrowserDetect.getVersion()<13||(ge().hasRoundedCorners()?Q&&(I.isFixedToViewport()||me("position","absolute"),e=a.projectMFI(I),q&&Sk.RRect.isEqual(q,e)||(q=e,(R||(A=new Sk.SVGEmitter,R=new Sk.PathTools(A)),R).drawRRectPath(q),me("clip-path",'path("'+A.flushPathList().join(" ")+'")'),a.isDebugEnabled()&&l.setAttribute("mfi",Util.splunkify(q)))):q&&(q=null,me("clip-path",null),a.isDebugEnabled()&&l.setAttribute("mfi",null)))}()},I.updateDebugRects=function(e,t,r,n,i){var o,s,l,c,d,u;if(a.isDebugEnabled()&&!BrowserDetect.isIE10()&&((l=B[e])&&(l.parentNode&&l.parentNode.removeChild(l),delete B[e],l=null),t.length)){for(B[e]=l=document.createElement("div"),l.style.position="absolute",l.style.left="0px",l.style.top="0px",l.style.padding="0px",l.style.margin="0px",l.style.pointerEvents="none",I.applyDrawTransform(l),o=0;o<t.length;o+=1)s=t[o],(c=document.createElement("div")).style.position="absolute",c.style.left=Sk.Rect.getX(s)+"px",c.style.top=Sk.Rect.getY(s)+"px",c.style.width=Sk.Rect.getWidth(s)+"px",c.style.height=Sk.Rect.getHeight(s)+"px",c.style.padding="0px",c.style.margin="0px",c.style.opacity="0.1",c.style.backgroundColor=r,c.style.pointerEvents="none",(d=document.createElement("div")).style.position="absolute",d.style.display="inline-block",d.style.backgroundColor=r,d.style.color=n,d.style.left=Sk.Rect.getX(s)+"px",d.style.top=Sk.Rect.getY(s)+"px",d.style.whiteSpace="nowrap",d.style.pointerEvents="none",u=e,i&&(u+=" ("+i+")"),d.textContent=u,l.appendChild(c),l.appendChild(d);I.getHudDiv().appendChild(l)}},I.setDebugFilterEnabled=function(e){!BrowserDetect.isMobileSafari()&&a.isDebugEnabled()&&(l.style.filter=e?"grayscale(100%)":null)},I.getLabels=function(){var e=[];return I.isDrawable()&&e.push("kIsDrawable"),I.isContentOpaque()&&e.push("kContentsOpaque"),I.shouldCheckBackfaceVisibility()&&e.push("kShouldCheckBackfaceVisibility"),I.isCanvasBacking()&&e.push("kIsCanvasBacking"),I.hasVideoContent()&&e.push("kVideoContent"),I.isSurfaceLayer()&&(I.isSurfaceLayerWithVideo()?e.push("kSurfaceLayerWithVideo"):I.isSurfaceLayerForOSC()?e.push("kSurfaceLayerForOSC"):e.push("kSurfaceLayer")),I.isPictureLayer()&&e.push("kPictureLayer"),I.isTextureLayer()&&e.push("kTextureLayer"),I.isMaskLayer(I)&&e.push("kMaskLayer"),I.hasMainThreadScrollingReasons()&&e.push("kHasMainThreadScrollingReasons"),I.isHitTestable()&&e.push("kIsHitTestable"),I.isInnerViewportScrollLayer()&&e.push("kIVSL"),I.isOuterViewportScrollLayer()&&e.push("kOVSL"),I.isOuterViewportContentLayer()&&e.push("kOVCL"),I.isScrollable()&&e.push("kScrollable"),I.isScrollbar()&&e.push("kScrollbar"),I.isCustomScrollbar()&&e.push("kCustomScrollbar"),I.containsCustomScrollbar()&&e.push("kContainsCustomScrollbar"),I.isFixedToViewport()&&e.push("kFixed"),I.isFixedToBottom()&&e.push("kFixedToBottom"),I.isScrollbarHorizontal()&&e.push("kScrollbarHorizontal"),I.is3dSorted()&&e.push("kIs3dSorted"),e},I.updateElementIdRegistration=function(){$(Compositor.DirtyProps.kElementId|Compositor.DirtyProps.kFlags|Compositor.DirtyProps.kScrollbarProps)&&(I.isScrollable()?(t&&s.unregisterElement(t),t=I.getElementId(),s.registerElement(t,I)):I.isScrollbar()?s.registerScrollbar(I):t&&(s.unregisterElement(t),t=null))},I.shouldAnimate=function(e){var t,r,n=J[e];return!(!n||!n.visual_rects||Sk.Region.isEmpty(n.visual_rects))&&(t=(r=I.fromScreenSpaceRect(o.getDeviceViewportRect()))?Sk.Rect.intersection(r,ce()):Sk.Rect.makeEmpty(),!Sk.Rect.isEmpty(t)&&Sk.Region.intersectsRect(n.visual_rects,t))},I.invalidateRegionForImage=function(e){var t,r;p&&(r=(t=J[e])?t.visual_rects:null)&&Sk.Region.iterate(r,p.invalidateRect)},I.invalidateRemoteRegionForImage=function(e){var t=J[e],r=t?t.visual_rects:null;r&&Sk.Region.iterate(r,o.setNeedsRepaint.curry(I.id))},I.applyProperties=function(e){var t,r,n,c=o.getPropertyTrees().getScrollTree(),d=ue();e&&(N.dirty_props=Compositor.DirtyProps.kAll),$(Compositor.DirtyProps.kFlags|Compositor.DirtyProps.kBounds)&&(!a.isScrollbarVisible()&&I.isScrollbar()&&(l.style.display="none"),I.isLocallyPaintedScrollbarLayer()?function(){var e;I.isLocallyPaintedScrollbarLayer(),f||(e=I.getOwnerScrollLayer(),I.isLocallyPaintedScrollbarLayer(),!e||e.isOuterViewportScrollLayer()||e.isInnerViewportScrollLayer())||(f=new Compositor.ScrollbarDelegate(I),g.appendChild(f.create()))}():function(){if(!I.isDrawable()&&!I.isSurfaceLayerForOSC())return p&&(a.getTileManager().freeTilingSet(p),p=null),y&&(y.stop("became undrawable"),y=null),void g.childNodes.length;var e,t;I.hasVideoContent()&&!y&&(y=new Compositor.VideoDelegate(o,I))&&y.start("alloc changed"),p||(v=new Compositor.DisplayList(o,I,I.hasVideoContent()?Sk.Rect.getArea(I.getBoundsRect())>4194304?{width:2048,height:2048}:Object.freeze(I.getBounds()):I.isUntiled()?Object.freeze(I.getBounds()):Object.freeze(s.getDisplayListTileSize())),t=(e=a.getTileManager().allocTilingSet({delta_mode:I.isCanvasBacking(),layer:I,display_list:v})).getDomNode(),a.isDebugEnabled()&&t.setAttribute("id","ts:"+o.getFid()+":"+I.id),p=e,g.childNodes.length,g.appendChild(p.getDomNode()))}(),r=I.getBounds(),X=Sk.Rect.fromWH(r.width,r.height),(I.isDrawable()||I.isSurfaceLayerForOSC())&&(I.isLocallyPaintedScrollbarLayer()?f&&f.updateBounds():(p.resize(r.width,r.height,"bounds-change"),y&&y.updateSizeAndRedraw(r)))),$(Compositor.DirtyProps.kScrollTreeIndex)&&(W.scroll&&c.deregisterObserver(W.scroll),W.scroll=c.registerObserver(I.getScrollTreeIndex(),ye)),$(Compositor.DirtyProps.kEffectTreeIndex)&&o.setLayerEffectChanged(I.getID()),$(Compositor.DirtyProps.kTransformTreeIndex)&&(W.transform&&d.deregisterObserver(W.transform),W.transform=d.registerObserver(I.getTransformTreeIndex(),pe),o.setLayerProjectionChanged(I.getID())),$(Compositor.DirtyProps.kScrollbarProps)&&ye(),$(Compositor.DirtyProps.kOffsetToTransformParent)&&o.setLayerProjectionChanged(I.getID()),$(Compositor.DirtyProps.kNodeId)&&(y&&y.pairWithVideoElementIfNeeded(),p&&I.isTextureLayer()&&a.getConfig().allowClientCanvasSrc()&&p.onCanvasNodeIdChange()),$(Compositor.DirtyProps.kNonFastScrollableRegion)&&((t=I.getNonFastScrollableRects())&&t.length?s.registerNonFastLayer(I):s.unregisterNonFastLayer(I.getID())),N.loaded_tile_updates&&(v&&(v.applyTileUpdates(N.loaded_tile_updates,p.invalidateRect),a.input&&a.input.didUpdateDisplayList(I),a.getInputDelegate()&&a.getInputDelegate().didUpdateDisplayList(I),a.getIframeDelegate()&&a.getIframeDelegate().didUpdateDisplayList(I)),N.loaded_tile_updates=null),$(Compositor.DirtyProps.kAnimatedImages)&&(ve(),J=N.animated_images_metadata||{},n=o.getImageAnimationController(),Util.forEachItem(J,(function(e,t){var r=t.metadata;r&&(n.updateAnimatedImage(r),n.registerAnimationDriver(r.paint_image_id,I))})),N.animated_images_metadata=null),a.isDebugEnabled()&&(l.setAttribute("element_id",I.getElementId()),l.setAttribute("type",i),l.setAttribute("props",Util.splunkify(N)),l.setAttribute("labels",I.getLabels().join(","))),$(Compositor.DirtyProps.kNonFastScrollableRegion|Compositor.DirtyProps.kTouchActionRegion)&&a.setNeedsDrawFrame(Compositor.DrawFrameReason.kDebugRectsChanged),$(Compositor.DirtyProps.kFrameSinkId)&&N.frame_sink_id&&o.registerChildLth(I),$(Compositor.DirtyProps.kDirtyPointerEventsNone)&&I.isSurfaceForChildFrame()&&a.callback.fire("pointer-events-status-changed",N.frame_sink_id,N.pointer_events_none),N.dirty_props=0},I.getLocalDrawRect=function(){return V},I.initScreenSpaceScaleFactorForReattach=function(){I.isTextureLayer(),k=I.getScreenSpaceScaleFactor()},I.updateLocalDrawRect=function(){var e,t=V,r=I.getScreenSpaceScaleFactor(),n=!k||!vec3.equals(r,k);(I.isDrawable()||I.isSurfaceLayerForOSC())&&(e=function(e,t){var r=t;return e&&(r=Sk.Rect.makeCopy(t),Sk.Rect.subtract(r,e)),r}(t,V=function(e,t){var r,n,i,o,s=ge().isHiddenByBackfaceVisibility()||I.shouldCheckBackfaceVisibility()&&_e()?Sk.Rect.makeEmpty():(i=a.getProjectionMatrix(Compositor.Projection.kScreenSpace,I),n=Compositor.Matrix3D.mapRectIfValid(i,I.getBoundsRect()),o=a.getDrawRect(),n&&Sk.Rect.isValid(n)&&!Sk.Rect.intersects(o,n)?Sk.Rect.makeEmpty():(r=Compositor.Matrix3D.mapRectIfValid(mat4.invert(G,i),o,!0))&&Sk.Rect.isValid(r)?Sk.Rect.intersection(r,I.getBoundsRect()):I.getBoundsRect());return Sk.Rect.isEmpty(s)||t?s:e&&!function(e,t){var r,n=ce(),i=I.getScreenSpaceScaleFactor(),o=Math.max(i[0],i[1])||1;return!(Sk.Rect.isEmpty(e)&&Sk.Rect.isEmpty(t)||!Sk.Rect.isEmpty(e)&&(r=Sk.Rect.resize(e,a.getMinimumDistanceBeforeDrawRectUpdate()/o),!(!Sk.Rect.contains(r,t)||0===Sk.Rect.getX(t)&&0!==Sk.Rect.getX(e)||0===Sk.Rect.getY(t)&&0!==Sk.Rect.getY(e)||Sk.Rect.getRight(t)===Sk.Rect.getWidth(n)&&Sk.Rect.getRight(e)!==Sk.Rect.getWidth(n)||Sk.Rect.getBottom(t)===Sk.Rect.getHeight(n)&&Sk.Rect.getBottom(e)!==Sk.Rect.getHeight(n))))}(e,s)?e:s}(t,n)),p&&!Sk.Rect.isEmpty(e)&&p.invalidateRect(e,"newly-exposed"),n&&(k=r,p&&p.hardInvalidateWithTileRecalc()),Sk.Rect.isEqual(t,V)||(a.isDebugAnnotationEnabled()&&I.updateDebugRects("["+o.getFrameSinkId()+":"+I.getID()+"] DrawRect: ",[V],"indigo",JSON.stringify(V)),p&&p.freeTiles((function(e){return!Sk.Rect.intersects(I.isPictureLayer()||I.hasVideoContent()||I.isSurfaceForChildFrame()?(Sk.Rect.isValid(V),V):I.isTextureLayer()||I.isSurfaceLayerForOSC()?I.getBoundsRect():null,e.rect)}))),a.isDebugEnabled()&&l.setAttribute("draw_rect",Util.splunkify(V)),b.update())},I.drawTilesInRect=function(e){var t;return Sk.Rect.isIntRect(e),y?y.drawFrame():(t=Sk.Region.getBoundingIntRect(p.getDirtyRegion(),e),p.drawRect(t,I.isContentOpaque()))},I.fallbackToRemoteCanvasSrc=function(){v&&v.fallbackToRemoteCanvasSrc(),p&&p.hardInvalidateTilesInRect(ce())},I.updateTexture=function(e){I.isTextureLayer(),p&&(a.getConfig().isLocalDLForTextureAllowed()?(v.applyTextureUpdate(e),p.invalidateRect(e.getCullRect())):p.playback(e,e.getCullRect(),I.isContentOpaque()),e.getProperties()&Sk.PictureFlags.kHintNeedsTextureSync&&I.getLayerTreeHost().setNeedsRepaint(I.getID(),ce(),!0))},I.updateOSCSurface=function(e){I.isSurfaceLayerForOSC(),p&&p.playback(e,e.getCullRect(),I.isContentOpaque())},I.remove=function(){var e,t=I.getContainer();if(s){if(I.id,r&&r.id,r&&r.getChildren().length,y&&y.stop("remove-layer"),I.isMaskLayer())return r.setMaskLayer(null),I.setParent(null),void I.setTree(null);t.parentNode&&(t.parentNode.removeChild(t),t.parentNode),c&&c.parentNode&&(c.parentNode.removeChild(c),c.parentNode,c=null),d&&(d.removeChild(I),I.setSortingContext3D(null)),r?(e=I.getSiblingIndex(),r.getChildren().splice(e,1)):s&&s.getRoot(),I.setParent(null),I.setTree(null)}},I.getContainer=function(){return l},I.getOrCreate3dContainer=function(){return c||((c=document.createElement("div")).style.display="none",a.isDebugEnabled()&&(c.setAttribute("sibling_rank",h),c.id="layer-3d:"+o.getFid()+":"+I.id)),c},I.get3dContainer=function(){return c},I.getChildrenDiv=function(){return m},I.withEachAncestorAndSelf=function(e){for(var t=I;t;)e(t),t=t.getParent()},I.restartVideoDelegate=function(){y&&y.start("restart")},I.setSiblingRank=function(e){h=e,a.isDebugEnabled()&&(l.setAttribute("sibling_rank",e),I.is3dSorted()&&c&&c.setAttribute("sibling_rank",e))},I.getSiblingRank=function(){return h},I.getSiblingIndex=function(){return r?r.getChildren().indexOf(I):-1},I.insertChild=function(e,t,r){var n,i,s,l,c,d;if(I.id,t.getContainer(),t.getParent(),t.id,t.isMaskLayer(),I.isMaskLayer(),t.setTree(e),t.setParent(I),o.setLayerProjectionChanged(t.getID()),t.isMaskLayer())return assert_unimplemented("mask layer inserted",{lid:I.id}),void I.setMaskLayer(t);s=t.getContainer(),t.is3dSorted()&&(c=t.getSortingContextId(),(d=L[c])||(d=new Compositor.SortingContext3D(a,c),L[c]=d),l=d,t.setSortingContext3D(l),s=l.insertChild(t,r)),t.restartVideoDelegate(),i=m.childNodes,r>=0&&i.length,i.length,(n=i[r])?m.insertBefore(s,n):(assert_unimplemented(r===i.length,{sib_idx:r,layer_id:I.id,child_id:t.id,child_nodes_len:i.length}),m.appendChild(s)),O.length,O.splice(r,0,t),function(e){var t,r=0===e?null:O[e-1],n=O[e+1],i=O[e];if(O.length,r&&n){if((t=Math.floor((r.getSiblingRank()+n.getSiblingRank())/2))===r.getSiblingRank()||t===n.getSiblingRank())return void ke()}else t=r?r.getSiblingRank()+j:n?n.getSiblingRank()-j:0;t<Number.MIN_SAFE_INTEGER||t>Number.MAX_SAFE_INTEGER?ke():i.setSiblingRank(t)}(r)},I.paintsBefore=function(e){return I.getSiblingRank()<=e.getSiblingRank()},I.walkDepthFirstIterative=function(e){for(var t,r,n,i=[I];i.length&&!e(t=i.pop());)for(t.getMaskLayer()&&i.push(t.getMaskLayer()),n=(r=t.getChildren()).length-1;n>=0;n-=1)i.push(r[n])},I.getElementsDiv=function(){return S},I.release=function(){I.getContainer()&&I.getContainer().parentNode,u&&(u.release(),u=null),f&&(f.release(),f=null),E&&(E.release(),E=null),I.isSurfaceForChildFrame()&&o.unregisterChildLth(I.getSurfaceFrameSinkId()),Util.forEachItem(L,(function(e,t){t.release()})),L={},l.parentNode,l=null,!s&&I.getParent(),o.setLayerTilesBecameDirty(I.getID()),ve(),J={},v=null,y&&(y.stop("destroy"),y=null),p&&(a.getTileManager().freeTilingSet(p),p=null),a.getInputDelegate()&&a.getInputDelegate().didRemoveLayer(I),a.getIframeDelegate()&&a.getIframeDelegate().didRemoveLayer(I),Util.forEachItem(H,(function(e,t){I.deregisterCallback(t)})),Util.forEachItem(W,(function(e,t){t.tree.deregisterObserver(t)})),W={},b&&(b.release(),b=null),Y=null,q=null,R=null,A=null},I.isLive=function(){return!(!l||!l.parentNode)},I.hitTestSubtree=function(e,t){var r,n,i,o=I.getChildren(),a=ce();for(r=o.length-1;r>=0;r-=1)if(n=o[r].hitTestSubtree(e,t))return n;return I.isHitTestable()&&(i=I.hitTestPoint(e))&&Sk.Rect.containsPoint(a,i)?t(I,i):null},I.getProjectionMatrix=function(e){var t,r;return t=ue().combineTransforms(I.getTransformTreeIndex(),e),r=I.getOffsetToTransformParent(),mat4.fromTranslation(z,[r.x,r.y,0]),mat4.multiply(z,t,z)},I.getProjectionMatrixInverse=function(e){return mat4.invert(G,a.getProjectionMatrix(e,I))},I.getDrawMatrix=function(){return a.getProjectionMatrix(I.isFixedToViewport()?Compositor.Projection.kIVSL:Compositor.Projection.kOVCL,I)},I.applyDrawTransform=function(e,t,r){var n=I.getDrawMatrix(),i=0,o=0;r&&mat4.multiply(n,n,r),t&&(i=Sk.Rect.getX(t),o=Sk.Rect.getY(t)),Compositor.Matrix3D.isIdentityOr2DTranslation(n)?function(e,t,r,n,i){var o,s=Compositor.Matrix3D.getTranslation(r),l=i+s.y;I.isFixedToBottom()&&t?(o=a.getOuterViewportScrollNode().getContainerBounds().height-(l+Sk.Rect.getHeight(t)),e.style.bottom=o+"px",e.style.top=""):(e.style.top=l+"px",e.style.bottom=""),e.style.left=n+s.x+"px",e.style.transform="",e.style.transformOrigin="",e.style.transformStyle=""}(e,t,n,i,o):function(e,t,r,n,i,o){var s,l,c=o?Compositor.Matrix3D.getScale(o):{x:1,y:1,z:1};e.style.left="0px",I.isFixedToBottom()&&t?(l=a.getOuterViewportScrollNode().getContainerBounds().height-Sk.Rect.getHeight(t)/c.y,e.style.bottom=l+"px",e.style.top=""):(e.style.top="0px",e.style.bottom=""),(n||i)&&(s=mat4.create(),mat4.fromTranslation(s,vec3.fromValues(n,i,0)),mat4.multiply(r,r,s)),e.style.transform=Compositor.Matrix3D.asCSSTransformMatrix(r),e.style.transformOrigin="0px 0px 0px"}(e,t,n,i,o,r)},I.applyDrawClip=function(e,t,r){var n=null,i=0,o=0;t&&r&&(n=Sk.Rect.intersection(t,r)),n?(Sk.Rect.isEmpty(n)||(i=Sk.Rect.getX(t),o=Sk.Rect.getY(t),n=Sk.Rect.makeOffset(n,-i,-o)),BrowserDetect.isIE()||BrowserDetect.isMobileSafari()&&BrowserDetect.getVersion()<13?me("clip",Sk.Rect.toCSSClip(n),e):me("clip-path",Sk.Rect.toCSSClipPath(t,n),e)):BrowserDetect.isIE()||BrowserDetect.isMobileSafari()&&BrowserDetect.getVersion()<13?me("clip",null,e):me("clip-path",null,e)},I.applyDrawOpacity=function(e){var t=I.getScreenSpaceOpacity();1!==t&&void 0!==t||(t=null),me("opacity",t,e)},I.toScreenSpaceRect=function(e,t){var r,n;return e=e||I.getBoundsRect(),r=a.getProjectionMatrix(Compositor.Projection.kScreenSpace,I),(n=t?Compositor.Matrix3D.mapRectIfValid(r,e):Compositor.Matrix3D.mapRect(r,e))&&(n.rect_stays_rect=Compositor.Matrix3D.rectStaysRect(r)),n},I.fromScreenSpaceRect=function(e,t){var r,n=Compositor.Projection.kScreenSpace,i=I.getProjectionMatrixInverse(n);return i?t?(r=Sk.Rect.intersection(e,a.getScreenSpaceClipRect(I)),Compositor.Matrix3D.mapRect(i,r,!0)):Compositor.Matrix3D.mapRect(i,e,!0):null},I.fromScreenPoint=Se,I.toScreenPoint=function(e){var t=I.getProjectionMatrix(Compositor.Projection.kScreenSpace);return t?Compositor.Matrix3D.projectPoint(t,e):null},I.isPointClippedOut=function(e){var t=a.getScreenSpaceClipRect(I);return!Sk.Rect.containsPoint(t,e)},I.hitTestPoint=function(e){var t=Se(e);return t?I.isPointClippedOut(e)?null:t:null},I.hitsWheelEventRegion=function(e){var t=N.wheel_event_region?N.wheel_event_region:Sk.Region.makeEmpty();return Sk.Region.containsPoint(t,e)},I.hitsTouchEventRegion=function(e){return Sk.Region.containsPoint(F,e)},I.hitsTouchActionRectLocal=function(e){var t,r=N.touch_action_region;return I.hitsTouchEventRegion(e)?null:r&&Sk.Region.containsPoint(r.whole_region,e)?(t=Compositor.TouchAction.kAuto,Util.forEachItem(r.touch_actions,(function(r,n){Sk.Region.containsPoint(n,e)&&(t&=r)})),{action:t}):null},I.hitTest=function(e,t){return e===Compositor.HitTest.kLayer?I.hitTestSubtree(t,(function(e,t){return e})):e===Compositor.HitTest.kScrollingOrScrollbarLayer?I.hitTestSubtree(t,(function(e,t){return e.isScrollerOrScrollbar()?e:null})):e===Compositor.HitTest.kTextureLayer?I.hitTestSubtree(t,(function(e,t){return e.isTextureLayer()?e:null})):e===Compositor.HitTest.kDrawing?I.hitTestSubtree(t,(function(e,t){return e.getHitTestResultAt(t)})):e===Compositor.HitTest.kEventTarget?I.hitTestSubtree(t,(function(e,t){var r=e.getHitTestResultAt(t);return r&&r.getFirstHittableItem()?r:null})):e===Compositor.HitTest.kScrollableContainerId?I.hitTestSubtree(t,(function(e,t){var r;return e.getDisplayList()&&(r=e.getDisplayList().hitTestPoint(t))&&r.getItemList().length?r.hitsScrollableContainer():null})):e===Compositor.HitTest.kTouchActionRegion?I.hitTestSubtree(t,(function(e,t){return e.hitsTouchActionRectLocal(t)})):e===Compositor.HitTest.kWheelEventRegion?I.hitTestSubtree(t,(function(e,t){return e.hitsWheelEventRegion(t)})):e===Compositor.HitTest.kTouchEventRegion?I.hitTestSubtree(t,(function(e,t){return e.hitsTouchEventRegion(t)})):void 0},I.getScreenSpaceScaleFactor=function(){return mat4.getScaling([],a.getProjectionMatrix(Compositor.Projection.kScreenSpace,I))},I.getScreenSpaceScaleFactorForScroll=function(){var e;return I.isScrollbar()||I.containsCustomScrollbar(),e=I.getScreenSpaceScaleFactor(),I.isScrollbarHorizontal()?e[0]:e[1]},I.getRasterScaleFactor=function(){var e,t,r=o.getDeviceScaleFactor();return I.isTextureLayer()&&a.getConfig().allowClientCanvasSrc()?r:(e=I.getScreenSpaceScaleFactor(),0===(t=Math.max(e[0],e[1]))?1:Math.min(a.getMaxRasterScaleFactor(),Math.ceil(t*r)))},I.getLayerTreeHost=function(){return o},I.getDisplay=function(){return o.getDisplay()},I.setTilingSetVisible=function(e){p&&(p.getDomNode().style.display=e?"block":"none")},I.getTilingSet=function(){return p},I.getVideoDelegate=function(){return y},I.runOn=function(e,t){var r;r=a.callback.registerOneShot(e,0,{on_success:function(){H.hasOwnProperty(r),delete H[r],t()}}),H[r]=r},I.registerCallback=function(e,t){var r=a.callback.register(e,t);return H[r]=r,r},I.deregisterCallback=function(e){a.callback.deregister(e),delete H[e]},I.freeTiles=function(e){p&&(p.freeTiles(e),p.invalidateRect(I.getBoundsRect(),"free-tiles"))},I.id=e.id,i=e.type,o=e.lth,a=o.getDisplay(),U=e.is_mask_layer,(D=(x=document).createElement("div")).className="svl",a.isDebugEnabled()&&(D.id="layer:"+o.getFid()+":"+I.id),D.style.position="static",D.style.left=D.style.top="0px",g=x.createElement("div"),a.isDebugEnabled()&&(g.id="content"),g.style.className="scd",g.style.pointerEvents="none",m=x.createElement("div"),a.isDebugEnabled()&&(m.id="children"),S=x.createElement("div"),a.isDebugEnabled()&&(S.id="sv-elements:"+o.getFid()+":"+I.id),S.style.position="static",S.style.margin="0px",S.style.padding="0px",S.style.overflow="visible",S.style.left=S.style.top="0px",D.appendChild(g),D.appendChild(S),D.appendChild(m),D.style.transformStyle="inherit",g.style.transformStyle="inherit",m.style.transformStyle="inherit",l=D,b=new Compositor.VelocityObserver(I,(function(e,t){var r;p&&(I.isTextureLayer()&&a.getConfig().allowClientCanvasSrc()||function(e,t){return 0===t.x&&0===t.y||!!e&&(Math.sign(e.x)!==Math.sign(t.x)||Math.sign(e.y)!==Math.sign(t.y))}(e,t)&&(Math.abs(t.x)>1||Math.abs(t.y)>1||(r=I.fromScreenSpaceRect(a.getScreenRect()))&&Sk.Rect.isValid(r)&&p.setHighResWindowToRect(Sk.Rect.intersection(V,r))))}))},Compositor.GestureType={kUnknown:0,kTapDown:1,kTapUp:2,kScrollBegin:3,kScrollUpdate:4,kScrollEnd:5,kPinchBegin:6,kPinchUpdate:7,kPinchEnd:8},Compositor.TouchPhase={kBegin:0,kUpdate:1,kEnd:2},Compositor.GestureDetector=function(e){var t;function r(){t={type:Compositor.GestureType.kUnknown,touch_by_id:{},active_touch_count:0,touches:[]}}function n(r,n,i){t.type=r,t.touch_event_id=n,i||e.on_gesture_fn(t)}function i(e){var r,i=t;switch(i.type){case Compositor.GestureType.kUnknown:switch(e){case Compositor.TouchPhase.kBegin:if(1===i.touches.length)return n(Compositor.GestureType.kTapDown,i.touches[0].touch_event_id);if(2===i.touches.length)return n(Compositor.GestureType.kPinchBegin,i.touches[0].touch_event_id)}break;case Compositor.GestureType.kTapDown:switch(e){case Compositor.TouchPhase.kBegin:if(2===i.touches.length)return n(Compositor.GestureType.kPinchBegin,i.touches[0].touch_event_id);break;case Compositor.TouchPhase.kUpdate:return 1===i.touches.length&&i.touches[0].move_count>0?(i.delta=Compositor.Offset.makeZero(),i.last_pos=i.touches[0].start_pos,i.velocity=i.touches[0].velocity,n(Compositor.GestureType.kScrollBegin,i.touches[0].touch_event_id)):n(Compositor.GestureType.kTapDown,i.touches[0].touch_event_id,!0);case Compositor.TouchPhase.kEnd:if(1===i.touches.length&&i.touches[0].start_pos&&i.touches[0].end_pos&&function(e,t){return r=e,n=t,Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2))<=2;var r,n}(i.touches[0].start_pos,i.touches[0].end_pos)&&i.touches[0].move_count<=0)return n(Compositor.GestureType.kTapUp,i.touches[0].touch_event_id)}break;case Compositor.GestureType.kScrollBegin:case Compositor.GestureType.kScrollUpdate:switch(e){case Compositor.TouchPhase.kUpdate:return i.touches.length,i.touches[0].move_count,r=i.touches[0].pos,i.delta=Compositor.Offset.subtract(r,i.last_pos),i.last_pos=r,i.velocity=i.touches[0].velocity,n(Compositor.GestureType.kScrollUpdate,i.touches[0].touch_event_id);default:return n(Compositor.GestureType.kScrollEnd,i.touches[0].touch_event_id)}case Compositor.GestureType.kPinchBegin:case Compositor.GestureType.kPinchUpdate:switch(e){case Compositor.TouchPhase.kUpdate:return i.touches.length,n(Compositor.GestureType.kPinchUpdate,i.touches[0].touch_event_id);default:return n(Compositor.GestureType.kPinchEnd,i.touches[0].touch_event_id)}}return n(Compositor.GestureType.kUnknown,0,!0)}function o(e){return"number"==typeof e.clientX&&e.clientY,MetricsUtils.clientToScreenPos(e.clientX,e.clientY)}function a(e,t){var r,n,i;e.pos=t,e.pos_hist.length>=2&&e.pos_hist.shift(),e.pos_hist.push({val:t,ts:Date.now()}),e.velocity=(r=e.pos_hist).length<2||i<=0||(i=r[r.length-1].ts-r[0].ts)<=0?Compositor.Offset.makeZero():(n=Compositor.Offset.subtract(r[r.length-1].val,r[0].val),Compositor.Offset.makeXY(n.x/i,n.y/i))}function s(e,n){t&&(n.end_pos=n.pos,n.end_pos,a(n,n.pos),n.touch_event_id=e.event_id,delete t.touch_by_id[n.identifier],t.active_touch_count-=1,t.active_event=e,t.active_touch_count,i(Compositor.TouchPhase.kEnd),0===t.active_touch_count&&r())}function l(r,n){var s;if("touchstart"===r.type)return s={start_pos:o(n),pos:o(n),pos_hist:[{val:o(n),ts:Date.now()}],velocity:Compositor.Offset.makeZero(),move_count:0,identifier:n.identifier,touch_event_id:r.event_id},t.touch_by_id[n.identifier],e.hit_test_touch_event(r,o(n)),t.touch_by_id[n.identifier]=s,t.touches.push(s),t.active_touch_count+=1,t.hits_non_fast_region=r.hits_non_fast_region,t.allowed_touch_actions=r.allowed_touch_actions,t.active_event=r,void i(Compositor.TouchPhase.kBegin);r.type,(s=t.touch_by_id[n.identifier])&&(s.touch_event_id=r.event_id,s.move_count+=1,a(s,o(n)),t.active_event=r,i(Compositor.TouchPhase.kUpdate))}this.processEvent=function(e){var r,n=t;if(function(e){e.touches&&t&&(Util.forEachItem(t.touch_by_id,(function(t,r){var n;for(n=0;n<e.touches.length;n+=1)if(t===String(e.touches[n].identifier))return;s(e,r)})),"touchstart"===e.type&&function(e){var r,n;for(r=0;r<e.changedTouches.length;r+=1)(n=t.touch_by_id[e.changedTouches[r].identifier])&&s(e,n)}(e))}(e),"touchstart"===e.type||"touchmove"===e.type)for(r=0;r<e.changedTouches.length;r+=1)l(e,e.changedTouches[r]);return n},this.getPendingGesture=function(){return t},r()},Compositor.TouchTracker=function(e){var t=this,r=e.getMainFrame().getFid(),n=[],i={},o=!1;function a(e){switch(e){case"touchstart":return 0;case"touchmove":return 1;case"touchend":return 2;case"touchcancel":return 3}return-1}function s(e){return i[e]}function l(t,i){var o,a,l,c,d=MetricsUtils.clientToScreenPos(t.clientX,t.clientY),u=Compositor.Offset.makeXY(d.x,d.y);if(o=s(t.identifier)){if(a=o.i,c=e.getSurfaceLayerForFrame(r)){if(!(l=c.fromScreenPoint(d)))return null;u.x=l.x,u.y=l.y}}else{if(o={},(a=function(){var e;for(e=0;e<16;e+=1)if(!n[e])return e;return-1}())<0)return null;e.findTargetAndCallback(d,(function(e,t){return r=e,u.x=t.x,u.y=t.y,!0}))}return o.i=a,o.s=i,o.x=d.x,o.y=d.y,o.wx=u.x,o.wy=u.y,o.rx=void 0!==t.radiusX?t.radiusX:1,o.ry=void 0!==t.radiusY?t.radiusY:1,o.ra=void 0!==t.rotationAngle?t.rotationAngle:0,o.f=void 0!==t.force?t.force:1,o}function c(e,t){var r;switch(e){case"touchstart":case"touchmove":if(!(r=l(t,"touchstart"===e?0:1)))return;n[r.i]=r,i[t.identifier]=r;break;case"touchend":case"touchcancel":if(!(r=s(t.identifier)))return;r.s="touchend"===e?2:3}}t.isTouchEnd=function(e){return"touchend"===e.type||"touchcancel"===e.type},t.pendingTouchEnd=function(){return o},t.cancelTouch=function(e){if("touchcancel"!==e.type&&window.TouchEvent){var r=new TouchEvent("touchcancel",{touches:e.touches,targetTouches:e.targetTouches,changedTouches:e.changedTouches,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey});r.event_id=e.event_id,r.hits_touch_region=e.hits_touch_region,r.hits_non_fast_region=e.hits_non_fast_region,t.processEvent(r)}else t.processEvent(e)},t.processEvent=function(s){var l;"touchstart"===s.type?o=!0:t.isTouchEnd(s)&&(o=!1),function(e){var t;for(t=0;t<e.changedTouches.length;t+=1)c(e.type,e.changedTouches[t])}(s),(l=function(){var e,t,r=[];for(t=0;t<16&&(e=n[t]);t+=1)e.i,r.push(e);return r}()).length&&e.sendCommand(["t",r,a(s.type),s.event_id,l]),s.touches.length||(i={},n=[],r=e.getMainFrame().getFid())}},Compositor.InputDelegate=function(e,t){var r,n,i,o,a,s,l=this,c=t.getMainFrame(),d={x:0,y:0},u={key:0,input:0,touch:0,click:0,mouse:0},f=!1,p={},g=null,m=null,_=!1,h=1,y=c.getFid();function v(e){return"touchstart"===e.type||"touchend"===e.type||"touchmove"===e.type||"touchcancel"===e.type}function k(e){return"keydown"===e.type||"keypress"===e.type||"keyup"===e.type}function S(e){return"mousemove"===e.type||"mousedown"===e.type||"mouseup"===e.type||"mouseout"===e.type||"contextmenu"===e.type||"click"===e.type}function b(e){return"wheel"===e.type}function w(e,r){t.sendCommand(["g",e,r])}function C(e,r){var n,i=t.getLthForFrame(e.fid)||c,a=i.hitTest(Compositor.HitTest.kDrawing,e.pos),s=null,l=null;return a&&(l=a.getLayer(),s=function(e){return e.hitsFormControlNode()||e.hitsNodeWithLink()||e.hitsTextNode()||e.hitsImageNode()}(a),e.htr=a),!s&&r&&(n=function(e,r){var n,i,o,a,s=r.hitTest(Compositor.HitTest.kLayer,e);return s&&(i=s.getDisplayList())?(a=t.getConfig(),(n=s.fromScreenSpaceRect(Sk.Rect.makeFromMidpoint(e,a.getTouchSize().width/2,a.getTouchSize().height/2),!0))&&(o=i.hitTestRect(n))?{item:o.getItemClosestToPoint(e),layer:s}:null):null}(e.pos,i))&&(s=n.item,l=n.layer),s&&l?(s.data.node_uid,o.hitLock(s.data.node_uid,l)):null}function T(){o&&o.transferFocusTo(m),m=null,s=null}function E(e){f||o.hitUnlockAll(r)}function A(e,t,r){r.fid=e,r.x=t.x,r.y=t.y}function R(a){"selectionchange"===a.type&&function(){var e=window.getSelection(),n=!e.isCollapsed,i=0!==e.rangeCount?e.getRangeAt(0).getBoundingClientRect():{x:0,y:0,width:0,height:0},a=MetricsUtils.clientToScreenPos(i.x,i.y),s=MetricsUtils.clientToScreenPos(i.x+i.width,i.y+i.height),l=t.getConfig(),c=l.getSelectionOverApproximation().horizontal,d=l.getSelectionOverApproximation().vertical;if(e.isCollapsed,e.isCollapsed,e.anchorNode,e.focusNode,f=n)return window.visualViewport&&window.visualViewport.dispatchEvent&&BrowserDetect.isMobileSafari()&&window.visualViewport.dispatchEvent(new CustomEvent("scroll")),c=Math.max(o.getMaxSelectionChangeDelta().x,c),d=Math.max(o.getMaxSelectionChangeDelta().y,d),a.x-=c,a.y-=d,s.x+=c,s.y+=d,void o.hitLockAllTextNodes(Sk.Rect.fromLTRB(a.x,a.y,s.x,s.y));o.hitUnlockAll(r)}(),k(a)&&p.keyboard.dispatchEvent(a),(S(a)||b(a))&&(!BrowserDetect.supportsTouchEvents()||Date.now()-u.touch>t.getConfig().getMouseEmulationTimeoutMs())&&p.mouse.dispatchEvent(a),b(a)&&p.wheel.dispatchEvent(a),v(a)&&function(t){var r;h+=1,t.event_id=h,t.hits_non_fast_region=!1,(r=n.processEvent(t)).forward_to_surrogate,r.forward_to_surrogate&&(f?i.pendingTouchEnd()&&i.isTouchEnd(t)&&i.cancelTouch(t):i.processEvent(t)),e.callback.fire("interaction",t)}(a)}function x(t){var n;t.target&&t.target.hasAttribute&&t.target.hasAttribute("data-ui-sv-prevent-push")||(e.detached?e.prevent_reattach||(e.detached=!1,Util.xframe_reload()):(function(e){(function(e){return"keydown"===e.type||"keypress"===e.type||"keyup"===e.type||"compositionstart"===e.type||"compositionupdate"===e.type||"compositionend"===e.type||"input"===e.type||"beforeinput"===e.type||"textInput"===e.type||"selectionchange"===e.type})(e)||k(e)?(u.input=Date.now(),k(e)&&(u.key=u.input)):v(e)?(BrowserDetect.supportsTouchEvents(),u.touch=Date.now(),"touchstart"!==e.type&&"touchmove"!==e.type||(d={x:e.touches[0].clientX,y:e.touches[0].clientY})):(S(e)||b(e))&&(u.mouse=Date.now(),"mousedown"===e.type&&(u.click=u.mouse),d={x:e.clientX,y:e.clientY})}(t),R(t),(n=o.findElement(r))&&n.processInputEvent&&n.processInputEvent(t)))}function D(e){var t=e?EventListener.addListener:EventListener.removeListener;["compositionstart","compositionupdate","compositionend","input","beforeinput","textInput","change"].forEach((function(e){t(window,e,x,!1)})),["selectionchange"].forEach((function(e){t(document,e,x,!1)}))}function I(e,t){var r=e?EventListener.addListener:EventListener.removeListener;["touchstart","touchmove","touchcancel","touchend"].forEach((function(e){r(window,e,x,!0,t)}))}l.doPointerDown=function(e){var r=t.getLthForFrame(e.fid),n=C(e,!0);e.forward_to_surrogate=!0,n&&(e.hit_node_uid=n.node_uid,n.processPointerEvent&&(e.forward_to_surrogate=n.processPointerEvent(e))),r&&r.getScrollDelegate().stopScrollAnimation()},l.doPointerUp=function(e){var t=o.findElement(e.hit_node_uid),n=o.findElement(r);t?(t.processPointerEvent&&(e.forward_to_surrogate=t.processPointerEvent(e)),e.type===Compositor.EventType.kTouch&&o.hitUnlock(t)):(e.active_event.preventDefault(),n&&n.getNode().blur&&n.getNode().blur(),window.getSelection().collapse(null)),e.type!==Compositor.EventType.kTouch||f||o.hitUnlockAll(r)},l.doPointerMove=function(e){var t=C(e);t&&!f&&o.hitUnlockAll(t.node_uid)},l.doPointerClick=function(e){l.doPointerDown(e),l.doPointerUp(e)},l.getLastActivityTime=function(){return{key:u.key,mouse:Math.max(u.mouse,u.touch),click:u.click,input:u.input}},l.getLastMousePos=function(){return d},l.release=function(){I(!1,!1),D(!1),m=null,s&&(clearTimeout(s),s=null),o&&(o.release(),o=null),Util.forEachItem(p,(function(e,t){t.release()})),p=null},l.didRemoveLayer=function(e){o.didRemoveLayer(e)},l.didUpdateProjection=function(e){o.didUpdateProjection(e)},l.didUpdateOpacity=function(e){o.didUpdateOpacity(e)},l.didUpdateDisplayList=function(e){o.didUpdateDisplayList(e),_&&function(){var e,t=document.activeElement;if(!g)return _=!1,Sk.disabledRemoteCaret=!0,void(t&&"function"==typeof t.blur&&t.blur());(e=o.findElement(g))?(_=!1,e.showRemoteCaret&&(Sk.disabledRemoteCaret=!e.showRemoteCaret()),e.getNode()&&e.getNode().focus&&e.getNode()!==t&&e.getNode().focus()):m=g}()},l.getShadowElementManager=function(){return o},l.getCurrentHitTestResult=function(){return a},l.getDisplay=function(){return t},l.getSafeview=function(){return e},l.isLocallyHandledHitElement=function(e){return!!Util.findPredicateOnBranch(e.target,(function(e){return e.getAttribute&&!!e.getAttribute("sv-prevent-push")}))},l.getMouseDelegate=function(){return p.mouse},e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_FOCUS_ELEMENT,(function(e,r,n){var i=t.getFrameToken(e),o=Sk.Util.getNodeKey(i,r);g!==o&&(g=o,_=!0)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_FOCUS_OUT,(function(e,r,n){var i=t.getFrameToken(e),a=Sk.Util.getNodeKey(i,r);o.findElement(a),g=null,_=!0})),e.interp.registerOpcodeHandler("htr",(function(e,r,n,i,o,s,l,c,d,u,f,p){a={is_text:r,is_selected:n,is_editable:i,url:o,link_target_blank:s,cursor_name:l,frame_id:e,title:c,node_id:d,viewport_bounds:t.toScreenBounds(e,u),select_items:f,non_text_input:p}})),t.callback.register("added-shadow-element",(function(e,t){t.updateShadowElementClip()})),t.callback.register("removed-shadow-element",(function(e,t){r===e&&(r=null),t.isLive()&&t.updateShadowElementClip()})),t.callback.register("shadow-element-focus-change",(function(e,t,n){if(n){if(r===e)return;return r&&(o.hitUnlock(r),r=null),o.hitLock(e,t),void(r=e)}r===e&&(o.hitUnlock(r),r=null)})),n=new Compositor.GestureDetector({on_gesture_fn:function(e){switch(e.type){case Compositor.GestureType.kUnknown:break;case Compositor.GestureType.kTapDown:!function(e){var r,n,i=e.touches[0].start_pos;t.findTargetAndCallback(i,(function(e,t){return n=e,!0})),r={pos:i,fid:n,type:Compositor.EventType.kTouch,active_event:e.active_event},l.doPointerDown(r),e.hit_node_uid=r.hit_node_uid,e.forward_to_surrogate=r.forward_to_surrogate,e.pointer_ctx=r}(e);break;case Compositor.GestureType.kTapUp:!function(e){l.doPointerUp(e.pointer_ctx),e.forward_to_surrogate=e.pointer_ctx.forward_to_surrogate,BrowserDetect.isMobileSafari()&&o.registerUserInitiatedFocusIfNeeded(e)&&(s&&(clearTimeout(s),s=null),s=setTimeout(T,1e3))}(e);break;case Compositor.GestureType.kScrollBegin:case Compositor.GestureType.kScrollUpdate:case Compositor.GestureType.kScrollEnd:e.type===Compositor.GestureType.kScrollBegin&&E(),function(e){var r,n,i,o=e.touches[0].pos,a={fid:c.getFid(),x:o.x,y:o.y},s=new Compositor.ScrollState(Compositor.EventType.kTouch,Compositor.Offset.makeXY(o.x,o.y),Compositor.Offset.scale(e.delta,-1),Compositor.Offset.scale(e.velocity,-1)),l=Compositor.ScrollAction.kNoAction,d=c.getScrollDelegate(),u=!1;if(e.type===Compositor.GestureType.kScrollBegin?t.findTargetAndCallback(o,(function(n,i){var c;return!!(r=t.getLthForFrame(n))&&(d=r.getScrollDelegate(),(l=d.doScroll(e.type,s))===Compositor.ScrollAction.kRequiresMainThreadHitTest&&(d.doScroll(Compositor.GestureType.kScrollEnd),s.reset(),(c=r.hitTest(Compositor.HitTest.kScrollableContainerId,o))&&(s.setHasMainThreadHitTestedReasons(),s.setTargetElementId(c.data.scrollable_container_id),l=d.doScroll(e.type,s))),l===Compositor.ScrollAction.kForwardToNextFrame?(d.doScroll(Compositor.GestureType.kScrollEnd),s.reset(),!1):(y=n,A(n,i,a),!0))})):e.type===Compositor.GestureType.kScrollUpdate?(r=t.getLthForFrame(y))&&(d=r.getScrollDelegate(),l=d.doScroll(e.type,s),(n=t.getSurfaceLayerForFrame(y))&&((i=n.fromScreenPoint(o))?A(y,i,a):l=Compositor.ScrollAction.kNoAction)):(e.type,Compositor.GestureType.kScrollEnd,function(e){var r=t.getLthForFrame(y);r&&r.getScrollDelegate().doScroll(Compositor.GestureType.kScrollEnd,e),y=c.getFid(),Compositor.ScrollAction.kNoAction}(s)),l===Compositor.ScrollAction.kForwardToSurrogate)return u=d.didHandlerPreventDefault(Compositor.EventType.kTouch),e.active_event.preventDefault(),void(u||function(e,t){var r,n=e.touches[0].pos;switch(e.type){case Compositor.GestureType.kScrollBegin:r={t:"sb",x:n.x,y:n.y,wx:t.x,wy:t.y};break;case Compositor.GestureType.kScrollUpdate:r={t:"su",x:n.x,y:n.y,wx:t.x,wy:t.y,dx:e.delta.x,dy:e.delta.y};break;case Compositor.GestureType.kScrollEnd:r={t:"se",x:n.x,y:n.y,wx:t.x,wy:t.y}}e.touch_event_id,r.tid=e.touch_event_id,w(t.fid,r)}(e,a));l===Compositor.ScrollAction.kPreventNativeScroll&&e.active_event.preventDefault()}(e);break;case Compositor.GestureType.kPinchBegin:case Compositor.GestureType.kPinchUpdate:case Compositor.GestureType.kPinchEnd:e.type===Compositor.GestureType.kPinchBegin&&E(),function(e){var r,n=e.touches[0].pos,i={fid:c.getFid(),x:n.x,y:n.y};if(function(e){var t=e.allowed_touch_actions;return!(!t||(t.action&Compositor.TouchAction.kPinchZoom)!==Compositor.TouchAction.kNone&&!t.hits_touch_event_region)}(e)){switch(t.findTargetAndCallback(n,(function(e,t){return A(e,t,i),!0})),e.type){case Compositor.GestureType.kPinchBegin:r={t:"pb",x:n.x,y:n.y,wx:i.x,wy:i.y};break;case Compositor.GestureType.kPinchUpdate:r={t:"pu",x:n.x,y:n.y,wx:i.x,wy:i.y,scale:.5};break;case Compositor.GestureType.kPinchEnd:r={t:"pe",x:n.x,y:n.y,wx:i.x,wy:i.y}}r.tid=e.touch_event_id,e.active_event.preventDefault(),w(i.fid,r)}}(e)}},hit_test_touch_event:function(e,r){e.allowed_touch_actions||t.findTargetAndCallback(r,(function(n,i){var o,a=t.getLthForFrame(n);return!!a&&(e.allowed_touch_actions={action:Compositor.TouchAction.kAuto},(o=a.hitTest(Compositor.HitTest.kTouchActionRegion,r))?e.allowed_touch_actions.action=o.action:e.allowed_touch_actions.hits_touch_event_region=a.hitTest(Compositor.HitTest.kTouchEventRegion,r),!0)}))}}),o=new Compositor.ShadowElementManager(t),i=new Compositor.TouchTracker(t),p.mouse=new Compositor.MouseDelegate(l,x),p.wheel=new Compositor.WheelDelegate(l,x),p.keyboard=new Compositor.KeyboardDelegate(l,x),p.drag_and_drop=new Compositor.DragDropDelegate(l,x),D(!0),I(!0,!1),function(){var t="";BrowserDetect.isMobile()&&(t+="*:not(input):not(textarea) {user-select: none; -user-select: none; -webkit-user-select: none; -moz-user-select; -ms-user-select: none;}"),BrowserDetect.isAndroidChrome()&&(t+="\nspan::selection {color: rgba(0,0,0,0); background-color: rgba(172, 206, 247, 0.6);}"),Compositor.Util.toggleStyle("sv-selection-style",t),function(){var t="@font-face {font-family: 'Menlo-Square'; src: local('Menlo-Square'), url('"+e.url_builder.buildAssetURL("/safeview-static/fonts/Menlo-Square.otf")+"');}";t+="\n@font-face {font-family: 'Menlo-Password'; src: local('Menlo-Password'), url('"+e.url_builder.buildAssetURL("/safeview-static/fonts/Menlo-Password.otf")+"');}",Compositor.Util.toggleStyle("sv-shadow-font",t)}()}(),Compositor.Util.toggleStyle("sv-input-style",'input[type=search]::-ms-clear {  display: none; width : 0; height: 0; }\ninput[type=search]::-ms-reveal {  display: none; width : 0; height: 0; }\ninput[type="search"]::-webkit-search-decoration,\ninput[type="search"]::-webkit-search-cancel-button,\ninput[type="search"]::-webkit-search-results-button,\ninput[type="search"]::-webkit-search-results-decoration { display: none; }\n')},Compositor.MouseButton=Object.freeze({kLeftButton:0,kMiddleButton:1,kRightButton:2}),Compositor.MouseDelegate=function(e,t){var r,n,i,o,a,s=this,l=new Logger("mouse",{level:"info"}),c=e.getSafeview(),d=e.getDisplay(),u=d.getMainFrame(),f=Compositor.Offset.makeZero(),p={x:0,y:0,type:""},g={x:0,y:0,fid:u.getFid()},m=0,_={},h=!1,y=!1;function v(){i&&(clearTimeout(i),i=null,d.sendCommand(r),r=null,n=null)}function k(e){return BrowserDetect.isIE()&&("mousedown"===e.type||"mouseup"===e.type||"mousemove"===e.type)&&e.detail>=4&&e.detail>m?m:e.detail}function S(e,t,r){r.fid=e,r.x=t.x,r.y=t.y}function b(t){var r=!0;return"mousemove"===t.type?(a={pos:p,fid:g.fid,type:Compositor.EventType.kMouse,active_event:t},t.buttons&&(h=!0),e.doPointerMove(a),function(e){var t;e.htr&&((t=e.htr.getFirstItem())&&t.data&&t.data.cursor?document.documentElement.style.cursor=Compositor.CSS.toCursorName(t.data.cursor):document.documentElement.style.cursor=null)}(a)):"mousedown"===t.type?(y||(a={pos:p,fid:g.fid,type:Compositor.EventType.kMouse,active_event:t,forward_to_surrogate:!0},e.doPointerDown(a),y=!0),r=!!a.forward_to_surrogate):"mouseup"===t.type?(a.type,Compositor.EventType.kMouse,a.pos=p,a.active_event=t,h||t.buttons?r=!0:(e.doPointerUp(a),r=!!a.forward_to_surrogate),t.buttons||(h=!1,y=!1,a=null)):"click"===t.type&&(a={pos:p,fid:g.fid,type:Compositor.EventType.kMouse,active_event:t},e.doPointerClick(a),r=!1),r}function w(t){var a,s,h,y,w=MetricsUtils.clientToScreenPos(t.clientX,t.clientY),C={fid:u.getFid(),x:w.x,y:w.y};if("mousedown"===t.type&&(c.clipboard.piggyback(t),c.callback.fire("interaction",t)),function(e){!BrowserDetect.isIE()||"mousedown"!==e.type&&"mouseup"!==e.type&&"mousemove"!==e.type||("mousedown"===e.type?(m+=1,o&&(clearTimeout(o),o=null)):"mouseup"===e.type&&(o=setTimeout((function(){m=0}),500)))}(t),d.callback.fire("mouse-event",t.type,w),t.type,Util.getMouseAndKeyboardModifiers(t,l),t.button,k(t),Util.get_node_tag(t.target),!d.in_page_searcher.mouse_event_search_input(t))return function(e){var t,r=e.target?Util.get_node_tag(e.target):null;return!!document.documentElement&&(e.target&&"html"!==r?(e.target,"div"===r&&(t=e.target.getBoundingClientRect(),!(e.clientX>t.left+e.target.clientWidth&&e.clientY>t.top+e.target.clientHeight)&&(e.clientX>t.left+e.target.clientWidth||e.clientY>t.top+e.target.clientHeight))):e.clientX>document.documentElement.clientWidth||e.clientY>document.documentElement.clientHeight)}(t)?(t.type,void Util.get_node_tag(t.target)):void("contextmenu"!==t.type?"mousemove"===t.type&&"mousemove"===p.type&&Compositor.Offset.isEqual(w,p)||(f=Compositor.Offset.makeXY(t.clientX,t.clientY),p.x=g.x=w.x,p.y=g.y=w.y,p.type=t.type,d.findTargetAndCallback(w,(function(e,t){return S(e,t,C),S(e,t,g),!0})),b(t)&&"click"!==t.type&&(e.isLocallyHandledHitElement(t)||(t.__sv_set_foreground=document.hasFocus(),y=Util.getMouseAndKeyboardModifiers(t,l),d.callback.fire("did-mouse-move"),a=["CM-mouse",C.fid,t.type,w.x,w.y,C.x,C.y,t.button,y,k(t)],"mousemove"===t.type&&(s=Util.calculateMouseMovement(t),n&&(s.x+=n.x,s.y+=n.y),a.push(s.x),a.push(s.y)),"mousemove"!==t.type||t.buttons?(v(),d.sendCommand(a)):(i||(i=setTimeout((function(){v()}),10)),r=a,n=s),function(e){return"mousedown"===e.type||"mouseup"===e.type}(t)&&(_[t.button]={is_down:!1,modifiers:y},"mousedown"===t.type&&(_[t.button].is_down=!0),BrowserDetect.isIE()&&"mousedown"===t.type&&(h=document.activeElement,document.body.focus(),h&&h.focus()))))):c.ctx_menu_mode&&c.ctx_menu_mode.backend_driven&&t.preventDefault())}function C(e){var r=e?EventListener.addListener:EventListener.removeListener;r(document,"mousemove",t,!1),r(document,"mousedown",t,!1),r(document,"contextmenu",t,!1),r(document,"mouseup",t,!1),r(document,"mouseout",t,!1),r(document,"click",t,!1)}s.getLastMousePosFid=function(){return g.fid},s.release=function(){C(!1)},s.dispatchEvent=function(e){switch(e.type){case"mousemove":case"mousedown":case"contextmenu":case"mouseup":case"click":w(e);break;case"mouseout":t=e,"html"===Util.get_node_tag(t.target)&&delete c.last_mouse_pos;break;case"wheel":!function(e){(p=MetricsUtils.clientToScreenPos(e.clientX,e.clientY)).type=e.type}(e)}var t},s.getScreenPos=function(){return p},s.getClientPos=function(){return f},d.callback.register("scroll-container-scrolled",(function(){Util.forEachItem(_,(function(e,t){t.is_down&&(t.is_down=!1,d.sendCommand(function(e,t,r,n,i,o,a,s,l,c,d){var u=["CM-mouse",t,"mouseup",r,n,i,o,a||0,s||0,0];return u}(0,g.fid,p.x,p.y,g.x,g.y,Number(e),t.modifiers)))}))})),C(!0)},Compositor.WheelDelegate=function(e,t){var r,n,i=this,o=new Logger("wheel",{level:"info"}),a=e.getSafeview(),s=e.getDisplay(),l=e.getMouseDelegate(),c=s.getMainFrame(),d=!1,u=c.getFid();function f(e,n){r&&(EventListener.removeListener.apply(Util,r),r=null),e&&(r=[document,"wheel",t,!1,n],EventListener.addListener.apply(Util,r))}function p(e,t){var n;e=e||l.getLastMousePosFid(),t=t||l.getScreenPos(),(n=(s.getLthForFrame(e)||c).getScrollDelegate().willScrollNatively(Compositor.EventType.kWheel,t))===d&&r||f(!0,d=n)}function g(){var e;n&&(n=null,(e=s.getLthForFrame(u))&&e.getScrollDelegate().doScroll(Compositor.GestureType.kScrollEnd),u=c.getFid())}function m(e,t,r){r.fid=e,r.x=t.x,r.y=t.y}i.dispatchEvent=function(t){t.type,function(t){var r,i,l,d=void 0===t.deltaX?0:Math.round(t.deltaX),f=void 0===t.deltaY?0:Math.round(t.deltaY),_=void 0===t.wheelDeltaX?-3*d:t.wheelDeltaX,h=void 0===t.wheelDeltaY?-3*f:t.wheelDeltaY,y=a.xbrowser.getEventTarget(t),v=MetricsUtils.clientToScreenPos(t.clientX,t.clientY),k={fid:c.getFid(),x:v.x,y:v.y},S=c.getScrollDelegate(),b=new Compositor.ScrollState(Compositor.EventType.kWheel,v,Compositor.Offset.makeZero()),w=new Compositor.ScrollState(Compositor.EventType.kWheel,v,Compositor.Offset.makeXY(d,f)),C=v;if(y){if(y.getAttribute&&!e.isLocallyHandledHitElement(t)){if(t.__sv_set_foreground=document.hasFocus(),n?(clearTimeout(n),i=s.getLthForFrame(u),(l=s.getSurfaceLayerForFrame(u))&&(C=l.hitTestPoint(v)),C&&i?(S=i.getScrollDelegate(),m(u,C,k),r=S.doScroll(Compositor.GestureType.kScrollUpdate,w),n=setTimeout((function(){g()}),100)):(g(),r=Compositor.ScrollAction.kNoAction,n=null)):(s.findTargetAndCallback(v,(function(e,t){var n;return!(!(i=s.getLthForFrame(e))||(S=i.getScrollDelegate(),(r=S.doScroll(Compositor.GestureType.kScrollBegin,b))===Compositor.ScrollAction.kRequiresMainThreadHitTest&&(S.doScroll(Compositor.GestureType.kScrollEnd),b.reset(),(n=i.hitTest(Compositor.HitTest.kScrollableContainerId,v))&&(b.setHasMainThreadHitTestedReasons(),b.setTargetElementId(n.data.scrollable_container_id),r=S.doScroll(Compositor.GestureType.kScrollBegin,b))),r===Compositor.ScrollAction.kForwardToNextFrame?(S.doScroll(Compositor.GestureType.kScrollEnd),b.reset(),1):(r=S.doScroll(Compositor.GestureType.kScrollUpdate,w))===Compositor.ScrollAction.kForwardToNextFrame?(S.doScroll(Compositor.GestureType.kScrollEnd),b.reset(),w.reset(),1):(u=e,m(e,t,k),0)))})),n=setTimeout((function(){g()}),100)),p(u,v),r===Compositor.ScrollAction.kForwardToSurrogate)return t.__sv_wheel_default_prevented=S.didHandlerPreventDefault(Compositor.EventType.kWheel),s.sendCommand(["CM-wheel",k.fid,v.x,v.y,k.x,k.y,d,f,_,h,!0,Util.getMouseAndKeyboardModifiers(t,o)]),void t.preventDefault();r===Compositor.ScrollAction.kPreventNativeScroll&&t.preventDefault(),S.getLth().hasEventListener(Compositor.EventType.kWheel)&&s.sendCommand(["CM-wheel",k.fid,v.x,v.y,k.x,k.y,d,f,_,h,!1,Util.getMouseAndKeyboardModifiers(t,o)])}}else o.error({event:"tc-wheel-event-error",reason:"invalid target"})}(t)},i.release=function(){f(!1)},s.callback.register("wheel-handler-state-changed",p),s.callback.register("wheel-event-listener-changed",p),s.callback.register("mouse-event",(function(e,t){g(),"mousemove"===e&&(p(),n&&(clearTimeout(n),n=null))})),a.interp.registerOpcodeHandler("did_wh_pd",(function(e,t){s.wheelHandlerStateChanged(e,t)})),p(),i.dispatchEvent},Compositor.KeyboardDelegate=function(e,t){var r,n=e.getSafeview(),i=e.getDisplay(),o=new KeyMap,a=i.getMainFrame(),s=a.getFid();function l(t){var l,c,d=o.getKeyCode(t),u=t.keyCode,f=t.ctrlKey,p=t.metaKey,g=t.altKey,m=!1;t.type,t.keyCode,t.charCode,l=r.get_operation(t),"keydown"!==t.type||i.in_page_searcher.is_search_focused()||(n.clipboard.piggyback(t),n.callback.fire("interaction",t)),n.callback.fire("key-event",t.target,t),n.print_handler.handlePrintKeyEventIfNeeded(t,l)||(u=Util.get_corresponding_chrome_keycode(t,u),"keypress"===t.type&&t.altKey&&(BrowserDetect.isIE()||RegExp("^.$","u").test(t.key))&&(f=!1,p=!1,g=!1,m=!0),"keyup"!==t.type&&!m&&r.tryProcess(t)||i.in_page_searcher.is_key_event_search_input(t)||e.isLocallyHandledHitElement(t)||(c=["kbd",s||a.getFid(),0,t.type,u,t.charCode,d,o.getCode(t),t.shiftKey,f,g,p,0,!1],i.sendCommand(c),function(e,t,r,n){return t||r||n||"keydown"===e.type&&!o.SPECIAL_KEYS.hasOwnProperty(e.keyCode)}(t,p,f,g)&&!i.in_page_searcher.is_search_operation(t)||t.preventDefault()))}function c(e){var r=e?EventListener.addListener:EventListener.removeListener;r(document,"keydown",t,!1),r(document,"keypress",t,!1),r(document,"keyup",t,!1),n.print_handler.attachKeyEventHandler(e)}this.dispatchEvent=function(e){l(e)},this.release=function(){c(!1)},r=new ShortcutKeyHandler(n,(function(e,t,r){switch(r){case"undo":case"redo":n.surrogate_channel.send("execcmd",s||a.getFid(),r)}return t.preventDefault(),!1})),c(!0),i.callback.register("input-focused",(function(e){s=e}))},Compositor.DragDropDelegate=function(e,t){var r=new Logger("dnd-del",{level:"info"}),n=e.getSafeview(),i=e.getDisplay(),o=i.getMainFrame(),a=e.getMouseDelegate(),s=null,l=null;function c(e,t,r,i,o,a,s,l){i.relative_to_target=!1,n.surrogate_channel.send("drag",e,{t:t,y:r,p:i,m:o,d:a,f:s,i:l})}function d(){s&&(c(s.frame,s.node,"dragleave",{x:0,y:0},{x:0,y:0},0,[{type:"text/plain"}],{0:{}}),s=null,l=null)}function u(t){var a,u,f,p,g,m,_,h,y=MetricsUtils.clientToScreenPos(t.clientX,t.clientY),v={fid:o.getFid(),x:y.x,y:y.y},k=e.getCurrentHitTestResult();n.allow_backend_dragdrop&&(i.findTargetAndCallback(y,(function(e,t){return function(e,t,r){r.fid=e,r.x=t.x,r.y=t.y}(e,t,v),!0})),k?(g=v.fid,m=k.node_id,p=t.type,t.preventDefault(),"drop"===p&&n.upload.setupDroppedUpload(t.dataTransfer.files),a={x:t.clientX,y:t.clientY,wx:v.x,wy:v.y},u=Util.calculateDragMovement(t),f=Util.getMouseAndKeyboardModifiers(t,r),_=Util.gen_dragdrop_file_list(t.dataTransfer),h=t.dataTransfer.items,s&&m===s.node||(c(g,m,"dragenter",a,{x:0,y:0},f,_,h),s&&c(s.frame,s.node,"dragleave",a,{x:0,y:0},f,_,h)),c(g,m,p,a,u,f,_,h),"drop"!==p?(s={frame:g,node:m},l&&clearTimeout(l),l=setTimeout(d,550)):s=null):i.sendCommand(["CM-mouse",v.fid,"mousemove",y.x,y.y,v.x,v.y,t.button,Util.getMouseAndKeyboardModifiers(t,r),t.detail]))}function f(e){var r=e?EventListener.addListener:EventListener.removeListener;r(document,"dragover",t||u,!1),r(document,"drop",t||u,!1)}n.interp.registerOpcodeHandler("drag-start",(function(e){var t=document.getElementById("sv-drag-img"),r=a.getClientPos(),n=r.x+"px",i=r.y+"px",o="data:image/png;base64,"+e;t||((t=document.createElement("img")).setAttribute("id","sv-drag-img"),t.src=o,t.style.position="fixed",t.style.opacity="0.7",t.style.filter="drop-shadow(0px 0px 4px gray)",t.style.left=n,t.style.top=i,t.style.transformOrigin="0px 0px 0px",t.style.transform="scale("+1/Util.getDeviceScaleFactor()+")",document.body.appendChild(t))})),n.interp.registerOpcodeHandler("drag-stop",(function(){var e=document.getElementById("sv-drag-img");e&&e.parentNode&&e.parentNode.removeChild(e)})),this.release=function(){f(!1)},f(!0),i.callback.register("did-mouse-move",(function(){var e,t;e=document.getElementById("sv-drag-img"),t=a.getClientPos(),e&&(e.style.left=t.x+"px",e.style.top=t.y+"px")}))},Compositor.IframeDelegate=function(e,t){var r=this,n={};function i(e,t,r){var i=n[e],o=!1;i&&(i.layer!==t?o=!0:i.item&&r&&(Sk.Rect.isEqual(i.item.visual_rect,r.visual_rect)||(o=!0)),o&&(i.layer&&i.layer.getID(),t&&t.getID(),i.item,i.layer=t,i.item=r,a(i)))}function o(e){var t=n[e];t&&(t.node.parentNode&&t.node.parentNode.removeChild(t.node),delete n[e])}function a(e){e.layer&&e.item?(e.node.parentNode!==e.layer.getContainer()&&e.layer.getContainer().appendChild(e.node),function(e){Sk.Rect.toCSSStyle(e.item.visual_rect,e.node.style)}(e),s(e),l(e),c(e)):e.node.parentNode&&e.node.parentNode.removeChild(e.node)}function s(e){e.layer.applyDrawTransform(e.node,e.item.visual_rect)}function l(e){e.layer.applyDrawClip(e.node,e.item.visual_rect,e.layer_clip_rect)}function c(e){e.layer.applyDrawOpacity(e.node)}r.getIframeNodeForFrame=function(e,n){var i,o,a,s,l;for(i=e,o=t.getLthForFrame(i);!o&&(s=getNodeByFrameFid(i));)i=s.fid,o=t.getLthForFrame(i);return o?(o.getLayerTree().walkDepthFirst((function(e){var t=e.getDisplayList(),r=t?t.hitTestRect(e.getBoundsRect()):null;r&&r.getItemList().some((function(t){var r=t.data;return r.frame_token===n&&r.type===Sk.HT.ElementType.kPlugInElement&&(a=e,l=t,!0)}))})),a?r.getIframeNode(n,a,l):r.getIframeNode(n,null,null)):null},r.getIframeNode=function(e,r,o){return n.hasOwnProperty(e)?i(e,r,o):function(e,r,i){var o=document.createElement("iframe");r&&r.getID(),t.isDebugEnabled()&&(o.id="iframe:"+e),o.style.display="block",o.style.position="absolute",o.style.border="0px",n[e]={node:o,layer:r,item:i,layer_clip_rect:null},a(n[e])}(e,r,o),n[e].node},r.didUpdateDisplayList=function(e){var t,r,o;Util.isDictEmpty(n)||(r=(t=e.getDisplayList())?t.hitTestRect(e.getBoundsRect()):null)&&(o=r.getItemList(),Util.forEachItem(n,(function(t,r){var n,a,s=null;for(a=0;a<o.length;a++)if((n=o[a]).data.frame_token===t&&n.data.type===Sk.HT.ElementType.kPlugInElement){s=n;break}s?i(t,e,s):r.layer===e&&i(t,null,null)})))},r.didRemoveLayer=function(e){Util.forEachItem(n,(function(t,r){r.layer===e&&i(t,null,null)}))},r.didUpdateProjection=function(e){Util.forEachItem(n,(function(t,r){r.layer===e&&s(r)}))},r.didUpdateClip=function(e,t){Util.forEachItem(n,(function(r,n){n.layer===e&&(n.layer_clip_rect||t)&&(n.layer_clip_rect&&t&&Sk.Rect.isEqual(n.layer_clip_rect,t)||(n.layer_clip_rect=t?Sk.Rect.makeCopy(t):null,l(n)))}))},r.didUpdateOpacity=function(e){Util.forEachItem(n,(function(t,r){r.layer===e&&c(r)}))},r.release=function(){Util.forEachItem(n,(function(e,t){o(e)})),Util.isDictEmpty(n)},e.callback.register("ftim-updated",(function(e,t,r){r&&Util.forEachItem(n,(function(t,r){t===e&&o(t)}))}))},Compositor.LayerTree=function(e,t,r){var n,i,o,a,s=this,l=new Logger("layer-tree",{level:"info"}),c=t.getDisplay(),d={},u={},f={},p={},g={},m=1,_=!1,h={};function y(e){return f[e]||(f[e]={}),f[e]}function v(e){var t;((t=d[e]).isScrollbar()||t.containsCustomScrollbar())&&s.unregisterScrollbar(t),t.release(),s.unregisterElement(t.getElementId()),s.unregisterNonFastLayer(e),delete d[e]}function k(e){return"number"==typeof e}function S(e){var r=t.getRootLayerId(),n={};k(r),e.forEach((function(e){var o,a,c,u=e.type,f=e.layer_id,p=f===r;k(f),u===Compositor.MutationType.kAddLayer?(o=e.layer_parent_id,a=e.layer_sibling_index,(c=s.getLayer(f))||(c=new Compositor.Layer({id:f,type:e.layer_type,is_mask_layer:-1===a,lth:t})),delete n[f],p?s.setRoot(c):(k(o),s.getLayer(o).insertChild(s,c,a)),function(e,t){d[e]=t}(f,c)):u===Compositor.MutationType.kRemoveLayer?(c=s.getLayer(f),n.hasOwnProperty(f),c?(c.walkDepthFirstIterative((function(e){e.remove(),i===e&&(i=null),n[e.id]=e})),c.getContainer().parentNode):l.error({event:"tc-layer-not-found-on-removal",id:f})):l.error({event:"tc-unknown-mutation-type",type:u})})),Util.forEachItem(n,(function(e,t){String(t.id),t.id,v(t.id)}))}function b(){i&&i.walkDepthFirstIterative((function(e){e.remove(),v(e.id)})),n.childNodes.length,Util.isDictEmpty(d),i=null}s.walkDepthFirst=function(e){i.walkDepthFirstIterative(e)},s.getLayer=function(e){return d.hasOwnProperty(e)?d[e]:null},s.getLayerByElementId=function(e){return u.hasOwnProperty(e)?u[e]:null},s.withEachLayerDo=function(e){Util.forEachItem(d,e)},s.withEachNonFastLayerDo=function(e){Util.forEachItem(p,e)},s.updateScrollbarGeometries=function(){_&&(Util.forEachItem(f,(function(e,r){var n,i,o,a,d,u,f,p,m,_,h,y;(o=(n=(i=t.getPropertyTrees()).getScrollTree()).findNodeFromElementId(e))&&(a=n.getScrollOffset(e),d=o.getContentBounds(),u=o.getContainerBounds(),(f=o===c.getInnerViewportScrollNode()||o===c.getOuterViewportScrollNode())&&(p={width:u.width,height:u.height},o===c.getInnerViewportScrollNode()?(m=c.getOuterViewportScrollNode(),a=Compositor.Offset.add(a,n.getScrollOffset(m.getElementId())),h=m.getContainerBounds(),p=Compositor.Bounds.setToMin(p,h),d=m.getContentBounds()):(_=c.getInnerViewportScrollNode(),a=Compositor.Offset.add(a,n.getScrollOffset(_.getElementId())),y=_.getContainerBounds(),p=Compositor.Bounds.setToMin(p,y)),p=Compositor.Bounds.scale(p,1/g.current),u=Compositor.Bounds.ceil(p)),Util.forEachItem(r,(function(t,r){var n,o=s.getLayer(r);o?(o.containsCustomScrollbar()?((n=o.getCustomScrollbarHelper()).setCurrentOffset(a),n.setClipLayerSize(u),n.setScrollLayerSize(d)):o.isScrollbarHorizontal()?(o.setCurrentPos(a.x),o.setClipLayerLength(u.width),o.setScrollLayerLength(d.width)):(o.setCurrentPos(a.y),o.setClipLayerLength(u.height),o.setScrollLayerLength(d.height)),f&&o.setVerticalAdjust(i.getInnerViewportContainerBoundsDelta().y)):l.warn({event:"no-scrollbar",id:r,scrolling_element_id:e})})))})),_=!1)},s.setScrollbarGeometriesNeedUpdate=function(){_=!0},s.getScrollbarsFor=function(e){var t=[],r=y(e);return r.horizontal&&0!==r.horizontal&&t.push(s.getLayer(r.horizontal)),r.vertical&&0!==r.vertical&&t.push(s.getLayer(r.vertical)),t},s.registerElement=function(e,t){0!==e&&(u.hasOwnProperty(e),u[e]=t)},s.unregisterElement=function(e){0!==e&&delete u[e]},s.withEachScrollbarLayerDo=function(e){Util.forEachItem(f,(function(t,r){Util.forEachItem(r,(function(t,r){return e(r,s.getLayer(r))}))}))},s.registerScrollbar=function(e,r){var n=y(e.getScrollElementId()),i=r;e.isScrollbar()&&(i=e.isScrollbarHorizontal()),i?n.horizontal=e.getID():n.vertical=e.getID(),s.setScrollbarGeometriesNeedUpdate(),t.getScrollbarController().didRegisterScrollbar(e)},s.unregisterScrollbar=function(e,r){var n=e.getScrollElementId(),i=y(n),o=r;e.isScrollbar()&&(o=e.isScrollbarHorizontal()),e.containsCustomScrollbar()&&void 0===r?(i.horizontal===e.getID()&&delete i.horizontal,i.vertical===e.getID()&&delete i.vertical):o?delete i.horizontal:delete i.vertical,i.hasOwnProperty("horizontal")||i.hasOwnProperty("vertical")||delete f[n],t.getScrollbarController().didUnregisterScrollbar(e)},s.registerNonFastLayer=function(e){e.getNonFastScrollableRects().length,p[e.getID()]=e},s.unregisterNonFastLayer=function(e){delete p[e]},s.cleanUpHiddenCanvasCache=function(){var e=Sk.getOrCreateHiddenCanvasCache(),r=t.getFrameToken(),n=0,i=0;Util.forEachItem(h,(function(t,o){var a=Sk.Util.getNodeKey(r,t),s=e.peek(a),l=s?s.value:null;l?l.hasPendingDelta()||(o&Compositor.DiscardResourceProviderFlags.kResize?l.willResize():(i+=1,n+=s.value.getMemoryUsage(),e.remove(a)),delete h[t]):delete h[t]})),i&&(n/=1024).toFixed(2)},s.release=function(){b(),n&&n.parentNode&&(n.parentNode.removeChild(n),n=null)},s.getPageScaleFactorLimits=function(){return g},s.applyCommit=function(e){var r,s,l,d;!e.full_tree||e.mutations,e.full_tree&&i&&(b(),t.setInvalidateProjections()),void 0!==e.device_scale_factor&&(m=e.device_scale_factor,i&&t.hardInvalidateTiles()),void 0!==e.page_scale_factor&&function(e){g.current=e.page_scale_factor,g.min=e.min_page_scale_factor,g.max=e.max_page_scale_factor,c.isDebugEnabled()&&n.setAttribute("psf",Util.splunkify(g)),c.callback.fire("did-surrogate-change-page-scale")}(e),void 0!==e.display_list_tile_size&&(o=e.display_list_tile_size),e.discarded_resource_providers&&(r=e.discarded_resource_providers,s=c.getTileManager(),l=Compositor.DiscardResourceProviderFlags,Util.forEachItem(r,(function(e,r){var n=!1,i=r&l.kInTreeScope;s&&(n=s.discardResourceProvider(t.getFid(),e,i)),n||(h[e]=r)}))),e.mutations&&(e.mutations.length,S(e.mutations)),e.overscroll_behavior&&(d=e.overscroll_behavior,a&&a.hash===d.hash||(a=d,t.isMainFrame()&&(document.documentElement.style.overscrollBehaviorX=Compositor.CSS.toOverscrollBehavior(a.x),document.documentElement.style.overscrollBehaviorY=Compositor.CSS.toOverscrollBehavior(a.y)),c.isDebugEnabled()&&n.setAttribute("overscroll_behavior",Util.splunkify(a)))),e.full_tree},s.getMaxDeviceScaleFactor=function(){return m},s.asDict=function(){var e={ids:[]};return Util.forEachItem(d,(function(t,r){e.ids.push(t)})),e},s.getDisplayListTileSize=function(){return Object.freeze(o)},s.getRoot=function(){return i},s.setRoot=function(e){(i=e).setTree(s),n.childNodes.length,n.appendChild(e.getContainer())},s.hitTest=function(e,t){return i?i.hitTest(e,t):null},s.hitTestLayer=function(e,t){return i?i.hitTestSubtree(e,t):null},s.freeTiles=function(e){i&&i.walkDepthFirstIterative((function(t){t.freeTiles(e)}))},s.getDiv=function(){return n},(n=document.createElement("div")).id=r,n.style.position="absolute",n.style.top="0px",n.style.left="0px",c.isDebugEnabled()&&n.setAttribute("frame_sink_id",t.getFrameSinkId())},Compositor.AnimatedImage=Object.freeze({kAnimationLoopOnce:0,kAnimationLoopInfinite:-1,kAnimationNone:-2,kDefaultFrameIndex:0,kInvalidId:-2,CompletionState:Object.freeze({kDone:0,kPartiallyDone:1}),InvalidationState:Object.freeze({kIdle:0,kPendingRequestBeginFrame:1,kPendingImplFrame:2,kPendingInvalidation:3}),SerializationFlags:Object.freeze({kRepetitionCountShift:17,kRepetitionCountMask:32767,kInfiniteAnimationLoop:65536,kFramesSizeShift:1,kFramesSizeMask:32767,kCompletionStateDone:1,kHighBitsShift:8,kHighBitsMask:16777215,kLowBitsMask:255})}),Compositor.AnimationState=function(){var e,t,r,n,i=this,o=Compositor.AnimatedImage.kInvalidId,a=1,s={},l=Compositor.AnimatedImage.kDefaultFrameIndex,c=!1,d=!1,u=!1,f=!1,p=Compositor.AnimatedImage.CompletionState.kPartiallyDone,g=Compositor.AnimatedImage.kAnimationNone,m=0;function _(){return p===Compositor.AnimatedImage.CompletionState.kDone}function h(e){return d?(e+1)%a:0}function y(e,t){var r,n;if(!c)return!1;switch(g){case Compositor.AnimatedImage.kAnimationLoopOnce:if(e>=1)return!1;break;case Compositor.AnimatedImage.kAnimationNone:case Compositor.AnimatedImage.kAnimationLoopInfinite:break;default:if(g<=e)return!1}return n=h(t),!(!s.hasOwnProperty(n)||!s[n])&&(r=a-1,p===Compositor.AnimatedImage.CompletionState.kDone||t!==r)}i.shouldAnimate=function(){return y(e.repetitions_completed,e.pending_index)},i.nextDesiredTickTime=function(){return e.next_desired_tick_time},i.updateStateFromDrivers=function(){c=!1,t.forEachItem((function(e,t){return!!t.shouldAnimate(o)&&(c=!0,!0)}))},i.advanceFrame=function(t){return d||(e.next_desired_frame_time=t.frame_time+r,e.next_desired_tick_time=t.frame_time+r,d=!0),t.frame_time<e.next_desired_tick_time||(e.num_of_frames_advanced=0,e=function(e,t,n){for(var i,o,s=t.frame_time+t.interval,l=n;l<s&&y(e.repetitions_completed,e.pending_index);)e.num_of_frames_advanced++,i=h(e.pending_index),l+=r,o=e.next_desired_frame_time+r,e.pending_index=i,e.next_desired_frame_time=o,e.next_desired_tick_time=o,e.pending_index===a-1&&_()&&e.repetitions_completed++;return e}(e,t,e.next_desired_tick_time)),e.pending_index!==l},i.addDriver=function(e){t.add(e),f&&e.invalidateRemoteRegionForImage(o)},i.removeDriver=function(e){return t.remove(e)},i.hasDrivers=function(){return!t.empty()},i.invalidateRegionFromDrivers=function(){t.forEachItem((function(e,t){t&&t.invalidateRegionForImage(o)}))},i.invalidateRemoteRegion=function(){f=!0,n&&n.willRequestRemoteInvalidation(),t.forEachItem((function(e,t){t&&t.invalidateRemoteRegionForImage(o)}))},i.setFrameUpdateObserver=function(e){n&&(f=!1),(n=e).onUpdateFrameCount(a)},i.updateMetadata=function(t){var i;o=t.paint_image_id,g=t.repetition_count,p=t.completion_state,a=t.nr_frames,r=t.duration_ms,n&&n.onUpdateFrameCount(a),i=a-1,e.pending_index===i&&_()&&0===e.repetitions_completed&&e.repetitions_completed++,m<t.reset_animation_sequence_id&&(m=t.reset_animation_sequence_id,d=!1,e.next_desired_frame_time=0,e.repetitions_completed=0,e.pending_index=Compositor.AnimatedImage.kDefaultFrameIndex)},i.onFrameLoaded=function(e,t){s[e]=t},i.getFrame=function(e){return s[e]},i.pushPendingToActive=function(){l=u?Compositor.AnimatedImage.kDefaultFrameIndex:e.pending_index},i.getActiveIndex=function(){return l},i.getActiveFrame=function(){return s[l]},i.getPendingIndex=function(){return e.pending_index},i.enableComparatorMode=function(){u=!0},e={pending_index:Compositor.AnimatedImage.kDefaultFrameIndex,repetitions_completed:0,num_of_frames_advanced:0,next_desired_tick_time:0,next_desired_frame_time:0},t=new Compositor.Set((function(e){return e.getID()}))},Compositor.InvalidationScheduler=function(e){var t=this,r=Compositor.AnimatedImage.InvalidationState,n=r.kIdle,i=0;function o(){n=r.kIdle}function a(){n=r.kPendingImplFrame,e.requestBeginFrameForAnimatedImages()}function s(){o(),n=r.kPendingInvalidation,e.requestInvalidationForAnimatedImages()}t.cancel=o,t.schedule=function(e){var t,s=Date.now();n!==r.kPendingInvalidation&&n!==r.kPendingImplFrame&&(e<s&&(e=s),n===r.kPendingRequestBeginFrame&&e===i||(o(),t=e-s,n=r.kPendingRequestBeginFrame,i=e,setTimeout(a,t)))},t.willBeginImplFrame=function(t){switch(n){case r.kIdle:case r.kPendingInvalidation:break;case r.kPendingRequestBeginFrame:t.frame_time>=i&&s();break;case r.kPendingImplFrame:t.frame_time>=i?s():e.requestBeginFrameForAnimatedImages()}},t.willAnimate=function(){n===r.kPendingInvalidation&&(n=r.kIdle,i=0)}},Compositor.ImageAnimationController=function(e){var t,r,n,i=this,o={},a=!1;function s(e){return e}i.willBeginImplFrame=function(e){n.willBeginImplFrame(e)},i.registerAnimationDriver=function(e,r){o[e].addDriver(r),t.add(e)},i.unregisterAnimationDriver=function(e,r){var n=o[e];n.removeDriver(r),n.hasDrivers()||t.remove(e)},i.animateForSyncTree=function(e){var i=null;return n.willAnimate(),t.forEachItem((function(t){var n=o[t];n.updateStateFromDrivers(),n.shouldAnimate()&&(n.advanceFrame(e)&&r.add(t),n.shouldAnimate()&&(i=null===i?n.nextDesiredTickTime():Math.min(n.nextDesiredTickTime(),i)))})),null===i?n.cancel():n.schedule(i),r},i.invalidateRegionForImages=function(e){e.empty()||e.forEachItem((function(e){var t=o[e];t&&t.invalidateRegionFromDrivers()}))},i.invalidateRemoteRegionForImage=function(e){var t=o[e];t&&t.invalidateRemoteRegion()},i.updateStateFromDrivers=function(){var e=null;t.forEachItem((function(t){var r=o[t];r.updateStateFromDrivers(),r.shouldAnimate()&&(e=null===e?r.nextDesiredTickTime():Math.min(r.nextDesiredTickTime(),e))})),null===e?n.cancel():n.schedule(e)},i.updateAnimatedImage=function(e){var t=e.paint_image_id,r=o[t];r||(r=new Compositor.AnimationState,o[t]=r),r.updateMetadata(e)},i.didActivate=function(){r.forEachItem((function(e){o[e].pushPendingToActive()})),r.clear(),a&&(Util.forEachItem(o,(function(e,t){t.hasDrivers()||delete o[e]})),a=!1)},i.getFrameIndexForImage=function(e){var t;return(t=o[e])?t.getActiveIndex():Compositor.AnimatedImage.kDefaultFrameIndex},i.getActiveFrame=function(e){return o[e].getActiveFrame()},i.onImageFrameLoaded=function(e,t,r){o[e].onFrameLoaded(t,r)},i.getFrameByIndex=function(e,t){return o[e].getFrame(t)},i.onSkImageCreated=function(e,t){var r=o[e];r||(r=new Compositor.AnimationState,o[e]=r),r.setFrameUpdateObserver(t)},i.enableComparatorMode=function(){Util.forEachItem(o,(function(e,t){t.enableComparatorMode()}))},i.getRegisteredAnimationsForTesting=function(){return t},i.getImagesAnimatedOnSyncTreeForTesting=function(){return r},t=new Compositor.Set(s),r=new Compositor.Set(s),n=new Compositor.InvalidationScheduler(e)},Compositor.ImageDelegate=function(e){var t,r,n,i,o,a=this,s={},l=Object.freeze({kNone:0,kWaitMediaNode:1,kGetMediaNode:2}),c=l.kNone;a.didUseVideoOnCanvasForTest=function(){return c===(l.kWaitMediaNode|l.kGetMediaNode)},a.getMediaNodeByUid=function(e,r){var n=t.getFrameTreeNodeId(e);return c|=l.kGetMediaNode,getNodeByUid(n,r)},a.waitForMediaNode=function(e,r,n){var i,o=t.getFrameTreeNodeId(e),a=getNodeByUid(o,r);c|=l.kWaitMediaNode,a?n():i=t.callback.register("media-node-inserted",(function(e,a){r===e&&o===a&&(n(),t.callback.deregister(i))}))},a.onPictureLoaded=function(e){var t=e.getContentId();s[t]&&(s[t](!0,e),delete s[t])},a.onImageFrameLoaded=function(t,r,n){e.getImageAnimationController().onImageFrameLoaded(t,r,n)},a.getFrameIndexForImage=function(t){return e.getImageAnimationController().getFrameIndexForImage(t)},a.getActiveFrame=function(t){return e.getImageAnimationController().getActiveFrame(t)},a.getFrameByIndex=function(t,r){return e.getImageAnimationController().getFrameByIndex(t,r)},a.onSkImageCreated=function(t,r){e.getImageAnimationController().onSkImageCreated(t,r)},a.waitForPicture=function(t,r){var n;(n=e.getActiveAssetCache().get(Sk.Deduper.Type.kPicture,t))&&n.allAssetsLoaded()?r(!0,n):s[t]=r},a.mapDataUrlToBlob=function(t){e.getImageAnimationController().invalidateRemoteRegionForImage(t)},a.allocNewTextureLayerClient=function(){return new Compositor.TextureLayerClient},a.getSVGContainerForHiddenCanvas=function(){return r||((r=document.createElement("div")).setAttribute("id","sv-hidden-con:"+e.getFid()),document.body.insertBefore(r,document.body.firstChild)),r},a.scheduleRasteringHiddenCanvas=function(r){if(!n)return assert_unimplemented(e.isCanvasPicture&&e.isCanvasPicture()),void r.flushTextureUpdates();n.add(r),t.setNeedsDrawFrame(Compositor.DrawFrameReason.kHiddenCanvas)},a.fallbackToRemoteCanvasSrc=function(){o=!0},a.isFallingBackToRemoteCanvasSrc=function(){return o},a.release=function(){r&&r.parentNode&&r.parentNode.removeChild(r),r=null,s={},i&&t.callback.deregister(i),i=null,n.clear(),n=null},n=new Compositor.Set((function(e){return e.getCanvasKey()})),t=e.getDisplay(),i=t.callback.register("will-draw",(function(){var e;n.empty()||(e=n,n=new Compositor.Set((function(e){return e.getCanvasKey()})),e.forEachItem((function(e,t){t.flushTextureUpdates()})))}))},Compositor.LayerTreeHost=function(e,t,r){var n,i,o,a,s,l,c,d,u,f,p,g=this,m=r,_=m===t.getMainFrameSinkId(),h=new Logger("lth",{level:"info",header:function(){return{fs_id:m}}}),y=[],v=!1,k={},S={},b={},w={},C={},T={},E={},A={},R=null,x=0,D={},I={},O=[],U=10;function M(){return g.getLayerTree()?g.getLayerTree().getRoot():null}function F(e){var r=g.getPropertyTrees().getTransformTree();return g.isMainFrame()?!!e.getTransformNode()&&r.hasPath(e.getTransformTreeIndex(),t.getInnerViewportScrollLayer().getTransformTreeIndex()):t.isLthTreeReady(e.getLayerTreeHost())}function P(e,t){var r,n=e.layer_updates;for(r=0;r<n.length;r+=1)t(n[r].id,n[r])}function L(){return{frame_time:Date.now(),interval:17}}function N(){var e=L(),t=p.animateForSyncTree(e);p.invalidateRegionForImages(t),p.didActivate()}function B(e){var r=e.commit,n=!0;t.getStats().inc("commit_activation_count"),Util.isDictEmpty(r),r.reset_cache&&(_&&t.callback.fire("will-reset-cache"),M()&&M().walkDepthFirstIterative((function(t){var r=t.getDisplayList();r&&(n&=r.freeAllTiles(e.old_asset_cache))})),Sk.getOrCreateHiddenCanvasCache().forEachEntry((function(t,r){var i=r.value;i&&(n&=i.clearTextureUpdates(e.old_asset_cache))})),o.flush(),e.old_asset_cache&&(n?e.old_asset_cache.release():e.old_asset_cache.setNeedsRelease(),e.old_asset_cache=null),e.asset_cache&&e.asset_cache.getContainer()&&document.body.insertBefore(e.asset_cache.getContainer(),document.body.firstChild)),r.special_ids&&(c=r.special_ids.root_layer_id,r.is_main_frame&&t.setSpecialIds(r.special_ids)),g.getLayerTree().applyCommit(r),g.getPropertyTrees().applyCommit(r),function(e){P(e.commit,(function(t,r){var n=g.layer_tree.getLayer(t);n?(n.isPictureLayer()&&(r.loaded_tile_updates=e.tile_updates_by_layer_id[t]),n.updateProperties(r)):h.error({event:"tc-prop-for-unknown-layer",lid:t})}))}(e),function(e){P(e,(function(e,t){var r=g.layer_tree.getLayer(e);r?r.updateElementIdRegistration():h.error({event:"tc-prop-for-unknown-layer",lid:e})}))}(r),g.getPropertyTrees().flushCaches(),function(e,t){P(e,(function(e,r){var n=g.layer_tree.getLayer(e);n?n.applyProperties(t):h.error({event:"tc-prop-for-unknown-layer",lid:e})}))}(r,!!r.special_ids),function(e){S[Compositor.EventType.kWheel]===e.wheel_event_listener&&b[Compositor.EventType.kWheel]===e.blocking_wheel_event_listener||(S[Compositor.EventType.kWheel]=e.wheel_event_listener,b[Compositor.EventType.kWheel]=e.blocking_wheel_event_listener,t.callback.fire("wheel-event-listener-changed")),S[Compositor.EventType.kTouch]===e.touch_event_listener&&b[Compositor.EventType.kTouch]===e.blocking_touch_event_listener||(S[Compositor.EventType.kTouch]=e.touch_event_listener,b[Compositor.EventType.kTouch]=e.blocking_touch_event_listener,t.callback.fire("touch-event-listener-changed"))}(r),g.getPropertyTrees().notifyObservers(),function(e){Util.isDictEmpty(e.texture_update_by_layer_id)||P(e.commit,(function(t,r){var n=g.layer_tree.getLayer(t);n&&e.texture_update_by_layer_id.hasOwnProperty(t)&&n.updateTexture(e.texture_update_by_layer_id[t])}))}(e),function(e){Util.isDictEmpty(e.surface_update_by_layer_id)||P(e.commit,(function(t,r){var n=g.layer_tree.getLayer(t);n&&e.surface_update_by_layer_id.hasOwnProperty(t)&&n.updateOSCSurface(e.surface_update_by_layer_id[t])}))}(e),t.isDebugEnabled()&&function(e){var t,r,n,i=[];for(e.surrogate_layer_ids&&(r=e.surrogate_layer_ids,n=[],M().walkDepthFirstIterative((function(e){n.push(e.getID())})),JSON.stringify(n)!==JSON.stringify(r)&&h.error({local_ids:n,surrogate_ids:r})),M().walkDepthFirstIterative((function(e){e.isRoot()||i.push(e)})),t=0;t<i.length-1;t+=1)i[t].getSiblingRank(),i[t+1].getSiblingRank(),i[t].paintsBefore(i[t+1])}(r),g.getLayerTree().updateScrollbarGeometries(),Util.isDictEmpty(E)&&t.callback.fire("did-activate-tree",_)}function H(r,n,i){return new Sk.SafeviewRecording(n,i,f,r.asset_cache,o,e.url_builder.asSkHelperFuncs(),t.getImageLoader(),t.getFlags()&Compositor.Options.kSyncImageLoad)}function V(e){e&&t.getTimeFromLastInput()<1e3?n=setTimeout((function(){V(e)}),U):(n=null,Util.forEachItem(k,(function(e,r){r&&!Sk.Rect.isEmpty(r)&&t.sendRepaintRequest(e,r)})),k={},U=10)}g.getFid=function(){return x},g.getFrameToken=function(){return t.getFrameToken(x)},g.getFrameSinkId=function(){return m},g.getImageAnimationController=function(){return p},g.enableComparatorMode=function(){p&&p.enableComparatorMode()},g.isMainFrame=function(){return _},g.setInvalidateProjections=function(){I.projs=!0},g.setInvalidateClips=function(){I.clips=!0},g.setInvalidateEffects=function(){I.effects=!0},g.getDisplay=function(){return t},g.getScrollDelegate=function(){return s},g.getScrollbarController=function(){return l},g.getActiveAssetCache=function(){return i},g.getRasterCache=function(){return o},g.getUrlBuilderFunction=function(){return e.url_builder.buildImageURLFromU8Array},g.registerChildLth=function(e){var r=e.getSurfaceFrameSinkId();D[r]=e.getID(),t.registerSurface(m,O,e)},g.unregisterChildLth=function(e){t.unregisterSurface(e),delete D[e]},g.forEachChildLth=function(e){Util.forEachItem(D,e)},g.hasChildLth=function(){return!Util.isDictEmpty(D)},g.updatePaintRanks=function(e,t,r){var n,i=e.length;if(O.length!==i+1||r)for(O.length=i+1,n=0;n<i;n+=1)O[n]=e[n];O[i]=t},g.getPaintRanks=function(){return O},g.paintsBefore=function(e,t,r){var n,i=e.getPaintRanks();for(n=0;n<O.length&&n<i.length&&O[n]===i[n];n+=1);return n>=O.length&&n>=i.length?t.paintsBefore(r):n>=O.length?t.getSiblingRank()<=i[n]:n>=i.length?O[n]<r.getSiblingRank():O[n]<=i[n]},g.registerParentLth=function(e,r,n){d!==e&&(d=e,t.setNeedsDrawFrame(Compositor.DrawFrameReason.kParentLayerTreeHostChanged)),g.updatePaintRanks(r,n,!1)},g.unregisterParentLth=function(){d=null,O=[]},g.getParentLthFrameSinkId=function(){return d},g.getSurfaceLayerForChildLth=function(e){var t=D[e];return t?g.getLayerTree().getLayer(t):null},g.getPendingCommitCount=function(){return y.length},g.getRootLayerId=function(){return c},g.arePropertyTreesDirty=function(){return g.getPropertyTrees().getTransformTree().isDirty()||g.getPropertyTrees().getClipTree().isDirty()||g.getPropertyTrees().getEffectTree().isDirty()},g.setLayerProjectionChanged=function(e){w[e]=!0,t.setNeedsDrawFrame(Compositor.DrawFrameReason.kLayerProjectionChanged)},g.setLayerEffectChanged=function(e){T[e]=!0,t.setNeedsDrawFrame(Compositor.DrawFrameReason.kLayerEffectChanged)},g.setVideoSizeChanged=function(){t.setNeedsDrawFrame(Compositor.DrawFrameReason.kVideoSizeChanged)},g.setLayerTilesBecameDirty=function(e){A[e]=!0,t.setNeedsDrawFrame(Compositor.DrawFrameReason.kTilesBecameDirty)},g.setLayerSortingContextIdChanged=function(e){E[e]=!0,t.setNeedsDrawFrame(Compositor.DrawFrameReason.k3DSortingChanged)},g.requestBeginFrameForAnimatedImages=function(){t.setNeedsDrawFrame(Compositor.DrawFrameReason.kAnimatedImages)},g.requestInvalidationForAnimatedImages=function(){N(),t.setNeedsDrawFrame(Compositor.DrawFrameReason.kAnimatedImages)},g.collectDeduperStats=function(){var e={};return Util.forEachItem(Sk.Deduper.Type,(function(t,r){e[r]=i.getStats(r).draw_cache})),e},g.invalidateTilesForNewlyExposedRegions=function(){Util.forEachItem(w,(function(e,t){var r=g.layer_tree.getLayer(e);r&&r.isLive()&&r.updateLocalDrawRect()}))},g.gatherDirtyTiles=function(){var e=[];return Util.forEachItem(A,(function(r){var n,i=g.layer_tree.getLayer(r);i&&(!i.hasVideoContent()||i.isDrawable(),n=i.getTilingSet(),i.isLive()&&i.willDraw()&&n&&F(i)&&n.forEachTileInRect(i.getLocalDrawRect(),(function(r,o,a){var s={tile_rect:n.getTileRectByIndices(o,a),layer:i};n.isRectDirty(s.tile_rect)&&(s.screen_rect=i.toScreenSpaceRect(s.tile_rect,!0),(!s.screen_rect||Sk.Rect.isValid(s.screen_rect)&&!Sk.Rect.isEmpty(s.screen_rect)&&Sk.Rect.intersects(t.getDrawRect(),s.screen_rect))&&e.push(s))})))})),A={},e},g.activateReadyTrees=function(){for(var e;y.length&&(e=y[0]).state===Compositor.CommitState.kLoadComplete;)y.shift(),B(e);N()},g.isInAnimationFrame=function(){return t.isInAnimationFrame()},g.update3dContexts=function(){var e=[];Util.isDictEmpty(E)||(Util.forEachItem(E,(function(t){var r=g.layer_tree.getLayer(t);r&&r.isLive()&&e.push(r)})),e.sort((function(e,t){return Number(e.getSiblingIndex())-Number(t.getSiblingIndex())})).forEach((function(e){e.update3dContext()})),E={},t.callback.fire("did-preserve-3d"))},g.updateProjections=function(){Util.forEachItem(w,(function(e,t){var r=g.layer_tree.getLayer(e);r&&r.isLive()&&F(r)&&r.updateProjection()}))},g.updateClips=function(){Util.forEachItem(C,(function(e,t){var r=g.layer_tree.getLayer(e);r&&r.isLive()&&r.updateClip()}))},g.updateEffects=function(){Util.forEachItem(T,(function(e,t){var r=g.layer_tree.getLayer(e);r&&r.isLive()&&r.updateEffect()}))},g.updateDebugRects=function(){t.getDebugRectsEnabled()&&M()&&M().walkDepthFirstIterative((function(e){e.updateDebugRects("non-fast scrollable",e.getNonFastScrollableRects(),"blue","black"),e.updateDebugRects("touch-region",e.getTouchActionRects(),"yellow","black")}))},g.invalidateLayerProjectionsAndClips=function(){g.getPropertyTrees().getTransformTree().updateStickyState(),M()&&(g.isMainFrame()||t.isLthTreeReady(g))&&(Util.isDictEmpty(I)&&!g.arePropertyTreesDirty()||(M().walkDepthFirstIterative((function(e){var r,n,i=g.getPropertyTrees().getTransformTree(),o=g.getPropertyTrees().getClipTree(),a=g.getPropertyTrees().getEffectTree();e&&e.isLive()&&F(e)&&(I.projs?w[e.getID()]=!0:i.isDirty()&&(r=i.getNode(e.getTransformTreeIndex()),i.hasDirtyAncestor(r.getId())&&(w[e.getID()]=!0),((n=a.getNode(e.getEffectTreeIndex())).hasRoundedCorners()||n.getFilters())&&i.hasDirtyAncestor(n.getTransformId())&&(T[e.getID()]=!0)),(I.clips||i.isDirty()||o.isDirty())&&(C[e.getID()]=!0),(I.effects||a.isDirty())&&(T[e.getID()]=!0),e.isSurfaceForChildFrame()&&function(e){t.isLthAlive(e.getSurfaceFrameSinkId())&&(w[e.getID()]&&t.invalidateLthProjections(e.getSurfaceFrameSinkId()),C[e.getID()]&&t.invalidateLthClips(e.getSurfaceFrameSinkId()),T[e.getID()]&&t.invalidateLthEffects(e.getSurfaceFrameSinkId()))}(e))})),I={}))},g.setNeedsRepaint=function(e,t,r){var i=k[e];i||(i=Sk.Rect.makeEmpty()),Sk.Rect.join(i,t),k[e]=i,r&&10===U&&(U=1e3,n&&(clearTimeout(n),n=null)),n||(n=setTimeout((function(){V(r)}),U))},g.toggleVideoMode=function(){M().walkDepthFirstIterative((function(e){e.hasVideoContent()&&e.getVideoDelegate().requestDisplay()}))},g.hardInvalidateTiles=function(){M()&&M().walkDepthFirstIterative((function(e){var t=e.getTilingSet();t&&t.hardInvalidateTilesInRect(e.getBoundsRect())}))},g.hitTest=function(e,t){return Compositor.Offset.isValid(t),g.layer_tree,g.layer_tree.hitTest(e,t)},g.hitTestLayerTree=function(e,t){return Compositor.Offset.isValid(e),g.layer_tree,g.layer_tree.hitTestLayer(e,t)},g.getLayerTree=function(){return g.layer_tree},g.getPropertyTrees=function(){return a},g.hasEventListener=function(e){return e===Compositor.EventType.kWheel||Compositor.EventType.kTouch,S[e]},g.hasBlockingEventListener=function(e){return e===Compositor.EventType.kWheel||Compositor.EventType.kTouch,b[e]},g.getDeviceScaleFactor=function(){return g.getLayerTree()?Math.min(t.getDeviceScaleFactor(),g.getLayerTree().getMaxDeviceScaleFactor()):1},g.getPageScaleFactor=function(){return g.getPropertyTrees().getTransformTree().getPageScaleFactor()},g.getDeviceViewportRect=function(){return t.getScreenRect()},g.setActiveTreePageScaleFactor=function(e){var r=t.getPageScaleTransformNode(),n=g.getPropertyTrees().getTransformTree();r&&n.getPageScaleFactor()!==e&&(n.setPageScaleFactor(e),r.resetPageScale(e),g.scheduleScrollAndScaleFlush())},g.getActiveVideoNode=function(){var e,t,r=null,n=[];if(!M())return null;for(M().walkDepthFirstIterative((function(e){e.hasVideoContent()&&n.push(e)})),n.sort((function(e,t){return e.isOccludedBy(t)?1:-1})),e=0;e<n.length&&!((t=n[e].getVideoDelegate())&&(r=t.getVideoNode())&&r.videoWidth>0&&r.videoHeight>0);e+=1);return r},g.scheduleScrollAndScaleFlush=function(){R||(R=setTimeout((function(){var e,r,n,i;r=Compositor.MessageFlags.kScrollAndScaleUpdate,n=new Sk.BinaryWriter(28),i=0,n.writeUint32(r),e=n.getOffset(),n.writeUint32(0),g.getPropertyTrees().getScrollTree().forEachPendingDelta((function(e,t){n.writeUint32(e),n.writeInt32(t.x),n.writeInt32(t.y),i+=1})),n.getView().setUint32(e,i,n.isLE()),n.writeFloat32(MetricsUtils.getVisualViewportScale()),t.sendCompositorMessage(x,n.getData()),R=null}),16))},g.setContentBounds=function(e){var t=g.layer_tree.getDiv().style;t.width=e.width+"px",t.height=e.height+"px",t.overflow="hidden"},g.onCompositorMessage=function(e){var r,n=i;if(!v&&!Util.isDictEmpty(e)){if(!e.full_tree)return!0;v=!0}return x!==e.fid&&(x=e.fid,t.isDebugEnabled()&&g.getDiv().setAttribute("fid",x),t.updateFrameSink(x,m)),i&&!e.reset_cache||(u=new Sk.TypefaceDelegate(x),i=new Sk.Deduper.Cache(u,x)),r={state:Compositor.CommitState.kLoadNotStarted,commit:e,old_asset_cache:n,asset_cache:i,reset_cache:e.reset_cache},y.push(r),function(e){e.state,Compositor.CommitState.kLoadNotStarted,e.state=Compositor.CommitState.kLoadStarted,function(e,t){var r=0,n=0,i=!1;function o(){t()}function a(){n+=1,i&&r===n&&o()}e.tile_updates_by_layer_id={},e.texture_update_by_layer_id={},e.surface_update_by_layer_id={},P(e.commit,(function(t,n){var i,o;if(n.layer_type===Compositor.LayerType.PictureLayer&&n.tile_updates)for(e.tile_updates_by_layer_id[t]=[],i=0;i<n.tile_updates.length;i+=1)r+=1,o=n.tile_updates[i],e.tile_updates_by_layer_id[t].push({index_x:o.index_x,index_y:o.index_y,invalidation_region:o.invalidation_region,solid_color:o.solid_color,skr:H(e,o.skr_u8a,a)});else n.layer_type===Compositor.LayerType.TextureLayer&&n.skr_u8a?(r+=1,e.texture_update_by_layer_id[t]=H(e,n.skr_u8a,a)):n.layer_type===Compositor.LayerType.SurfaceLayer&&n.skr_u8a&&(r+=1,e.surface_update_by_layer_id[t]=H(e,n.skr_u8a,a))})),i=!0,r===n&&o()}(e,(function(){e.state=Compositor.CommitState.kLoadComplete,t.setNeedsDrawFrame(Compositor.DrawFrameReason.kRecordingsLoaded)}))}(r),!0},g.getDiv=function(){return g.layer_tree.getDiv()},g.clearDirtyLayers=function(){w={},C={},T={}},g.cleanUpHiddenCanvasCache=function(){g.layer_tree&&g.layer_tree.cleanUpHiddenCanvasCache()},g.fallbackToRemoteCanvasSrc=function(){f&&f.fallbackToRemoteCanvasSrc(),g.layer_tree&&g.layer_tree.walkDepthFirst((function(e){e.isTextureLayer()&&e.fallbackToRemoteCanvasSrc()}))},g.flushRasterCache=function(){o.flush()},g.getTypefaceDelegate=function(){return u},g.getImageDelegateForTest=function(){return f},g.release=function(){g.layer_tree&&(g.layer_tree.release(),g.layer_tree=null),s&&(s.release(),s=null),l&&(l=null),a=null,i&&(i.release(),i=null),R&&(clearTimeout(R),R=null),n&&(clearTimeout(n),n=null),o&&(o.flush(),o=null),u&&(u.release(),u=null),f&&(f.release(),f=null),y=null,D=null,I={},O=null,f=null},s=new Compositor.ScrollDelegate(e,g),l=new Compositor.ScrollbarController(g),a=new Compositor.PropertyTrees(g),g.layer_tree=new Compositor.LayerTree(e,g,"sv-content"),o=new Sk.RasterCacheClass,f=new Compositor.ImageDelegate(g),p=new Compositor.ImageAnimationController(g),t.callback.register("begin-animation-frame",(function(){p.willBeginImplFrame(L()),p.updateStateFromDrivers()}))},Compositor.TransformNode=function(e,t){var r,n,i,o,a,s,l,c=this,d=0,u=Compositor.Offset.makeZero(),f=!1,p=!1,g={},m={};function _(){var r,a,s=o.x+i.x,l=o.y+i.y,d=i.z;return c.isScrollable()&&(s-=u.x,l-=u.y),c.isStickyPositioned()&&(s+=(r=e.stickyPositionOffset(t)).x,l+=r.y),a=mat4.fromTranslation(mat4.create(),vec3.fromValues(s,l,d)),mat4.multiply(a,a,n),mat4.translate(a,a,vec3.fromValues(-i.x,-i.y,-i.z)),a}c.getCachedTransformByDstId=function(e){return g[e]},c.setCachedTransformByDstId=function(e,t){g[e]=t},c.getCachedHasPathToDstId=function(e){return m[e]},c.setCachedHasPathToDstId=function(e,t){m[e]=t},c.clearCache=function(){g={},m={}},c.getToParentTransform=function(){return c.isStickyPositioned()?_():(l||(l=_()),l)},c.getId=function(){return t},c.getParentId=function(){return r<0?-1:r},c.getSortingContextId=function(){return d},c.getStickyPositionData=function(){return s},c.isStickyPositioned=function(){return!!(a&Compositor.TransformNodeFlags.kSticky)},c.stickyScrollAncestor=function(){return c.isStickyPositioned()?s.scroll_ancestor:-1},c.atStickyPosition=function(){return f},c.enterStickyPosition=function(){c.setDirty(),f=!0},c.leaveStickyPosition=function(){c.setDirty(),f=!1},c.movedByOuterViewportBoundsDeltaY=function(){return!!(a&Compositor.TransformNodeFlags.kMovedByOuterViewportBoundsDeltaY)},c.isScrollable=function(){return!!(a&Compositor.TransformNodeFlags.kScrolls)},c.flattensInheritedTransform=function(){return!!(a&Compositor.TransformNodeFlags.kFlattensInheritedTransform)},c.delegatesToParentForBackface=function(){return!!(a&Compositor.TransformNodeFlags.kDelegatesToParentForBackface)},c.setDirty=function(){p=!0,l=null,e.setDirty()},c.clearDirty=function(){p=!1},c.setScrollOffset=function(e){return!Compositor.Offset.isEqual(u,e)&&(u=e,c.setDirty(),!0)},c.resetPageScale=function(e){var t=[];return mat4.getScaling(t,n),(t[0]!==e||t[1]!==e||1!==t[2])&&(n=mat4.fromScaling(mat4.create(),vec3.fromValues(e,e,1)),c.setDirty(),!0)},c.getScrollOffset=function(){return Compositor.Offset.makeCopy(u)},c.update=function(e){function t(t){return e.dirty_flags,e.dirty_flags&t}t(Compositor.TransformNodeDirtyFlags.kParentId)&&(r=e.parent_id),t(Compositor.TransformNodeDirtyFlags.kTransform)&&(n=e.local),t(Compositor.TransformNodeDirtyFlags.kOrigin)&&(i=e.origin),t(Compositor.TransformNodeDirtyFlags.kPostTranslation)&&(o=e.post_translation),t(Compositor.TransformNodeDirtyFlags.kSortingContextId)&&(d=e.sorting_context_id),t(Compositor.TransformNodeDirtyFlags.kFlags)&&(a=e.flags),t(Compositor.TransformNodeDirtyFlags.kStickyPosData)&&(s=e.sticky_position_data),c.setDirty()},c.asDict=function(){return{origin:i,post_translation:o,sorting_context_id:d,local:n,scroll_off:u,flags:a,parent_id:r,id:t,cached_transform_by_dst_id:g,cached_has_path_to_dst_id:m}},c.isDirty=function(){return p}},Compositor.TransformTree=function(e){var t,r=this,n=[],i=!1,o={},a=0;function s(e,t){var n,i=r.getNode(e.getParentId());return e===t?{has_path:!0}:i?((n=i.getCachedHasPathToDstId(t.getId()))||(n=s(i,t)),e.setCachedHasPathToDstId(t.getId(),n),n):{has_path:!1}}function l(e,t){var n,i=r.getNode(e.getParentId()),o=mat4.create();return e!==t&&i?((n=i.getCachedTransformByDstId(t.getId()))||(n=l(i,t)),e.flattensInheritedTransform()&&Compositor.Matrix3D.flattenTo2d(n),o=mat4.multiply(o,n,e.getToParentTransform()),e.setCachedTransformByDstId(t.getId(),o),o):mat4.create()}function c(e){var t=r.getNode(e);return t?t.getStickyPositionData():null}r.setPageScaleFactor=function(e){t=e},r.getPageScaleFactor=function(){return t},r.applyCommit=function(e){var t=!1,i=n.length-e.transform_tree_node_count;i>0&&(n.splice(e.transform_tree_node_count,i),n.length,e.transform_tree_node_count,t=!0),e.transform_tree_mutations.forEach((function(e){var i=n[e.id];i||(i=new Compositor.TransformNode(r,e.id),n[e.id]=i),i.update(e),t=!0})),t&&r.setDirty(),n.length,e.transform_tree_node_count},r.getNode=function(e){return e<0?null:n[e]},r.getRootNode=function(){return r.getNode(0)},r.getSize=function(){return n.length},r.asDict=function(){var e,t=[];for(e=0;e<n.length;e+=1)t.push(n[e].asDict());return t},r.hasPath=function(e,t){var n=s(r.getNode(e),r.getNode(t));return n.has_path,n.has_path},r.clearTransformCache=function(){n.forEach((function(e){e.clearCache()}))},r.combineTransforms=function(e,t){return l(r.getNode(e),r.getNode(t))},r.shouldForceFixedPosition=function(e,t,n){for(var i=r.getNode(e);i&&i.getId()!==t;){if(i.isStickyPositioned()&&i.atStickyPosition())return i.stickyScrollAncestor()===n;i=r.getNode(i.getParentId())}return!1},r.movedByOuterViewportBoundsDeltaY=function(e){for(var t=r.getNode(e);t;){if(t.movedByOuterViewportBoundsDeltaY())return!0;t=r.getNode(t.getParentId())}return!1},r.setDirty=function(){i=!0},r.isDirty=function(){return i},r.hasDirtyAncestor=function(e){for(var t=r.getNode(e);t;){if(t.isDirty())return!0;t=r.getNode(t.getParentId())}return!1},r.clearDirty=function(){i=!1,n.forEach((function(e){e.clearDirty()}))},r.registerObserver=function(e,t){var n=a++;return o.hasOwnProperty(e)||(o[e]={}),o[e][n]=t,{index:e,tree:r,id:n}},r.deregisterObserver=function(e){void 0!==e.index&&e.id,delete o[e.index][e.id]},r.notifyObservers=function(){var e=argumentsToArray(arguments);Util.forEachItem(o,(function(t){Util.forEachItem(o[t],(function(t,r){r.apply(this,e.slice(1))}))}))},r.stickyPositionOffset=function(t){var n,i,o,a,s,l,d,u,f,p,g,m,_=r.getNode(t),h=Compositor.Offset.makeZero(),y=c(t);return _&&y?(i=e.getPropertyTrees().getScrollTree().getNode(y.scroll_ancestor),(o=r.getNode(i.getTransformId()))?(n=Sk.Rect.makeCopy(y.constraint_box_rect),Sk.Rect.makeOffset(n,o.getScrollOffset().x,o.getScrollOffset().y),(u=c(y.nearest_node_shifting_sticky_box))&&(a=u.total_sticky_box_sticky_offset),a=a||Compositor.Offset.makeZero(),(f=c(y.nearest_node_shifting_containing_block))&&(s=f.total_containing_block_sticky_offset),s=s||Compositor.Offset.makeZero(),l=Sk.Rect.makeCopy(y.scroll_container_relative_sticky_box_rect),Sk.Rect.makeOffset(l,a.x+s.x,a.y+s.y),d=Sk.Rect.makeCopy(y.scroll_container_relative_containing_block_rect),Sk.Rect.makeOffset(d,s.x,s.y),void 0!==y.right_offset&&(p=Sk.Rect.getRight(n)-y.right_offset,(g=Math.min(0,p-Sk.Rect.getRight(l)))<(m=Math.min(0,Sk.Rect.getX(d)-Sk.Rect.getX(l)))&&(g=m),h.x+=g),void 0!==y.left_offset&&(p=Sk.Rect.getX(n)+y.left_offset,(g=Math.max(0,p-Sk.Rect.getX(l)))>(m=Math.max(0,Sk.Rect.getRight(d)-Sk.Rect.getRight(l)))&&(g=m),h.x+=g),void 0!==y.bottom_offset&&(p=Sk.Rect.getBottom(n)-y.bottom_offset,(g=Math.min(0,p-Sk.Rect.getBottom(l)))<(m=Math.min(0,Sk.Rect.getY(d)-Sk.Rect.getY(l)))&&(g=m),h.y+=g),void 0!==y.top_offset&&(p=Sk.Rect.getY(n)+y.top_offset,(g=Math.max(0,p-Sk.Rect.getY(l)))>(m=Math.max(0,Sk.Rect.getBottom(d)-Sk.Rect.getBottom(l)))&&(g=m),h.y+=g),y.total_sticky_box_sticky_offset={x:a.x+h.x,y:a.y+h.y},y.total_containing_block_sticky_offset={x:a.x+s.x+h.x,y:a.y+s.y+h.y},h):h):h},r.updateStickyState=function(){n.forEach((function(e){if(e.isStickyPositioned()){var t=r.stickyPositionOffset(e.getId());Compositor.Offset.isZero(t)?e.leaveStickyPosition():e.enterStickyPosition()}else e.leaveStickyPosition()}))}},Compositor.ScrollNode=function(e,t){var r,n,i,o,a,s,l,c=this,d=e.getDisplay();function u(e){return!!(n&e)}c.getId=function(){return t},c.getParentId=function(){return r<0?-1:r},c.getElementId=function(){return o},c.getTransformId=function(){return i},c.isRootNode=function(){return 0===t},c.isSecondaryRootNode=function(){return 1===t},c.isRootOrSecondaryRootNode=function(){return t<=1},c.isScrollable=function(){return u(Compositor.ScrollNodeFlags.kUserScrollableHorizontal|Compositor.ScrollNodeFlags.kUserScrollableVertical)},c.isUserScrollableHorizontal=function(){return u(Compositor.ScrollNodeFlags.kUserScrollableHorizontal)},c.isUserScrollableVertical=function(){return u(Compositor.ScrollNodeFlags.kUserScrollableVertical)},c.scrollsOuterViewport=function(){return u(Compositor.ScrollNodeFlags.kScrollsOuterViewport)},c.scrollsInnerViewport=function(){return u(Compositor.ScrollNodeFlags.kScrollsInnerViewport)},c.hasMainThreadScrolling=function(){return u(Compositor.ScrollNodeFlags.kMainThreadScrolling)},c.preventViewportScrollingFromInner=function(){return u(Compositor.ScrollNodeFlags.kPreventViewportScrollingFromInner)},c.getContainerBounds=function(){return a},c.getContentBounds=function(){return s},c.getOverscrollBehavior=function(){return l},c.maxScrollOffset=function(){var t,r,n,i=c.getContentBounds(),o=1;return Compositor.Bounds.isEmpty(i)?Compositor.Offset.makeZero():(u(Compositor.ScrollNodeFlags.kMaxScrollOffsetAffectedByPageScale)&&(o=e.getPageScaleFactor()),t=Compositor.Bounds.scale(i,o),r=c.getContainerBounds(),n=Compositor.Offset.makeXY(t.width-r.width,t.height-r.height),Compositor.Offset.scale(n,1/o),Compositor.Offset.setToMax(n,Compositor.Offset.makeZero()))},c.clampScrollOffsetToLimits=function(e){return Compositor.Offset.setToMin(e,c.maxScrollOffset()),Compositor.Offset.roundDown(Compositor.Offset.setToMax(e,Compositor.Offset.makeZero()))},c.asDict=function(){return{id:t,parent_id:r,transform_id:i,element_id:o,flags:n,container_bounds:a,content_bounds:s,overscroll_behavior:l}},c.update=function(c){function u(e){return c.dirty_flags,c.dirty_flags&e}u(Compositor.ScrollNodeDirtyFlags.kParentId)&&(r=c.parent_id),u(Compositor.ScrollNodeDirtyFlags.kTransformId)&&(i=c.transform_id),u(Compositor.ScrollNodeDirtyFlags.kElementId)&&(o=c.element_id),u(Compositor.ScrollNodeDirtyFlags.kContainerBounds)&&(a=c.container_bounds),u(Compositor.ScrollNodeDirtyFlags.kBounds)&&(s=c.bounds,d.isOuterViewportScrollNode(e,t)&&e.setContentBounds(s)),u(Compositor.ScrollNodeDirtyFlags.kOverscrollBehavior)&&(l=c.overscroll_behavior),u(Compositor.ScrollNodeDirtyFlags.kFlags)&&(n=c.flags)}},Compositor.SyncedScroll=function(e){var t=this,r=Compositor.Offset.makeZero(),n=Compositor.Offset.makeZero();t.applyMainThreadDelta=function(e){return!Compositor.Offset.isZero(e)&&(r=Compositor.Offset.add(r,e),!0)},t.setActiveTreeScrollOffset=function(e){return!Compositor.Offset.isEqual(r,e)&&(n=Compositor.Offset.add(n,Compositor.Offset.subtract(e,r)),r=e,!0)},t.hasLocalDelta=function(){return!Compositor.Offset.isZero(n)},t.getScrollOffset=function(){return Compositor.Offset.makeCopy(r)},t.drainScrollDelta=function(){var e=Compositor.Offset.makeCopy(n);return n=Compositor.Offset.makeZero(),e},t.asDict=function(){return{scroll_offset:r}}},Compositor.ScrollTree=function(e){var t=this,r=e.getDisplay(),n=e.getScrollDelegate(),i=[],o={},a={},s=1,l={},c={};function d(e){var t=l[e];return t||(t=new Compositor.SyncedScroll(e),l[e]=t),t}function u(){Util.forEachItem(c,(function(e,t){d(e).applyMainThreadDelta(t)&&n.didUpdateScrollOffset(e,Compositor.ScrollOrigin.kOriginSurrogate)})),c={}}t.forEachPendingDelta=function(e){Util.forEachItem(l,(function(t,r){r.hasLocalDelta()&&e(Number(t),r.drainScrollDelta())}))},t.setScrollOffset=function(r,i,o){var a=t.findNodeFromElementId(r).clampScrollOffsetToLimits(Compositor.Offset.makeCopy(i));return!!d(r).setActiveTreeScrollOffset(a)&&(n.didUpdateScrollOffset(r,o),e.scheduleScrollAndScaleFlush(),!0)},t.setScrollOffsetX=function(e,r,n){var i=Compositor.Offset.makeCopy(t.getScrollOffset(e));return i.x=r,t.setScrollOffset(e,i,n)},t.setScrollOffsetY=function(e,r,n){var i=Compositor.Offset.makeCopy(t.getScrollOffset(e));return i.y=r,t.setScrollOffset(e,i,n)},t.getScrollOffset=function(e){return d(e).getScrollOffset()},t.calcProjectedScrollOffset=function(e,r){var n,i,o=Compositor.Offset.makeCopy(r);return e.isUserScrollableHorizontal()||(o.x=0),e.isUserScrollableVertical()||(o.y=0),n=t.getScrollOffset(e.getElementId()),i=Compositor.Offset.add(n,o),e.clampScrollOffsetToLimits(Compositor.Offset.makeCopy(i))},t.scrollBy=function(e,r){var n=t.calcProjectedScrollOffset(e,r);return t.setScrollOffset(e.getElementId(),n,Compositor.ScrollOrigin.kOriginProgrammatic)},t.collectMainThreadDeltas=function(e){e.main_thread_deltas.forEach((function(e){c.hasOwnProperty(e.element_id)?c[e.element_id]=Compositor.Offset.add(c[e.element_id],e.delta):(e.element_id,c[e.element_id]=e.delta)})),r.callback.registerOneShot("did-activate-tree",0,{on_success:u})},t.asDict=function(){var e=[];return i.forEach((function(t){e.push(t.asDict())})),e},t.getSize=function(){return i.length},t.applyCommit=function(t){var r=i.length-t.scroll_tree_node_count;r>0&&(i.splice(t.scroll_tree_node_count,r),i.length,t.scroll_tree_node_count),t.scroll_tree_mutations.forEach((function(t){t.id,t.id;var r=i[t.id];r||(r=new Compositor.ScrollNode(e,t.id),i[t.id]=r),r.getId(),t.id,r.update(t)})),o={},i.forEach((function(e){e.getElementId()&&(o[e.getElementId()],o[e.getElementId()]=e)})),Util.forEachItem(l,(function(e){o[e]||(delete l[e],delete c[e])}))},t.getNode=function(e){return e<0?null:i[e]},t.findNodeFromElementId=function(e){return o[e]},t.forEachElementId=function(e){Util.forEachItem(o,e)},t.hasPath=function(e,t){for(var r=i[e];r;){if(r.getId()===t)return!0;r=i[r.getParentId()]}return!1},t.registerObserver=function(e,r){a.hasOwnProperty(e)||(a[e]={});var n=s;return s+=1,a[e][n]=r,{index:e,tree:t,id:n}},t.deregisterObserver=function(e){void 0!==e.index&&e.id,delete a[e.index][e.id]},t.notifyObservers=function(){var e=argumentsToArray(arguments);Util.forEachItem(a,(function(t){Util.forEachItem(a[t],(function(t,r){r.apply(this,e.slice(1))}))}))}},Compositor.ClipNode=function(e,t){var r,n,i,o=this,a={};o.setCachedRectByKey=function(e,t){a[e]=Object.freeze(t)},o.getCachedRectByKey=function(e){return a[e]},o.clearCachedRects=function(){a={}},o.getId=function(){return t},o.getParentId=function(){return r<0?-1:r},o.getTransformId=function(){return n},o.getClipRect=function(){return i},o.setClipRect=function(t){i&&Sk.Rect.isEqual(i,t)||(i=Sk.Rect.makeCopy(t),e.setDirty())},o.asDict=function(){return{id:t,parent_id:r,transform_id:n,clip_rect:i}},o.update=function(t){function o(e){return t.dirty_flags,t.dirty_flags&e}o(Compositor.ClipNodeDirtyFlags.kParentId)&&(r=t.parent_id),o(Compositor.ClipNodeDirtyFlags.kTransformId)&&(n=t.transform_id),o(Compositor.ClipNodeDirtyFlags.kClipRect)&&(i=t.clip_rect),e.setDirty()}},Compositor.ClipTree=function(e){var t=this,r=[],n=!1;function i(r,n,o){var a,s,l,c,d,u,f=t.getNode(r.getParentId());return r!==n&&f?(l=function(e,t){return e+":"+t}(n.getId(),o),(s=f.getCachedRectByKey(l))||(s=i(f,n,o)),a=Sk.Rect.intersection((c=r,d=o,u=e.getPropertyTrees().getTransformTree().combineTransforms(c.getTransformId(),d),Compositor.Matrix3D.mapRect(u,c.getClipRect())),s),r.setCachedRectByKey(l,a),a):Sk.Rect.makeLargest()}t.applyCommit=function(e){var n=!1,i=r.length-e.clip_tree_node_count;i>0&&(r.splice(e.clip_tree_node_count,i),r.length,e.clip_tree_node_count,n=!0),e.clip_tree_mutations.forEach((function(e){var i=r[e.id];i||(i=new Compositor.ClipNode(t,e.id),r[e.id]=i),i.update(e),i.getId(),e.id,n=!0})),n&&t.setDirty(),r.length,e.clip_tree_node_count},t.getNode=function(e){return e<0?null:r[e]},t.getSize=function(){return r.length},t.setDirty=function(){n=!0},t.clearDirty=function(){n=!1},t.isDirty=function(){return n},t.clearClipCache=function(){r.forEach((function(e){e.clearCachedRects()}))},t.combineClips=function(e,r,n){return i(t.getNode(e),t.getNode(r),n)},t.notifyObservers=function(){},t.asDict=function(){var e=[];return r.forEach((function(t){e.push(t.asDict())})),e}},Compositor.BlendMode=Object.freeze({kClear:0,kSrc:1,kDst:2,kSrcOver:3,kDstOver:4,kSrcIn:5,kDstIn:6}),Compositor.FilterType=Object.freeze({GRAYSCALE:0,SEPIA:1,SATURATE:2,HUE_ROTATE:3,INVERT:4,BRIGHTNESS:5,CONTRAST:6,OPACITY:7,BLUR:8,DROP_SHADOW:9,COLOR_MATRIX:10,ZOOM:11,REFERENCE:12}),Compositor.EffectNode=function(e,t){var r,n,i,o,a,s,l,c,d,u=this,f={};function p(e){return!!(c&e)}u.getId=function(){return t},u.getParentId=function(){return r<0?-1:r},u.getTransformId=function(){return o},u.getRenderTargetId=function(){return u.hasRenderSurface()||!s?t:s},u.isContentsRoot=function(){return 1===u.getRenderTargetId()},u.getScreenSpaceOpacity=function(){return n},u.getBlendMode=function(){return i},u.getRoundedCornerBoundsRef=function(){return p(Compositor.EffectNodeFlags.kHasRoundedCorners),l.rounded_corner_bounds},u.setCachedMFITo=function(e,t){f[e]=t},u.getCachedMFITo=function(e){return f[e]},u.clearCachedMFIs=function(){f={}},u.getFilters=function(){return d},u.isHiddenByBackfaceVisibility=function(){return p(Compositor.EffectNodeFlags.kHiddenByBackfaceVisibility)},u.isDoubleSided=function(){return p(Compositor.EffectNodeFlags.kDoubleSided)},u.isSubtreeHidden=function(){return p(Compositor.EffectNodeFlags.kSubtreeHidden)},u.hasMaskingChild=function(){return p(Compositor.EffectNodeFlags.kHasMaskingChild)},u.isDrawn=function(){return p(Compositor.EffectNodeFlags.kIsDrawn)},u.hasFastRoundedCorner=function(){return p(Compositor.EffectNodeFlags.kHasFastRoundedCorner)},u.hasMaskFilterInfo=function(){return p(Compositor.EffectNodeFlags.kHasRoundedCorners|Compositor.EffectNodeFlags.kHasGradientMask)},u.hasRoundedCorners=function(){return p(Compositor.EffectNodeFlags.kHasRoundedCorners)},u.hasRenderSurface=function(){return p(Compositor.EffectNodeFlags.kHasRenderSurface)},u.asDict=function(){return{id:t,parent_id:r,opacity:n,blend_mode:i,flags:c,bv:u.isHiddenByBackfaceVisibility(),double_sided:u.isDoubleSided(),subtree_hidden:u.isSubtreeHidden(),has_masking_child:u.hasMaskingChild(),is_drawn:u.isDrawn(),transform_id:o,clip_id:a,target_id:s,mask_filter_info:l,filters:d,fast_rounded_corner:u.hasFastRoundedCorner(),render_surface:u.hasRenderSurface()}},u.update=function(t){function u(e){return t.dirty_flags,t.dirty_flags&e}u(Compositor.EffectNodeDirtyFlags.kParentId)&&(r=t.parent_id),u(Compositor.EffectNodeDirtyFlags.kScreenSpaceOpacity)&&(n=t.opacity),u(Compositor.EffectNodeDirtyFlags.kBlendMode)&&(i=t.blend_mode),u(Compositor.EffectNodeDirtyFlags.kTransformId)&&(o=t.transform_id),u(Compositor.EffectNodeDirtyFlags.kClipId)&&(a=t.clip_id),u(Compositor.EffectNodeDirtyFlags.kTargetId)&&(s=t.target_id),u(Compositor.EffectNodeDirtyFlags.kMaskFilterInfo)&&(l=t.mask_filter_info),u(Compositor.EffectNodeDirtyFlags.kFilterOperations)&&(d=t.filters),u(Compositor.EffectNodeDirtyFlags.kFlags)&&(c=t.flags),e.setDirty()}},Compositor.EffectTree=function(e){var t=this,r=[],n=!1;t.applyCommit=function(e){var n=e.effect_tree_node_count,i=r.length-n;i>0&&(r.splice(n,i),r.length),e.effect_tree_mutations.forEach((function(e){var n=r[e.id];n||(n=new Compositor.EffectNode(t,e.id),r[e.id]=n),n.update(e),n.getId(),e.id})),r.length},t.getNode=function(e){return e<0?null:r[e]},t.calcProjectedMFI=function(r,n){return function(t,r){var n,i,o=t.getCachedMFITo(r);return o||(i=t.getRoundedCornerBoundsRef(),n=e.getPropertyTrees().getTransformTree().combineTransforms(t.getTransformId(),r),o=Compositor.Matrix3D.mapRRect(n,i),t.setCachedMFITo(r,o)),Sk.RRect.makeCopy(o)}(t.getNode(r),n)},t.clearProjectedMFICache=function(){r.forEach((function(e){e.clearCachedMFIs()}))},t.getSize=function(){return r.length},t.asDict=function(){var e=[];return r.forEach((function(t){e.push(t.asDict())})),e},t.setDirty=function(){n=!0},t.clearDirty=function(){n=!1},t.isDirty=function(){return n},t.notifyObservers=function(){}},Compositor.PropertyTrees=function(e){var t=this,r=e.getScrollDelegate(),n={x:0,y:0},i={x:0,y:0},o={};function a(){o.transform.isDirty()&&o.transform.clearTransformCache(),(o.transform.isDirty()||o.clip.isDirty())&&o.clip.clearClipCache(),(o.transform.isDirty()||o.effect.isDirty())&&o.effect.clearProjectedMFICache()}t.getTransformTree=function(){return o.transform},t.getScrollTree=function(){return o.scroll},t.getClipTree=function(){return o.clip},t.getEffectTree=function(){return o.effect},t.getInnerViewportContainerBoundsDelta=function(){return n},t.getOuterViewportContainerBoundsDelta=function(){return i},t.applyCommit=function(e){var t;e.property_trees_mutations&&((t=e.property_trees_mutations).inner_viewport_container_bounds_delta&&(n=t.inner_viewport_container_bounds_delta),t.outer_viewport_container_bounds_delta&&(i=t.outer_viewport_container_bounds_delta)),e.transform_tree_mutations&&o.transform.applyCommit(e),e.scroll_tree_mutations&&o.scroll.applyCommit(e),e.clip_tree_mutations&&o.clip.applyCommit(e),e.effect_tree_mutations&&o.effect.applyCommit(e),e.transform_tree_mutations&&o.scroll.forEachElementId((function(e){r.didUpdateScrollOffset(e,Compositor.ScrollOrigin.kOriginIgnore)})),e.main_thread_deltas&&o.scroll.collectMainThreadDeltas(e)},t.notifyObservers=function(){Util.forEachItem(o,(function(e,t){t.notifyObservers()}))},t.flushCaches=a,t.willDraw=function(){a(),o.transform.clearDirty(),o.clip.clearDirty(),o.effect.clearDirty()},o.transform=new Compositor.TransformTree(e),o.scroll=new Compositor.ScrollTree(e),o.clip=new Compositor.ClipTree(e),o.effect=new Compositor.EffectTree(e)},Compositor.Debug=function(e){var t=new Logger("debug-helpers",{level:"info"}),r=e.getMainFrame();function n(){var e=r.getLayerTree();e.getRoot()&&(function(e){var r=[];e.getRoot(),e.walkDepthFirst((function(e){!function(e){for(var t=e;t.getParent();)t=t.getParent()}(e),e.getMaskLayer()&&e.getMaskLayer().getChildren().length,r.push(String(e.id))})),e.withEachLayerDo((function(e,n){-1===r.indexOf(e)&&t.error({event:"unreachable-node",id:e,type:typeof e,reachable_ids:r})})),r.forEach((function(t){e.getLayer(t)}))}(e),function(e){e.walkDepthFirst((function(e){var t,r;e.getChildren().length&&(t=e.getChildrenDiv().childNodes,r=t[0],e.getChildren().forEach((function(t){var n;n=function(e){var t=e.getSortingContext3D();return t?e.get3dContainer()?e.get3dContainer():t.getContext():e.getContainer()}(t),e.id,t.id,n.getAttribute("id"),r&&r.getAttribute("id"),r=r.nextSibling})))}))}(e))}e.callback.register("did-activate-tree",n),e.callback.register("did-preserve-3d",n)},Compositor.Matrix3D=function(){var e={},t=Compositor.FloatingPoint.isEqual;function r(e){return!isNaN(e)&&Number.isFinite(e)&&!t(e,0)}return e.getScale=function(e){var t=[];return mat4.getScaling(t,e),{x:t[0],y:t[1],z:t[2]}},e.hasPerspective=function(e){return 0!==e[3]||0!==e[7]||0!==e[11]||1!==e[15]},e.projectPoint=function(e,t){var r=[],n=vec4.fromValues(t.x||0,t.y||0,t.z||0,1);return vec4.transformMat4(r,n,e),r[3]?{x:r[0]/r[3],y:r[1]/r[3],z:r[2]/r[3]}:{x:0,y:0,z:0}},e.mapPoints=function(e,r){var n,i,o,a,s=[];for(n=0;n<r.length;n+=1)i=r[n],o=vec4.fromValues(i[0],i[1],0,1),a=vec4.create(),vec4.transformMat4(a,o,e),t(a[3],0)||a[3]<0?s.push(vec2.fromValues(NaN,NaN)):s.push(vec2.fromValues(a[0]/a[3],a[1]/a[3]));return s},e.projectHomogeneousPoint=function(t,n){var i,o,a,s=e.elem(t,2,2);return r(s)?(a=-(e.elem(t,2,0)*n[0]+e.elem(t,2,1)*n[1]+e.elem(t,2,3))/s,Number.isFinite(a)?(i=vec4.fromValues(n[0],n[1],a,1),o=vec4.create(),vec4.transformMat4(o,i,t),o):vec4.fromValues(0,0,0,0)):vec4.fromValues(0,0,0,0)},e.projectHomogeneousPoints=function(r,n){var i=[];return n.forEach((function(n){var o=e.projectHomogeneousPoint(r,n);t(o[3],0)||o[3]<0?i.push(vec2.fromValues(NaN,NaN)):i.push(vec2.fromValues(o[0]/o[3],o[1]/o[3]))})),i},e.projectFlatPoint=function(t,n,i){var o=vec2.fromValues(n.x,n.y),a=e.projectHomogeneousPoint(t,o);return r(a[3])?{x:a[0]/a[3],y:a[1]/a[3],z:a[2]/a[3]}:(i&&(i.clipped=!0),{x:0,y:0,z:0})},e.rectStaysRect=e.is2DAxisPreserving=function(e){var r=0!==e[3]||0!==e[7],n=0,i=0,o=0,a=0;return t(Math.abs(e[0]),0)||(n+=1,o+=1),t(Math.abs(e[4]),0)||(n+=1,a+=1),t(Math.abs(e[1]),0)||(i+=1,o+=1),t(Math.abs(e[5]),0)||(i+=1,a+=1),n<=1&&i<=1&&o<=1&&a<=1&&!r},e.isIdentityOr2DTranslation=function(e){return 1===e[0]&&1===e[5]&&1===e[10]&&1===e[15]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&0===e[11]&&0===e[14]},e.isFlat=function(e){return t(e[2],0)&&t(e[6],0)&&t(e[8],0)&&t(e[9],0)&&t(e[10],1)&&t(e[11],0)&&t(e[14],0)},e.is2DTransform=function(r){return!!e.isFlat(r)&&!!(t(r[3],0)&&t(r[7],0)&&t(r[11],0)&&t(r[15],1))},e.getTranslation=function(e){return{x:e[12],y:e[13],z:e[14]}},e.elem=function(e,t,r){return e[4*r+t]},e.toFlattenedSkMatrix=function(t){var r=function(r,n){return e.elem(t,r,n)};return mat3.fromValues(r(0,0),r(1,0),r(3,0),r(0,1),r(1,1),r(3,1),r(0,3),r(1,3),r(3,3))},e.projectRectToQuad=function(t,r){return e.projectHomogeneousPoints(t,Sk.Rect.toQuad(r))},e.mapRectToQuad=function(t,r){return e.mapPoints(t,Sk.Rect.toQuad(r))},e.mapRect=function(t,r,n,i){var o,a,s;if(e.isIdentityOr2DTranslation(t))return s=e.getTranslation(t),Sk.Rect.translate(Sk.Rect.makeCopy(r),s.x,s.y);for((o=n?e.projectRectToQuad(t,r):e.mapRectToQuad(t,r)).length,a=0;a<o.length;a+=1)if(isNaN(o[a][0])||isNaN(o[a][1]))return i&&(i.invalid=!0),Sk.Rect.makeEmpty();return Sk.Rect.bboxRect(o)},e.mapRectIfValid=function(t,r,n){var i,o={};return t?(i=e.mapRect(t,r,!!n,o),o.invalid?null:i):null},e.mapRRect=function(r,n){var i=e.toFlattenedSkMatrix(r);return t(Sk.Matrix.getScaleX(i),0)&&(i[Sk.Matrix.kMScaleX]=0),t(Sk.Matrix.getSkewX(i),0)&&(i[Sk.Matrix.kMSkewX]=0),t(Sk.Matrix.getSkewY(i),0)&&(i[Sk.Matrix.kMSkewY]=0),t(Sk.Matrix.getScaleY(i),0)&&(i[Sk.Matrix.kMScaleY]=0),Sk.Matrix.mapRRect(i,n)},e.asCSSTransformMatrix=function(t){return e.is2DTransform(t)?"matrix("+t[0]+","+t[1]+","+t[4]+","+t[5]+","+t[12]+","+t[13]+")":"matrix3d("+t[0]+","+t[1]+","+t[2]+","+t[3]+","+t[4]+","+t[5]+","+t[6]+","+t[7]+","+t[8]+","+t[9]+","+t[10]+","+t[11]+","+t[12]+","+t[13]+","+t[14]+","+t[15]+")"},e.asCanvasTransformMatrix2D=function(e){return e.length,[e[0],e[1],e[4],e[5],e[12],e[13]]},e.fromColumnMajorList=function(e){return mat4.fromValues.apply(mat4,e)},e.fromRowMajorList=function(t){var r=e.fromColumnMajorList(t);return mat4.transpose(r,r)},e.isIdentity=function(e){return mat4.exactEquals(e,mat4.create())},e.isBackFaceVisible=function(t){var r;return!e.isIdentity(t)&&0!==(r=mat4.determinant(t))&&(t[0]*t[5]*t[15]+t[4]*t[13]*t[3]+t[12]*t[1]*t[7]-t[0]*t[13]*t[7]-t[4]*t[1]*t[15]-t[12]*t[5]*t[3])*r<0},e.flattenTo2d=function(e){e[2]=0,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[14]=0},e}(),Compositor.InPageSearcher=function(e){var t,r,n,i=this,o=new Logger("in-page-search",{level:"info"}),a=new ShortcutKeyHandler(e),s=!1,l=!1,c="safeview-in-page-search-div",d="safeview-in-page-search-input";function u(t,n){var i=r.value;e.surrogate_channel.send("in-page-search","query",i,t,n)}function f(){s||i.show_find(),u(!0,!1),l=!0}function p(r){l=!1,e.surrogate_channel.send("in-page-search","end",r),t&&(t.style.display="none",s=!1)}function g(t){switch(t.type){case"input":""===r.value?(n.innerHTML="",e.surrogate_channel.send("in-page-search","end","clear")):f();break;case"keydown":13===t.keyCode?t.shiftKey?i.find_prev():t.ctrlKey?p("activate"):i.find_next():27===t.keyCode&&p("keep");break;case"paste":t.stopPropagation()}}function m(e){return e.id===c}return i.insertInput=function(){var i,o;t||(document.head.appendChild(("/safeview-static/css/search.css",i=e.url_builder.buildAssetURL("/safeview-static/css/search.css"),(o=document.createElement("link")).type="text/css",o.id="safeview-in-page-search-css",o.rel="stylesheet",o.href=i,o.media="all",o)),document.body.insertAdjacentHTML("beforeend",e.template.get("search-template")),t=document.getElementById(c),(n=document.getElementById("safeview-in-page-search-count")).innerHTML="",r=document.getElementById(d),EventListener.addListener(r,"keydown",g,!0),EventListener.addListener(r,"input",g,!0),EventListener.addListener(r,"paste",g,!0),BrowserDetect.isIE()?t.classList.add("safeview-in-page-search-div-ie"):BrowserDetect.isEdge()?t.classList.add("safeview-in-page-search-div-edge"):BrowserDetect.isFirefox()?t.classList.add("safeview-in-page-search-div-firefox"):BrowserDetect.isChrome()&&t.classList.add("safeview-in-page-search-div-chrome"),t.style.display="none",s=!1)},i.find_next=function(){l?u(!0,!0):f()},i.find_prev=function(){l?u(!1,!0):f()},i.show_find=function(){s||(t||i.insertInput(),t.style.display="block",s=!0),r.focus(),r.select()},i.mouse_event_search_input=function(e){if(!s||!Util.findPredicateOnBranch(e.target,m))return!1;if("mouseup"===e.type)switch(e.target.id){case"safeview-in-page-search-close-button":p("keep");break;case"safeview-in-page-search-next-button":i.find_next(),r.focus();break;case"safeview-in-page-search-prev-button":i.find_prev(),r.focus();break;default:r.focus()}return!0},i.is_key_event_search_input=function(e){return s&&e.target.id===d&&!i.is_search_operation(e)},i.is_search_operation=function(e){var t=a.get_operation(e);return"inPageSearch"===t||"inPageSearchNext"===t||"inPageSearchPrev"===t},i.is_search_focused=function(){return s&&document.activeElement===r},i.release=function(){t&&t.parentNode&&t.parentNode.removeChild(t),t=null},e.interp.registerOpcodeHandler("search_reply",(function(e,t){s&&l&&(n.innerHTML=t+"/"+e)})),e.interp.registerOpcodeHandler("search_start",(function(e){switch(e){case"new":i.show_find();break;case"next":i.find_next();break;case"prev":i.find_prev();break;default:o.error("unexpected search type="+e)}})),i},Compositor.CommitFlags=Object.freeze({kFullTree:1,kResetCache:2,kWheelEventListener:4,kBlockingWheelEventListener:8,kDirtySpecialIds:16,kDirtyDSF:32,kHasMutations:64,kDirtyPageScaleFactorAndLimits:128,kDirtyDisplayListTileSize:256,kTouchEventListener:512,kBlockingTouchEventListener:1024,kDirtyConfig:2048,kHasMainThreadDeltas:4096,kDirtyTransformTree:8192,kDirtyScrollTree:16384,kDirtyClipTree:32768,kDirtyEffectTree:65536,kIsSubFrame:1<<17,kDirtyViewportContainerBoundsDelta:1<<18,kIsFrameSinkId:1<<19,kDiscardResourceProvider:1<<20}),Compositor.DirtyProps=Object.freeze({kFlags:1,kBounds:2,kOffsetToTransformParent:4,kBackgroundColor:8,kNodeId:16,kNonFastScrollableRegion:32,kDirtyTiles:64,kTextureBounds:128,kTouchActionRegion:256,kTransformTreeIndex:512,kClipTreeIndex:1024,kScrollTreeIndex:2048,kEffectTreeIndex:4096,kElementId:8192,kScrollbarProps:16384,kFrameSinkId:32768,kDirtyPointerEventsNone:65536,kWheelEventRegion:1<<17,kHitTestOpaqueness:1<<18,kAnimatedImages:1<<19,kAll:4294967295}),Compositor.LayerFlags=Object.freeze({kContentsOpaque:2,kIsDrawable:4,kShouldCheckBackfaceVisibility:8,kHasWillChangeTransformHint:64,kHideLayerAndSubTree:128,kIsCanvasBacking:256,kIsScrollbar:512,kIsSurfaceLayerWithVideo:4096,kIsUntiled:16384,kIsDisplayListDelta:32768,kIsSurfaceLayerForOSC:65536}),Compositor.StickyPositionConstraint=Object.freeze({kIsSticky:1,kIsAnchoredLeft:2,kIsAnchoredRight:4,kIsAnchoredTop:8,kIsAnchoredBottom:16}),Compositor.LayerType=Object.freeze({Unknown:0,Layer:1,PictureLayer:2,SolidColorScrollbarLayer:3,VideoLayer:4,TextureLayer:5,SurfaceLayer:6,PaintedScrollbarLayer:7,PaintedOverlayScrollbarLayer:8}),Compositor.MutationType=Object.freeze({kAddLayer:0,kRemoveLayer:1}),Compositor.TouchAction=Object.freeze({kNone:0,kPanLeft:1,kPanRight:2,kPanX:3,kPanUp:4,kPanDown:8,kPanY:12,kPan:15,kPinchZoom:16,kManipulation:31,kDoubleTapZoom:32,kInternalPanXScrolls:64,kInternalNotWritable:128,kAuto:255,kMax:255}),Compositor.MessageFlags=Object.freeze({kFrameDelay:0,kPixelDistance:1,kInvalidateAllLayers:2,kInvalidateLayerRect:3,kInvalidateLayerTree:4,kSetDebugDataEnabled:5,kScrollAndScaleUpdate:6,kDisplayListDelta:7,kAttachLayerTreeHost:8,kRemoteCanvasSrc:9,kResetDeduper:10}),Compositor.PropertyTreesDirtyFlags=Object.freeze({kInnerViewportContainerBoundsDelta:1,kOuterViewportContainerBoundsDelta:2}),Compositor.TransformNodeFlags=Object.freeze({kMovedByOuterViewportBoundsDeltaY:1,kSticky:2,kScrolls:4,kFlattensInheritedTransform:8,kDelegatesToParentForBackface:16}),Compositor.ScrollNodeFlags=Object.freeze({kUserScrollableHorizontal:2,kUserScrollableVertical:4,kMaxScrollOffsetAffectedByPageScale:8,kScrollsInnerViewport:16,kScrollsOuterViewport:32,kMainThreadScrolling:128,kPreventViewportScrollingFromInner:256}),Compositor.TransformNodeDirtyFlags=Object.freeze({kParentId:1,kTransform:2,kOrigin:4,kPostTranslation:8,kFlags:16,kStickyPosData:32,kSortingContextId:64}),Compositor.ScrollNodeDirtyFlags=Object.freeze({kParentId:1,kTransformId:2,kElementId:4,kContainerBounds:8,kBounds:16,kOverscrollBehavior:32,kFlags:64}),Compositor.ClipNodeDirtyFlags=Object.freeze({kParentId:1,kTransformId:2,kClipRect:4}),Compositor.EffectNodeDirtyFlags=Object.freeze({kParentId:1,kScreenSpaceOpacity:2,kBlendMode:4,kTransformId:8,kClipId:16,kFlags:32,kTargetId:64,kMaskFilterInfo:128,kFilterOperations:256}),Compositor.EffectNodeFlags=Object.freeze({kHiddenByBackfaceVisibility:1,kDoubleSided:2,kTrilinearFiltering:4,kIsDrawn:8,kSubtreeHidden:16,kHasMaskingChild:32,kHasFastRoundedCorner:64,kHasRenderSurface:128,kHasRoundedCorners:256}),Compositor.OverscrollBehaviorType=Object.freeze({kNone:0,kAuto:1,kContain:2}),Compositor.ScrollbarFlags=Object.freeze({kIsOverlay:1,kIsHorizontal:2,kIsLeftSideVertical:4,kHasThumb:8,kJumpOnTrackClick:16,kSupportsDragSnapBack:32}),Compositor.ConfigFlags=Object.freeze({kUseFocusPlaceholder:1,kEnableDOMRasterization:2,kEnableDOMText:4,kPruneOccludedTiles:8,kPreferScrollingCorrectness:16,kAllowCSSGradients:32,kAllowDisplayListDeltaForDrag:64,kAllowLocalDLForTexture:128,kUseNewPictureShader:256,kAllowClientCanvasSrc:512,kAllowMFI:1024,kAllowSingleRasterTile:2048,kAllow3dCompositing:4096}),Compositor.HitTestOpaqueness=Object.freeze({kTransparent:0,kMixed:1,kOpaque:2}),Compositor.DiscardResourceProviderFlags=Object.freeze({kInTreeScope:1,kResize:2,kOther:4}),Compositor.BinaryReader=function(){function e(e){var t,r={};return t=e.readUint32(),r.type=1&t,r.layer_id=t>>1,r.type===Compositor.MutationType.kAddLayer&&(r.layer_type=e.readUint32(),r.layer_parent_id=e.readInt32(),-1!==r.layer_parent_id&&(r.layer_sibling_index=e.readInt32())),r}function t(e){var t={};function r(e){return t.dirty_flags,t.dirty_flags&e}return t.dirty_flags=e.readUint32(),t.id=e.readInt32(),r(Compositor.TransformNodeDirtyFlags.kParentId)&&(t.parent_id=e.readInt32()),r(Compositor.TransformNodeDirtyFlags.kTransform)&&(t.local=function(e){var t,r,n=e.readUint32();return n&(Sk.MatrixMask.Scale|Sk.MatrixMask.Affine|Sk.MatrixMask.Perspective)?r=Compositor.Matrix3D.fromRowMajorList(e.readFloat32Array(16)):n&Sk.MatrixMask.Translate?(t=e.readFloat32Array(3),r=mat4.fromTranslation(mat4.create(),t)):r=mat4.create(),r}(e)),r(Compositor.TransformNodeDirtyFlags.kOrigin)&&(t.origin={x:e.readFloat32(),y:e.readFloat32(),z:e.readFloat32()}),r(Compositor.TransformNodeDirtyFlags.kPostTranslation)&&(t.post_translation={x:e.readFloat32(),y:e.readFloat32()}),r(Compositor.TransformNodeDirtyFlags.kSortingContextId)&&(t.sorting_context_id=e.readInt32()),r(Compositor.TransformNodeDirtyFlags.kFlags)&&(t.flags=e.readUint32()),r(Compositor.TransformNodeDirtyFlags.kStickyPosData)&&(t.sticky_position_data=function(e){var t={},r=e.readUint32();return Compositor.StickyPositionConstraint.kIsSticky,r&Compositor.StickyPositionConstraint.kIsAnchoredLeft&&(t.left_offset=e.readFloat32()),r&Compositor.StickyPositionConstraint.kIsAnchoredRight&&(t.right_offset=e.readFloat32()),r&Compositor.StickyPositionConstraint.kIsAnchoredTop&&(t.top_offset=e.readFloat32()),r&Compositor.StickyPositionConstraint.kIsAnchoredBottom&&(t.bottom_offset=e.readFloat32()),t.constraint_box_rect=e.readRect(),t.scroll_container_relative_sticky_box_rect=e.readRect(),t.scroll_container_relative_containing_block_rect=e.readRect(),t.scroll_ancestor=e.readInt32(),t.nearest_node_shifting_sticky_box=e.readInt32(),t.nearest_node_shifting_containing_block=e.readInt32(),t}(e)),t}function r(e){var t,r={};function n(e){return r.dirty_flags,r.dirty_flags&e}return r.dirty_flags=e.readUint32(),r.id=e.readInt32(),n(Compositor.ScrollNodeDirtyFlags.kParentId)&&(r.parent_id=e.readInt32()),n(Compositor.ScrollNodeDirtyFlags.kTransformId)&&(r.transform_id=e.readInt32()),n(Compositor.ScrollNodeDirtyFlags.kElementId)&&(r.element_id=e.readUint32(),r.element_id),n(Compositor.ScrollNodeDirtyFlags.kContainerBounds)&&(r.container_bounds={width:e.readUint32(),height:e.readUint32()}),n(Compositor.ScrollNodeDirtyFlags.kBounds)&&(r.bounds={width:e.readUint32(),height:e.readUint32()}),n(Compositor.ScrollNodeDirtyFlags.kOverscrollBehavior)&&(r.overscroll_behavior={},t=e.readUint32(),r.overscroll_behavior.x=t>>16&65535,r.overscroll_behavior.y=65535&t),n(Compositor.ScrollNodeDirtyFlags.kFlags)&&(r.flags=e.readUint32()),r}function n(e){var t={};function r(e){return t.dirty_flags,t.dirty_flags&e}return t.dirty_flags=e.readUint32(),t.id=e.readInt32(),r(Compositor.ClipNodeDirtyFlags.kParentId)&&(t.parent_id=e.readInt32()),r(Compositor.ClipNodeDirtyFlags.kTransformId)&&(t.transform_id=e.readInt32()),r(Compositor.ClipNodeDirtyFlags.kClipRect)&&(t.clip_rect=e.readRect()),t}function i(e){var t=e.readUint32(),r={};return t!==Compositor.FilterType.DROP_SHADOW?(Compositor.Util.filterTypeToString(t),null):(r.type=t,r.amount=e.readFloat32(),r.offset={},r.offset.x=e.readInt32(),r.offset.y=e.readInt32(),r.drop_shadow_color=e.readUint32(),r)}function o(e){var t={};function r(e){return t.dirty_flags,t.dirty_flags&e}return t.dirty_flags=e.readUint32(),t.id=e.readInt32(),r(Compositor.EffectNodeDirtyFlags.kParentId)&&(t.parent_id=e.readInt32()),r(Compositor.EffectNodeDirtyFlags.kScreenSpaceOpacity)&&(t.opacity=e.readFloat32()),r(Compositor.EffectNodeDirtyFlags.kBlendMode)&&(t.blend_mode=e.readUint32()),r(Compositor.EffectNodeDirtyFlags.kTransformId)&&(t.transform_id=e.readInt32()),r(Compositor.EffectNodeDirtyFlags.kClipId)&&(t.clip_id=e.readInt32()),r(Compositor.EffectNodeDirtyFlags.kTargetId)&&(t.target_id=e.readInt32()),r(Compositor.EffectNodeDirtyFlags.kMaskFilterInfo)&&(t.mask_filter_info={rounded_corner_bounds:e.readRRect(Sk.RRectType.kComplex)}),r(Compositor.EffectNodeDirtyFlags.kFilterOperations)&&(t.filters=function(e){var t,r,n=e.readUint32(),o=[];if(!n)return null;for(r=0;r<n;++r)(t=i(e))&&o.push(t);return o.length?o:null}(e)),r(Compositor.EffectNodeDirtyFlags.kFlags)&&(t.flags=e.readUint32()),t}function a(e){return{element_id:e.readUint32(),delta:{x:e.readFloat32(),y:e.readFloat32()}}}function s(e){return e.readUint32()+":"+e.readUint32()}function l(e){var t,r,n,i,o,a,l,c,d,u={};function f(e){return u.dirty_props,u.dirty_props&e}function p(e){var t=Sk.Region.makeEmpty();for(a=e.readUint32(),l=0;l<a;l+=1)Sk.Region.addRect(t,e.readRect());return t}if(u.dirty_props=e.readUint32(),u.layer_type=e.readUint32(),u.id=e.readInt32(),d=u.layer_type,Util.forEachItem(Compositor.LayerType,(function(e,t){if(d===t)return!0})),u.dirty_props&Compositor.DirtyProps.kFlags&&(u.flags=e.readUint32()),u.dirty_props&Compositor.DirtyProps.kBounds&&(u.bounds={width:e.readUint32(),height:e.readUint32()}),f(Compositor.DirtyProps.kOffsetToTransformParent)&&(u.offset_to_transform_parent={x:e.readFloat32(),y:e.readFloat32()}),u.dirty_props&Compositor.DirtyProps.kBackgroundColor&&(u.background_color=e.readUint32()),f(Compositor.DirtyProps.kTransformTreeIndex)&&(u.transform_tree_index=e.readInt32()),f(Compositor.DirtyProps.kClipTreeIndex)&&(u.clip_tree_index=e.readInt32()),f(Compositor.DirtyProps.kScrollTreeIndex)&&(u.scroll_tree_index=e.readInt32()),f(Compositor.DirtyProps.kEffectTreeIndex)&&(u.effect_tree_index=e.readInt32()),u.dirty_props&Compositor.DirtyProps.kNodeId&&(u.node_id=e.readInt32()),u.dirty_props&Compositor.DirtyProps.kNonFastScrollableRegion&&(u.non_fast_scrollable_rects=p(e)),u.dirty_props&Compositor.DirtyProps.kWheelEventRegion&&(u.wheel_event_region=p(e)),u.dirty_props&Compositor.DirtyProps.kTouchActionRegion){for(t=e.readUint32(),i=Sk.Region.makeEmpty(),o={},l=0;l<t;++l){for(n=e.readUint32(),a=n>>16&65535,o[r=65535&n]=Sk.Region.makeEmpty(),c=0;c<a;c+=1)Sk.Region.addRect(o[r],e.readRect());Sk.Region.addRegion(i,o[r])}u.touch_action_region={whole_region:i,touch_actions:o}}return f(Compositor.DirtyProps.kElementId)&&(u.element_id=e.readUint32()),f(Compositor.DirtyProps.kHitTestOpaqueness)&&(u.hit_test_opaqueness=e.readUint32()),u.layer_type===Compositor.LayerType.PictureLayer?(u.dirty_props&Compositor.DirtyProps.kDirtyTiles&&function(e,t){var r,n,i,o,a,s,l,c=e.readUint32();for(t.tile_updates=[],r=0;r<c;r+=1){for(s={},i=e.readUint32(),s.index_x=65535&i,s.index_y=i>>16&65535,a=(o=e.readUint32())>>16&65535,l=!!(1&o),s.invalidation_region=[],n=0;n<a;n+=1)s.invalidation_region.push(e.readRect());l&&(s.solid_color=e.readUint32()),s.skr_u8a=e.readByteArray(),t.tile_updates.push(s)}}(e,u),u.dirty_props&Compositor.DirtyProps.kAnimatedImages&&function(e,t){var r,n,i,o,a,s,l=e.readUint32(),c=Compositor.AnimatedImage.SerializationFlags;for(t.animated_images_metadata={},r=0;r<l;r+=1){for(n=e.readUint32(),(i={}).nr_frames=n>>c.kFramesSizeShift&c.kFramesSizeMask,n&c.kInfiniteAnimationLoop?i.repetition_count=Compositor.AnimatedImage.kAnimationLoopInfinite:i.repetition_count=n>>c.kRepetitionCountShift&c.kRepetitionCountMask,i.completion_state=n&c.kCompletionStateDone?Compositor.AnimatedImage.CompletionState.kDone:Compositor.AnimatedImage.CompletionState.kPartiallyDone,o=(n=e.readUint32())&c.kLowBitsMask,i.paint_image_id=n>>c.kHighBitsShift&c.kHighBitsMask,n=e.readUint32(),i.reset_animation_sequence_id=n&c.kLowBitsMask,i.duration_ms=n>>c.kHighBitsShift&c.kHighBitsMask,(s={}).metadata=i,s.visual_rects=Sk.Region.makeEmpty(),a=0;a<o;++a)Sk.Region.addRect(s.visual_rects,e.readRect());t.animated_images_metadata[i.paint_image_id]=s}}(e,u)):u.layer_type===Compositor.LayerType.TextureLayer?(u.dirty_props&Compositor.DirtyProps.kTextureBounds&&(u.texture_bounds={width:e.readUint32(),height:e.readUint32()}),u.dirty_props&Compositor.DirtyProps.kDirtyTiles&&(u.skr_u8a=e.readByteArray())):u.layer_type===Compositor.LayerType.PaintedScrollbarLayer||u.layer_type===Compositor.LayerType.SolidColorScrollbarLayer||u.layer_type===Compositor.LayerType.PaintedOverlayScrollbarLayer?f(Compositor.DirtyProps.kScrollbarProps)&&(u.scroll_element_id=e.readUint32(),u.scrollbar_flags=e.readUint32(),u.layer_type===Compositor.LayerType.PaintedOverlayScrollbarLayer?(u.track_rect=e.readRect(),u.scrollbar_flags&Compositor.ScrollbarFlags.kHasThumb&&(u.thumb_size={width:e.readUint32(),height:e.readUint32()})):u.layer_type===Compositor.LayerType.PaintedScrollbarLayer?(u.track_rect=e.readRect(),u.back_button_rect=e.readRect(),u.forward_button_rect=e.readRect(),u.scrollbar_flags&Compositor.ScrollbarFlags.kHasThumb&&(u.thumb_size={width:e.readUint32(),height:e.readUint32()})):u.layer_type===Compositor.LayerType.SolidColorScrollbarLayer&&(u.thumb_thickness=e.readInt32(),u.track_start=e.readInt32())):u.layer_type===Compositor.LayerType.SurfaceLayer&&(f(Compositor.DirtyProps.kFrameSinkId)&&(u.frame_sink_id=s(e)),f(Compositor.DirtyProps.kDirtyPointerEventsNone)&&(u.pointer_events_none=!!e.readUint32()),f(Compositor.DirtyProps.kDirtyTiles)&&(u.skr_u8a=e.readByteArray())),u}this.readCommit=function(i){var c,d,u,f,p,g,m,_=new Sk.BinaryReader(i),h={};function y(e){return d&e}return h.fid=_.readUint32(),c=_.readUint32(),h.flags=d=c,h.is_main_frame=!(d&Compositor.CommitFlags.kIsSubFrame),d&Compositor.CommitFlags.kIsFrameSinkId&&(h.is_frame_sink_id=!0),h.full_tree=!!(d&Compositor.CommitFlags.kFullTree),h.reset_cache=!!(d&Compositor.CommitFlags.kResetCache),h.wheel_event_listener=!!(d&Compositor.CommitFlags.kWheelEventListener),h.blocking_wheel_event_listener=!!(d&Compositor.CommitFlags.kBlockingWheelEventListener),h.touch_event_listener=!!(d&Compositor.CommitFlags.kTouchEventListener),h.blocking_touch_event_listener=!!(d&Compositor.CommitFlags.kBlockingTouchEventListener),h.is_main_frame||(h.frame_sink_id=s(_)),d&Compositor.CommitFlags.kDirtySpecialIds&&(h.special_ids={},h.special_ids.root_layer_id=_.readInt32(),h.is_main_frame&&(h.special_ids.inner_scroll=_.readInt32(),h.special_ids.outer_scroll=_.readInt32(),h.special_ids.outer_content=_.readInt32(),h.special_ids.page_scale=_.readInt32())),d&Compositor.CommitFlags.kDirtyDSF&&(h.device_scale_factor=_.readFloat32()),d&Compositor.CommitFlags.kDirtyConfig&&(h.config={max_pre_draw_distance:_.readFloat32(),pre_draw_distance_factor:_.readFloat32(),pre_draw_distance_factor_for_dom_raster:_.readFloat32(),flags:_.readUint32()}),d&Compositor.CommitFlags.kDirtyPageScaleFactorAndLimits&&(h.page_scale_factor=_.readFloat32(),h.min_page_scale_factor=_.readFloat32(),h.max_page_scale_factor=_.readFloat32()),d&Compositor.CommitFlags.kDirtyDisplayListTileSize&&(g=_.readUint32(),m=_.readUint32(),h.display_list_tile_size=Object.freeze({width:g,height:m})),y(Compositor.CommitFlags.kDirtyViewportContainerBoundsDelta)&&(h.property_trees_mutations=function(e){var t={},r=e.readUint32(),n=Compositor.PropertyTreesDirtyFlags;return r&n.kInnerViewportContainerBoundsDelta&&(t.inner_viewport_container_bounds_delta={x:e.readFloat32(),y:e.readFloat32()}),r&n.kOuterViewportContainerBoundsDelta&&(t.outer_viewport_container_bounds_delta={x:e.readFloat32(),y:e.readFloat32()}),t}(_)),y(Compositor.CommitFlags.kDirtyTransformTree)&&(h.transform_tree_node_count=_.readUint32(),h.transform_tree_mutations=function(e){var r,n=[],i=e.readUint32();for(r=0;r<i;r+=1)n.push(t(e));return n}(_)),y(Compositor.CommitFlags.kDirtyScrollTree)&&(h.scroll_tree_node_count=_.readUint32(),h.scroll_tree_mutations=function(e){var t,n=[],i=e.readUint32();for(t=0;t<i;t+=1)n.push(r(e));return n}(_)),y(Compositor.CommitFlags.kDirtyClipTree)&&(h.clip_tree_node_count=_.readUint32(),h.clip_tree_mutations=function(e){var t,r=[],i=e.readUint32();for(t=0;t<i;t+=1)r.push(n(e));return r}(_)),y(Compositor.CommitFlags.kDirtyEffectTree)&&(h.effect_tree_node_count=_.readUint32(),h.effect_tree_mutations=function(e){var t,r=[],n=e.readUint32();for(t=0;t<n;t+=1)r.push(o(e));return r}(_)),y(Compositor.CommitFlags.kHasMainThreadDeltas)&&(h.main_thread_deltas=function(e){var t,r=[],n=e.readUint32();for(t=0;t<n;t+=1)r.push(a(e));return r}(_)),y(Compositor.CommitFlags.kDiscardResourceProvider)&&(h.discarded_resource_providers=function(e){var t,r,n,i={},o=e.readUint32();for(t=0;t<o;++t)n=15&(r=e.readUint32()),i[r>>4&268435455]=n;return i}(_)),d&Compositor.CommitFlags.kHasMutations&&(h.mutations=function(t){var r,n=[],i=t.readUint32();for(r=0;r<i;r+=1)n.push(e(t));return n}(_)),p=(f=_.readUint32())>>28&15,h.overscroll_behavior={hash:p},h.overscroll_behavior.x=3&p,h.overscroll_behavior.y=p>>2&3,u=268435455&f,h.layer_updates=function(e,t){var r,n=[];for(r=0;r<t;r+=1)n.push(l(e));return n}(_,u),Object.freeze(h)}},Compositor.VideoMode={kCopy:0,kNative:1},Compositor.VideoDelegate=function(e,t){var r,n,i,o,a,s,l=this,c=new Logger("video-del",{level:"info",header:function(){return{lid:t.getID(),fc:e.getDisplay().getFrameCount()}}}),d=e.getDisplay(),u={},f=0,p=0,g=0,m=0,_=!1,h=!1,y=null;function v(){i&&d.getMediaDiv().appendChild(i)}function k(r,n){t.getDOMNodeId()===n&&e.getFid()===r&&i&&(i=null)}function S(){var e;d.isDebugEnabled()&&(o||((o=document.createElement("div")).style.position="absolute",o.style.left="0px",o.style.top="0px",o.style.backgroundColor="#FF851B",o.style.color="white",t.getHudDiv()&&t.getHudDiv().appendChild(o)),e=f?p/f:0,o.textContent="Video: "+f+" FPS, "+e.toFixed(2)+" ms/F")}function b(e,o){var a=e.canvas;(BrowserDetect.isFirefox()||BrowserDetect.isChrome()&&BrowserDetect.isMac()&&BrowserDetect.getVersion()<71)&&a.drawVideoRect(i,Sk.Rect.fromXYWH(0,0,1,1),Sk.Rect.fromXYWH(0,0,1,1)),d.isVideoEnabled()?a.drawVideoRect(i,Sk.Rect.fromWH(i.videoWidth,i.videoHeight),t.getBoundsRect(),r):a.drawRRect({rect:o},n)}function w(){var e=Util.now();return d.isInAnimationFrame(),Compositor.VideoMode.kCopy,!!t.getTilingSet().drawTilesInRect(t.getBoundsRect(),b)&&(Util.now()-g>=1e3?(S(),f=0,p=0,g=Util.now()):(f+=1,p+=Util.now()-e),!0)}function C(e){return e===Compositor.VideoMode.kCopy||(Compositor.VideoMode.kNative,d.isNativeVideoEnabled()&&!_)}function T(){s&&(clearTimeout(s),s=null),f=0,p=0,S()}function E(e,t){i&&d.isDebugEnabled()&&i.setAttribute("debug_"+e,t)}function A(){var e,r,n,o=t.getBoundsRect();d.isInAnimationFrame(),void 0!==i.videoWidth&&i.videoHeight,i.lastVideoWidth=i.videoWidth,i.lastVideoHeight=i.videoHeight,i.videoWidth>0&&i.videoHeight>0?(E("debug","got dims "+i.videoWidth+"x"+i.videoHeight),n=mat4.create(),e=Sk.Rect.getWidth(o)/i.videoWidth,r=Sk.Rect.getHeight(o)/i.videoHeight,d.isDebugEnabled()&&(i.setAttribute("sx",e),i.setAttribute("sy",r)),mat4.scale(n,n,vec3.fromValues(e,r,1))):E("debug","awaiting dims"),t.applyDrawTransform(i,o,n)}function R(){var e,r,n,o,s;a!==Compositor.VideoMode.kCopy&&i&&(e=1,r=1,o=n=t.getBoundsRect(),s=y,void 0!==i.videoWidth&&i.videoHeight,i.videoWidth>0&&i.videoHeight>0&&y&&(Sk.Rect.isEmpty(n)||(e=i.videoWidth/Sk.Rect.getWidth(n),r=i.videoHeight/Sk.Rect.getHeight(n)),1===e&&1===r||(o=Sk.Rect.fromWH(i.videoWidth,i.videoHeight),s=Sk.Rect.scaleXY(y,e,r))),t.applyDrawClip(i,o,s))}function x(){t.applyDrawOpacity(i)}function D(e){t.getTilingSet().invalidateRect(t.getLocalDrawRect(),e)}function I(){return d.isInAnimationFrame(),v(),t.setTilingSetVisible(!0),o&&(o.style.display="block"),D("video-switch-to-copy"),!0}function O(e,r){if(d.isInAnimationFrame(),i&&a!==e){if(!C(e))return a=Compositor.VideoMode.kCopy,void I();if(r&&(_=!0),e===Compositor.VideoMode.kNative)return d.isInAnimationFrame(),T(),t.setTilingSetVisible(!1),t.getContainer().appendChild(i),l.updateProjection(),R(),l.updateOpacity(),o&&(o.style.display="none"),void(a=e);Compositor.VideoMode.kCopy,a!==e&&(a=e,I())}}function U(){var e;t.hasVideoContent(),i||(e=t.getDOMNodeId())&&(i=getNodeByUidOnly(e))&&(i.style.position="absolute",d.isDebugEnabled()&&i.setAttribute("video_layer",t.getID()),L(i,!0),l.updateSizeAndRedraw(t.getBounds()),l.requestDisplay())}function M(){a!==Compositor.VideoMode.kCopy||!i||Util.now()-m<1e3/30||i.paused||D("video-needs-redraw")}function F(r){i?(E("state",r.type),E("src",i.src),E("currentSrc",i.currentSrc),a!==Compositor.VideoMode.kCopy?a!==Compositor.VideoMode.kNative||"timeupdate"!==r.type&&"loadedmetadata"!==r.type||i.lastVideoWidth===i.videoWidth&&i.lastVideoHeight===i.videoHeight||(e.setVideoSizeChanged(),t.runOn("will-draw",(function(){i&&(A(),R(),x())}))):function(e){"play"!==e.type&&"seeked"!==e.type&&"loadeddata"!==e.type&&"canplay"!==e.type||D("video-copy-mode-event")}(r)):c.error({event:"tc-unexpected-video-event",reason:"not paired with video element"})}function P(e,r){e===t.getDOMNodeId()&&U()}function L(e,t){var r=t?EventListener.addListener:EventListener.removeListener;["play","pause","seeked","canplay","loadeddata","loadedmetadata","timeupdate"].forEach((function(t){r(e,t,F)}))}l.drawFrame=function(){return d.isInAnimationFrame(),a!==Compositor.VideoMode.kCopy||(C(Compositor.VideoMode.kNative)&&(s||(s=setTimeout((function(){s=null,i&&a!==Compositor.VideoMode.kNative&&t.runOn("will-draw",(function(){O(Compositor.VideoMode.kNative)}))}),500))),i&&i.parentNode?(m=Util.now(),w()):(c.error({event:"tc-video-draw-error",video:!!i,attached:!!i&&!!i.parentNode,reason:"video element is in unplayable state"}),!0))},l.updateProjection=function(){a!==Compositor.VideoMode.kCopy&&i&&A()},l.updateClip=function(e){(y||e)&&(y=e?Sk.Rect.makeCopy(e):null,R())},l.updateOpacity=function(){a!==Compositor.VideoMode.kCopy&&i&&x()},l.requestDisplay=function(){t.runOn("will-draw",(function(){O(d.isNativeVideoEnabled()?Compositor.VideoMode.kNative:Compositor.VideoMode.kCopy)}))},l.pairWithVideoElementIfNeeded=U,l.updateSizeAndRedraw=function(e){i&&a===Compositor.VideoMode.kCopy&&w()},l.stop=function(e){h&&(t.getID(),T(),v(),i&&(L(i,!1),i=null,a=null),Util.forEachItem(u,(function(e,t){d.callback.deregister(t)})),u={},h=!1)},l.start=function(e){t.getID(),h=!0,u.media_node_insert=d.callback.register("media-node-inserted",P),u.begin_animation_frame=d.callback.register("begin-animation-frame",M),d.callback.register("remove-media-node",k),U()},l.getVideoNode=function(){return i},r=Sk.Paint.makePaint({filterQuality:Sk.FilterQuality.kLow,blendMode:Sk.BlendMode.kSrc}),n=Sk.Paint.makePaint({filterQuality:Sk.FilterQuality.kLow,blendMode:Sk.BlendMode.kSrc,color:0})},Compositor.GraphWidgetType=Object.freeze({kRateWidget:1,kValueWidget:2}),Compositor.GraphWidget=function(e,t,r,n,i){var o,a,s,l=this,c=Date.now(),d=[],u=0;function f(e){e=Math.round(e),a.firstChild&&a.removeChild(a.firstChild),a.appendChild(document.createTextNode(e+" "+t))}function p(e){var t=30/r[1];return Math.round(t*e),Math.min(30,Math.max(Math.round(t*e),1))}l.getDiv=function(){return o},l.getHelpMsg=function(){return i},l.update=function(t){var i,o,a,l,g,m,_,h=Math.max(1,Date.now()-c),y=0,v=0;if(t.length){if(s.childNodes.length>=70)i=s.firstChild,s.removeChild(i);else for((i=document.createElement("div")).style.width="1px",i.style.float="left",i.style.overflow="hidden",_=0;_<n;_+=1)(o=document.createElement("div")).style.display="block",o.style.width="1px",o.style.padding="0px 0px 0px 0px",i.appendChild(o);for(_=0;_<t.length;_+=1)g=t[_][0],m=t[_][1]||"rgb(0, 255, 0)",void 0===d[_]&&(d[_]=0),d[_]+=g,u+=v+=g,e===Compositor.GraphWidgetType.kRateWidget?a=p(d[_]*(1e3/h)):e===Compositor.GraphWidgetType.kValueWidget&&(a=p(g)),(l=i.childNodes[_]).style.top=y+"px",l.style.height=a+"px",l.style.backgroundColor=g>r[1]?"rgb(255, 0, 0)":m,y+=a;h>=1e3&&(e===Compositor.GraphWidgetType.kRateWidget?f(u/(h/1e3)):e===Compositor.GraphWidgetType.kValueWidget&&f(v),d=[],u=0,c=Date.now()),s.appendChild(i)}},e===Compositor.GraphWidgetType.kRateWidget||Compositor.GraphWidgetType.kValueWidget,(a=document.createElement("div")).id="sv-text:"+t,a.style.color="rgb(0, 255, 0)",a.style.fontFamily="Arial",a.style.fontSize="9px",a.style.fontWeight="bold",a.style.lineHeight="15px",f(""),(s=document.createElement("div")).id="sv-graph:"+t,s.style.position="relative",s.style.width="74px",s.style.height="30px",s.style.backgroundColor="rgb(0, 0, 0)",s.style.transform="rotateX(180deg)",s.style.overflow="hidden",(o=document.createElement("div")).id="sv-widget:"+t,o.style.display="inline-block",o.style.textAlign="left",o.style.padding="0px 0px 3px 3px",o.style.margin="5px",o.style.backgroundColor="rgb(0, 0, 0)",o.style.borderRadius="3px 3px 3px 3px",o.style.overflow="visible",o.style.opacity="0.8",o.style.filter="drop-shadow(0 0 40px #333)",o.appendChild(a),o.appendChild(s)},Compositor.HUD=function(e,t){var r,n,i,o=this,a=Date.now(),s={};function l(){n||(n=window.requestAnimationFrame((function(){n=null,Date.now()-a>=t&&(e(s),a=Date.now()),l()})))}void 0===t&&(t=100),o.getDiv=function(){return r},o.start=function(){l()},o.stop=function(){n&&(window.cancelAnimationFrame(n),n=null)},o.show=function(){r.style.display="block"},o.hide=function(){r.style.display="none"},o.addWidget=function(e){var t=document.createElement("div");return t.id=e,r.appendChild(t),t},o.updateWidget=function(e,t){e&&(e.firstChild&&e.removeChild(e.firstChild),t?(e.style.display="block",e.appendChild(document.createTextNode(t))):e.style.display="none")},o.release=function(){o.stop(),r&&r.parentNode&&r.parentNode.removeChild(r),r=null},(i=document.createElement("div")).id="sv-tooltip:"+name,i.style.display="none",i.style.position="fixed",i.style.left="50%",i.style.top="40%",i.style.transform="translate(-50%, -50%)",i.style.padding="10px",i.style.color="white",i.style.backgroundColor="rgba(40, 40, 40, 0.9)",i.style.borderRadius="3px 3px 3px 3px",(r=document.createElement("div")).id="sv-hud",r.style.display="none",r.style.position="fixed",r.style.top="10%",r.style.right="15px",r.style.width="80px",r.appendChild(i),s.cps=new Compositor.GraphWidget(Compositor.GraphWidgetType.kRateWidget,"CPS",[0,30],1,"Commits Per Second"),s.fps=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"FPS",[0,70],1,"Frames Per Second"),s.sfps=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"SFPS",[0,70],1,"Surrogate FPS"),s.cql=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"CQL",[0,100],1,"Commit Queue Length"),s.crx=new Compositor.GraphWidget(Compositor.GraphWidgetType.kRateWidget,"DR (KB)",[0,200],2,"Data Rate (TX & RX)"),s.canvas=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"CANV (MB)",[0,600],6,"Total Canvas Memory Usage"),s.hidden_canvas=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"HIDDEN CANV (MB)",[0,600],1,"Hidden Canvas Memory Usage"),s.ptn_count=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"PTNC",[0,40],4,"Property Tree Node Count"),s.ptn_mutations=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"PTNM",[0,40],4,"Property Tree Node Mutation Rate"),s.fdt=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"FDT",[0,200],1,"Frames Drawing Time (ms)"),s.vtc=new Compositor.GraphWidget(Compositor.GraphWidgetType.kValueWidget,"VTC",[0,100],1,"Visible Tiles Count"),Util.forEachItem(s,(function(e,t){r.appendChild(t.getDiv()),EventListener.addListener(t.getDiv(),"mouseover",(function(e){var r;i.style.display="block",r=t.getHelpMsg(),i.firstChild&&i.removeChild(i.firstChild),i.appendChild(document.createTextNode(r))})),EventListener.addListener(t.getDiv(),"mouseout",(function(e){i.style.display="none"}))}))},Compositor.RequestAnimationFrame=function(e){var t,r,n=this,i="visibilitychange",o=!1,a=[],s=0,l=!1;function c(){a.push(Date.now()),a.length>60&&a.shift(),e()}function d(){if(s&&!l)return setTimeout(d,s),void(l=!0);l=!1,t=null,c(),o&&(t=window.requestAnimationFrame(d))}function u(){t&&(window.cancelAnimationFrame(t),t=null),r&&(clearInterval(r),r=null),Util.isTabVisible()?t=window.requestAnimationFrame(d):(a=[],r=window.setInterval(c,3e3))}n.getFPS=function(){var e;return a.length<60||(e=a[a.length-1]-a[0])<=0?60:a.length/(e/1e3)},n.setFrameDelayForTest=function(e){s=e},n.start=function(){o=!0,EventListener.addListener(document,i,u),u()},n.stop=function(){o&&(EventListener.removeListener(document,i,u),t&&(window.cancelAnimationFrame(t),t=null),r&&(clearInterval(r),r=null),o=!1)},n.release=function(){n.stop()},n.runOne=function(){d()},window.requestAnimationFrame&&window.cancelAnimationFrame},Compositor.ScrollThread=Object.freeze({kScrollOnSurrogateMainThread:0,kScrollOnLocalJavaScriptThread:1,kScrollOnLocalImplThread:2,kScrollIgnored:3}),Compositor.ScrollOrigin=Object.freeze({kOriginSurrogate:0,kOriginScrollEvent:1,kOriginProgrammatic:2,kOriginIgnore:3}),Compositor.ScrollAction=Object.freeze({kNoAction:0,kForwardToSurrogate:1,kPreventNativeScroll:2,kAllowNativeScroll:3,kForwardToNextFrame:4,kRequiresMainThreadHitTest:5}),Compositor.MainThreadScrollingReason=Object.freeze({kNotScrollingOnMain:0,kScrollingOnMainForAnyReason:1,kHasBackgroundAttachmentFixedObjects:4,kPopupNoThreadedInput:16,kPreferNonCompositedScrolling:32768,kBackgroundNeedsRepaintOnScroll:65536,kNotOpaqueForTextAndLCDText:32,kCantPaintScrollingBackgroundAndLCDText:64,kScrollbarScrolling:128,kNonFastScrollableRegion:256,kFailedHitTest:512,kNoScrollingLayer:1024,kWheelEventHandlerRegion:8192,kTouchEventHandlerRegion:16384,kMainThreadScrollingReasonLast:16}),Compositor.PreventDefaultObserver=function(e,t){var r=this,n=t.getDisplay(),i={};r.didHandlerPreventDefault=function(e){return e===Compositor.EventType.kWheel||Compositor.EventType.kTouch,!!i[e]},r.wheelHandlerStateChanged=function(e){var t=i[e];e===Compositor.EventType.kWheel||Compositor.EventType.kTouch,t&&clearTimeout(t),t=setTimeout((function(){delete i[e],n.callback.fire("wheel-handler-state-changed")}),5e3),i[e]=t,n.callback.fire("wheel-handler-state-changed")},r.release=function(){Util.forEachItem(i,(function(e,t){t&&clearTimeout(t)})),i=null}},Compositor.ScrollState=function(e,t,r,n){var i,o=this,a=Compositor.Offset.makeCopy(r),s=!1,l=!1,c=!1;o.getPosition=function(){return t},o.getVelocity=function(){return n},o.getEventType=function(){return e},o.getRemainingDelta=function(){return a},o.getTargetElementId=function(){return i},o.setTargetElementId=function(e){i=e},o.setHasMainThreadHitTestedReasons=function(){l=!0},o.hasMainThreadHitTestedReasons=function(){return l},o.setIsScrollbarInteraction=function(){c=!0},o.isScrollbarInteraction=function(){return c},o.hasRemainingDelta=function(){return!Compositor.Offset.isZero(a)},o.wasDeltaConsumed=function(){return s},o.consumeDelta=function(e){return Compositor.Offset.isZero(e)||(s=!0),Compositor.Offset.subtract(a,e,a)},o.asDict=function(){return{pos:t,rem_delta:a,target_element_id:i}},o.reset=function(){a.x=a.y=0,s=!1,i=null,l=!1},Compositor.Offset.isValid(t)},Compositor.ScrollAnimator=function(e,t){var r,n,i,o,a,s=this;function l(){var t=Date.now()-a,r=Compositor.Offset.makeXY(i.x?Math.min(i.x/.003,2e3):0,i.y?Math.min(i.y/.003,2e3):0),l=Compositor.Offset.makeXY(r.x?t/r.x:1,r.y?t/r.y:1),c=Compositor.Offset.makeXY(l.x<=1?Compositor.Util.quadBezier(l.x,i.x,0,0):0,l.y<=1?Compositor.Util.quadBezier(l.y,i.y,0,0):0),d=Date.now()-o,u=Compositor.Offset.multiply(c,Compositor.Offset.scale(n,d)),f=new Compositor.ScrollState(Compositor.EventType.kTouch,Compositor.Offset.makeZero(),u);l.x,l.y,e.scrollUpdate(f),o=Date.now(),l.x>=1&&l.y>=1&&s.stop()}s.start=function(e){r||(n=Compositor.Offset.sign(e),i=Compositor.Offset.abs(e),o=Date.now(),a=Date.now(),l(),r=setInterval(l,16))},s.stop=function(){r&&(clearInterval(r),r=null,t())}},Compositor.ScrollDelegate=function(e,t){var r,n,i,o,a,s=this,l=t.getDisplay();function c(){return t.getPropertyTrees().getScrollTree()}function d(e){return!e||e.isRootOrSecondaryRootNode()?null:e.scrollsInnerViewport()&&!e.preventViewportScrollingFromInner()?l.getOuterViewportScrollNode():e}function u(e,t,r){var n,i,o=c();return e.isScrollbar()?((i=o.findNodeFromElementId(e.getScrollElementId()))&&r(d(i)),!0):(n=d(o.getNode(e.getScrollTreeIndex())),!(t&&!n||n&&!t||(t||n)&&(t.isScrollbar()||n.getId()!==t.getScrollTreeIndex()||(r(n),0))))}function f(e,t){var r,n,i;return!(!Compositor.Offset.isZero(e)&&(r=c().getScrollOffset(t.getElementId()),n=c().calcProjectedScrollOffset(t,e),Compositor.Offset.isEqual(r,n)||(i=Compositor.Offset.subtract(n,r),Compositor.Offset.angleBetween(e,i)>=45&&(t.scrollsOuterViewport(),1))))}function p(e,t){var r=e.getOverscrollBehavior();return!(0!==t.x&&r.x!==Compositor.OverscrollBehaviorType.kAuto||0!==t.y&&r.y!==Compositor.OverscrollBehaviorType.kAuto)}function g(e){return!(!l.getInnerViewportScrollNode()||!l.getOuterViewportScrollNode())&&(e.scrollsInnerViewport()||e.scrollsOuterViewport())}function m(e){var r,n,o,a={},f=e.getPosition(),p=e.getTargetElementId();if(Compositor.Offset.isZero(e.getRemainingDelta()),!(n=t.hitTest(Compositor.HitTest.kLayer,f)))return a.thread=Compositor.ScrollThread.kScrollIgnored,a.reason="no-layer-was-hit",a;if(function(e,r){var n=e.getEventType(),i=e.getPosition();return!!(t.hasBlockingEventListener(n)&&r.getScrollNode().isScrollable()&&(r.isTextureLayer()&&t.hitTest(Compositor.HitTest.kTouchActionRegion,i)||l.getConfig().getPreferScrollingCorrectness()&&s.didHandlerPreventDefault(n)&&(t.hitTest(Compositor.HitTest.kWheelEventRegion,i)||t.hitTest(Compositor.HitTest.kTouchEventRegion,i))))}(e,n))return{thread:Compositor.ScrollThread.kScrollOnSurrogateMainThread,reason:"requires-main-thread-scrolling"};if(p){if(!(r=c().findNodeFromElementId(p)))return{thread:Compositor.ScrollThread.kScrollIgnored,reason:"no-scroll-node-for-id"}}else{if(e.hasMainThreadHitTestedReasons())return{thread:Compositor.ScrollThread.kScrollIgnored,reason:"hit-test-bouncing"};if(!(o=function(e){var r,n,i,o,a,s=[],c={},f=function(e){a=e};for(c.hit_test_successful=!1,c.scroll_node=null,t.hitTestLayerTree(e,(function(e,t){return s.push(e),!(!e.isScrollerOrScrollbar()&&!e.isOpaqueToHitTest()||(o=e,0))})),r=0;r<s.length;++r){if(!u(n=s[r],o,f))return c.main_thread_hit_test_reasons=Compositor.MainThreadScrollingReason.kFailedHitTest,c;if((i=n.hitTestPoint(e))&&Sk.Region.containsPoint(n.getNonFastScrollableRects(),i))return c.main_thread_hit_test_reasons=Compositor.MainThreadScrollingReason.kNonFastScrollableRegion,c}return a?(c.scroll_node=a,c.hit_test_successful=!0,c):(c.hit_test_successful=!0,l.getInnerViewportScrollNode()&&(c.scroll_node=d(l.getInnerViewportScrollNode())),c)}(f)).hit_test_successful)return a.main_thread_hit_test_reasons=o.main_thread_hit_test_reasons,a;r=o.scroll_node}return(r=d(r))?(i=r.getElementId(),function(e){var t;return l.isNativeOVSLScrollingEnabled()&&e.scrollsOuterViewport()?{thread:Compositor.ScrollThread.kScrollOnLocalImplThread,reason:"scrolls-outer-viewport"}:e.isScrollable()?(t=e.maxScrollOffset()).x<=0&&t.y<=0&&!e.scrollsOuterViewport()&&!e.scrollsInnerViewport()?{thread:Compositor.ScrollThread.kScrollIgnored,reason:"cannot-scroll"}:{thread:Compositor.ScrollThread.kScrollOnLocalJavaScriptThread,reason:"does-not-scroll-ovsl"}:{thread:Compositor.ScrollThread.kScrollIgnored,reason:"not-scrollable"}}(r)):{thread:Compositor.ScrollThread.kScrollIgnored,reason:"no-scroll-node"}}function _(e){var t;if(!(t=c().findNodeFromElementId(n||i)))return!1;if(!n){if(!(t=function(e,t){var r,n,i=c();for(n=t;n;n=i.getNode(n.getParentId())){if(g(n)){r=d(n);break}if(n.isScrollable()){if(f(e.getRemainingDelta(),n)){r=n;break}if(!p(n,e.getRemainingDelta())){r=n;break}}}return r}(e,t)))return!1;n=t.getElementId()}return function(e,t){var r=c(),n=e.getRemainingDelta(),o=r.getScrollOffset(t.getElementId()),a=r.calcProjectedScrollOffset(t,n),s=Compositor.Offset.subtract(a,o);l.isNativeOVSLScrollingEnabled()&&t.scrollsOuterViewport()||r.scrollBy(t,s),e.consumeDelta(s),i=t.getElementId()}(e,t),e.wasDeltaConsumed()&&n!==i&&(n=i),e.wasDeltaConsumed()}function h(){n&&(n=null),i=null}function y(){var e;return!!n&&(e=c().findNodeFromElementId(n))&&e.scrollsOuterViewport()}s.getLth=function(){return t},s.wheelHandlerStateChanged=function(e){r.wheelHandlerStateChanged(e)},s.didHandlerPreventDefault=function(e){return r.didHandlerPreventDefault(e)},s.willScrollNatively=function(e,t){return m(new Compositor.ScrollState(e,t,Compositor.Offset.makeXY(0,0))).thread===Compositor.ScrollThread.kScrollOnLocalImplThread},s.didUpdateScrollOffset=function(e,r){var n=c(),i=n.findNodeFromElementId(e),o=t.getPropertyTrees().getTransformTree().getNode(i.getTransformId()),a=n.getScrollOffset(e),s=t.getLayerTree().getLayerByElementId(i.getElementId());o&&(o.setScrollOffset(a),function(e,r){var n=t.getLayerTree();n.setScrollbarGeometriesNeedUpdate(),n.updateScrollbarGeometries(),n.getScrollbarsFor(e).forEach((function(e){var t=e.isLocallyPaintedScrollbarLayer()?e.getScrollbarDelegate():null;t&&t.setPosition(r)}))}(e,a),l.isNativeOVSLScrollingEnabled()&&s&&s.isOuterViewportScrollLayer()&&(Compositor.ScrollOrigin.kOriginProgrammatic,r===Compositor.ScrollOrigin.kOriginSurrogate&&s.scrollTo(a)))},s.scrollUpdate=_,s.doScroll=function(e,r){if(e===Compositor.GestureType.kScrollEnd)return r&&r.getEventType()===Compositor.EventType.kTouch&&o.thread===Compositor.ScrollThread.kScrollOnLocalJavaScriptThread?(r.getVelocity(),(a=new Compositor.ScrollAnimator(s,(function(){h(),o=null,a=null}))).start(r.getVelocity())):(h(),o=null),Compositor.ScrollAction.kNoAction;if(e===Compositor.GestureType.kScrollBegin)a&&(a.stop(),a=null),o&&r.isScrollbarInteraction()!==o.is_scrollbar_interaction&&(h(),o=null),(o=m(r)).is_scrollbar_interaction=r.isScrollbarInteraction(),r.hasRemainingDelta();else if(e===Compositor.GestureType.kScrollUpdate){if(!o)return Compositor.ScrollAction.kNoAction;o.thread===Compositor.ScrollThread.kScrollOnLocalJavaScriptThread&&(_(r)||t.isMainFrame()||r.isScrollbarInteraction()||(o.thread=Compositor.ScrollThread.kScrollIgnored))}return o.thread,o.reason,o.main_thread_hit_test_reasons?Compositor.ScrollAction.kRequiresMainThreadHitTest:o.thread===Compositor.ScrollThread.kScrollOnSurrogateMainThread?Compositor.ScrollAction.kForwardToSurrogate:o.thread===Compositor.ScrollThread.kScrollIgnored?t.isMainFrame()?Compositor.ScrollAction.kForwardToSurrogate:Compositor.ScrollAction.kForwardToNextFrame:l.isNativeOVSLScrollingEnabled()?o.thread===Compositor.ScrollThread.kScrollOnLocalImplThread||y()?Compositor.ScrollAction.kAllowNativeScroll:n?(y(),n&&(o.thread,Compositor.ScrollThread.kScrollOnLocalImplThread),Compositor.ScrollAction.kPreventNativeScroll):BrowserDetect.isMobileSafari()?Compositor.ScrollAction.kAllowNativeScroll:Compositor.ScrollAction.kPreventNativeScroll:Compositor.ScrollAction.kPreventNativeScroll},s.onPointerEventScrollResult=function(e,t){var r,n,i;return t&&(t.type,Compositor.PointerResultType.kScrollbarScroll),r=t.phase,i=t.scroll_delta||Compositor.Offset.makeZero(),r!==Compositor.GestureType.kScrollBegin||Compositor.Offset.isZero(i)||((n=new Compositor.ScrollState(Compositor.EventType.kWheel,Compositor.Offset.makeXY(e.x,e.y),Compositor.Offset.makeZero())).setIsScrollbarInteraction(),n.setTargetElementId(t.target_scroller),s.doScroll(Compositor.GestureType.kScrollBegin,n),r=Compositor.GestureType.kScrollUpdate),(n=new Compositor.ScrollState(Compositor.EventType.kWheel,Compositor.Offset.makeXY(e.x,e.y),i)).setIsScrollbarInteraction(),n.setTargetElementId(t.target_scroller),s.doScroll(r,n)},s.stopScrollAnimation=function(){a&&(a.stop(),a=null)},s.release=function(){s.stopScrollAnimation(),r&&(r.release(),r=null)},s.getPendingScrollForTest=function(){return o},s.getScrollingElementIdForTest=function(){return i},r=new Compositor.PreventDefaultObserver(e,t)},Compositor.VisualViewportDelegate=function(e,t){var r,n,i=t.getMainFrame(),o=new Compositor.ManagedListeners,a=!0,s=Util.getScreenOrientationType();function l(){var e=MetricsUtils.getVisualViewportMetrics();return{scroll_off:Compositor.Offset.makeXY(e.x,e.y),scale:MetricsUtils.getVisualViewportScale()}}function c(e){var r=t.getInnerViewportScrollNode();r&&(i.setActiveTreePageScaleFactor(e.scale),i.getPropertyTrees().getScrollTree().setScrollOffset(r.getElementId(),e.scroll_off,Compositor.ScrollOrigin.kOriginScrollEvent))}function d(){var r,n=e.getLayoutViewport(),i=t.getOuterViewportScrollNode();BrowserDetect.isMobile()&&(n.width!==i.getContainerBounds().width||MetricsUtils.maybeSplitView()?n.width=i.getContainerBounds().width:n.width="device-width",r=t.getMainFrame().getLayerTree().getPageScaleFactorLimits(),Util.isDictEmpty(r),n.initial_scale=r.current,BrowserDetect.isMobileSafariOnIPhone()||BrowserDetect.isAndroidChrome()?(n.minimum_scale=r.min,n.maximum_scale=r.max):(void 0!==r.min&&(n.minimum_scale=Math.round(100*r.min)/100),void 0!==r.max&&(n.maximum_scale=Math.round(100*r.max)/100)),function(e){var r=t.getInnerViewportScrollNode();r&&e.initial_scale&&BrowserDetect.isMobileSafari()&&!BrowserDetect.isMobileSafariOnIPhone()&&("device-width"!==e.width&&e.width>r.getContainerBounds().width&&1===e.initial_scale||(e.initial_scale=void 0))}(n),e.setLayoutViewport(n))}function u(){var t=l();r&&Compositor.Offset.isEqual(t.scroll_off,r.scroll_off)&&t.scale===r.scale||(c(t),r=t,e.callback.fire("visual-viewport-changed"))}this.asDict=function(){return{}},this.release=function(){o&&(o.release(),o=null)},n=Util.getVisualViewport(),BrowserDetect.isMobileSafari()&&o.add([[window,"resize",function(){var e,r,n=Util.getScreenOrientationType();s!==n&&((r=t.getOuterViewportScrollNode())&&(e=i.getPropertyTrees().getScrollTree().getScrollOffset(r.getElementId()),window.scrollTo(e.x,e.y)),s=n)},!1]]),n?o.add([[n,"resize",u],[n,"scroll",u]]):BrowserDetect.isMobileSafari()&&o.add([[window,"scroll",u,!1]]),t.callback.register("did-activate-tree",(function(){var n,i;!a&&(n=e.getLayoutViewport(),!(i=t.getOuterViewportScrollNode())||n.width===i.getContainerBounds().width||MetricsUtils.maybeSplitView()&&"number"==typeof n.width&&Math.abs(n.width-i.getContainerBounds().width)<5)||(t.getInnerViewportScrollNode(),d(),c(r),a=!1)})),t.callback.register("did-surrogate-change-page-scale",(function(){a?t.getInnerViewportScrollNode():(t.getInnerViewportScrollNode(),d())})),r=l()},Compositor.TileManager=function(e){var t=this,r=new Compositor.Set((function(e){return e.fid+":"+e.lid+":"+e.key})),n=new Compositor.Set((function(e){return e.getLayer().getLayerTreeHost().getFid()+":"+e.getLayer().getID()})),i={},o={},a={},s=0;function l(e){return e.fid+":"+e.lid+e.key}function c(e,t){return e+":"+t}t.allocTilingSet=function(e){var t,r=e.layer,o=c(r.getLayerTreeHost().getFid(),r.getDOMNodeId());return i.hasOwnProperty(o)&&(t=i[o],delete i[o],t.attachToNewLayer(r)),t||(t=new Compositor.TilingSet(e)),n.has(t),n.add(t),t},t.discardResourceProvider=function(t,r,n){var a;return!(e.getConfig().isLocalDLForTextureAllowed()&&(a=c(t,r),i.hasOwnProperty(a)?(i[a].release(),delete i[a],0):!n||(o[a]=1,0)))},t.freeTilingSet=function(t){n.remove(t),function(t){var r,n=t.getLayer();return!!(n&&n.isTextureLayer()&&e.getConfig().isLocalDLForTextureAllowed())&&(r=c(n.getLayerTreeHost().getFid(),n.getDOMNodeId()),o[r]?(delete o[r],n.getDOMNodeId(),!1):(i[r]=t,!0))}(t)?t.getLayer().getDOMNodeId():t.release()},t.forEachTilingSet=function(e){n.forEachItem(e)},t.forEachTile=function(e){r.forEachItem(e)},t.addTile=function(e){r.add(e),e.type===Compositor.TileType.kCanvas&&(a[e.rsf]||(a[e.rsf]={}),a[e.rsf][l(e)]=e),s+=e.mem_size},t.removeTile=function(e){e.type===Compositor.TileType.kCanvas&&delete a[e.rsf][l(e)],r.remove(e),s-=e.mem_size},t.asDict=function(){return{mem_size:s,tiles:r.asDict(),tiles_by_rsf:a}}},Compositor.RemoteInputTracker=function(e,t){var r={};function n(e,t){r[e]||(r[e]={}),r[e][t]||(r[e][t]={value:null,caret_pos:null})}this.getState=function(e,t){return r[e]?r[e][t]:null},this.asDict=function(){return r},e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_INPUT_VALUE,(function(e,i,o){n(e,i),r[e][i].value=o,t.callback.fire("input-value-changed",e,i,o)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_CARET_POS,(function(e,i,o){JSON.stringify(o),n(e,i),r[e][i].caret_pos=o,t.callback.fire("input-caret-changed",e,i,o)})),e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_INPUTS_UPDATE,(function(e,i,o){var a;for(JSON.stringify(i),JSON.stringify(o),a=0;a<i.length;a+=1)r[e]&&delete r[e][i[a]];Util.forEachItem(o,(function(i,o){n(e,i),r[e][i].value=o,t.callback.fire("input-value-changed",e,i,o)}))})),e.interp.hasOpcodeHandler(e.interp.OPCODES.REMOTING_V2_SET_SELECTIONS)||e.interp.registerOpcodeHandler(e.interp.OPCODES.REMOTING_V2_SET_SELECTIONS,(function(){}))},Compositor.ShadowAnchorNode=function(){var e,t=this,r=!1;t.rewriteUntrustedUrl=function(e){return e=e.trim(),Util.startsWithAnyOf(e,["http:","https:"])?Util.rewriteRawHref(e):(safeview.pairing_dict&&safeview.pairing_dict.client_caps&&safeview.pairing_dict.client_caps.applicationLinks&&(r=Util.startsWithAnyOf(e,safeview.pairing_dict.client_caps.applicationLinks)),r?e:"about:blank#blocked")},t.onPointerEventsStatusChanged=function(t){e.style.pointerEvents=t?"none":"auto"},t.getType=function(){return Sk.SE.Type.kShadowAnchorNode},t.update=function(r){var n=r[0].data.link_url,i=t.rewriteUntrustedUrl(n);e.setAttribute("href",i)},t.updateProjection=function(t,r){var n,i=Sk.Rect.makeEmpty();for(n=0;n<r.length;n+=1)Sk.Rect.join(i,r[n].canvas_bounds);Sk.Rect.toCSSStyle(i,e.style),t.applyDrawTransform(e,i)},t.release=function(){e.parentNode,e=null},t.getNode=function(){return e},t.processPointerEvent=function(t){var n,i=t.active_event;return"touchend"===i.type&&r?(e.click(),i.preventDefault(),i.stopPropagation(),!1):"click"!==i.type&&"mousedown"!==i.type&&"mouseup"!==i.type||((n=function(e){if(e.button,e.button!==Compositor.MouseButton.kLeftButton)return!0;if(BrowserDetect.isMac()){if(e.ctrlKey)return!0;if(e.metaKey)return!0}return!1}(i))||"click"!==i.type||i.preventDefault(),!n)},t.init=function(t){var r;(r=document.createElement("a")).style.position="absolute",r.style.display="block",r.style.backgroundColor="transparent",r.style.color="transparent",e=r}},Compositor.ShadowElementManager=function(e){var t,r,n,i,o=this,a=new Logger("sem",{level:"info"}),s=!1,l={},c={},d={},u={},f={},p={},g=0,m=0,_={};function h(t){var r,n,i=c[t];if(i&&(function(e){var t,r,n;e.getFid&&(t=e.getFid(),_.hasOwnProperty(t)&&(n=_[t],r=0,n.forEach((function(t){t.getNodeUid()!==e.getNodeUid()&&(r+=1)})),r!==n.length&&n.splice(r,1),0===n.length&&delete _[t]))}(i),r=i.getNode(),i.focus_fn&&EventListener.setListenersEnabled(!1,r,["focus"],i.focus_fn),i.blur_fn&&EventListener.setListenersEnabled(!1,r,["blur"],i.blur_fn),r.parentNode.removeChild(r),e.callback.fire("removed-shadow-element",t,i.layer),i.release(),i.items=null,i.layer=null,delete c[t],i.layer&&i.layer.getLayerTreeHost())){if(n=i.layer.getLayerTreeHost().getFrameSinkId(),!d.hasOwnProperty(n))return;delete d[n][t]}}function y(e){c[e]&&(s?h(e):l.hasOwnProperty(e)||(l[e]=Date.now(),n||(n=setInterval((function(){if(Util.isDictEmpty(l))return clearInterval(n),void(n=null);Util.forEachItem(l,(function(e,t){Date.now()-t<1e3||(delete l[e],h(e))}))}),200))))}function v(e){var t=e.getFid();e.setForceReadOnly&&p.hasOwnProperty(t)&&e.setForceReadOnly(!!p[t].is_readonly)}function k(e){var t=e.getFid(),r=e.getNodeId();p.hasOwnProperty(t)&&p[t].is_readonly&&p[t].has_exception&&safeview.surrogate_channel.send("mi-query-ro-exception",Number(t),String(r))}function S(e){return e.data.type===Sk.HT.ElementType.kFormControl}function b(e){return e[0].data.type===Sk.HT.ElementType.kFormControl}function w(e){return!!S(e[0])}function C(t,r,n){r?t.onFocusEvent&&t.onFocusEvent(n):t.onBlurEvent&&t.onBlurEvent(n),e.callback.fire("shadow-element-focus-change",t.node_uid,t.layer,r)}function T(t,r,n){var i=c[t],o=n.getLayerTreeHost().getFrameSinkId();if(function(e){l.hasOwnProperty(e)&&delete l[e]}(t),!i){if(!(i=function(t,r,n){var i=r[0];return S(i)?function(t,r,n){var i=t.data.node_id,o=t.data.node_uid,a=t.data.formctrl,s=null;switch(a.type,a.type){case Sk.HT.FormControlElement.Type.kInput:case Sk.HT.FormControlElement.Type.kTextArea:case Sk.HT.FormControlElement.Type.kContentEditable:s=new Compositor.ShadowTextControl(Number(n),Number(i),String(o),e.getRemoteInputTracker().getState(n,i));break;case Sk.HT.FormControlElement.Type.kSelect:s=new Compositor.ShadowSelect(Number(n),Number(i),String(o));break;default:return null}return p.hasOwnProperty(n)?(v(s),k(s),s):(_.hasOwnProperty(n)||(_[n]=[]),_[n].push(s),s)}(i,0,e.getFrameTreeNodeId(i.data.frame_token)):i.data.flags&Sk.HT.ElementFlags.kHasLink&&f.hasOwnProperty(i.data.node_uid)?function(e){return window.TPROXY_ENABLED||p.hasOwnProperty(e)&&!p[e].is_readonly}(e.getFrameTreeNodeId(i.data.frame_token))?new Compositor.ShadowAnchorNode:null:function(e){return!(e.data.type!==Sk.HT.ElementType.kTextNode||e.data.flags&Sk.HT.ElementFlags.kInShadowTree||e.data.flags&Sk.HT.ElementFlags.kHasContentEditableOwner)}(i)&&f.hasOwnProperty(i.data.node_uid)?new Compositor.ShadowTextNode(e):function(e){return e.data.type===Sk.HT.ElementType.kImageElement}(i)&&f.hasOwnProperty(i.data.node_uid)?new Compositor.ShadowImageNode:null}(0,r)))return null;c[t]=i,d[o]||(d[o]={}),d[o][t]=1,i.node_uid=t,i.items=r,i.layer=n,i.init(r),i.getNode()&&i.getNode().parentNode,e.isDebugEnabled()&&(i.getNode().setAttribute("nuid",t),i.getNode().setAttribute("lid",n.getID()),i.getNode().setAttribute("item_count",r.length),r[0].data.debug_name&&i.getNode().setAttribute("debug",r[0].data.debug_name),i.getNode().setAttribute("blob_count",r[0].blobs.length)),(i.onBlurEvent||i.onFocusEvent)&&(i.focus_fn=C.curry(i,!0),i.blur_fn=C.curry(i,!1),EventListener.setListenersEnabled(!0,i.getNode(),["focus"],i.focus_fn),EventListener.setListenersEnabled(!0,i.getNode(),["blur"],i.blur_fn)),u.hasOwnProperty(o)&&i.onPointerEventsStatusChanged&&i.onPointerEventsStatusChanged(u[o])}return i.getNode(),function(e,t,r,n){e.getNode().parentNode&&e.layer&&e.items&&e.layer===r&&function(e,t){var r={};return e.length===t.length&&(e.forEach((function(e){var t=Compositor.ItemListConcatenator.itemToKey(e);r[t]=e})),t.every((function(e){var t,n=Compositor.ItemListConcatenator.itemToKey(e);return!!r.hasOwnProperty(n)&&(t=r[n],e.data.display_item_type===Sk.HT.DisplayItemType.kOther&&t.blobs.length===e.blobs.length&&t.data.text===e.data.text||(e.stringified||(e.stringified=JSON.stringify(e)),!(!t.stringified||t.stringified!==e.stringified)))})))}(e.items,t)||(e.getType()!==Sk.SE.Type.kShadowTextControl&&e.getType()!==Sk.SE.Type.kShadowSelect||R(t,e.hasBorderBoxRect())?(e.items=t,e.layer=r,e.update(t)):e.update(t))}(i,r,n),i}function E(r,n,i){var a,s,l,d,u=r.getDisplayList(),p=null,_=null;u&&(s=n?r.fromScreenSpaceRect(n):r.getBoundsRect())&&(p=r.getDisplayList().hitTestRect(s))&&p.getItemList().length&&(l=p.getItemList(),d=null,l.forEach((function(e){2===e.data.type&&(d&&(g=Math.max(g,Math.abs(Sk.Rect.getX(e.visual_rect)-Sk.Rect.getX(d.visual_rect))),m=Math.max(m,Math.abs(Sk.Rect.getY(e.visual_rect)-Sk.Rect.getY(d.visual_rect)))),d=e)})),a=p.getItemMap(),Util.forEachItem(c,(function(e,t){t.layer===r&&(!a.has(e)||function(e,t){return t&&Array.isArray(t),e.items&&Array.isArray(e.items),!(e.items.length>0&&t.length>0&&w(e.items)!==w(t))}(t,a.get(e))?a.has(e)&&Sk.Rect.intersects(t.items[0].visual_rect,s)||y(e):h(e))})),a.forEachEntryInOrder((function(n,o){if(Sk.Rect.intersects(o[0].visual_rect,s)){i&&(f[n]=!0);var a=T(n,o,r);a&&(function(r,n){var i=null;b(r.items)?r.getNode().parentNode!==t&&t.appendChild(r.getNode()):r.getNode().parentNode!==r.layer.getElementsDiv()&&(i=n&&n.getNode().parentNode===r.layer.getElementsDiv()?n.getNode().nextSibling:r.layer.getElementsDiv().childNodes[0],r.layer.getElementsDiv().insertBefore(r.getNode(),i),e.callback.fire("added-shadow-element",r.node_uid,r.layer))}(a,_),_=a)}})),o.didUpdateProjection(r,s),o.didUpdateOpacity(r))}function A(e){return!!(e.data.flags&Sk.HT.ElementFlags.kBackgroundPaintInContentsSpace)}function R(e,t){var r,n;for(r=0;r<e.length;r+=1)if((n=e[r]).data.display_item_type===Sk.HT.DisplayItemType.kBoxDecorationBackground){if(t&&A(n))continue;return n}return null}function x(t,r,n){var i=e.getFrameToken(t),o=Sk.Util.getNodeKey(i,r),a=c[o];a&&a.setValue(n)}function D(t,r,n){var i=e.getFrameToken(t),o=Sk.Util.getNodeKey(i,r),a=c[o];a&&a.setCaretPos(n)}function I(e,t){u[e]=t,d.hasOwnProperty(e)&&Util.forEachItem(d[e],(function(e,r){var n=c[e];n&&n.onPointerEventsStatusChanged&&n.onPointerEventsStatusChanged(t)}))}function O(){document.activeElement&&document.activeElement.hasAttribute("sv-focus-placeholder")&&(document.activeElement,r.blur())}function U(){BrowserDetect.isMobileSafari()&&r&&O()}o.deleteShadowElement=function(e){e.getNodeUid&&h(e.getNodeUid())},o.setNoPendingRemoval=function(e){s=e},o.getMaxSelectionChangeDelta=function(){return{x:g,y:m}},o.didUpdateDisplayList=function(e){E(e)},o.didRemoveLayer=function(e){Util.forEachItem(c,(function(t,r){r.layer===e&&y(t)}))},o.hitUnlockAll=function(e){f={},Util.forEachItem(c,(function(t,r){w(r.items)||e&&t===e||h(t)}))},o.hitLock=function(e,t){var r=o.findElement(e);return f[e]=!0,r||(E(t),r=o.findElement(e)),r},o.hitUnlock=function(e){f.hasOwnProperty(e)&&delete f[e]},o.hitLockAllTextNodes=function(t){var r=e.getMainFrame().getLayerTree();t&&r&&r.getRoot()&&r.getRoot().walkDepthFirstIterative((function(e){E(e,t,!0)}))},o.findElement=function(e){return e?c[e]:null},o.forEachShadowElement=function(e){Util.forEachItem(c,e)},o.didUpdateProjection=function(e,t){void 0===t&&(t=e.getBoundsRect()),Util.forEachItem(c,(function(r,n){var i,o,s;n.layer!==e||void 0!==t&&!Sk.Rect.intersects(n.items[0].visual_rect,t)||(n.updateProjection?n.updateProjection(n.layer,n.items):(o=R(n.items))?(n.items,i=n.getNode(),s=o.border_box_rect||o.visual_rect,b(n.items)&&(n.layer.isFixedToViewport()?i.style.position="fixed":i.style.position="absolute"),n.setHasBorderBoxRect&&n.setHasBorderBoxRect(),Sk.Rect.toCSSStyle(s,i.style),n.layer.applyDrawTransform(i,s)):a.error({event:"missing-box-item",se_type:n.getType(),se_node:n.getNode()}))}))},o.didUpdateOpacity=function(e){Util.forEachItem(c,(function(t,r){r.layer===e&&(r.updateOpacity?r.updateOpacity(r.layer,r.items):r.layer.applyDrawOpacity(r.getNode()))}))},o.registerUserInitiatedFocusIfNeeded=function(n){var i;return!(!e.getConfig().useFocusPlaceholder()||e.isFullscreen()||(r||(r=function(){var r;return BrowserDetect.isMobileSafari()?((r=document.createElement("input")).setAttribute("type","text"),r.setAttribute("readonly","1"),r.setAttribute("class","sv-focus-placeholder"),r.setAttribute("sv-focus-placeholder",1),e.isDebugEnabled()&&(r.id="sv-focus-placeholder"),r.style.position="absolute",r.style.caretColor="transparent",r.style.opacity="0",r.style.height="0px",r.style.width="0px",r.style.left="-1000px",r.style.top="-1000px",r.style.fontSize="20px",r.style.margin="0px",r.style.padding="0px",r.style.borderRadius="0px",r.style.webkitAppearance="none",r.style.outline="none",r.style.borderColor="rgba(0,0,0,0)",r.style.backgroundColor="rgba(0,0,0,0)",r.style.userSelect="auto",r.style.webkitUserSelect="auto",t.appendChild(r),r):null}()),o.findElement(n.hit_node_uid)||(i=n.touches[0].start_pos,r.style.left=i.x+"px",r.style.top=i.y+"px",r.focus(),0)))},o.transferFocusTo=function(e){var t=o.findElement(e);t&&t.getType()===Sk.SE.Type.kShadowTextControl?t.getNode().focus():O(),r.style.left="-1000px",r.style.top="-1000px"},o.unregisterSurface=function(e){delete u[e]},o.release=function(){e.callback.deregister("input-value-changed",x),e.callback.deregister("input-caret-changed",D),e.callback.deregister("pointer-events-status-changed",I),safeview.callback.deregister("will-request-fullscreen",U),t&&t.parentNode&&(t.parentNode.removeChild(t),t=null)},e.callback.register("input-value-changed",x),e.callback.register("input-caret-changed",D),e.callback.register("pointer-events-status-changed",I),safeview.callback.register("will-request-fullscreen",U),safeview.interp.registerOpcodeHandler(safeview.interp.OPCODES.REMOTING_V2_SET_READONLY_EXCEPTION,(function(t,r,n){var i=e.getFrameToken(t),a=Sk.Util.getNodeKey(i,r),s=o.findElement(a);s&&s.setForceReadOnly&&(s.setForceReadOnly(!n),s.isFocused&&s.isFocused()&&s.getNode()&&(BrowserDetect.isMobileSafari()?s.getNode().blur():s.getNode().focus()))})),safeview.interp.deregisterOpcodeHandler(safeview.interp.OPCODES.READONLY_STATUS_CHANGED),safeview.interp.registerOpcodeHandler(safeview.interp.OPCODES.READONLY_STATUS_CHANGED,(function(e,t,r,n,i){p.hasOwnProperty(e)&&r!==p[e].is_readonly&&o.forEachShadowElement((function(t,n){n.setForceReadOnly&&n.getFid&&n.getFid()===e&&n.setForceReadOnly(r)})),p[e]={},p[e].is_readonly=r,p[e].has_exception=i,safeview.callback.fire("enable_readonly_bar",r,n),_.hasOwnProperty(e)&&(_[e].forEach((function(e){v(e),k(e)})),delete _[e])})),safeview.interp.registerOpcodeHandler("datetime-chooser",(function(){})),i=document.createElement("div"),e.isDebugEnabled()&&(i.id="sv-shadow-elements"),i.position="absolute",i.style.margin="0px",i.style.padding="0px",i.style.left=i.style.top="0px",i.style.width=i.style.height="0px",i.style.overflow="visible",t=i,document.body.appendChild(t)},Compositor.ShadowImageNode=function(){var e,t=this;t.onPointerEventsStatusChanged=function(t){e.style.pointerEvents=t?"none":"auto"},t.getType=function(){return Sk.SE.Type.kShadowImageNode},t.release=function(){e=null},t.update=function(r){var n,i=r[0];i.data.type,Sk.HT.ElementType.kImageElement,(n=i.image_src)||(n=t.layer.getDisplayList().getImageForItem(i)),n!==e.src&&e.setAttribute("src",n)},t.updateProjection=function(t,r){var n,i=Sk.Rect.makeEmpty();for(n=0;n<r.length;n+=1)Sk.Rect.join(i,r[n].canvas_bounds);Sk.Rect.toCSSStyle(i,e.style),t.applyDrawTransform(e,i)},t.getNode=function(){return e},t.updateOpacity=function(e,t){},t.init=function(t){var r=t[0];r.data.type,Sk.HT.ElementType.kImageElement,e=function(e){var t=new Image;return e.image_src&&(Util.requiresCofRequest(e.image_src)?safeview.xbrowser.createBlobSrc(e.image_src).catch((function(){return e.image_src})).then((function(e){t.setAttribute("src",e)})):t.setAttribute("src",e.image_src)),t.style.position="absolute",t.style.opacity="0",t.style.margin=t.style.padding="0px",t}(r)}},Compositor.ShadowSelect=function(e,t,r){var n,i=this,o=new Logger("shadow-select",{level:"info"}),a=!1,s=!1,l=!1;function c(r){var n,i=r.target.value;if(r.target.multiple,r.target.multiple)return n=Array.from(r.target.selectedOptions).map((function(e){return Number(e.value)})),void safeview.sendCommand(["CM-select",e,t,n]);safeview.sendCommand(["CM-select",e,t,Number(i)])}i.setHasBorderBoxRect=function(){l=!0},i.hasBorderBoxRect=function(){return l},i.onPointerEventsStatusChanged=function(e){n.style.pointerEvents=e?"none":"auto"},i.getType=function(){return Sk.SE.Type.kShadowSelect},i.release=function(){EventListener.setListenersEnabled(!1,n,["change"],c),n=null},i.update=function(e){var t=e[0].data.formctrl.flags;s=!!(t&Sk.HT.FormControlElement.Flags.kDisabled),a||s?n.setAttribute("disabled","1"):n.removeAttribute("disabled"),Compositor.FormCtrlUtils.setAutoFillAttrs(n,e[0].data.formctrl)},i.getNode=function(){return n},i.setForceReadOnly=function(e){a=e,n&&(a||s?n.setAttribute("disabled","1"):n.removeAttribute("disabled"))},i.getFid=function(){return e},i.getNodeId=function(){return t},i.getNodeUid=function(){return r},i.updateOpacity=function(e,t){},i.init=function(e){var t,r,i,a,s,l=e[0].data.formctrl;t=l.select.items,r=l.select.flags,(i=document.createElement("select")).setAttribute("sv-prevent-push",!0),i.style.position="absolute",i.style.opacity="0",i.style.margin=i.style.padding="0px",i.style.cursor="inherit",i.style.fontSize="20px",i.style.width=i.style.height="0px",BrowserDetect.isSafari()&&(i.style.webkitAppearance="none"),r&Sk.HT.SelectElement.Flags.kUsesMenuList||(i.multiple=!0),s=null,t.forEach((function(e){switch(e.type){case Sk.HT.SelectItem.Type.kSeparator:(a=document.createElement("option")).textContent="-----",a.setAttribute("disabled",!0),i.appendChild(a),s=null;break;case Sk.HT.SelectItem.Type.kGroup:(a=document.createElement("optgroup")).setAttribute("label",e.label),i.appendChild(a),s=a;break;case Sk.HT.SelectItem.Type.kOption:(a=document.createElement("option")).textContent=e.label,a.setAttribute("value",e.index),e.flags&Sk.HT.SelectItem.Flags.kChecked&&a.setAttribute("selected",!0),e.flags&Sk.HT.SelectItem.Flags.kEnabled||a.setAttribute("disabled",!0),e.flags&Sk.HT.SelectItem.Flags.kHidden&&(a.setAttribute("hidden",!0),a.style.display="none",a.style.visibility="hidden"),e.flags&Sk.HT.SelectItem.Flags.kInGroup?s.appendChild(a):(s=null,i.appendChild(a));break;default:o.error({event:"tc-unrecognized-select-item-type",type:e.type})}})),EventListener.setListenersEnabled(!0,i,["change"],c),n=i}},Compositor.FormCtrlUtils=function(){var e={};function t(e,t){var r;if(e.input){switch(e.input.type){case Sk.HT.InputElement.Type.kNumber:r="number";break;case Sk.HT.InputElement.Type.kEmail:r="email";break;case Sk.HT.InputElement.Type.kPassword:r="password";break;case Sk.HT.InputElement.Type.kSearch:r="search";break;case Sk.HT.InputElement.Type.kTel:r="tel";break;case Sk.HT.InputElement.Type.kDate:r="date";break;case Sk.HT.InputElement.Type.kDatetimeLocal:r="datetime-local";break;case Sk.HT.InputElement.Type.kMonth:r="month";break;case Sk.HT.InputElement.Type.kTime:r="time";break;case Sk.HT.InputElement.Type.kWeek:r="week";break;case Sk.HT.InputElement.Type.kColor:r="color";break;default:r="text"}t.setAttribute("type",r)}}return e.setAutoFillAttrs=function(e,r){if(window.TPROXY_ENABLED)r.id_attr&&e.setAttribute("id",r.id_attr),r.name_attr&&e.setAttribute("name",r.name_attr),r.autocomplete_attr&&e.setAttribute("autocomplete",r.autocomplete_attr),t(r,e);else{if(e.setAttribute("autocomplete","off"),!r.input)return;r.input.type===Sk.HT.InputElement.Type.kPassword?(e.setAttribute("type","url"),BrowserDetect.isChrome()&&(e.style.caretColor=Sk.Paint.skColorToCSSColor(r.color)),e.style.fontFamily="Menlo-Password"):r.input.type!==Sk.HT.InputElement.Type.kEmail&&t(r,e)}},e.populateBaseTemporalProperties=function(e,t){var r=t.input;window.Date&&r&&r.flags&Sk.HT.InputElement.Flags.kIsBaseTemporal&&(e.setAttribute("sv-base-temporal",!0),["min","max"].forEach((function(t){var n,i=r[t];i&&!isNaN(i)&&(n=new Date(i),e.setAttribute(t,n.toISOString().slice(0,16)))})),function(e,t){var r,n,i=e.input,o=i.value;switch(i.flags,Sk.HT.InputElement.Flags.kIsBaseTemporal,r=isNaN(o)?new Date:new Date(o),i.type){case Sk.HT.InputElement.Type.kDate:n=r.toISOString().slice(0,10);break;case Sk.HT.InputElement.Type.kDatetimeLocal:n=r.toISOString().slice(0,16);break;case Sk.HT.InputElement.Type.kMonth:n=r.toISOString().slice(0,7);break;case Sk.HT.InputElement.Type.kTime:n=r.toTimeString().slice(0,5);break;case Sk.HT.InputElement.Type.kWeek:n=r.toISOString().slice(0,16);break;default:n=""}t.setAttribute("value",n)}(t,e))},e}(),Compositor.ShadowTextControl=function(e,t,r,n){var i,o,a,s,l=this,c=null,d=!1,u=!1,f=!1,p=!1,g=!1,m=!1;function _(){return a.type===Sk.HT.FormControlElement.Type.kContentEditable}function h(){return a.type===Sk.HT.FormControlElement.Type.kInput}function y(){return h()&&a.input.type===Sk.HT.InputElement.Type.kColor}function v(){return i.hasAttribute("sv-base-temporal")}function k(){return h()}function S(r){safeview.sendCommand([r,e,t,i.value])}function b(){var e;return!!h()||!!a.enterkeyhint_attr||a.type===Sk.HT.FormControlElement.Type.kTextArea&&1===(e=a.textarea).rows&&e.flags&Sk.HT.TextAreaElement.Flags.kHasFormOwner&&BrowserDetect.isMobileSafari()&&!BrowserDetect.isMobileSafariOnIPhone()}function w(){k(),i.style.opacity="0"}function C(e){return BrowserDetect.isMobile()&&!v()?Math.max(16,e):e}function T(){i.style.color=d?Sk.Paint.skColorToCSSColor(a.color):"rgba(0,0,0,0)",Compositor.FormCtrlUtils.setAutoFillAttrs(i,a)}function E(){var t,r;r=null,a.input&&a.input.data_list&&(r=a.input.data_list),r!==c&&(s&&(s.parentNode,i.removeAttribute("list"),i.removeChild(s),s=null),a.input.flags&Sk.HT.InputElement.Flags.kHasDataList?(s=document.createElement("datalist"),i.appendChild(s),(c=a.input.data_list).options.forEach((function(e){var t=e.flags,r=document.createElement("option");t&Sk.HT.DataListOptionItem.Flags.kDisabled&&r.setAttribute("disabled",!0),t&Sk.HT.DataListOptionItem.Flags.kHasValue&&r.setAttribute("value",e.value),s.appendChild(r)})),t=e+":"+c.node_id,s.setAttribute("id",t),i.setAttribute("list",t)):c=null)}function A(e){k()&&d!==e&&(d=e,e?Sk.focusedElementInfoByNodeId[r]={type:i.getAttribute("type")}:delete Sk.focusedElementInfoByNodeId[r],T(),l.layer&&l.layer.getTilingSet()&&l.layer.getTilingSet().invalidateRect(l.layer.getBoundsRect()))}l.getType=function(){return Sk.SE.Type.kShadowTextControl},l.setHasBorderBoxRect=function(){m=!0},l.hasBorderBoxRect=function(){return m},l.setValue=function(e){i.value!==e&&(i.value=e)},l.setCaretPos=function(e){try{i.selectionStart=e.start,i.selectionEnd=e.end}catch(e){i.getAttribute("type")}},l.processPointerEvent=function(e){return _()&&(i.value=""),!k()&&BrowserDetect.isMobileSafari()&&"1"!==i.style.opacity&&(safeview.callback.registerOneShot("visual-viewport-changed",0,{on_success:w}),i.style.opacity="1"),!(k()&&u)},l.processInputEvent=function(r){switch(r.type,r.data,i.value,i.selectionStart,r.target,r.target.localName,r.target.id,r.target.getAttribute&&r.target.getAttribute("nid"),r.type){case"beforeinput":o=i.value;break;case"input":_()?function(){var r,n,a,s=0;if((r=i.value)!==o){for(;s<r.length&&s<o.length&&r[s]===o[s];)s+=1;for(n=o.length-s,a=r.substring(s),s=0;s<n;s+=1)safeview.sendCommand(["kbd",safeview.fid||0,0,"keydown",8,8,"Backspace","Backspace",!1,!1,!1,!1,0,!1]),safeview.sendCommand(["kbd",safeview.fid||0,0,"keyup",8,8,"Backspace","Backspace",!1,!1,!1,!1,0,!1]);safeview.sendCommand(["mi-editable",e,t,n,a,g])}}():v()?safeview.sendCommand(["input",e,t,i.value]):y()?S(r.type):(null===i.selectionStart?(i.getAttribute("type"),n=a=-1):(n=i.selectionStart,a=i.selectionEnd),safeview.sendCommand(["mi-simpleinput",e,t,i.value,n,a,g]));break;case"change":y()&&S(r.type);break;case"keydown":case"keyup":!function(t){var r=new KeyMap;"Enter"===t.key&&b()?safeview.sendCommand(["kbd",e||0,0,t.type,13,13,t.key,r.getCode(t),!1,!1,!1,!1,0,!1]):("Backspace"===t.key&&_()&&""===i.value&&safeview.sendCommand(["kbd",e,0,t.type,8,8,t.key,r.getCode(t),!1,!1,!1,!1,0,!1]),g=!("keyup"===t.type))}(r)}var n,a},l.update=function(e){var t,r,n,o,s;r=!!((t=(a=e[0].data.formctrl).flags)&Sk.HT.FormControlElement.Flags.kDisabled),p=!!(t&Sk.HT.FormControlElement.Flags.kReadOnly),n=f||p,o=!!(t&Sk.HT.FormControlElement.Flags.kAutoCapitalize),s=!!(t&Sk.HT.FormControlElement.Flags.kHasEnterKeyHint),Sk.Font.applyFontStyle(i,a,C(a.font_size),C(a.font_size),a.typeface_id,l.layer.getLayerTreeHost().getFid()),T(),E(),i.style.padding="0px",i.style.paddingLeft=a.padding_left+"px",i.style.paddingTop=a.padding_top+"px",i.style.paddingRight=a.padding_right+"px",i.style.paddingBottom=a.padding_bottom+"px",i.style.borderLeftWidth=a.border_width_left+"px",i.style.borderTopWidth=a.border_width_top+"px",i.style.borderRightWidth=a.border_width_right+"px",i.style.borderBottomWidth=a.border_width_bottom+"px",i.style.textIndent=a.text_indent+"px",i.style.textAlign=Sk.Util.skTextAlignToCSSTextAlign(a.text_align),a.flags&Sk.HT.FormControlElement.Flags.kRightToLeft&&(i.style.direction="rtl"),i.style.boxSizing="border-box",r?i.setAttribute("disabled","1"):i.removeAttribute("disabled"),n?i.setAttribute("readonly","1"):i.removeAttribute("readonly"),o?i.setAttribute("autocapitalize","on"):i.removeAttribute("autocapitalize"),s?i.setAttribute("enterkeyhint",a.enterkeyhint_attr):i.removeAttribute("enterkeyhint"),i.setAttribute("spellcheck","false"),i.setAttribute("custom_formctrl_flags",t),Compositor.FormCtrlUtils.setAutoFillAttrs(i,a),Compositor.FormCtrlUtils.populateBaseTemporalProperties(i,a),y()&&i.setAttribute("value",Sk.Paint.skColorToHexadecimalColor(a.input.color))},l.onFocusEvent=function(e){A(!0),i.focus(),u=!0},l.onBlurEvent=function(e){A(!1),_()&&(i.value=""),u=!1},l.release=function(){A(!1),i=null,_()||null===e||safeview.sendCommand(["mi-unregister",e,t])},l.onPointerEventsStatusChanged=function(e){i.style.pointerEvents=e?"none":"auto"},l.getNode=function(){return i},l.showRemoteCaret=function(){return!k()},l.isFocused=function(){return u},l.setForceReadOnly=function(e){f=e,i&&(f||p?i.setAttribute("readonly","1"):i.removeAttribute("readonly"))},l.getFid=function(){return e},l.getNodeId=function(){return t},l.getNodeUid=function(){return r},l.updateOpacity=function(e,t){k()&&e.applyDrawOpacity(i)},l.init=function(r){(function(e){e.input?i=document.createElement("input"):(e.textarea||e.contenteditable)&&(i=document.createElement("textarea")),i.style.position="absolute",k()||(i.style.caretColor="transparent",i.style.opacity="0"),i.style.left=i.style.top="0px",i.style.width=i.style.height="0px",i.style.fontSize="20px",i.style.margin=i.style.padding="0px",i.style.borderRadius="0px",i.style.webkitAppearance="none",i.style.outline="none",i.style.borderColor="rgba(0,0,0,0)",i.style.backgroundColor="rgba(0,0,0,0)",i.style.userSelect="auto",i.style.webkitUserSelect="auto",i.setAttribute("sv-prevent-push",!0)})(a=r[0].data.formctrl),n&&(n.value&&l.setValue(n.value),n.caret_pos&&l.setCaretPos(n.caret_pos)),_()||safeview.sendCommand(["mi-register",e,t])}},Compositor.ShadowTextNode=function(e){var t,r=this,n=new Logger("stn",{level:"info"});function i(e,t){var r=document.createElement("span");return r.textContent=e,r.style.padding="0px",r.style.margin="0px",r.style.fontSize=t+"px",r.style.userSelect="text",r.style.webkitUserSelect="text",BrowserDetect.isMobileSafari()||(r.style.display="inline-block",r.style.verticalAlign="text-bottom"," "===e&&(r.innerHTML="&nbsp")),r}function o(e,t){for(var r=0;t<e.length&&""===e[t].trim();)t+=1,r+=1;return r}function a(e,t,r){for(var n=Math.ceil(r/t);t>1;)e.appendChild(i(" ",n)),r-=n,t-=1;e.appendChild(i(" ",r))}function s(t,r,n,s,l,c,d){var u,f,p,g=function(t){var r=document.createElement("div");return r.style.position="absolute",e.isDebugEnabled()&&(r.id="blob-div-"+t.data.node_uid),r.style.padding="0px",r.style.margin="0px",r.style.color="rgba(0,0,0,0)",r.style.fontFamily="Menlo-Square",r.style.userSelect="auto",r.style.webkitUserSelect="auto",r.style.whiteSpace="pre",r}(t),m=n,_=Sk.Rect.getTop(t.data.box_rect),h=n,y=Sk.Rect.getBottom(t.data.box_rect),v=new Sk.TextBlobIterator,k=0,S=t.data.text,b=0;return s.runs.length,v.forEachRun(s,null,(function(e,t,s){var d=t.paint.textSize/Sk.Paint.kCanonicalTextSizeForPaths;k=Math.max(k,t.paint.textSize),e.forEachGlyph(t,l,c,(function(e,t,s){var l=S[r],c=Sk.Rect.roundOut0(Sk.Rect.scale(e.bounds,d)),u=Math.floor(t)-n;0!==(b=o(S,r))&&(a(g,b,u),n+=u,u=0,r+=b),(l=S[r])&&(u+=Sk.Rect.getX(c)+Sk.Rect.getWidth(c),g.appendChild(i(l,u)),n+=u,r+=1),m=Math.min(m,Math.floor(t)),_=Math.min(_,Math.floor(s)+Sk.Rect.getY(c)),h=Math.max(h,n),y=Math.max(y,Math.floor(s)+Sk.Rect.getY(c)+Sk.Rect.getHeight(c))}))})),r!==S.length&&0!==(b=o(S,r))&&b===S.length-r&&(a(g,b,Sk.Rect.getRight(t.data.box_rect)-n),n=Sk.Rect.getRight(t.data.box_rect),r=S.length),r===S.length&&(h=Math.max(h,Sk.Rect.getRight(t.data.box_rect))),u=Sk.Matrix.mapRect(d,Sk.Rect.fromLTRB(m,_,h,y)),f=Sk.Rect.makeCopy(u),Sk.Rect.translate(f,-Sk.Rect.getX(t.canvas_bounds),-Sk.Rect.getY(t.canvas_bounds)),Sk.Rect.toCSSStyle(f,g.style),p=y-_,g.style.fontSize=p+"px",g.style.lineHeight=p+"px",g.style.paddingBottom="10vh",g.style.paddingRight="10vw",BrowserDetect.isSamsungBrowser()&&(g.style.lineHeight="normal",g.childNodes.forEach((function(e){var t=parseFloat(e.style.fontSize);t&&(e.style.minHeight=p+"px",e.style.transform="scaleY("+p/t+")",e.style.transformOrigin="0 0")}))),{char_index:r,sel_pos:n,node:g}}function l(r,i){var o;o=t.firstChild,r.forEach((function(r){var a,l=Compositor.ItemListConcatenator.itemToKey(r),c=0,d=Sk.Rect.getLeft(r.data.box_rect),u={};if(i[l])o=i[l].nextSibling;else if((a=document.createElement("div")).key=l,e.isDebugEnabled()&&(a.id="text-item-"+r.data.node_uid,r.data.debug_name&&a.setAttribute("debug",r.data.debug_name)),a.style.padding=a.style.margin="0px",a.style.position="absolute",function(e){return!(e.data.flags&Sk.HT.ElementFlags.kInShadowTree||!(e.data.flags&Sk.HT.ElementFlags.kSelectable))}(r)){if(!r.data.text)return n.error("no text for the text item available!"),void t.insertBefore(a,o);r.blobs.forEach((function(e){var t,n,i;if(c!==r.data.text.length){if(r.blobs.length>1){if(e.bounds||function(e){(new Sk.TextBlobIterator).forEachRun(e.blob,null,(function(t,r,n){var i=r.paint.textSize/Sk.Paint.kCanonicalTextSizeForPaths;!function(e,t,r,n,i){var o=r,a=r,s=n,l=n;e.forEachGlyph(t,r,n,(function(e,t,r){var n=Sk.Rect.roundOut0(Sk.Rect.scale(e.bounds,i)),c=Math.floor(t)+Sk.Rect.getX(n),d=Math.floor(r)+Sk.Rect.getY(n);o=Math.min(o,c),s=Math.min(s,d),a=Math.max(a,c+Sk.Rect.getWidth(n)),l=Math.max(l,d+Sk.Rect.getHeight(n))})),t.bounds=Sk.Rect.fromLTRB(o,s,a,l)}(t,r,e.x,e.y,i),e.bounds?e.bounds=Sk.Rect.join(e.bounds,r.bounds):e.bounds=Sk.Rect.makeCopy(r.bounds)}))}(e),i=Sk.Rect.toString(e.bounds),u.hasOwnProperty(i)&&(u[i].paint.strokeWidth!==e.paint.strokeWidth||u[i].ctm!==e.ctm))return;u[i]=e}(t=s(r,c,d,e.blob,e.x,e.y,e.ctm)).node&&(c=t.char_index,d=t.sel_pos,(n=document.createElement("div")).appendChild(t.node),a.appendChild(n))}})),t.insertBefore(a,o)}else t.insertBefore(a,o)}))}r.getType=function(){return Sk.SE.Type.kShadowTextNode},r.onPointerEventsStatusChanged=function(e){r.getNode().style.pointerEvents=e?"none":"auto"},r.release=function(){t.parentNode,t=null},r.update=function(e){var r={};!function(e,r){var n;for(e.forEach((function(e){var t=Compositor.ItemListConcatenator.itemToKey(e);r[t]=null})),n=t.firstChild;n;)n.key,r.hasOwnProperty(n.key)&&(r[n.key]=n),n=n.nextSibling}(e,r),function(e){var r,n;for(n=t.firstChild;n;)r=n.nextSibling,n.key,e.hasOwnProperty(n.key)||t.removeChild(n),n=r}(r),l(e,r)},r.updateProjection=function(e,r){var n,i;for(t.childNodes.length,r.length,n=0;n<r.length;n+=1)i=t.childNodes[n],Sk.Rect.toCSSStyle(r[n].canvas_bounds,i.style),e.applyDrawTransform(i,r[n].canvas_bounds)},r.updateOpacity=function(e,r){var n,i;for(t.childNodes.length,r.length,n=0;n<r.length;n+=1)i=t.childNodes[n],e.applyDrawOpacity(i)},r.getNode=function(){return t},r.init=function(e){t=document.createElement("div")}};
//# sourceMappingURL=thin-client-min.js.map